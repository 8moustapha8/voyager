/*
  MIT license
  from https://github.com/harthur/clusterfck
*/
!function(e,t){"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?module.exports=t():e.clusterfck=t()}(this,function(){var e=function(t,n){var r=e.resolve(t,n||"/"),i=e.modules[r];if(!i)throw new Error("Failed to resolve module "+t+", tried "+r);var a=i._cached?i._cached:i();return a};e.paths=[],e.modules={},e.extensions=[".js",".coffee"],e._core={assert:!0,events:!0,fs:!0,path:!0,vm:!0},e.resolve=function(){return function(t,n){function r(t){if(e.modules[t])return t;for(var n=0;n<e.extensions.length;n++){var r=e.extensions[n];if(e.modules[t+r])return t+r}}function i(t){t=t.replace(/\/+$/,"");var n=t+"/package.json";if(e.modules[n]){var i=e.modules[n](),a=i.browserify;if("object"==typeof a&&a.main){var s=r(o.resolve(t,a.main));if(s)return s}else if("string"==typeof a){var s=r(o.resolve(t,a));if(s)return s}else if(i.main){var s=r(o.resolve(t,i.main));if(s)return s}}return r(t+"/index")}function a(e,t){for(var n=s(t),a=0;a<n.length;a++){var o=n[a],u=r(o+"/"+e);if(u)return u;var l=i(o+"/"+e);if(l)return l}var u=r(e);return u?u:void 0}function s(e){var t;t="/"===e?[""]:o.normalize(e).split("/");for(var n=[],r=t.length-1;r>=0;r--)if("node_modules"!==t[r]){var i=t.slice(0,r+1).join("/")+"/node_modules";n.push(i)}return n}if(n||(n="/"),e._core[t])return t;var o=e.modules.path(),u=n||".";if(t.match(/^(?:\.\.?\/|\/)/)){var l=r(o.resolve(u,t))||i(o.resolve(u,t));if(l)return l}var c=a(t,u);if(c)return c;throw new Error("Cannot find module '"+t+"'")}}(),e.alias=function(n,r){var i=e.modules.path(),a=null;try{a=e.resolve(n+"/package.json","/")}catch(s){a=e.resolve(n,"/")}for(var o=i.dirname(a),u=t(e.modules),l=0;l<u.length;l++){var c=u[l];if(c.slice(0,o.length+1)===o+"/"){var f=c.slice(o.length);e.modules[r+f]=e.modules[o+f]}else c===o&&(e.modules[r]=e.modules[o])}},e.define=function(t,n){var r=e._core[t]?"":e.modules.path().dirname(t),i=function(t){return e(t,r)};i.resolve=function(t){return e.resolve(t,r)},i.modules=e.modules,i.define=e.define;var a={exports:{}};e.modules[t]=function(){return e.modules[t]._cached=a.exports,n.call(a.exports,i,a,a.exports,r,t),e.modules[t]._cached=a.exports,a.exports}};var t=Object.keys||function(e){var t=[];for(var n in e)t.push(n);return t};return"undefined"==typeof process&&(process={}),process.nextTick||(process.nextTick=function(e){setTimeout(e,0)}),process.title||(process.title="browser"),process.binding||(process.binding=function(t){if("evals"===t)return e("vm");throw new Error("No such module")}),process.cwd||(process.cwd=function(){return"."}),e.define("path",function(e,t,n){function r(e,t){for(var n=[],r=0;r<e.length;r++)t(e[r],r,e)&&n.push(e[r]);return n}function i(e,t){for(var n=0,r=e.length;r>=0;r--){var i=e[r];"."==i?e.splice(r,1):".."===i?(e.splice(r,1),n++):n&&(e.splice(r,1),n--)}if(t)for(;n--;n)e.unshift("..");return e}var a=/^(.+\/(?!$)|\/)?((?:.+?)?(\.[^.]*)?)$/;n.resolve=function(){for(var e="",t=!1,n=arguments.length;n>=-1&&!t;n--){var a=n>=0?arguments[n]:process.cwd();"string"==typeof a&&a&&(e=a+"/"+e,t="/"===a.charAt(0))}return e=i(r(e.split("/"),function(e){return!!e}),!t).join("/"),(t?"/":"")+e||"."},n.normalize=function(e){var t="/"===e.charAt(0),n="/"===e.slice(-1);return e=i(r(e.split("/"),function(e){return!!e}),!t).join("/"),e||t||(e="."),e&&n&&(e+="/"),(t?"/":"")+e},n.join=function(){var e=Array.prototype.slice.call(arguments,0);return n.normalize(r(e,function(e){return e&&"string"==typeof e}).join("/"))},n.dirname=function(e){var t=a.exec(e)[1]||"",n=!1;return t?1===t.length||n&&t.length<=3&&":"===t.charAt(1)?t:t.substring(0,t.length-1):"."},n.basename=function(e,t){var n=a.exec(e)[2]||"";return t&&n.substr(-1*t.length)===t&&(n=n.substr(0,n.length-t.length)),n},n.extname=function(e){return a.exec(e)[3]||""}}),e.define("/clusterfck.js",function(e,t){t.exports={hcluster:e("./hcluster"),kmeans:e("./kmeans")}}),e.define("/hcluster.js",function(e,t){var n=e("./distance"),r=function(e,t,n){this.distance=e,this.linkage=t,this.threshold=void 0==n?1/0:n};r.prototype={cluster:function(e,t,n){this.clusters=[],this.dists=[],this.mins=[],this.index=[];for(var r=0;r<e.length;r++){var i={value:e[r],key:r,index:r,size:1};this.clusters[r]=i,this.index[r]=i,this.dists[r]=[],this.mins[r]=0}for(var r=0;r<this.clusters.length;r++)for(var a=0;r>=a;a++){var s=r==a?1/0:this.distance(this.clusters[r].value,this.clusters[a].value);this.dists[r][a]=s,this.dists[a][r]=s,s<this.dists[r][this.mins[r]]&&(this.mins[r]=a)}for(var o=this.mergeClosest(),r=0;o;)n&&r++%t==0&&n(this.clusters),o=this.mergeClosest();return this.clusters.forEach(function(e){delete e.key,delete e.index}),this.clusters},mergeClosest:function(){for(var e=0,t=1/0,n=0;n<this.clusters.length;n++){var r=this.clusters[n].key,i=this.dists[r][this.mins[r]];t>i&&(e=r,t=i)}if(t>=this.threshold)return!1;var a=this.index[e],s=this.index[this.mins[e]],o={left:a,right:s,key:a.key,size:a.size+s.size};this.clusters[a.index]=o,this.clusters.splice(s.index,1),this.index[a.key]=o;for(var n=0;n<this.clusters.length;n++){var i,u=this.clusters[n];a.key==u.key?i=1/0:"single"==this.linkage?(i=this.dists[a.key][u.key],this.dists[a.key][u.key]>this.dists[s.key][u.key]&&(i=this.dists[s.key][u.key])):"complete"==this.linkage?(i=this.dists[a.key][u.key],this.dists[a.key][u.key]<this.dists[s.key][u.key]&&(i=this.dists[s.key][u.key])):i="average"==this.linkage?(this.dists[a.key][u.key]*a.size+this.dists[s.key][u.key]*s.size)/(a.size+s.size):this.distance(u.value,a.value),this.dists[a.key][u.key]=this.dists[u.key][a.key]=i}for(var n=0;n<this.clusters.length;n++){var l=this.clusters[n].key;if(this.mins[l]==a.key||this.mins[l]==s.key){for(var t=l,c=0;c<this.clusters.length;c++){var f=this.clusters[c].key;this.dists[l][f]<this.dists[l][t]&&(t=f)}this.mins[l]=t}this.clusters[n].index=n}return delete a.key,delete s.key,delete a.index,delete s.index,!0}};var i=function(e,t,i,a,s,o){t=t||"euclidean",i=i||"average","string"==typeof t&&(t=n[t]);var u=new r(t,i,a).cluster(e,s,o);return void 0===a?u[0]:u};t.exports=i}),e.define("/distance.js",function(e,t){t.exports={euclidean:function(e,t){for(var n=0,r=0;r<e.length;r++)n+=Math.pow(t[r]-e[r],2);return Math.sqrt(n)},manhattan:function(e,t){for(var n=0,r=0;r<e.length;r++)n+=Math.abs(t[r]-e[r]);return n},max:function(e,t){for(var n=0,r=0;r<e.length;r++)n=Math.max(n,Math.abs(t[r]-e[r]));return n}}}),e.define("/kmeans.js",function(e,t){function n(e,t){var n=e.slice(0);return n.sort(function(){return Math.round(Math.random())-.5}),n.slice(0,t)}function r(e,t,n){for(var r=1/0,i=0,a=0;a<t.length;a++){var s=n(e,t[a]);r>s&&(r=s,i=a)}return i}function i(e,t,i,s,o){i=i||"euclidean","string"==typeof i&&(i=a[i]);for(var u=n(e,t),l=new Array(e.length),c=new Array(t),f=0,d=!0;d;){for(var h=0;h<e.length;h++)l[h]=r(e[h],u,i);d=!1;for(var p=0;t>p;p++){var g=[];if(l.forEach(function(t,n){t==p&&g.push(e[n])}),g.length){for(var v=u[p],m=new Array(v.length),y=0;y<v.length;y++){for(var x=0,h=0;h<g.length;h++)x+=g[h][y];m[y]=x/g.length,m[y]!=v[y]&&(d=!0)}u[p]=m,c[p]=g}}o&&f++%s==0&&o(c)}return c}var a=e("./distance");t.exports=i}),e("/clusterfck")}),function(){function e(t,r){function a(e){if(a[e]!==v)return a[e];var t;if("bug-string-char-index"==e)t="a"!="a"[0];else if("json"==e)t=a("json-stringify")&&a("json-parse");else{var n,i='{"a":[1,true,false,null,"\\u0000\\b\\n\\f\\r\\t"]}';if("json-stringify"==e){var u=r.stringify,c="function"==typeof u&&x;if(c){(n=function(){return 1}).toJSON=n;try{c="0"===u(0)&&"0"===u(new s)&&'""'==u(new o)&&u(y)===v&&u(v)===v&&u()===v&&"1"===u(n)&&"[1]"==u([n])&&"[null]"==u([v])&&"null"==u(null)&&"[null,null,null]"==u([v,y,null])&&u({a:[n,!0,!1,null,"\x00\b\n\f\r	"]})==i&&"1"===u(null,n)&&"[\n 1,\n 2\n]"==u([1,2],null,1)&&'"-271821-04-20T00:00:00.000Z"'==u(new l(-864e13))&&'"+275760-09-13T00:00:00.000Z"'==u(new l(864e13))&&'"-000001-01-01T00:00:00.000Z"'==u(new l(-621987552e5))&&'"1969-12-31T23:59:59.999Z"'==u(new l(-1))}catch(f){c=!1}}t=c}if("json-parse"==e){var d=r.parse;if("function"==typeof d)try{if(0===d("0")&&!d(!1)){n=d(i);var h=5==n.a.length&&1===n.a[0];if(h){try{h=!d('"	"')}catch(f){}if(h)try{h=1!==d("01")}catch(f){}if(h)try{h=1!==d("1.")}catch(f){}}}}catch(f){h=!1}t=h}}return a[e]=!!t}t||(t=i.Object()),r||(r=i.Object());var s=t.Number||i.Number,o=t.String||i.String,u=t.Object||i.Object,l=t.Date||i.Date,c=t.SyntaxError||i.SyntaxError,f=t.TypeError||i.TypeError,d=t.Math||i.Math,h=t.JSON||i.JSON;"object"==typeof h&&h&&(r.stringify=h.stringify,r.parse=h.parse);var p,g,v,m=u.prototype,y=m.toString,x=new l(-0xc782b5b800cec);try{x=-109252==x.getUTCFullYear()&&0===x.getUTCMonth()&&1===x.getUTCDate()&&10==x.getUTCHours()&&37==x.getUTCMinutes()&&6==x.getUTCSeconds()&&708==x.getUTCMilliseconds()}catch(b){}var k="[object Function]",_="[object Date]",w="[object Number]",S="[object String]",O="[object Array]",A="[object Boolean]",T=a("bug-string-char-index");if(!x)var E=d.floor,M=[0,31,59,90,120,151,181,212,243,273,304,334],C=function(e,t){return M[t]+365*(e-1970)+E((e-1969+(t=+(t>1)))/4)-E((e-1901+t)/100)+E((e-1601+t)/400)};(p=m.hasOwnProperty)||(p=function(e){var t,n={};return(n.__proto__=null,n.__proto__={toString:1},n).toString!=y?p=function(e){var t=this.__proto__,n=e in(this.__proto__=null,this);return this.__proto__=t,n}:(t=n.constructor,p=function(e){var n=(this.constructor||t).prototype;return e in this&&!(e in n&&this[e]===n[e])}),n=null,p.call(this,e)}),g=function(e,t){var r,i,a,s=0;(r=function(){this.valueOf=0}).prototype.valueOf=0,i=new r;for(a in i)p.call(i,a)&&s++;return r=i=null,s?g=2==s?function(e,t){var n,r={},i=y.call(e)==k;for(n in e)i&&"prototype"==n||p.call(r,n)||!(r[n]=1)||!p.call(e,n)||t(n)}:function(e,t){var n,r,i=y.call(e)==k;for(n in e)i&&"prototype"==n||!p.call(e,n)||(r="constructor"===n)||t(n);(r||p.call(e,n="constructor"))&&t(n)}:(i=["valueOf","toString","toLocaleString","propertyIsEnumerable","isPrototypeOf","hasOwnProperty","constructor"],g=function(e,t){var r,a,s=y.call(e)==k,o=!s&&"function"!=typeof e.constructor&&n[typeof e.hasOwnProperty]&&e.hasOwnProperty||p;for(r in e)s&&"prototype"==r||!o.call(e,r)||t(r);for(a=i.length;r=i[--a];o.call(e,r)&&t(r));}),g(e,t)};var z={92:"\\\\",34:'\\"',8:"\\b",12:"\\f",10:"\\n",13:"\\r",9:"\\t"},L="000000",j=function(e,t){return(L+(t||0)).slice(-e)},P="\\u00",I=function(e){for(var t='"',n=0,r=e.length,i=!T||r>10,a=i&&(T?e.split(""):e);r>n;n++){var s=e.charCodeAt(n);switch(s){case 8:case 9:case 10:case 12:case 13:case 34:case 92:t+=z[s];break;default:if(32>s){t+=P+j(2,s.toString(16));break}t+=i?a[n]:e.charAt(n)}}return t+'"'},D=function(e,t,n,r,i,a,s,o){var u,l,c,d,h,m,x,b,k,T,M,z,L,P,W,R;o=o||0;try{u=t[e]}catch(N){}if("object"==typeof u&&u)if(l=y.call(u),l!=_||p.call(u,"toJSON"))"function"==typeof u.toJSON&&(l!=w&&l!=S&&l!=O||p.call(u,"toJSON"))&&(u=u.toJSON(e));else if(u>-1/0&&1/0>u){if(C){for(h=E(u/864e5),c=E(h/365.2425)+1970-1;C(c+1,0)<=h;c++);for(d=E((h-C(c,0))/30.42);C(c,d+1)<=h;d++);h=1+h-C(c,d),m=(u%864e5+864e5)%864e5,x=E(m/36e5)%24,b=E(m/6e4)%60,k=E(m/1e3)%60,T=m%1e3}else c=u.getUTCFullYear(),d=u.getUTCMonth(),h=u.getUTCDate(),x=u.getUTCHours(),b=u.getUTCMinutes(),k=u.getUTCSeconds(),T=u.getUTCMilliseconds();u=(0>=c||c>=1e4?(0>c?"-":"+")+j(6,0>c?-c:c):j(4,c))+"-"+j(2,d+1)+"-"+j(2,h)+"T"+j(2,x)+":"+j(2,b)+":"+j(2,k)+"."+j(3,T)+"Z"}else u=null;if(n&&(u=n.call(t,e,u)),null===u)return"null";if(l=y.call(u),l==A)return""+u;if(l==w)return u>-1/0&&1/0>u?""+u:"null";if(l==S)return I(""+u);if("object"==typeof u){for(P=s.length;P--;)if(s[P]===u)throw f();if(s.push(u),M=[],W=a,a+=i,l==O){var R,X=a.length;for(L=0,P=u.length;P>L;L++)z=D(L,u,n,r,i,a,s,o),R=z===v?"null":z,X+=R.length+(L>0?1:0),M.push(R);R=M.length?i&&X>o?"[\n"+a+M.join(",\n"+a)+"\n"+W+"]":"["+M.join(",")+"]":"[]"}else{var X=a.length,L=0;g(r||u,function(e){var t,l=D(e,u,n,r,i,a,s,o);l!==v&&(t=I(e)+":"+(i?" ":"")+l,X+=t.length+(L++>0?1:0),M.push(t))}),R=M.length?i&&X>o?"{\n"+a+M.join(",\n"+a)+"\n"+W+"}":"{"+M.join(",")+"}":"{}"}return s.pop(),R}};if(r.stringify=function(e,t,r,i){var a,s,o,u;if(n[typeof t]&&t)if((u=y.call(t))==k)s=t;else if(u==O){o={};for(var l,c=0,f=t.length;f>c;l=t[c++],u=y.call(l),(u==S||u==w)&&(o[l]=1));}if(r)if((u=y.call(r))==w){if((r-=r%1)>0)for(a="",r>10&&(r=10);a.length<r;a+=" ");}else u==S&&(a=r.length<=10?r:r.slice(0,10));return D("",(l={},l[""]=e,l),s,o,a,"",[],i)},r.compactStringify=function(e,t,n){return r.stringify(e,t,n,60)},!a("json-parse")){var W,R,N=o.fromCharCode,X={92:"\\",34:'"',47:"/",98:"\b",116:"	",110:"\n",102:"\f",114:"\r"},F=function(){throw W=R=null,c()},Y=function(){for(var e,t,n,r,i,a=R,s=a.length;s>W;)switch(i=a.charCodeAt(W)){case 9:case 10:case 13:case 32:W++;break;case 123:case 125:case 91:case 93:case 58:case 44:return e=T?a.charAt(W):a[W],W++,e;case 34:for(e="@",W++;s>W;)if(i=a.charCodeAt(W),32>i)F();else if(92==i)switch(i=a.charCodeAt(++W)){case 92:case 34:case 47:case 98:case 116:case 110:case 102:case 114:e+=X[i],W++;break;case 117:for(t=++W,n=W+4;n>W;W++)i=a.charCodeAt(W),i>=48&&57>=i||i>=97&&102>=i||i>=65&&70>=i||F();e+=N("0x"+a.slice(t,W));break;default:F()}else{if(34==i)break;for(i=a.charCodeAt(W),t=W;i>=32&&92!=i&&34!=i;)i=a.charCodeAt(++W);e+=a.slice(t,W)}if(34==a.charCodeAt(W))return W++,e;F();default:if(t=W,45==i&&(r=!0,i=a.charCodeAt(++W)),i>=48&&57>=i){for(48==i&&(i=a.charCodeAt(W+1),i>=48&&57>=i)&&F(),r=!1;s>W&&(i=a.charCodeAt(W),i>=48&&57>=i);W++);if(46==a.charCodeAt(W)){for(n=++W;s>n&&(i=a.charCodeAt(n),i>=48&&57>=i);n++);n==W&&F(),W=n}if(i=a.charCodeAt(W),101==i||69==i){for(i=a.charCodeAt(++W),(43==i||45==i)&&W++,n=W;s>n&&(i=a.charCodeAt(n),i>=48&&57>=i);n++);n==W&&F(),W=n}return+a.slice(t,W)}if(r&&F(),"true"==a.slice(W,W+4))return W+=4,!0;if("false"==a.slice(W,W+5))return W+=5,!1;if("null"==a.slice(W,W+4))return W+=4,null;F()}return"$"},q=function(e){var t,n;if("$"==e&&F(),"string"==typeof e){if("@"==(T?e.charAt(0):e[0]))return e.slice(1);if("["==e){for(t=[];e=Y(),"]"!=e;n||(n=!0))n&&(","==e?(e=Y(),"]"==e&&F()):F()),","==e&&F(),t.push(q(e));return t}if("{"==e){for(t={};e=Y(),"}"!=e;n||(n=!0))n&&(","==e?(e=Y(),"}"==e&&F()):F()),(","==e||"string"!=typeof e||"@"!=(T?e.charAt(0):e[0])||":"!=Y())&&F(),t[e.slice(1)]=q(Y());return t}F()}return e},H=function(e,t,n){var r=U(e,t,n);r===v?delete e[t]:e[t]=r},U=function(e,t,n){var r,i=e[t];if("object"==typeof i&&i)if(y.call(i)==O)for(r=i.length;r--;)H(i,r,n);else g(i,function(e){H(i,e,n)});return n.call(e,t,i)};r.parse=function(e,t){var n,r;return W=0,R=""+e,n=q(Y()),"$"!=Y()&&F(),W=R=null,t&&y.call(t)==k?U((r={},r[""]=n,r),"",t):n}}return r.runInContext=e,r}var t="function"==typeof define&&define.amd,n={"function":!0,object:!0},r=n[typeof exports]&&exports&&!exports.nodeType&&exports,i=n[typeof window]&&window||this,a=r&&n[typeof module]&&module&&!module.nodeType&&"object"==typeof global&&global;if(!a||a.global!==a&&a.window!==a&&a.self!==a||(i=a),r&&!t)e(i,r);else{var s=i.JSON,o=i.JSON3,u=!1,l=e(i,i.JSON3={noConflict:function(){return u||(u=!0,i.JSON=s,i.JSON3=o,s=o=null),l}});i.JSON={parse:l.parse,stringify:l.stringify}}t&&define(function(){return l})}.call(this),function(e){if("function"==typeof define&&define.amd)define(["d3","topojson"],e);else{var t="undefined"==typeof topojson?null:topojson;vg=e(d3,t)}}(function(e,t){function n(e){return e.replace(D,"$1\\'")}function r(e,t,n,r){for(arguments.length<3&&(n=0),arguments.length<4&&(r=e.length);r>n;){var i=n+r>>>1;P.cmp(e[i],t)<0?n=i+1:r=i}return n}function i(e,t,n){var r=0,i=e.split(W);return e=n?(i=i.reverse()).filter(function(e){return r+=e.length,t>=r}).reverse():i.filter(function(e){return r+=e.length,t>=r}),e.length?e.join("").trim():i[0].slice(0,t)}function a(e){P.config.isNode?process.stderr.write(e+"\n"):console.log(e)}function s(e){return e.__vgtree__=!0,e.nodes=function(){return o(this,[])},e}function o(e,t){var n,r=e.values,i=r?r.length:0;for(t.push(e),n=0;i>n;++n)o(r[n],t);return t}function u(e){var t,n,r=e;if(P.isArray(e))for(r=[],t=0,n=e.length;n>t;++t)r.push(u(e[t]));else if(P.isObject(e)){r={};for(t in e)r[t]=u(e[t])}return r}function l(e){return N.test(e)}function c(e){return 0===e.indexOf(X)}function f(t,n){return P.log("LOAD: "+t),d(t)?void e.xhr(t,function(e,t){t&&(t=t.responseText),n(e,t)}):void P.error("URL is not whitelisted: "+t)}function d(e){if(!P.config.domainWhiteList)return!0;var t=document.createElement("a");t.href=e;var n=t.hostname.toLowerCase();return window.location.hostname===n||P.config.domainWhiteList.some(function(e){var t=n.length-e.length;return e===n||t>1&&"."===n[t-1]&&n.lastIndexOf(e)===t})}function h(e,t){P.log("LOAD FILE: "+e);var n=e.indexOf(X);n>=0&&(e=e.slice(X.length)),require("fs").readFile(e,t)}function p(e,t){P.log("LOAD HTTP: "+e);var n=require("http").request(e,function(e){var n=0,r=new Buffer(parseInt(e.headers["content-length"],10));e.on("error",function(e){t(e,null)}),e.on("data",function(e){e.copy(r,n),n+=e.length}),e.on("end",function(){t(null,r)})});n.on("error",function(e){t(e)}),n.end()}function g(e,t,n){if(r=[],n&&t.length>1){for(var r,i,a,s=v(e.domain()),o=-1,u=t.length,l=(t[1]-t[0])/++n;++o<u;)for(i=n;--i>0;)(a=+t[o]-i*l)>=s[0]&&r.push(a);for(--o,i=0;++i<n&&(a=+t[o]+i*l)<s[1];)r.push(a)}return r}function v(e){var t=e[0],n=e[e.length-1];return n>t?[t,n]:[n,t]}function m(e){return e.rangeExtent?e.rangeExtent():v(e.range())}function y(e,t,n,r,i,a){i=Math.max(i,0)+a,("left"===e||"top"===e)&&(i*=-1),"top"===e||"bottom"===e?(P.extend(t.properties.enter,{x:n,y:{value:i}}),P.extend(t.properties.update,{x:r,y:{value:i},align:{value:"center"},baseline:{value:q[e]}})):(P.extend(t.properties.enter,{x:{value:i},y:n}),P.extend(t.properties.update,{x:{value:i},y:r,align:{value:Y[e]},baseline:{value:"middle"}}))}function x(e,t,n,r,i){var a="left"===e||"top"===e?-1:1;i=1/0===i?"top"===e||"bottom"===e?{group:"mark.group.height",mult:-a}:{group:"mark.group.width",mult:-a}:{value:a*i},"top"===e||"bottom"===e?(P.extend(t.properties.enter,{x:n,y:{value:0},y2:i}),P.extend(t.properties.update,{x:r,y:{value:0},y2:i}),P.extend(t.properties.exit,{x:r})):(P.extend(t.properties.enter,{x:{value:0},x2:i,y:n}),P.extend(t.properties.update,{x:{value:0},x2:i,y:r}),P.extend(t.properties.exit,{y:r}))}function b(e,t,n,r){var i=~~((n[0]+n[1])/2),a="top"===e||"left"===e?-1:1;"bottom"===e||"top"===e?P.extend(t.properties.update,{x:{value:i},y:{value:a*r},angle:{value:0}}):P.extend(t.properties.update,{x:{value:a*r},y:{value:i},angle:{value:-90}})}function k(e,t,n,r){var i;("top"===e||"left"===e)&&(r=-1*r),i="bottom"===e||"top"===e?"M"+n[0]+","+r+"V0H"+n[1]+"V"+r:"M"+r+","+n[0]+"H0V"+n[1]+"H"+r,t.properties.update.path={value:i}}function _(e,t,n){var r=n?{}:e,i=e.mark.def.offset,a=e.mark.def.orient,s=t.width,o=t.height;if(P.isArray(i)){var u=i[0],l=i[1];switch(a){case"left":r.x=-u,r.y=l;break;case"right":r.x=s+u,r.y=l;break;case"bottom":r.x=u,r.y=o+l;break;case"top":r.x=u,r.y=-l;break;default:r.x=u,r.y=l}}else switch(P.isObject(i)&&(i=-t.scales[i.scale](i.value)),a){case"left":r.x=-i,r.y=0;break;case"right":r.x=s+i,r.y=0;break;case"bottom":r.x=0,r.y=o+i;break;case"top":r.x=0,r.y=-i;break;default:r.x=0,r.y=0}n&&n.interpolate(e,r)}function w(){return{type:"rule",interactive:!1,key:"data",properties:{enter:{stroke:{value:P.config.axis.tickColor},strokeWidth:{value:P.config.axis.tickWidth},opacity:{value:1e-6}},exit:{opacity:{value:1e-6}},update:{opacity:{value:1}}}}}function S(){return{type:"text",interactive:!0,key:"data",properties:{enter:{fill:{value:P.config.axis.tickLabelColor},font:{value:P.config.axis.tickLabelFont},fontSize:{value:P.config.axis.tickLabelFontSize},opacity:{value:1e-6},text:{field:"label"}},exit:{opacity:{value:1e-6}},update:{opacity:{value:1}}}}}function O(){return{type:"text",interactive:!0,properties:{enter:{font:{value:P.config.axis.titleFont},fontSize:{value:P.config.axis.titleFontSize},fontWeight:{value:P.config.axis.titleFontWeight},fill:{value:P.config.axis.titleColor},align:{value:"center"},baseline:{value:"middle"},text:{field:"data"}},update:{}}}}function A(){return{type:"path",interactive:!1,properties:{enter:{x:{value:.5},y:{value:.5},stroke:{value:P.config.axis.axisColor},strokeWidth:{value:P.config.axis.axisWidth}},update:{}}}}function T(e,t,n){var r,i=n?{}:e,a=e.mark.def.offset,s=e.mark.def.orient,o=2*e.mark.def.padding,u=~~e.bounds.width()+(e.width?0:o),l=~~e.bounds.height()+(e.height?0:o);switch(i.x=.5,i.y=.5,i.width=u,i.height=l,!n&&t.bounds&&(t.bounds.delta=t.bounds.x2-t.width),s){case"left":r=t.bounds?t.bounds.x1:0,i.x+=r-a-u;break;case"right":r=t.width,t.bounds&&(r=n?t.width+t.bounds.delta:t.bounds.x2),i.x+=r+a}n&&n.interpolate(e,i),e.mark.def.properties.enter(e,t,n)}function E(e,t,n,r,i){var a=e.properties.enter,s=e.properties.update;t&&(a.size=s.size={scale:t.scaleName,field:"data"}),n&&(a.shape=s.shape={scale:n.scaleName,field:"data"}),r&&(a.fill=s.fill={scale:r.scaleName,field:"data"}),i&&(a.stroke=s.stroke={scale:i.scaleName,field:"data"})}function M(){var e=P.config.legend;return{type:"text",interactive:!1,key:"data",properties:{enter:{x:{value:0},y:{value:0},fill:{value:e.titleColor},font:{value:e.titleFont},fontSize:{value:e.titleFontSize},fontWeight:{value:e.titleFontWeight},baseline:{value:"top"},text:{field:"data"},opacity:{value:1e-6}},exit:{opacity:{value:1e-6}},update:{opacity:{value:1}}}}}function C(){var e=P.config.legend;return{type:"symbol",interactive:!1,key:"data",properties:{enter:{x:{field:"offset",mult:.5},y:{scale:"legend",field:"index"},shape:{value:e.symbolShape},size:{value:e.symbolSize},stroke:{value:e.symbolColor},strokeWidth:{value:e.symbolStrokeWidth},opacity:{value:1e-6}},exit:{opacity:{value:1e-6}},update:{x:{field:"offset",mult:.5},y:{scale:"legend",field:"index"},opacity:{value:1}}}}}function z(){var e=P.config.legend;return{type:"text",interactive:!1,key:"data",properties:{enter:{x:{field:"offset",offset:5},y:{scale:"legend",field:"index"},fill:{value:e.labelColor},font:{value:e.labelFont},fontSize:{value:e.labelFontSize},align:{value:e.labelAlign},baseline:{value:e.labelBaseline},text:{field:"label"},opacity:{value:1e-6}},exit:{opacity:{value:1e-6}},update:{opacity:{value:1},x:{field:"offset",offset:5},y:{scale:"legend",field:"index"}}}}}function L(){var e=P.config.legend;return{type:"rect",interactive:!1,properties:{enter:{x:{value:0},y:{value:0},width:{value:e.gradientWidth},height:{value:e.gradientHeight},stroke:{value:e.gradientStrokeColor},strokeWidth:{value:e.gradientStrokeWidth},opacity:{value:1e-6}},exit:{opacity:{value:1e-6}},update:{x:{value:0},y:{value:0},opacity:{value:1}}}}}function j(){var e=P.config.legend;return{type:"text",interactive:!1,key:"data",properties:{enter:{x:{scale:"legend",field:"data"},y:{value:20},dy:{value:2},fill:{value:e.labelColor},font:{value:e.labelFont},fontSize:{value:e.labelFontSize},align:{field:"align"},baseline:{value:"top"},text:{field:"label"},opacity:{value:1e-6}},exit:{opacity:{value:1e-6}},update:{x:{scale:"legend",field:"data"},y:{value:20},opacity:{value:1}}}}}var P={version:"1.4.4",d3:e,topojson:t},I=Object.prototype.toString;P.isObject=function(e){return e===Object(e)},P.isFunction=function(e){return"[object Function]"==I.call(e)},P.isString=function(e){return"[object String]"==I.call(e)},P.isArray=Array.isArray||function(e){return"[object Array]"==I.call(e)},P.isNumber=function(e){return"[object Number]"==I.call(e)},P.isBoolean=function(e){return"[object Boolean]"==I.call(e)},P.isTree=function(e){return e&&e.__vgtree__},P.tree=function(e,t){var n=[e];return n.__vgtree__=!0,n.children=t||"children",n},P.number=function(e){return+e},P.boolean=function(e){return!!e},P.identity=function(e){return e},P.true=function(){return!0},P.extend=function(e){for(var t,n,r=1,i=arguments.length;i>r;++r){t=arguments[r];for(n in t)e[n]=t[n]}return e},P.duplicate=function(e){return JSON.parse(JSON.stringify(e))},P.field=function(e){return e.split("\\.").map(function(e){return e.split(".")}).reduce(function(e,t){return e.length&&(e[e.length-1]+="."+t.shift()),e.push.apply(e,t),e},[])},P.accessor=function(e){var t;return P.isFunction(e)||null==e?e:P.isString(e)&&(t=P.field(e)).length>1?function(e){return t.reduce(function(e,t){return e[t]},e)}:function(t){return t[e]}},P.mutator=function(e){var t;return P.isString(e)&&(t=P.field(e)).length>1?function(e,n){for(var r=0;r<t.length-1;++r)e=e[t[r]];e[t[r]]=n}:function(t,n){t[e]=n}},P.comparator=function(e){var t=[];return void 0===e&&(e=[]),e=P.array(e).map(function(e){var n=1;return"-"===e[0]?(n=-1,e=e.slice(1)):"+"===e[0]&&(n=1,e=e.slice(1)),t.push(n),P.accessor(e)}),function(n,r){var i,a,s,o,u;for(i=0,a=e.length;a>i;++i){if(s=e[i],o=s(n),u=s(r),u>o)return-1*t[i];if(o>u)return t[i]}return 0}},P.cmp=function(e,t){return t>e?-1:e>t?1:e>=t?0:0/0},P.numcmp=function(e,t){return e-t},P.array=function(e){return null!=e?P.isArray(e)?e:[e]:[]},P.values=function(e){return P.isObject(e)&&!P.isArray(e)&&e.values?e.values:e},P.str=function(e){return P.isArray(e)?"["+e.map(P.str)+"]":P.isObject(e)?JSON.stringify(e):P.isString(e)?"'"+n(e)+"'":e};var D=/(^|[^\\])'/g;P.keys=function(e){var t=[];for(var n in e)t.push(n);return t},P.unique=function(e,t,n){if(!P.isArray(e)||0==e.length)return[];t=t||P.identity,n=n||[];for(var r,i=0,a=e.length;a>i;++i)r=t(e[i]),n.indexOf(r)<0&&n.push(r);return n},P.minIndex=function(e,t){if(!P.isArray(e)||0==e.length)return-1;t=t||P.identity;for(var n=0,r=t(e[0]),i=r,a=1,s=e.length;s>a;++a)i=t(e[a]),r>i&&(r=i,n=a);return n},P.maxIndex=function(e,t){if(!P.isArray(e)||0==e.length)return-1;t=t||P.identity;for(var n=0,r=t(e[0]),i=r,a=1,s=e.length;s>a;++a)i=t(e[a]),i>r&&(r=i,n=a);return n},P.bins=function(e){e=e||{};var t,n,i,a,s=e.maxbins||1024,o=e.base||10,u=e.div||[5,2],l=e.minstep||0,c=Math.log(o),f=Math.ceil(Math.log(s)/c),d=e.min,h=e.max,p=h-d,g=Math.max(l,Math.pow(o,Math.round(Math.log(p)/c)-f)),v=Math.ceil(p/g);if(null!=e.step)g=e.step;else if(e.steps)g=e.steps[Math.min(e.steps.length-1,r(e.steps,p/s))];else{do g*=o,v=Math.ceil(p/g);while(v>s);for(i=0;i<u.length;++i)n=g/u[i],n>=l&&s>=p/n&&(g=n,v=Math.ceil(p/g))}return n=Math.log(g),t=n>=0?0:~~(-n/c)+1,a=(0>d?-1:1)*Math.pow(o,-t-1),d=Math.min(d,Math.floor(d/g+a)*g),h=Math.ceil(h/g)*g,{start:d,stop:h,step:g,unit:t}},P.truncate=function(e,t,n,r,a){var s=e.length;if(t>=s)return e;a=a||"...";var o=Math.max(0,t-a.length);switch(n){case"left":return a+(r?i(e,o,1):e.slice(s-o));case"middle":case"center":var u=Math.ceil(o/2),l=Math.floor(o/2);return(r?i(e,u):e.slice(0,u))+a+(r?i(e,l,1):e.slice(s-l));default:return(r?i(e,o):e.slice(0,o))+a}};var W=/([\u0009\u000A\u000B\u000C\u000D\u0020\u00A0\u1680\u180E\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200A\u202F\u205F\u2028\u2029\u3000\uFEFF])/;P.log=function(e){a("[Vega Log] "+e)},P.error=function(e){e="[Vega Err] "+e,a(e),"undefined"!=typeof alert&&alert(e)},P.config={},P.config.isNode="undefined"!=typeof exports&&this.exports!==exports,P.config.domainWhiteList=!1,P.config.safeMode=!1,P.config.baseURL="",P.config.svgNamespace='version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"',P.config.autopadInset=5,P.config.scale={time:e.time.scale,utc:e.time.scale.utc},P.config.render={lineWidth:1,lineCap:"butt",font:"sans-serif",fontSize:11},P.config.axis={orient:"bottom",ticks:10,padding:3,axisColor:"#000",gridColor:"#d8d8d8",tickColor:"#000",tickLabelColor:"#000",axisWidth:1,tickWidth:1,tickSize:6,tickLabelFontSize:11,tickLabelFont:"sans-serif",titleColor:"#000",titleFont:"sans-serif",titleFontSize:11,titleFontWeight:"bold",titleOffset:35},P.config.legend={orient:"right",offset:10,padding:3,gradientStrokeColor:"#888",gradientStrokeWidth:1,gradientHeight:16,gradientWidth:100,labelColor:"#000",labelFontSize:10,labelFont:"sans-serif",labelAlign:"left",labelBaseline:"middle",labelOffset:8,symbolShape:"circle",symbolSize:50,symbolColor:"#888",symbolStrokeWidth:1,titleColor:"#000",titleFont:"sans-serif",titleFontSize:11,titleFontWeight:"bold"},P.config.color={rgb:[128,128,128],lab:[50,0,0],hcl:[0,0,50],hsl:[0,0,.5]},P.config.range={category10:["#1f77b4","#ff7f0e","#2ca02c","#d62728","#9467bd","#8c564b","#e377c2","#7f7f7f","#bcbd22","#17becf"],category20:["#1f77b4","#aec7e8","#ff7f0e","#ffbb78","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5","#8c564b","#c49c94","#e377c2","#f7b6d2","#7f7f7f","#c7c7c7","#bcbd22","#dbdb8d","#17becf","#9edae5"],shapes:["circle","cross","diamond","square","triangle-down","triangle-up"]},P.Bounds=function(){var e=function(e){this.clear(),e&&this.union(e)},t=e.prototype;return t.clear=function(){return this.x1=+Number.MAX_VALUE,this.y1=+Number.MAX_VALUE,this.x2=-Number.MAX_VALUE,this.y2=-Number.MAX_VALUE,this},t.set=function(e,t,n,r){return this.x1=e,this.y1=t,this.x2=n,this.y2=r,this},t.add=function(e,t){return e<this.x1&&(this.x1=e),t<this.y1&&(this.y1=t),e>this.x2&&(this.x2=e),t>this.y2&&(this.y2=t),this},t.expand=function(e){return this.x1-=e,this.y1-=e,this.x2+=e,this.y2+=e,this},t.round=function(){return this.x1=Math.floor(this.x1),this.y1=Math.floor(this.y1),this.x2=Math.ceil(this.x2),this.y2=Math.ceil(this.y2),this},t.translate=function(e,t){return this.x1+=e,this.x2+=e,this.y1+=t,this.y2+=t,this},t.rotate=function(e,t,n){var r=Math.cos(e),i=Math.sin(e),a=t-t*r+n*i,s=n-t*i-n*r,o=this.x1,u=this.x2,l=this.y1,c=this.y2;return this.clear().add(r*o-i*l+a,i*o+r*l+s).add(r*o-i*c+a,i*o+r*c+s).add(r*u-i*l+a,i*u+r*l+s).add(r*u-i*c+a,i*u+r*c+s)},t.union=function(e){return e.x1<this.x1&&(this.x1=e.x1),e.y1<this.y1&&(this.y1=e.y1),e.x2>this.x2&&(this.x2=e.x2),e.y2>this.y2&&(this.y2=e.y2),this},t.encloses=function(e){return e&&this.x1<=e.x1&&this.x2>=e.x2&&this.y1<=e.y1&&this.y2>=e.y2},t.intersects=function(e){return e&&!(this.x2<e.x1||this.x1>e.x2||this.y2<e.y1||this.y1>e.y2)},t.contains=function(e,t){return!(e<this.x1||e>this.x2||t<this.y1||t>this.y2)},t.width=function(){return this.x2-this.x1},t.height=function(){return this.y2-this.y1},e}(),P.Gradient=function(){function e(e){this.id="grad_"+R++,this.type=e||"linear",this.stops=[],this.x1=0,this.x2=1,this.y1=0,this.y2=0}var t=e.prototype;return t.stop=function(e,t){return this.stops.push({offset:e,color:t}),this},e}();var R=0;P.canvas={},P.canvas.path=function(){function t(e){var t,n,r,i=[];e=e.slice().replace(d[0],"###$1").split(d[1]).slice(1);for(var a,s,o=0,u=e.length;u>o;o++){t=e[o],n=t.slice(1).trim().replace(d[2],"$1###-").split(d[3]),s=[t.charAt(0)];for(var a=0,l=n.length;l>a;a++)r=parseFloat(n[a]),isNaN(r)||s.push(r);var c=s[0].toLowerCase(),h=f[c];if(s.length-1>h)for(var p=1,g=s.length;g>p;p+=h)i.push([s[0]].concat(s.slice(p,p+h)));else i.push(s)}return i}function n(e,t,n,r,s,o,u){for(var l=r[0],c=r[1],f=r[2],d=r[3],h=r[4],p=r[5],g=r[6],v=i(p,g,l,c,d,h,f,t,n),m=0;m<v.length;m++){var y=a.apply(null,v[m]);e.bezierCurveTo.apply(e,y),s.add(y[0]-o,y[1]-u),s.add(y[2]-o,y[3]-u),s.add(y[4]-o,y[5]-u)}}function r(e,t,n,r){for(var s=n[0],o=n[1],u=n[2],l=n[3],c=n[4],f=n[5],d=n[6],h=i(f,d,s,o,l,c,u,e,t),p=0;p<h.length;p++){var g=a.apply(null,h[p]);r.add(g[0],g[1]),r.add(g[2],g[3]),r.add(g[4],g[5])}}function i(e,t,n,r,i,a,s,o,u){if(c=g.call(arguments),h[c])return h[c];var l=s*(Math.PI/180),f=Math.sin(l),d=Math.cos(l);n=Math.abs(n),r=Math.abs(r);var p=d*(o-e)*.5+f*(u-t)*.5,v=d*(u-t)*.5-f*(o-e)*.5,m=p*p/(n*n)+v*v/(r*r);m>1&&(m=Math.sqrt(m),n*=m,r*=m);var y=d/n,x=f/n,b=-f/r,k=d/r,_=y*o+x*u,w=b*o+k*u,S=y*e+x*t,O=b*e+k*t,A=(S-_)*(S-_)+(O-w)*(O-w),T=1/A-.25;0>T&&(T=0);var E=Math.sqrt(T);a==i&&(E=-E);var M=.5*(_+S)-E*(O-w),C=.5*(w+O)+E*(S-_),z=Math.atan2(w-C,_-M),L=Math.atan2(O-C,S-M),j=L-z;0>j&&1==a?j+=2*Math.PI:j>0&&0==a&&(j-=2*Math.PI);for(var P=Math.ceil(Math.abs(j/(.5*Math.PI+.001))),I=[],D=0;P>D;D++){var W=z+D*j/P,R=z+(D+1)*j/P;I[D]=[M,C,W,R,n,r,f,d]}return h[c]=I}function a(e,t,n,r,i,a,s,o){if(c=g.call(arguments),p[c])return p[c];var u=o*i,l=-s*a,f=s*i,d=o*a,h=Math.cos(n),v=Math.sin(n),m=Math.cos(r),y=Math.sin(r),x=.5*(r-n),b=Math.sin(.5*x),k=8/3*b*b/Math.sin(x),_=e+h-k*v,w=t+v+k*h,S=e+m,O=t+y,A=S+k*y,T=O-k*m;return p[c]=[u*_+l*w,f*_+d*w,u*A+l*T,f*A+d*T,u*S+l*O,f*S+d*O]}function s(e,t,r,i){var a,s,o,u,l,c=null,f=0,d=0,h=0,p=0,g=new P.Bounds;void 0==r&&(r=0),void 0==i&&(i=0),e.beginPath();
for(var v=0,m=t.length;m>v;++v){switch(a=t[v],a[0]){case"l":f+=a[1],d+=a[2],e.lineTo(f+r,d+i),g.add(f,d);break;case"L":f=a[1],d=a[2],e.lineTo(f+r,d+i),g.add(f,d);break;case"h":f+=a[1],e.lineTo(f+r,d+i),g.add(f,d);break;case"H":f=a[1],e.lineTo(f+r,d+i),g.add(f,d);break;case"v":d+=a[1],e.lineTo(f+r,d+i),g.add(f,d);break;case"V":d=a[1],e.lineTo(f+r,d+i),g.add(f,d);break;case"m":f+=a[1],d+=a[2],e.moveTo(f+r,d+i),g.add(f,d);break;case"M":f=a[1],d=a[2],e.moveTo(f+r,d+i),g.add(f,d);break;case"c":s=f+a[5],o=d+a[6],h=f+a[3],p=d+a[4],e.bezierCurveTo(f+a[1]+r,d+a[2]+i,h+r,p+i,s+r,o+i),g.add(f+a[1],d+a[2]),g.add(h,p),g.add(s,o),f=s,d=o;break;case"C":f=a[5],d=a[6],h=a[3],p=a[4],e.bezierCurveTo(a[1]+r,a[2]+i,h+r,p+i,f+r,d+i),g.add(a[1],a[2]),g.add(h,p),g.add(f,d);break;case"s":s=f+a[3],o=d+a[4],h=2*f-h,p=2*d-p,e.bezierCurveTo(h+r,p+i,f+a[1]+r,d+a[2]+i,s+r,o+i),g.add(h,p),g.add(f+a[1],d+a[2]),g.add(s,o),h=f+a[1],p=d+a[2],f=s,d=o;break;case"S":s=a[3],o=a[4],h=2*f-h,p=2*d-p,e.bezierCurveTo(h+r,p+i,a[1]+r,a[2]+i,s+r,o+i),f=s,d=o,g.add(a[1],a[2]),g.add(h,p),g.add(s,o),h=a[1],p=a[2];break;case"q":s=f+a[3],o=d+a[4],h=f+a[1],p=d+a[2],e.quadraticCurveTo(h+r,p+i,s+r,o+i),f=s,d=o,g.add(h,p),g.add(s,o);break;case"Q":s=a[3],o=a[4],e.quadraticCurveTo(a[1]+r,a[2]+i,s+r,o+i),f=s,d=o,h=a[1],p=a[2],g.add(h,p),g.add(s,o);break;case"t":s=f+a[1],o=d+a[2],null===c[0].match(/[QqTt]/)?(h=f,p=d):"t"===c[0]?(h=2*f-u,p=2*d-l):"q"===c[0]&&(h=2*f-h,p=2*d-p),u=h,l=p,e.quadraticCurveTo(h+r,p+i,s+r,o+i),f=s,d=o,h=f+a[1],p=d+a[2],g.add(h,p),g.add(s,o);break;case"T":s=a[1],o=a[2],h=2*f-h,p=2*d-p,e.quadraticCurveTo(h+r,p+i,s+r,o+i),f=s,d=o,g.add(h,p),g.add(s,o);break;case"a":n(e,f+r,d+i,[a[1],a[2],a[3],a[4],a[5],a[6]+f+r,a[7]+d+i],g,r,i),f+=a[6],d+=a[7];break;case"A":n(e,f+r,d+i,[a[1],a[2],a[3],a[4],a[5],a[6]+r,a[7]+i],g,r,i),f=a[6],d=a[7];break;case"z":case"Z":e.closePath()}c=a}return g.translate(r,i)}function o(e,t){for(var n,i,a,s,o,u=null,l=0,c=0,f=0,d=0,h=0,p=e.length;p>h;++h){switch(n=e[h],n[0]){case"l":l+=n[1],c+=n[2],t.add(l,c);break;case"L":l=n[1],c=n[2],t.add(l,c);break;case"h":l+=n[1],t.add(l,c);break;case"H":l=n[1],t.add(l,c);break;case"v":c+=n[1],t.add(l,c);break;case"V":c=n[1],t.add(l,c);break;case"m":l+=n[1],c+=n[2],t.add(l,c);break;case"M":l=n[1],c=n[2],t.add(l,c);break;case"c":i=l+n[5],a=c+n[6],f=l+n[3],d=c+n[4],t.add(l+n[1],c+n[2]),t.add(f,d),t.add(i,a),l=i,c=a;break;case"C":l=n[5],c=n[6],f=n[3],d=n[4],t.add(n[1],n[2]),t.add(f,d),t.add(l,c);break;case"s":i=l+n[3],a=c+n[4],f=2*l-f,d=2*c-d,t.add(f,d),t.add(l+n[1],c+n[2]),t.add(i,a),f=l+n[1],d=c+n[2],l=i,c=a;break;case"S":i=n[3],a=n[4],f=2*l-f,d=2*c-d,l=i,c=a,t.add(n[1],n[2]),t.add(f,d),t.add(i,a),f=n[1],d=n[2];break;case"q":i=l+n[3],a=c+n[4],f=l+n[1],d=c+n[2],l=i,c=a,t.add(f,d),t.add(i,a);break;case"Q":i=n[3],a=n[4],l=i,c=a,f=n[1],d=n[2],t.add(f,d),t.add(i,a);break;case"t":i=l+n[1],a=c+n[2],null===u[0].match(/[QqTt]/)?(f=l,d=c):"t"===u[0]?(f=2*l-s,d=2*c-o):"q"===u[0]&&(f=2*l-f,d=2*c-d),s=f,o=d,l=i,c=a,f=l+n[1],d=c+n[2],t.add(f,d),t.add(i,a);break;case"T":i=n[1],a=n[2],f=2*l-f,d=2*c-d,l=i,c=a,t.add(f,d),t.add(i,a);break;case"a":r(l,c,[n[1],n[2],n[3],n[4],n[5],n[6]+l,n[7]+c],t),l+=n[6],c+=n[7];break;case"A":r(l,c,[n[1],n[2],n[3],n[4],n[5],n[6],n[7]],t),l=n[6],c=n[7];break;case"z":case"Z":}u=n}return t}function u(t){var n,r=t[0];return n="horizontal"===r.orient?e.svg.area().y(function(e){return e.y}).x0(function(e){return e.x}).x1(function(e){return e.x+e.width}):e.svg.area().x(function(e){return e.x}).y1(function(e){return e.y}).y0(function(e){return e.y+e.height}),r.interpolate&&n.interpolate(r.interpolate),null!=r.tension&&n.tension(r.tension),n(t)}function l(t){var n=t[0],r=e.svg.line().x(function(e){return e.x}).y(function(e){return e.y});return n.interpolate&&r.interpolate(n.interpolate),null!=n.tension&&r.tension(n.tension),r(t)}var c,f={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},d=[/([MLHVCSQTAZmlhvcsqtaz])/g,/###/,/(\d)-/g,/\s|,|###/],h={},p={},g=Array.prototype.join;return{parse:t,render:s,bounds:o,area:u,line:l}}(),P.canvas.marks=function(){function e(e,t){var n=t.x||0,r=t.y||0,i=t.innerRadius||0,a=t.outerRadius||0,s=(t.startAngle||0)-Math.PI/2,o=(t.endAngle||0)-Math.PI/2;e.beginPath(),0===i?e.moveTo(n,r):e.arc(n,r,i,s,o,0),e.arc(n,r,a,o,s,1),e.closePath()}function t(e,t){var n=t[0],r=n.mark,i=r.pathCache||(r.pathCache=S(P.canvas.path.area(t)));O(e,i)}function n(e,t){var n=t[0],r=n.mark,i=r.pathCache||(r.pathCache=S(P.canvas.path.line(t)));O(e,i)}function r(e,t){if(null!=t.path){var n=t.pathCache||(t.pathCache=S(t.path));return O(e,n,t.x,t.y)}}function i(e,t){e.beginPath();var n,r,i,a,s=null!=t.size?t.size:100,o=t.x,u=t.y;if(null==t.shape||"circle"===t.shape)return n=Math.sqrt(s/Math.PI),e.arc(o,u,n,0,2*Math.PI,0),void e.closePath();switch(t.shape){case"cross":n=Math.sqrt(s/5)/2,r=3*n,e.moveTo(o-r,u-n),e.lineTo(o-n,u-n),e.lineTo(o-n,u-r),e.lineTo(o+n,u-r),e.lineTo(o+n,u-n),e.lineTo(o+r,u-n),e.lineTo(o+r,u+n),e.lineTo(o+n,u+n),e.lineTo(o+n,u+r),e.lineTo(o-n,u+r),e.lineTo(o-n,u+n),e.lineTo(o-r,u+n);break;case"diamond":a=Math.sqrt(s/(2*T)),i=a*T,e.moveTo(o,u-a),e.lineTo(o+i,u),e.lineTo(o,u+a),e.lineTo(o-i,u);break;case"square":r=Math.sqrt(s),n=r/2,e.rect(o-n,u-n,r,r);break;case"triangle-down":i=Math.sqrt(s/A),a=i*A/2,e.moveTo(o,u+a),e.lineTo(o+i,u-a),e.lineTo(o-i,u-a);break;case"triangle-up":i=Math.sqrt(s/A),a=i*A/2,e.moveTo(o,u-a),e.lineTo(o+i,u+a),e.lineTo(o-i,u+a)}e.closePath()}function a(e,t){var r=t[0],i=r.strokeWidth,a=r.strokeCap;e.lineWidth=null!=i?i:P.config.render.lineWidth,e.lineCap=null!=a?a:P.config.render.lineCap,n(e,t)}function s(e,t){var n=t.x||0,r=t.y||0,i=null!=t.x2?t.x2:n,a=null!=t.y2?t.y2:r,s=t.strokeWidth,o=t.strokeCap;e.lineWidth=null!=s?s:P.config.render.lineWidth,e.lineCap=null!=o?o:P.config.render.lineCap,e.beginPath(),e.moveTo(n,r),e.lineTo(i,a)}function o(e,t,n,r){var i,a,s,o=n.fill,u=n.stroke;e(t,r),i=null==n.opacity?1:n.opacity,0!=i&&(o||u)&&(o&&(t.globalAlpha=i*(null==n.fillOpacity?1:n.fillOpacity),t.fillStyle=v(t,n,o),t.fill()),u&&(s=null!=(s=n.strokeWidth)?s:P.config.render.lineWidth,s>0&&(t.globalAlpha=i*(null==n.strokeOpacity?1:n.strokeOpacity),t.strokeStyle=v(t,n,u),t.lineWidth=s,t.lineCap=null!=(a=n.strokeCap)?a:P.config.render.lineCap,t.vgLineDash(n.strokeDash||null),t.vgLineDashOffset(n.strokeDashOffset||0),t.stroke())))}function u(e,t,n,r){var i,a,s;for(i=0,a=n.items.length;a>i;++i)s=n.items[i],(!r||r.intersects(s.bounds))&&o(e,t,s,s)}function l(e,t,n){if(t.items.length)for(var r,i,a,s,o,u,l,c,f,d,h=t.items,p=0,g=h.length;g>p;++p)r=h[p],(!n||n.intersects(r.bounds))&&(l=r.x||0,c=r.y||0,f=r.width||0,d=r.height||0,s=null==r.opacity?1:r.opacity,0!=s&&((i=r.fill)&&(e.globalAlpha=s*(null==r.fillOpacity?1:r.fillOpacity),e.fillStyle=v(e,r,i),e.fillRect(l,c,f,d)),(a=r.stroke)&&(u=null!=(u=r.strokeWidth)?u:P.config.render.lineWidth,u>0&&(e.globalAlpha=s*(null==r.strokeOpacity?1:r.strokeOpacity),e.strokeStyle=v(e,r,a),e.lineWidth=u,e.lineCap=null!=(o=r.strokeCap)?o:P.config.render.lineCap,e.vgLineDash(r.strokeDash||null),e.vgLineDashOffset(r.strokeDashOffset||0),e.strokeRect(l,c,f,d)))))}function c(e,t,n){if(t.items.length)for(var r,i,a,s,o,u,l,c,f,d=t.items,h=0,p=d.length;p>h;++h)r=d[h],(!n||n.intersects(r.bounds))&&(u=r.x||0,l=r.y||0,c=null!=r.x2?r.x2:u,f=null!=r.y2?r.y2:l,a=null==r.opacity?1:r.opacity,0!=a&&(i=r.stroke)&&(o=null!=(o=r.strokeWidth)?o:P.config.render.lineWidth,o>0&&(e.globalAlpha=a*(null==r.strokeOpacity?1:r.strokeOpacity),e.strokeStyle=v(e,r,i),e.lineWidth=o,e.lineCap=null!=(s=r.strokeCap)?s:P.config.render.lineCap,e.vgLineDash(r.strokeDash||null),e.vgLineDashOffset(r.strokeDashOffset||0),e.beginPath(),e.moveTo(u,l),e.lineTo(c,f),e.stroke())))}function f(e,t,n){if(t.items.length)for(var r,i=this,a=t.items,s=0,o=a.length;o>s;++s)if(r=a[s],!n||n.intersects(r.bounds)){r.image&&r.image.url===r.url||(r.image=i.loadImage(r.url),r.image.url=r.url);var u,l,c,f,d;c=r.width||r.image&&r.image.width||0,f=r.height||r.image&&r.image.height||0,u=(r.x||0)-("center"===r.align?c/2:"right"===r.align?c:0),l=(r.y||0)-("middle"===r.baseline?f/2:"bottom"===r.baseline?f:0),r.image.loaded&&(e.globalAlpha=null!=(d=r.opacity)?d:1,e.drawImage(r.image,u,l,c,f))}}function d(e,t,n){if(t.items.length)for(var r,i,a,s,o,u,l,c,f,d=t.items,h=0,p=d.length;p>h;++h)r=d[h],(!n||n.intersects(r.bounds))&&(e.font=P.scene.fontString(r),e.textAlign=r.align||"left",e.textBaseline=r.baseline||"alphabetic",s=null==r.opacity?1:r.opacity,0!=s&&(u=r.x||0,l=r.y||0,(c=r.radius)&&(f=(r.theta||0)-Math.PI/2,u+=c*Math.cos(f),l+=c*Math.sin(f)),r.angle?(e.save(),e.translate(u,l),e.rotate(r.angle*Math.PI/180),u=r.dx||0,l=r.dy||0):(u+=r.dx||0,l+=r.dy||0),(i=r.fill)&&(e.globalAlpha=s*(null==r.fillOpacity?1:r.fillOpacity),e.fillStyle=v(e,r,i),e.fillText(r.text,u,l)),(a=r.stroke)&&(o=null!=(o=r.strokeWidth)?o:1,o>0&&(e.globalAlpha=s*(null==r.strokeOpacity?1:r.strokeOpacity),e.strokeStyle=v(r,a),e.lineWidth=o,e.strokeText(r.text,u,l))),r.angle&&e.restore()))}function h(e){return function(t,n,r){u(e,t,n,r)}}function p(e){return function(t,n,r){n.items.length&&(!r||r.intersects(n.items[0].bounds))&&o(e,t,n.items[0],n.items)}}function g(e,t,n){if(t.items.length){var r,i,a,s,o,u,c,f,d,h=t.items,p=this;for(l(e,t,n),u=0,c=h.length;c>u;++u){for(r=h[u],i=r.axisItems||[],a=r.legendItems||[],s=r.x||0,o=r.y||0,e.save(),e.translate(s,o),r.clip&&(e.beginPath(),e.rect(0,0,r.width||0,r.height||0),e.clip()),n&&n.translate(-s,-o),f=0,d=i.length;d>f;++f)"back"===i[f].def.layer&&p.draw(e,i[f],n);for(f=0,d=r.items.length;d>f;++f)p.draw(e,r.items[f],n);for(f=0,d=i.length;d>f;++f)"back"!==i[f].def.layer&&p.draw(e,i[f],n);for(f=0,d=a.length;d>f;++f)p.draw(e,a[f],n);n&&n.translate(s,o),e.restore()}}}function v(e,t,n){return n.id?m(e,n,t.bounds):n}function m(e,t,n){var r,i,a=n.width(),s=n.height(),o=n.x1+t.x1*a,u=n.y1+t.y1*s,l=n.x1+t.x2*a,c=n.y1+t.y2*s,f=e.createLinearGradient(o,u,l,c),d=t.stops;for(r=0,i=d.length;i>r;++r)f.addColorStop(d[r].offset,d[r].color);return f}function y(e,t,n,r,i,a){if(0===t.items.length||t.bounds&&!t.bounds.contains(i,a))return!1;var s,o,u,l,c,f,d,h=t.items,p=this;for(f=h.length;--f>=0;){for(o=h[f],l=o.x||0,c=o.y||0,e.save(),e.translate(l,c),d=o.items.length;--d>=0;)if(s=o.items[d],s.interactive!==!1&&(u=p.pick(s,n,r,i-l,a-c)))return e.restore(),u;e.restore()}return t.interactive?x(M.group,e,t,n,r,i,a):!1}function x(e,t,n,r,i,a,s){if(!n.items.length)return!1;var o,u,l;for(1!==t._ratio&&(r*=t._ratio,i*=t._ratio),l=n.items.length;--l>=0;)if(o=n.items[l],u=o.bounds,(!u||u.contains(a,s))&&u&&e(t,o,r,i,a,s))return o;return!1}function b(e,t,n,r,i,a){if(!t.items.length)return!1;var s,o=t.items;return s=o[0].bounds,s&&!s.contains(i,a)?!1:(1!==e._ratio&&(n*=e._ratio,r*=e._ratio),M.area(e,o,n,r)?o[0]:!1)}function k(e,t,n,r,i,a){if(!t.items.length)return!1;var s,o=t.items;return s=o[0].bounds,s&&!s.contains(i,a)?!1:(1!==e._ratio&&(n*=e._ratio,r*=e._ratio),M.line(e,o,n,r)?o[0]:!1)}function _(e){return function(t,n,r,i,a,s){return x(e,t,n,r,i,a,s)}}function w(e,t,n,r,i,a){if(!t.fontSize)return!1;if(!t.angle)return!0;var s=P.scene.bounds.text(t,E,!0),o=-t.angle*Math.PI/180,u=Math.cos(o),l=Math.sin(o),n=t.x,r=t.y,c=u*i-l*a+(n-n*u+r*l),f=l*i+u*a+(r-n*l-r*u);return s.contains(c,f)}var S=P.canvas.path.parse,O=P.canvas.path.render,A=(Math.PI/2,Math.sqrt(3)),T=Math.tan(30*Math.PI/180),E=new P.Bounds,M={text:w,rect:function(){return!0},image:function(){return!0},group:function(e,t){return t.fill||t.stroke},rule:function(e,t,n,r){return e.isPointInStroke?(s(e,t),e.isPointInStroke(n,r)):!1},line:function(e,t,n,r){return e.isPointInStroke?(a(e,t),e.isPointInStroke(n,r)):!1},arc:function(t,n,r,i){return e(t,n),t.isPointInPath(r,i)},area:function(e,n,r,i){return t(e,n),e.isPointInPath(r,i)},path:function(e,t,n,i){return r(e,t),e.isPointInPath(n,i)},symbol:function(e,t,n,r){return i(e,t),e.isPointInPath(n,r)}};return{draw:{group:g,area:p(t),line:p(n),arc:h(e),path:h(r),symbol:h(i),rect:l,rule:c,text:d,image:f,drawOne:p,drawAll:h},pick:{group:y,area:b,line:k,arc:_(M.arc),path:_(M.path),symbol:_(M.symbol),rect:_(M.rect),rule:_(M.rule),text:_(M.text),image:_(M.image),pickAll:x}}}(),P.canvas.Renderer=function(){function t(e,t){var n=window.devicePixelRatio||1,r=t.webkitBackingStorePixelRatio||t.mozBackingStorePixelRatio||t.msBackingStorePixelRatio||t.oBackingStorePixelRatio||t.backingStorePixelRatio||1,i=n/r;if(n!==r){var a=e.width,s=e.height;e.setAttribute("width",a*i),e.setAttribute("height",s*i),e.style.width=a+"px",e.style.height=s+"px"}return i}function n(e){if(!e.vgLineDash){var t=[];e.setLineDash?(e.vgLineDash=function(e){this.setLineDash(e||t)},e.vgLineDashOffset=function(e){this.lineDashOffset=e}):void 0!==e.webkitLineDash?(e.vgLineDash=function(e){this.webkitLineDash=e||t},e.vgLineDashOffset=function(e){this.webkitLineDashOffset=e}):void 0!==e.mozDash?(e.vgLineDash=function(e){this.mozDash=e},e.vgLineDashOffset=function(){}):(e.vgLineDash=function(){},e.vgLineDashOffset=function(){})}}function r(e,t){for(var n=new P.Bounds(t);null!=(e=e.mark.group);)n.translate(e.x||0,e.y||0);return n}function i(e){return e?P.array(e).reduce(function(e,t){return e.union(r(t,t.bounds)).union(r(t,t["bounds:prev"]))},new P.Bounds):null}function a(e,t){var n=null;return t&&(n=new P.Bounds(t).round(),e.beginPath(),e.rect(n.x1,n.y1,n.width(),n.height()),e.clip()),n}var s=function(){this._ctx=null,this._el=null,this._imgload=0},o=s.prototype;return o.initialize=function(t,n,r,i){if(this._el=t,!t)return this;var a=e.select(t).selectAll("canvas.marks").data([1]);return a.enter().append("canvas").attr("class","marks"),a.exit().remove(),this.resize(n,r,i)},o.resize=function(r,i,a){if(this._width=r,this._height=i,this._padding=a,this._el){var s=e.select(this._el).select("canvas.marks");s.attr("width",r+a.left+a.right).attr("height",i+a.top+a.bottom);var o;this._ctx=s.node().getContext("2d"),this._ctx._ratio=o=t(s.node(),this._ctx)||1,this._ctx.setTransform(o,0,0,o,o*a.left,o*a.top)}return n(this._ctx),this},o.context=function(e){return e?(this._ctx=e,this):this._ctx},o.element=function(){return this._el},o.pendingImages=function(){return this._imgload},o.render=function(e,t){var n,r=this._ctx,s=this._padding,o=this._width+s.left+s.right,u=this._height+s.top+s.bottom,l=null;this._scene=e,r.save(),l=a(r,i(t)),r.clearRect(-s.left,-s.top,o,u),this.draw(r,e,l),t&&(r.restore(),r.save(),n=a(r,i(t)),l.encloses(n)||(r.clearRect(-s.left,-s.top,o,u),this.draw(r,e,n))),r.restore(),this._scene=null},o.draw=function(e,t,n){var r=t.marktype,i=P.canvas.marks.draw[r];i.call(this,e,t,n)},o.renderAsync=function(e){var t=this;t._async_id&&clearTimeout(t._async_id),t._async_id=setTimeout(function(){t.render(e),delete t._async_id},50)},o.loadImage=function(e){var t,n=this,r=n._scene,i=null;return n._imgload+=1,P.config.isNode?(i=new(require("canvas").Image),P.data.load(e,function(e,t){return e?void P.error(e):(i.src=t,i.loaded=!0,void(n._imgload-=1))})):(i=new Image,t=P.config.baseURL+e,i.onload=function(){P.log("LOAD IMAGE: "+t),i.loaded=!0,n._imgload-=1,n.renderAsync(r)},i.src=t),i},s}(),P.canvas.Handler=function(){function t(e){var t=e.indexOf(".");return 0>t?e:e.slice(0,t)}var n=function(e,t){this._active=null,this._handlers={},e&&this.initialize(e),t&&this.model(t)},r=n.prototype;r.initialize=function(t,n,a){this._el=e.select(t).node(),this._canvas=e.select(t).select("canvas.marks").node(),this._padding=n,this._obj=a||null;var s=this._canvas,o=this;return i.forEach(function(e){s.addEventListener(e,function(t){r[e].call(o,t)})}),this},r.padding=function(e){return this._padding=e,this},r.model=function(e){return arguments.length?(this._model=e,this):this._model},r.handlers=function(){var e=this._handlers;return P.keys(e).reduce(function(t,n){return e[n].reduce(function(e,t){return e.push(t),e},t)},[])};var i=["mousedown","mouseup","click","dblclick","wheel","keydown","keypress","keyup","mousewheel"];return i.forEach(function(e){r[e]=function(t){this.fire(e,t)}}),i.push("mousemove"),i.push("mouseout"),r.mousemove=function(e){var t=this._padding,n=e.target.getBoundingClientRect(),r=e.clientX-n.left,i=e.clientY-n.top,a=this._active,s=this.pick(this._model.scene(),r,i,r-t.left,i-t.top);return s===a?void this.fire("mousemove",e):(a&&this.fire("mouseout",e),this._active=s,void(s&&this.fire("mouseover",e)))},r.mouseout=function(e){this._active&&this.fire("mouseout",e),this._active=null},r.DOMMouseScroll=function(e){this.fire("mousewheel",e)},r.fire=function(e,t){var n=this._active,r=this._handlers[e];if(n&&r)for(var i=0,a=r.length;a>i;++i)r[i].handler.call(this._obj,t,n)},r.on=function(e,n){var r=t(e),i=this._handlers;return i=i[r]||(i[r]=[]),i.push({type:e,handler:n}),this},r.off=function(e,n){var r=t(e),i=this._handlers[r];if(i){for(var a=i.length;--a>=0;)i[a].type===e&&(n&&i[a].handler!==n||i.splice(a,1));return this}},r.context=function(){return this._canvas.getContext("2d")},r.pick=function(e,t,n,r,i){var a=this.context(),s=e.marktype,o=P.canvas.marks.pick[s];return o.call(this,a,e,t,n,r,i)},n}(),P.svg={},P.svg.marks=function(){function t(e){return e.x||0}function n(e){return e.y||0}function r(e){return e.x+e.width||0}function i(e){return e.y+e.height||0}function a(e){return null==e.size?100:e.size}function s(e){return e.shape||"circle"}function o(e){var t,n,r,i,a,s=e.mark?e:e.length?e[0]:null;if(null!==s)for(t=0,n=j.length;n>t;++t)r=j[t],i=L[r],a=s[r],null==a?"fill"===i?this.style.setProperty(i,"none",null):this.style.removeProperty(i):(a.id&&(P.svg._cur._defs.gradient[a.id]=a,a="url("+window.location.href+"#"+a.id+")"),this.style.setProperty(i,a+"",null))}function u(e){var t=e.x||0,n=e.y||0;this.setAttribute("transform","translate("+t+","+n+")"),this.setAttribute("d",S(e))}function l(e){if(e.length){var t=e[0],n="horizontal"===t.orient?A:O;n.interpolate(t.interpolate||"linear").tension(null==t.tension?.7:t.tension),this.setAttribute("d",n(e))}}function c(e){if(e.length){var t=e[0];T.interpolate(t.interpolate||"linear").tension(null==t.tension?.7:t.tension),this.setAttribute("d",T(e))}}function f(e){var t=e.x||0,n=e.y||0;this.setAttribute("transform","translate("+t+","+n+")"),null!=e.path&&this.setAttribute("d",e.path)}function d(e){this.setAttribute("x",e.x||0),this.setAttribute("y",e.y||0),this.setAttribute("width",e.width||0),this.setAttribute("height",e.height||0)}function h(e){var t=e.x||0,n=e.y||0;this.setAttribute("x1",t),this.setAttribute("y1",n),this.setAttribute("x2",null!=e.x2?e.x2:t),this.setAttribute("y2",null!=e.y2?e.y2:n)}function p(e){var t=e.x||0,n=e.y||0;this.setAttribute("transform","translate("+t+","+n+")"),this.setAttribute("d",E(e))}function g(e){var t=e.width||e.image&&e.image.width||0,n=e.height||e.image&&e.image.height||0,r=e.x-("center"===e.align?t/2:"right"===e.align?t:0),i=e.y-("middle"===e.baseline?n/2:"bottom"===e.baseline?n:0),a=P.config.baseURL+e.url;this.setAttributeNS("http://www.w3.org/1999/xlink","href",a),this.setAttribute("x",r),this.setAttribute("y",i),this.setAttribute("width",t),this.setAttribute("height",n)}function v(e){return(e.fontStyle?e.fontStyle+" ":"")+(e.fontVariant?e.fontVariant+" ":"")+(e.fontWeight?e.fontWeight+" ":"")+(null!=e.fontSize?e.fontSize:P.config.render.fontSize)+"px "+(e.font||P.config.render.font)}function m(e){var t=e.x||0,n=e.y||0,r=e.dx||0,i=e.dy||0,a=e.angle||0,s=e.radius||0,o=z[e.align||"left"],u="top"===e.baseline?".9em":"middle"===e.baseline?".35em":0;if(s){var l=(e.theta||0)-Math.PI/2;t+=s*Math.cos(l),n+=s*Math.sin(l)}this.setAttribute("x",t+r),this.setAttribute("y",n+i),this.setAttribute("text-anchor",o),a?this.setAttribute("transform","rotate("+a+" "+t+","+n+")"):this.removeAttribute("transform"),u?this.setAttribute("dy",u):this.removeAttribute("dy"),this.textContent=e.text,this.style.setProperty("font",v(e),null)}function y(e){var t=e.x||0,n=e.y||0;if(this.setAttribute("transform","translate("+t+","+n+")"),e.clip){var r={width:e.width||0,height:e.height||0},i=e.clip_id||(e.clip_id="clip"+C++);P.svg._cur._defs.clipping[i]=r,this.setAttribute("clip-path","url(#"+i+")")}}function x(e){var t=e.width||0,n=e.height||0;this.setAttribute("width",t),this.setAttribute("height",n)}function b(e){var t="type-"+e.type;return e.name&&(t+=" "+e.name),t}function k(e,t,n){return function(r,i,a){_(r,i,a,"mark_",e,t,n)}}function _(t,n,r,i,a,s,u){var l=u?[n.items]:n.items,c=n.interactive===!1?"none":null,f=t.node().childNodes,d="g"!==a,h=(h=f[r+1])?e.select(h):t.append("g").attr("id","g"+ ++M).attr("class",b(n.def)),p=h.attr("id"),g="#"+p+" > "+a,v=h.selectAll(g).data(l),m=v.enter().append(a);return d?(h.style("pointer-events",c),m.each(function(e){e.mark?e._svg=this:e.length&&(e[0]._svg=this)})):m.append("rect").attr("class","background").style("pointer-events",c),v.exit().remove(),v.each(s),d?v.each(o):h.selectAll(g+" > rect.background").each(x).each(o),h}function w(t,n,r,i){var a,s,o,u=_(t,n,r,i||"group_","g",y),l=u.node().childNodes,c=l.length;for(a=0;c>a;++a){var f=l[a].__data__.items,d=l[a].__data__.legendItems||[],h=l[a].__data__.axisItems||[],p=e.select(l[a]),g=0;for(s=0,o=h.length;o>s;++s)"back"===h[s].def.layer&&w.call(this,p,h[s],g++,"axis_");for(s=0,o=f.length;o>s;++s)this.draw(p,f[s],g++);for(s=0,o=h.length;o>s;++s)"back"!==h[s].def.layer&&w.call(this,p,h[s],g++,"axis_");for(s=0,o=d.length;o>s;++s)w.call(this,p,d[s],g++,"legend_")}}var S=e.svg.arc(),O=e.svg.area().x(t).y1(n).y0(i),A=e.svg.area().y(n).x0(r).x1(t),T=e.svg.line().x(t).y(n),E=e.svg.symbol().type(s).size(a),M=0,C=0,z={left:"start",center:"middle",right:"end"},L={fill:"fill",fillOpacity:"fill-opacity",stroke:"stroke",strokeWidth:"stroke-width",strokeOpacity:"stroke-opacity",strokeCap:"stroke-linecap",strokeDash:"stroke-dasharray",strokeDashOffset:"stroke-dashoffset",opacity:"opacity"},j=P.keys(L);return{update:{group:d,area:l,line:c,arc:u,path:f,symbol:p,rect:d,rule:h,text:m,image:g},nested:{area:!0,line:!0},style:o,draw:{group:w,area:k("path",l,!0),line:k("path",c,!0),arc:k("path",u),path:k("path",f),symbol:k("path",p),rect:k("rect",d),rule:k("line",h),text:k("text",m),image:k("image",g),draw:k}}}(),P.svg.Renderer=function(){var t=function(){this._svg=null,this._ctx=null,this._el=null,this._defs={gradient:{},clipping:{}}},n=t.prototype;return n.initialize=function(t,n,r,i){return this._el=t,e.select(t).select("svg.marks").remove(),this._svg=e.select(t).append("svg").attr("class","marks"),this._ctx=this._svg.append("g"),this.resize(n,r,i)},n.resize=function(e,t,n){return this._width=e,this._height=t,this._padding=n,this._svg.attr("width",e+n.left+n.right).attr("height",t+n.top+n.bottom),this._ctx.attr("transform","translate("+n.left+","+n.top+")"),this},n.context=function(){return this._ctx},n.element=function(){return this._el},n.updateDefs=function(){var t,n,r=this._svg,i=this._defs,a=P.keys(i.gradient),s=P.keys(i.clipping),o=r.select("defs");return 0===a.length&&0==s.length?void o.remove():(o.empty()&&(o=r.insert("defs",":first-child")),t=o.selectAll("linearGradient").data(a,P.identity),t.enter().append("linearGradient").attr("id",P.identity),t.exit().remove(),t.each(function(t){var n=i.gradient[t],r=e.select(this);r.attr({x1:n.x1,x2:n.x2,y1:n.y1,y2:n.y2}),stop=r.selectAll("stop").data(n.stops),stop.enter().append("stop"),stop.exit().remove(),stop.attr("offset",function(e){return e.offset}).attr("stop-color",function(e){return e.color})}),n=o.selectAll("clipPath").data(s,P.identity),n.enter().append("clipPath").attr("id",P.identity),n.exit().remove(),void n.each(function(t){var n=i.clipping[t],r=e.select(this).selectAll("rect").data([1]);r.enter().append("rect"),r.attr("x",0).attr("y",0).attr("width",n.width).attr("height",n.height)}))},n.render=function(e,t){P.svg._cur=this,t?this.renderItems(P.array(t)):this.draw(this._ctx,e,-1),this.updateDefs(),delete P.svg._cur},n.renderItems=function(e){var t,n,r,i,a,s=P.svg.marks;for(i=0,a=e.length;a>i;++i)t=e[i],n=t._svg,r=t.mark.marktype,t=s.nested[r]?t.mark.items:t,s.update[r].call(n,t),s.style.call(n,t)},n.draw=function(e,t,n){var r=t.marktype,i=P.svg.marks.draw[r];i.call(this,e,t,n)},t}(),P.svg.Handler=function(){function t(e){var t=this;return function(n){var r=n.target,i=r.__data__;i&&(i=i.mark?i:i[0],e.call(t._obj,n,i))}}function n(e){var t=e.indexOf(".");return 0>t?e:e.slice(0,t)}var r=function(e,t){this._active=null,this._handlers={},e&&this.initialize(e),t&&this.model(t)},i=r.prototype;return i.initialize=function(t,n,r){return this._el=e.select(t).node(),this._svg=e.select(t).select("svg.marks").node(),this._padding=n,this._obj=r||null,this},i.padding=function(e){return this._padding=e,this},i.model=function(e){return arguments.length?(this._model=e,this):this._model},i.handlers=function(){var e=this._handlers;return P.keys(e).reduce(function(t,n){return e[n].reduce(function(e,t){return e.push(t),e},t)},[])},i.on=function(r,i){var a=n(r),s=this._handlers,o=e.select(this._svg).node(),u={type:r,handler:i,svg:t.call(this,i)};return s=s[a]||(s[a]=[]),s.push(u),o.addEventListener(a,u.svg),this},i.off=function(t,r){var i=n(t),a=this._handlers[i],s=e.select(this._svg).node();if(a){for(var o=a.length;--o>=0;)a[o].type===t&&(r&&a[o].handler!==r||(s.removeEventListener(i,a[o].svg),a.splice(o,1)));return this}},r}(),P.data={},P.data.ingestAll=function(e){return P.isTree(e)?s(P.data.ingestTree(e[0],e.children)):e.map(P.data.ingest)},P.data.ingest=function(e,t){return{data:e,index:t}},P.data.ingestTree=function(e,t,n){var r,i,a=P.data.ingest(e,n||0),s=e[t];if(s&&(r=s.length))for(a.values=Array(r),i=0;r>i;++i)a.values[i]=P.data.ingestTree(s[i],t,i);return a},P.data.mapper=function(e){return function(t){return t.forEach(e),t}},P.data.size=function(e,t){return e=P.isArray(e)?e:[0,e],e=e.map(function(e){return"string"==typeof e?t[e]:e})},P.data.load=function(e,t){var n=l(e)?e:P.config.baseURL+e;if(P.config.isNode){var r=c(n)?h:p;r(n,t)}else f(n,t)};var N=/^[A-Za-z]+\:\/\//,X="file://";P.data.read=function(){function n(e,t){var n=t&&t.type||"json";return e=a[n](e,t),t&&t.parse&&r(e,t.parse),e}function r(e,t){var n=P.keys(t),r=n.map(function(e){return s[t[e]]}),a=P.isTree(e);i(a?[e]:e,n,r,a)}function i(e,t,n,i){var a,s,o,u,l;for(s=0,u=e.length;u>s;++s){for(a=e[s],o=0,l=t.length;l>o;++o)a[t[o]]=n[o](a[t[o]]);i&&a.values&&r(a,t,n,!0)}}var a={},s={number:P.number,"boolean":P.boolean,date:Date.parse};return a.json=function(e,t){var n=P.isObject(e)?e:JSON.parse(e);return t&&t.property&&(n=P.accessor(t.property)(n)),n},a.csv=function(t){var n=e.csv.parse(t);return n},a.tsv=function(t){var n=e.tsv.parse(t);return n},a.topojson=function(e,n){if(null==t)return P.error("TopoJSON library not loaded."),[];var r=P.isObject(e)?e:JSON.parse(e),i=[];return n&&n.feature?i=(i=r.objects[n.feature])?t.feature(r,i).features:(P.error("Invalid TopoJSON object: "+n.feature),[]):n&&n.mesh?i=(i=r.objects[n.mesh])?[t.mesh(r,r.objects[n.mesh])]:(P.error("Invalid TopoJSON object: "+n.mesh),[]):P.error("Missing TopoJSON feature or mesh parameter."),i},a.treejson=function(e,t){return e=P.isObject(e)?e:JSON.parse(e),P.tree(e,t.children)},n.formats=a,n.parse=r,n}(),P.data.aggregate=function(){function e(e){return e.op+"_"+e.field}function t(e){var t=i.reduce(function(t,n){return t.push(n(e)),t},[]).join("|");return l[t]||(l[t]=n(e))}function n(t){for(var n={},r=0;r<s.length;++r)n[s[r]]=i[r](t);for(n.count=0,r=0;r<o.length;++r)if("count"!==o[r].op){var a=u[o[r].op];n[e(o[r])]=a.init?a.init():0}return n}function r(n){var r,i=[],s=o.map(e),c=o.map(function(e){return u[e.op]});n.forEach(function(e){var n=t(e);n.count+=1;for(var r=0;r<o.length;++r)n[s[r]]=c[r](n,n[s[r]],a[r](e))});var f=0;for(r in l)i.push({index:f++,data:l[r]});return l={},i}var i,a,s=[],o=[],u={count:function(){},sum:function(e,t,n){return t+n},avg:function(e,t,n){return t+(n-t)/e.count},min:function(e,t,n){return t>n?n:t},max:function(e,t,n){return n>t?n:t}};u.min.init=function(){return+1/0},u.max.init=function(){return-1/0};var l={};return r.fields=function(e){return o=P.array(e),a=o.map(function(e,t){var n=e.field;return 0===n.indexOf("data.")&&(o[t]={op:e.op,field:n.slice(5)}),P.accessor(n)}),r},r.groupby=function(e){return s=P.array(e),i=s.map(function(e,t){return 0===e.indexOf("data.")&&(s[t]=e.slice(5)),P.accessor(e)}),r},r},P.data.array=function(){function e(e){return e.map(function(e){for(var n=[],r=0,i=t.length;i>r;++r)n.push(t[r](e));return n})}var t=[];return e.fields=function(n){return t=P.array(n).map(P.accessor),e},e},P.data.bin=function(){function e(e){var t={min:null!=i?i:+1/0,max:null!=a?a:-1/0,step:null!=s?s:null,maxbins:o};(null==i||null==a)&&e.forEach(function(e){var r=n(e);null==i&&r>t.max&&(t.max=r),null==a&&r<t.min&&(t.min=r)});var u=P.bins(t);return e.forEach(function(e){var t=n(e);r(e,u.start+u.step*~~((t-u.start)/u.step))}),e}var t,n,r,i=void 0,a=void 0,s=void 0,o=20,u="bin";return e.min=function(t){return i=t,e},e.max=function(t){return a=t,e},e.step=function(t){return s=t,e},e.maxbins=function(t){return o=t,e},e.field=function(r){return t=r,n=P.accessor(r),e},e.output=function(t){return u=t,r=P.mutator(t),e},e},P.data.copy=function(){var e=P.accessor("data"),t=[],n=null,r=P.data.mapper(function(r){var i,a,s=e(r),o=n||t;for(i=0,a=t.length;a>i;++i)r[o[i]]=s[t[i]];return r});return r.from=function(t){return e=P.accessor(t),r},r.fields=function(e){return t=P.array(e),r},r.as=function(e){return n=P.array(e),r},r},P.data.cross=function(){function e(e){var i,a,s,o=[],u=t||e,l=e.length;for(a=0;l>a;++a)for(s=0;l>s;++s)n&&a===s||(i={},i[r.left]=e[a],i[r.right]=u[s],o.push(i));return o}var t=null,n=!1,r={left:"a",right:"b"};return e["with"]=function(n){return t=n,e},e.diagonal=function(t){return n=!t,e},e.output=function(t){return P.keys(r).forEach(function(e){void 0!==t[e]&&(r[e]=t[e])}),e},e},P.data.facet=function(){function e(e){var r,i,a,s,o,u,l,c={key:"",keys:[],values:[]},f={},d=c.values;if(0===t.length)return d.push(r={key:"",keys:[],index:0,values:n?e.slice():e}),n&&n(r.values),c;for(o=0,s=e.length;s>o;++o){for(u=0,i=[],a="";u<t.length;++u)l=t[u](e[o]),i.push(l),a+=(u>0?"|":"")+String(l);r=f[a],void 0===r&&d.push(r=f[a]={key:a,keys:i,index:d.length,values:[]}),r.values.push(e[o])}if(n)for(o=0,s=d.length;s>o;++o)n(d[o].values);return c}var t=[],n=null;return e.keys=function(n){return t=P.array(n).map(P.accessor),e},e.sort=function(t){return n=P.data.sort().by(t),e},e},P.data.filter=function(){function e(e){return t?e.filter(t):e}var t=null;return e.test=function(n){return t=P.isFunction(n)?n:P.parse.expr(n),e},e},P.data.flatten=function(){function e(e){return t(e,[])}function t(e,n){if(e.values)for(var r=0,i=e.values.length;i>r;++r)t(e.values[r],n);else n.push(e);return n}return e},P.data.fold=function(){function e(e){var i,a,s,o,u=[],l=t.length;for(a=0,o=e.length;o>a;++a)for(i=e[a],s=0;l>s;++s){var c={index:u.length,data:i.data};c[r.key]=t[s],c[r.value]=n[s](i),u.push(c)}return u}var t=[],n=[],r={key:"key",value:"value"};return e.fields=function(r){return t=P.array(r),n=t.map(P.accessor),e},e.output=function(t){return P.keys(r).forEach(function(e){void 0!==t[e]&&(r[e]=t[e])}),e},e},P.data.force=function(){function t(e,t,i){n.size(P.data.size(u,i)).nodes(e),r&&t[r]&&n.links(t[r]),n.start();for(var a=0;o>a;++a)n.tick();return n.stop(),e}var n=e.layout.force(),r=null,i=20,a=1,s=-30,o=500,u=["width","height"],l=["friction","theta","gravity","alpha"];return t.links=function(e){return r=e,t},t.size=function(e){return u=e,t},t.linkDistance=function(e){return i="number"==typeof e?e:P.accessor(e),n.linkDistance(i),t},t.linkStrength=function(e){return a="number"==typeof e?e:P.accessor(e),n.linkStrength(a),t},t.charge=function(e){return s="number"==typeof e?e:P.accessor(e),n.charge(s),t},t.iterations=function(e){return o=e,t},l.forEach(function(e){t[e]=function(r){return n[e](r),t}}),t},P.data.force.dependencies=["links"],P.data.formula=function(){return function(){var e=null,t=P.identity,n=P.data.mapper(function(n,r,i){return e&&(n[e]=t.call(null,n,r,i)),n});return n.field=function(t){return e=t,n},n.expr=function(e){return t=P.isFunction(e)?e:P.parse.expr(e),n},n}}(),P.data.geo=function(){function t(){var t={},r="mercator",i=e.geo[r](),a=P.identity,s=P.identity,o={x:"x",y:"y"},u=P.data.mapper(function(e){var t=[s(e),a(e)],n=i(t);
return e[o.x]=n[0],e[o.y]=n[1],e});return u.func=function(){return i},u.projection=function(n){if(r!==n){r=n,i=e.geo[r]();for(var a in t)i[a](t[a])}return u},n.forEach(function(e){u[e]=function(n){return t[e]=n,i[e](n),u}}),u.lon=function(e){return s=P.accessor(e),u},u.lat=function(e){return a=P.accessor(e),u},u.output=function(e){return P.keys(o).forEach(function(t){void 0!==e[t]&&(o[t]=e[t])}),e},u}var n=["center","scale","translate","rotate","precision","clipAngle"];return t.params=n,t}(),P.data.geopath=function(){var t=e.geo.path().projection(e.geo.mercator()),n="mercator",r=P.identity,i={},a={path:"path"},s=P.data.mapper(function(e){return e[a.path]=t(r(e)),e});return s.projection=function(r){if(n!==r){n=r;var a=e.geo[n]();for(var o in i)a[o](i[o]);t.projection(a)}return s},P.data.geo.params.forEach(function(e){s[e]=function(n){return i[e]=n,t.projection()[e](n),s}}),s.value=function(e){return r=P.accessor(e),s},s.output=function(e){return P.keys(a).forEach(function(t){void 0!==e[t]&&(a[t]=e[t])}),e},s},P.data.link=function(){function e(e){var t=s(e),n=o(e);return"M"+t.x+","+t.y+"L"+n.x+","+n.y}function t(e){var t=s(e),n=o(e),r=n.x-t.x,i=n.y-t.y,a=u*(r+i),l=u*(i-r);return"M"+t.x+","+t.y+"C"+(t.x+a)+","+(t.y+l)+" "+(n.x+l)+","+(n.y-a)+" "+n.x+","+n.y}function n(e){var t=s(e),n=o(e),r=(t.x+n.x)/2;return"M"+t.x+","+t.y+"C"+r+","+t.y+" "+r+","+n.y+" "+n.x+","+n.y}function r(e){var t=s(e),n=o(e),r=(t.y+n.y)/2;return"M"+t.x+","+t.y+"C"+t.x+","+r+" "+n.x+","+r+" "+n.x+","+n.y}function i(e){var t=c[a];return e.forEach(function(e){e[l.path]=t(e)}),e}var a="line",s=P.accessor("source"),o=P.accessor("target"),u=.2,l={path:"path"},c={line:e,curve:t,diagonal:n,diagonalX:n,diagonalY:r};return i.shape=function(e){return a=e,i},i.tension=function(e){return u=e,i},i.source=function(e){return s=P.accessor(e),i},i.target=function(e){return o=P.accessor(e),i},i.output=function(e){return P.keys(l).forEach(function(t){void 0!==e[t]&&(l[t]=e[t])}),i},i},P.data.pie=function(){function t(t){var n=t.map(function(e){return+r(e)}),u=i,l=(a-i)/e.sum(n),c=e.range(t.length);return s&&c.sort(function(e,t){return n[e]-n[t]}),c.forEach(function(e){var r;t[e].value=r=n[e],t[e][o.startAngle]=u,t[e][o.midAngle]=u+.5*r*l,t[e][o.endAngle]=u+=r*l}),t}var n=function(){return 1},r=n,i=0,a=2*Math.PI,s=!1,o={startAngle:"startAngle",endAngle:"endAngle",midAngle:"midAngle"};return t.sort=function(e){return s=e,t},t.value=function(e){return r=e?P.accessor(e):n,t},t.startAngle=function(e){return i=Math.PI*e/180,t},t.endAngle=function(e){return a=Math.PI*e/180,t},t.output=function(e){return P.keys(o).forEach(function(t){void 0!==e[t]&&(o[t]=e[t])}),t},t},P.data.slice=function(){function e(e){if(e=P.values(e),"min"===t)e=[e[P.minIndex(e,n)]];else if("max"===t)e=[e[P.maxIndex(e,n)]];else if("median"===t){var r=e.slice().sort(function(e,t){return e=n(e),t=n(t),t>e?-1:e>t?1:0});e=[e[~~(r.length/2)]]}else{var i=P.array(t);e=e.slice(i[0],i[1])}return e}var t=null,n=P.accessor("data");return e.by=function(n){return t=n,e},e.field=function(t){return n=P.accessor(t),e},e},P.data.sort=function(){function e(e){e=P.isArray(e)?e:e.values||[],e.sort(t);for(var n=0,r=e.length;r>n;++n)e[n].index=n;return e}var t=null;return e.by=function(n){return t=P.comparator(n),e},e},P.data.stack=function(){function t(e){var t=o.y0,i=o.y1,a=o.cy,s=n(e);return 0===s.length?e:(r.out(function(e,n,r){e.datum&&(e.datum[t]=n,e.datum[i]=r+n,e.datum[a]=n+r/2)})(s),e)}function n(e){var t,n,r,s,o,u,l,c,f=P.values(e),d=[],h=[];if(0===f.length)return h;for(n=0,r=f.length;r>n;++n){for(t=P.values(f[n]),s=0,o=t.length;o>s;++s)d.push({x:i(t[s]),y:a(t[s]),z:n,datum:t[s]});h.push([])}for(d.sort(function(e,t){return e.x<t.x?-1:e.x>t.x?1:e.z<t.z?-1:e.z>t.z?1:0}),c=d[0].x,n=0,s=0,u=0,r=d.length;r>u;++u){if(l=d[u],l.x!==c){for(;n<h.length;)h[n++].push({x:s,y:0});c=l.x,n=0,s+=1}for(;l.z>n;)h[n++].push({x:s,y:0});l.x=s,h[n++].push(l)}for(;n<h.length;)h[n++].push({x:s,y:0});return h}var r=e.layout.stack(),i=P.accessor("index"),a=P.accessor("data"),s=["offset","order"],o={y0:"y2",y1:"y",cy:"cy"};return t.point=function(e){return i=P.accessor(e),t},t.height=function(e){return a=P.accessor(e),t},s.forEach(function(e){t[e]=function(n){return r[e](n),t}}),t.output=function(n){return e.keys(o).forEach(function(e){void 0!==n[e]&&(o[e]=n[e])}),t},t},P.data.stats=function(){function e(e){var t,s,o,u,l=+1/0,c=-1/0,f=0,d=0,h=0,p=(P.isArray(e)?e:e.values||[]).map(n);for(t=0,s=p.length;s>t;++t)o=p[t],l>o&&(l=o),o>c&&(c=o),f+=o,u=o-d,d+=u/(t+1),h+=u*(o-d);h/=s-1;var g=P.isArray(e)?{}:e;if(i&&(p.sort(P.numcmp),t=p.length>>1,g[a.median]=p.length%2?p[t]:(p[t-1]+p[t])/2),g[a.count]=s,g[a.min]=l,g[a.max]=c,g[a.sum]=f,g[a.mean]=d,g[a.variance]=h,g[a.stdev]=Math.sqrt(h),r){for(p=P.isArray(e)?e:e.values,o={},o[a.count]=s,o[a.min]=l,o[a.max]=c,o[a.sum]=f,o[a.mean]=d,o[a.variance]=h,o[a.stdev]=Math.sqrt(h),i&&(o[a.median]=g[a.median]),t=0,s=p.length;s>t;++t)p[t].stats=o;P.isArray(e)&&(g=p)}return g}function t(t){return P.isArray(t)?e(t):(t.values||[]).map(e)}var n=P.accessor("data"),r=!1,i=!1,a={count:"count",min:"min",max:"max",sum:"sum",mean:"mean",variance:"variance",stdev:"stdev",median:"median"};return t.median=function(e){return i=e||!1,t},t.value=function(e){return n=P.accessor(e),t},t.assign=function(e){return r=e,t},t.output=function(e){return P.keys(a).forEach(function(t){void 0!==e[t]&&(a[t]=e[t])}),t},t},P.data.treemap=function(){function t(e,t,a){e=n.size(P.data.size(i,a)).value(r).nodes(P.isTree(e)?e:{values:e});var o=P.keys(s),u=o.length;return e.forEach(function(e){for(var t,n,r=0;u>r;++r)t=o[r],t!==s[t]&&(n=e[t],delete e[t],e[s[t]]=n)}),e}var n=e.layout.treemap().children(function(e){return e.values}),r=P.accessor("data"),i=["width","height"],a=["round","sticky","ratio","padding"],s={x:"x",y:"y",dx:"width",dy:"height"};return t.size=function(e){return i=e,t},t.value=function(e){return r=P.accessor(e),t},a.forEach(function(e){t[e]=function(r){return n[e](r),t}}),t.output=function(e){return P.keys(s).forEach(function(t){void 0!==e[t]&&(s[t]=e[t])}),t},t},P.data.truncate=function(){var e=P.accessor("data"),t="truncate",n="right",r="...",i=!0,a=100,s=P.data.mapper(function(s){var o=P.truncate(e(s),a,n,i,r);return s[t]=o,s});return s.value=function(t){return e=P.accessor(t),s},s.output=function(e){return t=e,s},s.limit=function(e){return a=+e,s},s.position=function(e){return n=e,s},s.ellipsis=function(e){return r=e+"",s},s.wordbreak=function(e){return i=!!e,s},s},P.data.unique=function(){function e(e){return P.unique(e,t).map(function(e){var t={};return t[n]=e,t})}var t=null,n="field";return e.field=function(n){return t=P.accessor(n),e},e.as=function(t){return n=t,e},e},P.data.window=function(){function e(e){e=P.isArray(e)?e:e.values||[];var r,i,a,s=[],o=e.length-t;for(r=0;o>=r;r+=n){for(i=0,a=[];t>i;++i)a.push(e[r+i]);s.push({key:r,values:a})}return{values:s}}var t=2,n=1;return e.size=function(n){return t=n,e},e.step=function(t){return n=t,e},e},P.data.wordcloud=function(){function t(e,t,o){function l(t){var r,i,s,o,l,c=n.size(),f=c[0]/2,d=c[1]/2,h=P.keys(u),p=h.length;for(e.sort(function(e,t){return a(t)-a(e)}),s=0,o=t.length;o>s;++s)for(i=e[s],l=0;p>l;++l)r=h[l],i[u[r]]=t[s][r],"x"===r&&(i[u.x]+=f),"y"===r&&(i[u.y]+=d)}return n.size(P.data.size(i,o)).text(r).fontSize(a).rotate(s).words(e).on("end",l).start(),e}var n=e.layout.cloud().size([900,500]),r=P.accessor("data"),i=["width","height"],a=function(){return 14},s=function(){return 0},o=["font","fontStyle","fontWeight","padding"],u={x:"x",y:"y",size:"fontSize",font:"font",rotate:"angle"};return t.text=function(e){return r=P.accessor(e),t},t.size=function(e){return i=e,t},t.fontSize=function(e){return a=P.accessor(e),t},t.rotate=function(e){var n;return P.isObject(e)&&!Array.isArray(e)?void 0!==e.random?(n=(n=e.random)?P.array(n):[0],s=function(){return n[~~(Math.random()*n.length-1e-5)]}):void 0!==e.alternate&&(n=(n=e.alternate)?P.array(n):[0],s=function(e,t){return n[t%n.length]}):s=P.accessor(field),t},o.forEach(function(e){t[e]=function(r){return n[e](r),t}}),t.output=function(e){return P.keys(u).forEach(function(t){void 0!==e[t]&&(u[t]=e[t])}),t},t},P.data.zip=function(){function e(e,s){var o,u,l,c,f,d=s[t],h=d.length;for(a&&(f={},d.forEach(function(e){f[a(e)]=e})),l=0,c=e.length;c>l;++l)u=e[l],u[n]=f?null!=(o=f[r(u)])?o:i:d[l%h];return e}var t=null,n="zip",r=P.accessor("data"),i=void 0,a=null;return e["with"]=function(n){return t=n,e},e["default"]=function(t){return i=t,e},e.as=function(t){return n=t,e},e.key=function(t){return r=P.accessor(t),e},e.withKey=function(t){return a=P.accessor(t),e},e},P.data.zip.dependencies=["with"],P.parse={},P.parse.axes=function(){function e(e,n,r){(e||[]).forEach(function(e,i){n[i]=n[i]||P.scene.axis(),t(e,i,n[i],r)})}function t(e,t,r,i){void 0!==e.scale&&r.scale(i[e.scale]),r.orient(e.orient||n[e.type]),r.offset(e.offset||0),r.layer(e.layer||"front"),r.grid(e.grid||!1),r.title(e.title||null),r.titleOffset(null!=e.titleOffset?e.titleOffset:P.config.axis.titleOffset),r.tickValues(e.values||null),r.tickFormat(e.format||null),r.tickSubdivide(e.subdivide||0),r.tickPadding(e.tickPadding||P.config.axis.padding);var a=[];if(void 0!==e.tickSize)for(var s=0;3>s;++s)a.push(e.tickSize);else{var o=P.config.axis.tickSize;a=[o,o,o]}if(null!=e.tickSizeMajor&&(a[0]=e.tickSizeMajor),null!=e.tickSizeMinor&&(a[1]=e.tickSizeMinor),null!=e.tickSizeEnd&&(a[2]=e.tickSizeEnd),a.length&&r.tickSize.apply(r,a),null!=e.ticks){var u=P.isArray(e.ticks)?e.ticks:[e.ticks];r.ticks.apply(r,u)}else r.ticks(P.config.axis.ticks);var l=e.properties;l&&l.ticks?(r.majorTickProperties(l.majorTicks?P.extend({},l.ticks,l.majorTicks):l.ticks),r.minorTickProperties(l.minorTicks?P.extend({},l.ticks,l.minorTicks):l.ticks)):(r.majorTickProperties(l&&l.majorTicks||{}),r.minorTickProperties(l&&l.minorTicks||{})),r.tickLabelProperties(l&&l.labels||{}),r.titleProperties(l&&l.title||{}),r.gridLineProperties(l&&l.grid||{}),r.domainProperties(l&&l.axis||{})}var n={x:"bottom",y:"left",top:"top",bottom:"bottom",left:"left",right:"right"};return e}(),P.parse.data=function(e,t){function n(e){return function(n,r){n?P.error("LOADING FAILED: "+e.url):i.load[e.name]=P.data.read(r.toString(),e.format),0===--a&&t()}}function r(e){1!==l[e]&&(l[e]||(l[e]=1,(i.source[e]||[]).forEach(r),(i.deps[e]||[]).forEach(r),l[e]=2,u.push(e)))}var i={defs:e,load:{},flow:{},deps:{},source:{},sorted:null},a=0;(e||[]).forEach(function(e){if(e.url?(a+=1,P.data.load(e.url,n(e))):e.values?i.load[e.name]=P.data.read(e.values,e.format):e.source&&(i.source[e.source]||(i.source[e.source]=[])).push(e.name),e.transform){var t=P.parse.dataflow(e);i.flow[e.name]=t,t.dependencies.forEach(function(t){(i.deps[t]||(i.deps[t]=[])).push(e.name)})}});for(var s,o=(e||[]).map(P.accessor("name")),u=[],l={};o.length;)2!==l[s=o.pop()]&&r(s);return i.sorted=u.reverse(),0===a&&setTimeout(t,1),i},P.parse.dataflow=function(e){var t=(e.transform||[]).map(P.parse.transform),n=t.length?function(e,n,r){return t.reduce(function(e,t){return t(e,n,r)},e)}:P.identity;return n.transforms=t,n.dependencies=P.keys((e.transform||[]).reduce(function(e,t){var n=P.data[t.type].dependencies;return n&&n.forEach(function(n){t[n]&&(e[t[n]]=1)}),e},{})),n},P.parse.expr=function(){var e={E:"Math.E",LN2:"Math.LN2",LN10:"Math.LN10",LOG2E:"Math.LOG2E",LOG10E:"Math.LOG10E",PI:"Math.PI",SQRT1_2:"Math.SQRT1_2",SQRT2:"Math.SQRT2"},t={abs:"Math.abs",acos:"Math.acos",asin:"Math.asin",atan:"Math.atan",atan2:"Math.atan2",ceil:"Math.ceil",cos:"Math.cos",exp:"Math.exp",floor:"Math.floor",log:"Math.log",max:"Math.max",min:"Math.min",pow:"Math.pow",random:"Math.random",round:"Math.round",sin:"Math.sin",sqrt:"Math.sqrt",tan:"Math.tan"},n=/([\"\']|[\=\<\>\~\&\|\?\:\+\-\/\*\%\!\^\,\;\[\]\{\}\(\) ]+)/;return function(r){if(P.config.safeMode)return P.error("Safe mode: Expression parsing disabled."),P.true;var i,a,s,o,u,l,c=r.split(n);for(u=0,l=0,s=0,o=c.length;o>s;++s){var i=c[s];"'"!==i?'"'!==i?l||u||(e[i]&&(c[s]=e[i]),t[i]&&(a=c[s+1])&&"("===a[0]&&(c[s]=t[i])):u||(l=!l):l||(u=!u)}return Function("d","index","data","return ("+c.join("")+");")}}(),P.parse.legends=function(){function e(e,n,r){(e||[]).forEach(function(e,i){n[i]=n[i]||P.scene.legend(),t(e,i,n[i],r)})}function t(e,t,n,r){n.size(e.size?r[e.size]:null),n.shape(e.shape?r[e.shape]:null),n.fill(e.fill?r[e.fill]:null),n.stroke(e.stroke?r[e.stroke]:null),e.orient&&n.orient(e.orient),null!=e.offset&&n.offset(e.offset),n.title(e.title||null),n.values(e.values||null),n.format(void 0!==e.format?e.format:null);var i=e.properties;n.titleProperties(i&&i.title||{}),n.labelProperties(i&&i.labels||{}),n.legendProperties(i&&i.legend||{}),n.symbolProperties(i&&i.symbols||{}),n.gradientProperties(i&&i.gradient||{})}return e}(),P.parse.mark=function(e){var t=e.properties,n=e.marks;if(P.keys(t).forEach(function(n){t[n]=P.parse.properties(e.type,t[n])}),e.delay&&(e.delay=P.parse.properties(e.type,{delay:e.delay})),e.from){var r=e.from.data,i=P.parse.dataflow(e.from);e.from=function(e,t,n){var a=P.scene.data(r?e[r]:null,n);return i(a,e,t)}}return n&&(e.marks=n.map(P.parse.mark)),e},P.parse.marks=function(e,t,n){return{type:"group",width:t,height:n,scales:e.scales||[],axes:e.axes||[],legends:e.legends||[],marks:(e.marks||[]).map(P.parse.mark)}},P.parse.padding=function(e){if(null==e)return"auto";if(P.isString(e))return"strict"===e?"strict":"auto";if(P.isObject(e))return e;var t=P.isNumber(e)?e:20;return{top:t,left:t,right:t,bottom:t}},P.parse.properties=function(){function e(e,r){var i,a,s,o,u="",l=P.keys(r),c={};for(u+="var o = trans ? {} : item;\n",i=0,a=l.length;a>i;++i)o=r[s=l[i]],u+=i>0?"\n  ":"  ",u+="o."+s+" = "+n(s,o)+";",c[s]=!0;c.x2&&(c.x?(u+="\n  if (o.x > o.x2) { var t = o.x; o.x = o.x2; o.x2 = t; };",u+="\n  o.width = (o.x2 - o.x);"):u+=c.width?"\n  o.x = (o.x2 - o.width);":"\n  o.x = o.x2;"),c.xc&&(u+=c.width?"\n  o.x = (o.xc - o.width/2);":"\n  o.x = o.xc;"),c.y2&&(c.y?(u+="\n  if (o.y > o.y2) { var t = o.y; o.y = o.y2; o.y2 = t; };",u+="\n  o.height = (o.y2 - o.y);"):u+=c.height?"\n  o.y = (o.y2 - o.height);":"\n  o.y = o.y2;"),c.yc&&(u+=c.height?"\n  o.y = (o.yc - o.height/2);":"\n  o.y = o.yc;"),t(e,c)&&(u+="\n  item.touch();"),u+="\n  if (trans) trans.interpolate(item, o);";try{return Function("item","group","trans",u)}catch(f){P.error(f),P.log(u)}}function t(e,t){return t.path||("area"===e||"line"===e)&&(t.x||t.x2||t.width||t.y||t.y2||t.height||t.tension||t.interpolate)}function n(e,t){if(null==t)return null;var n="fill"===e||"stroke"===e;if(n){if(t.c)return r("hcl",t.h,t.c,t.l);if(t.h||t.s)return r("hsl",t.h,t.s,t.l);if(t.l||t.a)return r("lab",t.l,t.a,t.b);if(t.r||t.g||t.b)return r("rgb",t.r,t.g,t.b)}var a="item.datum.data";if(void 0!==t.value&&(a=P.str(t.value)),null!=t.group){var s="group.datum";P.isString(t.group)&&(s=i[t.group]?"group."+t.group:"group.datum["+P.field(t.group).map(P.str).join("][")+"]")}if(null!=t.field?P.isString(t.field)?(a="item.datum["+P.field(t.field).map(P.str).join("][")+"]",null!=t.group&&(a="this.accessor("+a+")("+s+")")):a="this.accessor(group.datum["+P.field(t.field.group).map(P.str).join("][")+"])(item.datum.data)":null!=t.group&&(a=s),null!=t.scale){var o=P.isString(t.scale)?P.str(t.scale):(t.scale.group?"group":"item")+".datum["+P.str(t.scale.group||t.scale.field)+"]";o="group.scales["+o+"]",a=o+(t.band?".rangeBand()":"("+a+")")}return a="("+(t.mult?P.number(t.mult)+" * ":"")+a+")"+(t.offset?" + "+P.number(t.offset):"")}function r(e,t,r,i){var a=t?n("",t):P.config.color[e][0],s=r?n("",r):P.config.color[e][1],o=i?n("",i):P.config.color[e][2];return"(this.d3."+e+"("+[a,s,o].join(",")+') + "")'}var i={width:1,height:1,"mark.group.width":1,"mark.group.height":1};return e}(),P.parse.scales=function(){function t(e,t,r,i){return(e||[]).reduce(function(e,t){var a=t.name,s=a+":prev";return e[a]=n(t,e[a],r,i),e[s]=e[s]||e[a],e},t||{})}function n(e,t,n,s){var o=r(e,t),u=o.type===f?i:a,c=l(e,s),d=P.values(s.datum);return u(e,o,c,n,d),o}function r(t,n){var r=t.type||c;if(!n||r!==n.type){var i=P.config.scale[r]||e.scale[r];i||P.error("Unrecognized scale type: "+r),(n=i()).type=n.type||r,n.scaleName=t.name}return n}function i(e,t,n,r,i){var a,u,l,c,f=!1,d=e.padding||0,h=e.outerPadding||0;if(P.isObject(e.range)&&!P.isArray(e.range)&&(f=!0,c=e.range.fields||P.array(e.range),n=s(c,r,i)),u=e.sort&&!f,a=o(e,r,i,u),a&&t.domain(a),e.bandWidth){var p=e.bandWidth,g=a.length,v=n[0]||0,m=e.points?d*p:d*p*(g-1)+2*h;n=[v,v+(p*g+m)]}l="string"==typeof n[0],l||n.length>2||1===n.length||f?t.range(n):e.points?t.rangePoints(n,d):e.round||void 0===e.round?t.rangeRoundBands(n,d,h):t.rangeBands(n,d,h)}function a(t,n,r,i,a){var s,l;s=t.type===g?o(t,i,a,!1):u(t,i,a),n.domain(s),"height"===t.range&&(r=r.reverse()),n[t.round&&n.rangeRound?"rangeRound":"range"](r),t.exponent&&t.type===h&&n.exponent(t.exponent),t.clamp&&n.clamp(!0),t.nice&&(t.type===p?(l=e.time[t.nice],l||P.error("Unrecognized interval: "+l),n.nice(l)):n.nice())}function s(e,t,n){return e.reduce(function(e,r){var i=P.values(t[r.data]||n),a=P.accessor(P.isString(r.field)?r.field:"data."+P.accessor(r.field.group)(n));return P.unique(i,a,e)},[])}function o(e,t,n,r){var i,a,o=e.domain;return P.isArray(o)?i=r?o.slice():o:P.isObject(o)&&(a=o.fields||P.array(o),i=s(a,t,n)),i&&r&&i.sort(P.cmp),i}function u(t,n,r){function i(t,i,a,s){var u=P.values(n[t.data]||r),l=P.array(t.field).map(function(e){return P.isString(e)?e:"data."+P.accessor(e.group)(r)});l.forEach(function(t){t=P.accessor(t),i&&(o[0]=e.min([o[0],e.min(u,t)])),a&&(o[s]=e.max([o[s],e.max(u,t)]))})}var a,s,o=[null,null];return void 0!==t.domain&&(P.isArray(t.domain)?o=t.domain.slice():P.isObject(t.domain)?(a=t.domain.fields||P.array(t.domain),a.forEach(function(e){i(e,1,1,1)})):o=t.domain),s=o.length-1,void 0!==t.domainMin&&(P.isObject(t.domainMin)?(o[0]=null,a=t.domainMin.fields||P.array(t.domainMin),a.forEach(function(e){i(e,1,0,s)})):o[0]=t.domainMin),void 0!==t.domainMax&&(P.isObject(t.domainMax)?(o[s]=null,a=t.domainMax.fields||P.array(t.domainMax),a.forEach(function(e){i(e,0,1,s)})):o[s]=t.domainMax),t.type===d||t.type===p||!t.zero&&void 0!==t.zero||(o[0]=Math.min(0,o[0]),o[s]=Math.max(0,o[s])),o}function l(e,t){var n=[null,null];if(void 0!==e.range)if("string"==typeof e.range)if(v[e.range])n=[0,t[e.range]];else{if(!P.config.range[e.range])return P.error("Unrecogized range: "+e.range),n;n=P.config.range[e.range]}else if(P.isArray(e.range))n=e.range;else{if(P.isObject(e.range))return null;n=[0,e.range]}if(void 0!==e.rangeMin&&(n[0]=e.rangeMin),void 0!==e.rangeMax&&(n[n.length-1]=e.rangeMax),void 0!==e.reverse){var r=e.reverse;P.isObject(r)&&(r=P.accessor(r.field)(t.datum)),r&&(n=n.reverse())}return n}var c="linear",f="ordinal",d="log",h="pow",p="time",g="quantile",v={width:1,height:1};return t}(),P.parse.spec=function(t,n,r){function i(e){e=P.duplicate(e);var t=e.width||500,i=e.height||500,a=e.viewport||null,s={width:t,height:i,viewport:a,padding:P.parse.padding(e.padding),marks:P.parse.marks(e,t,i),data:P.parse.data(e.data,function(){n(o)})},o=r(s)}r=r||P.ViewFactory,P.isObject(t)?i(t):e.json(t,function(e,t){e?P.error(e):i(t)})},P.parse.transform=function(e){var t=P.data[e.type]();return P.keys(e).forEach(function(n){"type"!==n&&t[n](e[n])}),t},P.scene={},P.scene.GROUP="group",P.scene.ENTER=0,P.scene.UPDATE=1,P.scene.EXIT=2,P.scene.DEFAULT_DATA={sentinel:1},P.scene.data=function(e,t){var n=P.scene.DEFAULT_DATA;return e=P.values(e||t||[n]),e===n&&(e=[n]),e},P.scene.fontString=function(e){return(e.fontStyle?e.fontStyle+" ":"")+(e.fontVariant?e.fontVariant+" ":"")+(e.fontWeight?e.fontWeight+" ":"")+(null!=e.fontSize?e.fontSize:P.config.render.fontSize)+"px "+(e.font||P.config.render.font)},P.scene.Item=function(){function e(e){this.mark=e}var t=e.prototype;return t.hasPropertySet=function(e){var t=this.mark.def.properties;return t&&null!=t[e]},t.cousin=function(e,t){if(0===e)return this;e=e||-1;var n=this.mark,r=n.group,i=null==t?n.items.indexOf(this):t,a=r.items.indexOf(n)+e;return r.items[a].items[i]},t.sibling=function(e){if(0===e)return this;e=e||-1;var t=this.mark,n=t.items.indexOf(this)+e;return t.items[n]},t.remove=function(){var e=this,t=e.mark.items,n=t.indexOf(e);return n>=0&&(n===t.length-1?t.pop():t.splice(n,1)),e},t.touch=function(){this.pathCache&&(this.pathCache=null),this.mark.pathCache&&(this.mark.pathCache=null)},e}(),P.scene.item=function(e){return new P.scene.Item(e)},P.scene.visit=function(e,t){var n,r,i,a,s;if(t(e))return!0;var o=["items","axisItems","legendItems"];for(i=0,a=o.length;a>i;++i)if(s=e[o[i]])for(n=0,r=s.length;r>n;++n)if(P.scene.visit(s[n],t))return!0},P.scene.build=function(){function t(e,t,s,u,l){var c=P.scene.data(e.from?e.from(t,s,u):null,u);return s=n(e,s),s.items=r(e,c,s),a(e,s),e.type===o&&i(e,t,s,l),s}function n(e,t){return t=t||{},t.def=e,t.marktype=e.type,t.interactive=!(e.interactive===!1),t}function r(e,t,n){var r,i,a,o,f,d,h=s(e.key),p=n.items||[],g=[],v={};for(r=0,a=p.length;a>r;++r)o=p[r],o.status=c,h&&(v[o.key]=o);for(r=0,a=t.length;a>r;++r)f=t[r],i=r,o=h?v[i=h(f)]:p[r],d=o?!1:(o=P.scene.item(n),!0),o.status=d?u:l,o.datum=f,o.key=i,g.push(o);for(r=0,a=p.length;a>r;++r)o=p[r],o.status===c&&(o.key=h?o.key:g.length,g.splice(o.index,0,o));return g}function i(e,n,r,i){var a,s,o,u,l,c,f=r.items,d=e.marks;for(a=0,s=f.length;s>a;++a){if(c=f[a],!i&&c.scales)for(l in c.scales)l.indexOf(":prev")<0&&(c.scales[l+":prev"]=c.scales[l].copy());for(c.items=c.items||[],o=0,u=d.length;u>o;++o)c.items[o]=t(d[o],n,c.items[o],c.datum),c.items[o].group=c}}function a(t,n){if(t.duration&&(n.duration=t.duration),t.ease&&(n.ease=e.ease(t.ease)),t.delay){var r,i=n.items,a=n.group,s=i.length;for(r=0;s>r;++r)t.delay.call(this,i[r],a)}}function s(e){if(null==e)return null;var t=P.array(e).map(P.accessor);return function(e){for(var n="",r=0,i=t.length;i>r;++r)r>0&&(n+="|"),n+=String(t[r](e));return n}}var o=P.scene.GROUP,u=P.scene.ENTER,l=P.scene.UPDATE,c=P.scene.EXIT;return t}(),P.scene.bounds=function(){function t(){return _||(_=(P.config.isNode?new(require("canvas"))(1,1):e.select("body").append("canvas").attr("class","vega_hidden").attr("width",1).attr("height",1).style("display","none").node()).getContext("2d"))}function n(e,t,n){return null==t?n.set(0,0,0,0):(v(t,n),e.stroke&&0!==e.opacity&&e.strokeWidth>0&&n.expand(e.strokeWidth)),n}function r(e,t){var r=e.path?e.pathCache||(e.pathCache=g(e.path)):null;return n(e,r,t)}function i(e,t){var r=e.mark.items,e=r[0],i=e.pathCache||(e.pathCache=g(m(r)));return n(r[0],i,t)}function a(e,t){var r=e.mark.items,e=r[0],i=e.pathCache||(e.pathCache=g(y(r)));return n(r[0],i,t)}function s(e,t){var n=e.x||0,r=e.y||0,i=n+e.width||0,a=r+e.height||0;return t.set(n,r,i,a),e.stroke&&0!==e.opacity&&e.strokeWidth>0&&t.expand(e.strokeWidth),t}function o(e,t){var n=e.width||0,r=e.height||0,i=(e.x||0)-("center"===e.align?n/2:"right"===e.align?n:0),a=(e.y||0)-("middle"===e.baseline?r/2:"bottom"===e.baseline?r:0);return t.set(i,a,i+n,a+r)}function u(e,t){var n,r;return t.set(n=e.x||0,r=e.y||0,null!=e.x2?e.x2:n,null!=e.y2?e.y2:r),e.stroke&&0!==e.opacity&&e.strokeWidth>0&&t.expand(e.strokeWidth),t}function l(e,t){var n,r,i,a,s,o,u,l,c,f=e.x||0,d=e.y||0,h=e.innerRadius||0,p=e.outerRadius||0,g=(e.startAngle||0)-x,v=(e.endAngle||0)-x,m=1/0,y=-1/0,b=1/0,k=-1/0,_=[g,v],w=g-g%x;for(r=0;4>r&&v>w;++r,w+=x)_.push(w);for(r=0,i=_.length;i>r;++r)n=_[r],a=Math.cos(n),o=h*a,l=p*a,s=Math.sin(n),u=h*s,c=p*s,m=Math.min(m,o,l),y=Math.max(y,o,l),b=Math.min(b,u,c),k=Math.max(k,u,c);return t.set(f+m,d+b,f+y,d+k),e.stroke&&0!==e.opacity&&e.strokeWidth>0&&t.expand(e.strokeWidth),t}function c(e,t){var n,r,i,a,s=null!=e.size?e.size:100,o=e.x||0,u=e.y||0;switch(e.shape){case"cross":n=Math.sqrt(s/5)/2,r=3*n,t.set(o-r,u-n,o+r,u+n);break;case"diamond":a=Math.sqrt(s/(2*k)),i=a*k,t.set(o-i,u-a,o+i,u+a);break;case"square":r=Math.sqrt(s),n=r/2,t.set(o-n,u-n,o+n,u+n);break;case"triangle-down":i=Math.sqrt(s/b),a=i*b/2,t.set(o-i,u-a,o+i,u+a);break;case"triangle-up":i=Math.sqrt(s/b),a=i*b/2,t.set(o-i,u-a,o+i,u+a);break;default:n=Math.sqrt(s/Math.PI),t.set(o-n,u-n,o+n,u+n)}return e.stroke&&0!==e.opacity&&e.strokeWidth>0&&t.expand(e.strokeWidth),t}function f(e,n,r){var i,a,s=(e.x||0)+(e.dx||0),o=(e.y||0)+(e.dy||0),u=e.fontSize||P.config.render.fontSize,l=e.align,c=e.baseline,f=e.radius||0,d=t();return d.font=P.scene.fontString(e),d.textAlign=l||"left",d.textBaseline=c||"alphabetic",i=d.measureText(e.text||"").width,f&&(a=(e.theta||0)-Math.PI/2,s+=f*Math.cos(a),o+=f*Math.sin(a)),"center"===l?s-=i/2:"right"===l&&(s-=i),"top"===c?o+=u/5:"bottom"===c?o-=u:"middle"===c?o=o-u/2+u/10:o-=4*u/5,n.set(s,o,s+i,o+u),e.angle&&!r&&n.rotate(e.angle*Math.PI/180,e.x||0,e.y||0),n.expand(r?0:1)}function d(e,t,n){var r,i,a=e.axisItems||[],s=e.legendItems||[];for(r=0,i=a.length;i>r;++r)t.union(a[r].bounds);for(r=0,i=e.items.length;i>r;++r)t.union(e.items[r].bounds);if(n){for(r=0,i=s.length;i>r;++r)t.union(s[r].bounds);null!=e.width&&null!=e.height&&t.add(e.width,e.height),null!=e.x&&null!=e.y&&t.add(0,0)}return t.translate(e.x||0,e.y||0),t}function h(e,t,n){t=t||w[e.mark.marktype],e.bounds_prev||(e["bounds:prev"]=new P.Bounds);var r=e.bounds,i=e["bounds:prev"];return r&&i.clear().union(r),e.bounds=t(e,r?r.clear():new P.Bounds,n),r||i.clear().union(e.bounds),e.bounds}function p(e,t,n){t=t||e.bounds&&e.bounds.clear()||new P.Bounds;var r,i,a=e.marktype,s=w[a],o=e.items;if("area"===a||"line"===a)o.length&&(o[0].bounds=s(o[0],t));else for(r=0,i=o.length;i>r;++r)t.union(h(o[r],s,n));e.bounds=t}var g=P.canvas.path.parse,v=P.canvas.path.bounds,m=P.canvas.path.area,y=P.canvas.path.line,x=Math.PI/2,b=Math.sqrt(3),k=Math.tan(30*Math.PI/180),_=null,w={group:d,symbol:c,image:o,rect:s,rule:u,arc:l,text:f,path:r,area:i,line:a};return{mark:p,item:h,text:f,group:d}}(),P.scene.encode=function(){function e(e,r,i,a,s){return a&&s?t.call(this,e,r,i,a,s):n.call(this,e,e,r,i,a),e}function t(e,t,n,r,i){i=P.array(i);var a,s,o,u,l,c;for(a=0,s=i.length;s>a;++a)o=i[a],u=o.mark.group||null,l=o.mark.def.properties,c=l&&l[r],c&&(c.call(P,o,u,n),P.scene.bounds.item(o))}function n(e,t,n,r,o){a.call(this,e,t.items,n,r,o),t.marktype===s?i.call(this,t,n,e,r,o):P.scene.bounds.mark(t)}function r(e,t,n,r,s){i.call(this,t,n,e,r,s),a.call(this,e,t.items,n,r,s),P.scene.bounds.mark(t,null,!0)}function i(e,t,i,a,s){var o,u,l,c,f,d,h,p,g,v,m,y;for(o=0,u=e.items.length;u>o;++o)for(f=e.items[o],d=f.scales||(f.scales=t.scales?P.extend({},i.scales):i.scales),t.scales&&P.parse.scales(t.scales,d,this._data,f),t.axes&&(h=f.axes||(f.axes=[]),p=f.axisItems||(f.axisItems=[]),P.parse.axes(t.axes,h,f.scales),h.forEach(function(e,t){g=e.def(),p[t]=P.scene.build(g,this._data,p[t],null,1),p[t].group=f,n.call(this,f,f.axisItems[t],g,a)})),l=0,c=f.items.length;c>l;++l)n.call(this,f,f.items[l],t.marks[l],a,s);if(P.scene.bounds.mark(e,null,!t.legends),t.legends){for(o=0,u=e.items.length;u>o;++o)f=e.items[o],v=f.legends||(f.legends=[]),m=f.legendItems||(f.legendItems=[]),P.parse.legends(t.legends,v,f.scales),v.forEach(function(e,t){y=e.def(),m[t]=P.scene.build(y,this._data,m[t],null,1),m[t].group=f,r.call(this,f,f.legendItems[t],y,a)});P.scene.bounds.mark(e,null,!0)}}function a(e,t,n,r,i){var a,s,f,d,h=n.properties||c,p=h.enter,g=h.update,v=h.exit;if(i){if(d=h[i])for(a=0,s=t.length;s>a;++a)d.call(P,t[a],e,r)}else for(a=0;a<t.length;++a)f=t[a],f.status===o&&(p&&p.call(P,f,e),f.status=u),f.status!==l&&g&&g.call(P,f,e,r),f.status===l&&(v&&v.call(P,f,e,r),r&&!v?r.interpolate(f,c):r||t[a--].remove())}var s=P.scene.GROUP,o=P.scene.ENTER,u=P.scene.UPDATE,l=P.scene.EXIT,c={};return e}(),P.scene.Transition=function(){function t(t,n){this.duration=t||500,this.ease=n&&e.ease(n)||e.ease("cubic-in-out"),this.updates={next:null}}function n(e){for(var t,n,r,i,a,s,o=this.updates,u=o,l=u.next,c=this.duration,f=!0;null!=l;u=l,l=u.next)if(t=l.item,n=t.delay||0,r=(e-n)/c,0>r)f=!1;else{for(r>1&&(r=1),i=l.ease(r),a=0,s=l.length;s>a;++a)t[l[a].property]=l[a](i);t.touch(),P.scene.bounds.item(t),1===r?(l.remove&&t.remove(),u.next=l.next,l=u):f=!1}return this.callback(),f}var r=t.prototype,i={text:1,url:1};return r.interpolate=function(t,n){var r,a,s,o,u=null;for(r in n)a=t[r],s=n[r],a!==s&&(i[r]||void 0===a?t[r]=s:"number"!=typeof a||isFinite(a)?(o=e.interpolate(a,s),o.property=r,(u||(u=[])).push(o)):t[r]=s);return null===u&&t.status===P.scene.EXIT&&(u=[]),null!=u&&(u.item=t,u.ease=t.mark.ease||this.ease,u.next=this.updates.next,this.updates.next=u),this},r.start=function(t){for(var r=this,i=r.updates,a=i.next;null!=a;i=a,a=i.next)a.item.status===P.scene.EXIT&&(a.remove=!0);r.callback=t,e.timer(function(e){return n.call(r,e)})},t}(),P.scene.transition=function(e,t){return new P.scene.Transition(e,t)},P.scene.axis=function(){function t(){o=null}function n(e){var t,n,r;"ordinal"===e.type?(t={scale:e.scaleName,offset:.5+e.rangeBand()/2},n=t):(t={scale:e.scaleName,offset:.5},n={scale:e.scaleName+":prev",offset:.5}),r=m(e);var a=w(),o=w(),u=w(),l=S(),c=A(),g=O();a.properties.enter.stroke={value:P.config.axis.gridColor},x(i,a,n,t,1/0),x(i,o,n,t,f),x(i,u,n,t,d),y(i,l,n,t,f,p),k(i,c,r,h),b(i,g,r,s),P.extend(a.properties.update,z),P.extend(o.properties.update,j),P.extend(u.properties.update,I),P.extend(l.properties.update,L),P.extend(c.properties.update,W),P.extend(g.properties.update,D);var v=[a,o,u,l,c,g];return{type:"group",interactive:!1,properties:{enter:_,update:_},marks:v.map(P.parse.mark)}}var r,i=P.config.axis.orient,a=0,s=P.config.axis.titleOffset,o=null,u="front",l=!1,c=null,f=P.config.axis.tickSize,d=P.config.axis.tickSize,h=P.config.axis.tickSize,p=P.config.axis.padding,v=null,T=null,E=null,M=0,C=[P.config.axis.ticks],z={},L={},j={},I={},D={},W={},R={};return R.def=function(){var t=o?o:o=n(r);E=T?"time"===r.type?e.time.format(T):e.format(T):null;var s=null==v?r.ticks?r.ticks.apply(r,C):r.domain():v,f=g(r,s,M).map(P.data.ingest);s=s.map(P.data.ingest);var d=null==E?r.tickFormat?r.tickFormat.apply(r,C):String:E;s.forEach(function(e){e.label=d(e.data)});var h=c?[c].map(P.data.ingest):[];return t.marks[0].from=function(){return l?s:[]},t.marks[1].from=function(){return s},t.marks[2].from=function(){return f},t.marks[3].from=t.marks[1].from,t.marks[4].from=function(){return[1]},t.marks[5].from=function(){return h},t.offset=a,t.orient=i,t.layer=u,t},R.scale=function(e){return arguments.length?(r!==e&&(r=e,t()),R):r},R.orient=function(e){return arguments.length?(i!==e&&(i=e in F?e+"":P.config.axis.orient,t()),R):i},R.title=function(e){return arguments.length?(c!==e&&(c=e,t()),R):c},R.ticks=function(){return arguments.length?(C=arguments,R):C},R.tickValues=function(e){return arguments.length?(v=e,R):v},R.tickFormat=function(e){return arguments.length?(T!==e&&(T=e,t()),R):T},R.tickSize=function(e,n){if(!arguments.length)return f;var r=arguments.length-1,i=+e,a=r>1?+n:f,s=r>0?+arguments[r]:f;return(f!==i||d!==a||h!==s)&&t(),f=i,d=a,h=s,R},R.tickSubdivide=function(e){return arguments.length?(M=+e,R):M},R.offset=function(e){return arguments.length?(a=P.isObject(e)?e:+e,R):a},R.tickPadding=function(e){return arguments.length?(p!==+e&&(p=+e,t()),R):p},R.titleOffset=function(e){return arguments.length?(s!==+e&&(s=+e,t()),R):s},R.layer=function(e){return arguments.length?(u!==e&&(u=e,t()),R):u},R.grid=function(e){return arguments.length?(l!==e&&(l=e,t()),R):l},R.gridLineProperties=function(e){return arguments.length?(z!==e&&(z=e),R):z},R.majorTickProperties=function(e){return arguments.length?(j!==e&&(j=e),R):j},R.minorTickProperties=function(e){return arguments.length?(I!==e&&(I=e),R):I},R.tickLabelProperties=function(e){return arguments.length?(L!==e&&(L=e),R):L},R.titleProperties=function(e){return arguments.length?(D!==e&&(D=e),R):D},R.domainProperties=function(e){return arguments.length?(W!==e&&(W=e),R):W},R.reset=function(){t()},R};var F={top:1,right:1,bottom:1,left:1},Y={bottom:"center",top:"center",left:"right",right:"left"},q={bottom:"top",top:"bottom",left:"middle",right:"middle"};P.scene.legend=function(){function t(){o=null}function n(e){return"ordinal"===e||"quantize"===e||"quantile"===e||"threshold"===e
}function r(t){var n,r,a,s=i(u,l,c,f),o=(null==h?t.ticks?t.ticks.apply(t,b):t.domain():h).map(P.data.ingest),g=null==p?t.tickFormat?t.tickFormat.apply(t,b):String:p,m=5,y=e.range(o.length);u?(r=o.map(function(e){return Math.sqrt(u(e.data))}),a=e.max(r),r=r.reduce(function(e,t,n,r){return n>0&&(e[n]=e[n-1]+r[n-1]/2+m),e[n]+=t/2,e},[0]).map(Math.round)):(a=Math.round(Math.sqrt(P.config.legend.symbolSize)),r=d||(n=O.fontSize)&&n.value+m||P.config.legend.labelFontSize+m,r=y.map(function(e,t){return Math.round(a/2+t*r)}));var k,_=x;v&&(k=S.fontSize,_+=5+(k&&k.value||P.config.legend.titleFontSize));for(var w=0,A=r.length;A>w;++w)r[w]+=_;var t={name:"legend",type:"ordinal",points:!0,domain:y,range:r},T=(v?[v]:[]).map(P.data.ingest);return o.forEach(function(e){e.label=g(e.data),e.offset=a}),s.scales=[t],s.marks[0].from=function(){return T},s.marks[1].from=function(){return o},s.marks[2].from=s.marks[1].from,s}function i(e,t,n,r){var i=M(),a=C(),s=z();return E(a,e,t,n,r),P.extend(i.properties.update,S),P.extend(a.properties.update,_),P.extend(s.properties.update,O),i.properties.enter.x.value+=x,i.properties.enter.y.value+=x,s.properties.enter.x.offset+=x+1,a.properties.enter.x.offset=x+1,s.properties.update.x.offset+=x+1,a.properties.update.x.offset=x+1,{type:"group",interactive:!1,properties:{enter:P.parse.properties("group",k),update:T},marks:[i,a,s].map(P.parse.mark)}}function a(e){var t=s(e),n=e.domain(),r=n.map(P.data.ingest),i=w.width&&w.width.value||P.config.legend.gradientWidth,a=null==p?e.tickFormat?e.tickFormat.apply(e,b):String:p,o={name:"legend",type:e.type,round:!0,zero:!1,domain:[n[0],n[n.length-1]],range:[x,i+x]};"pow"===e.type&&(o.exponent=e.exponent());var u=(v?[v]:[]).map(P.data.ingest);return r.forEach(function(e,t){e.label=a(e.data),e.align=t==r.length-1?"right":0==t?"left":"center"}),t.scales=[o],t.marks[0].from=function(){return u},t.marks[1].from=function(){return[1]},t.marks[2].from=function(){return r},t}function s(e){var t=M(),n=L(),r=j(),i=new P.Gradient,a=e.domain(),s=a[0],o=a[a.length-1],u=e.copy().domain([s,o]).range([0,1]),l="linear"!==e.type&&e.ticks?e.ticks.call(e,15):a;s!==l[0]&&l.unshift(s),o!==l[l.length-1]&&l.push(o);for(var c=0,f=l.length;f>c;++c)i.stop(u(l[c]),e(l[c]));n.properties.enter.fill={value:i},P.extend(t.properties.update,S),P.extend(n.properties.update,w),P.extend(r.properties.update,O);var d=n.properties,h=w.height,p=h&&h.value||d.enter.height.value;if(r.properties.enter.y.value=p,r.properties.update.y.value=p,v){var g=t.properties,m=S.fontSize,y=4+(m&&m.value||g.enter.fontSize.value);n.properties.enter.y.value+=y,r.properties.enter.y.value+=y,n.properties.update.y.value+=y,r.properties.update.y.value+=y}return t.properties.enter.x.value+=x,t.properties.enter.y.value+=x,n.properties.enter.x.value+=x,n.properties.enter.y.value+=x,r.properties.enter.y.value+=x,n.properties.update.x.value+=x,n.properties.update.y.value+=x,r.properties.update.y.value+=x,{type:"group",interactive:!1,properties:{enter:P.parse.properties("group",k),update:T},marks:[t,n,r].map(P.parse.mark)}}var o,u=null,l=null,c=null,f=null,d=null,h=null,p=null,g=null,v=void 0,m="right",y=P.config.legend.offset,x=P.config.legend.padding,b=[5],k={},_={},w={},S={},O={},A={},o=null;return A.def=function(){var t=u||l||c||f;return p=g?"time"===t.type?e.time.format(g):e.format(g):null,o||(o=t!==c&&t!==f||n(t.type)?r(t):a(t)),o.orient=m,o.offset=y,o.padding=x,o},A.size=function(e){return arguments.length?(u!==e&&(u=e,t()),A):u},A.shape=function(e){return arguments.length?(l!==e&&(l=e,t()),A):l},A.fill=function(e){return arguments.length?(c!==e&&(c=e,t()),A):c},A.stroke=function(e){return arguments.length?(f!==e&&(f=e,t()),A):f},A.title=function(e){return arguments.length?(v!==e&&(v=e,t()),A):v},A.format=function(e){return arguments.length?(g!==e&&(g=e,t()),A):g},A.spacing=function(e){return arguments.length?(d!==+e&&(d=+e,t()),A):d},A.orient=function(e){return arguments.length?(m=e in H?e+"":P.config.legend.orient,A):m},A.offset=function(e){return arguments.length?(y=+e,A):y},A.values=function(e){return arguments.length?(h=e,A):h},A.legendProperties=function(e){return arguments.length?(k=e,A):k},A.symbolProperties=function(e){return arguments.length?(_=e,A):_},A.gradientProperties=function(e){return arguments.length?(w=e,A):w},A.labelProperties=function(e){return arguments.length?(O=e,A):O},A.titleProperties=function(e){return arguments.length?(S=e,A):S},A.reset=function(){t()},A};var H={right:1,left:1};return P.Model=function(){function e(){this._defs=null,this._data={},this._scene=null,this._reset={axes:!1,legends:!1}}var t=e.prototype;return t.defs=function(e){return arguments.length?(this._defs=e,this):this._defs},t.data=function(e){function t(e){(l[e]||[]).forEach(function(n){a[n]=e,t(n)})}if(!arguments.length)return this._data;var n,r,i,a={},o=this._defs,l=o.data.source,c=o.data.flow||{},f=o.data.sorted,d=f.length;for(P.keys(e).forEach(t),n=0;d>n;++n){if(e[r=f[n]])i=e[r];else{if(!a[r])continue;i=u(this._data[a[r]]),P.isTree(e)&&s(i)}this._data[r]=c[r]?c[r](i,this._data,o.marks):i}return this._reset.legends=!0,this},t.width=function(e){return this._defs&&(this._defs.width=e),this._defs&&this._defs.marks&&(this._defs.marks.width=e),this._scene&&(this._scene.items[0].width=e),this._reset.axes=!0,this},t.height=function(e){return this._defs&&(this._defs.height=e),this._defs&&this._defs.marks&&(this._defs.marks.height=e),this._scene&&(this._scene.items[0].height=e),this._reset.axes=!0,this},t.scene=function(e){return arguments.length?(this._scene=e,this):this._scene},t.build=function(){var e=this,t=e._data,n=e._defs.marks;return e._scene=P.scene.build.call(e,n,t,e._scene),e._scene.items[0].width=n.width,e._scene.items[0].height=n.height,e._scene.interactive=!1,this},t.encode=function(e,t,n){this.reset();var r=this,i=r._scene,a=r._defs;return P.scene.encode.call(r,i,a.marks,e,t,n),this},t.reset=function(){return this._scene&&this._reset.axes&&(P.scene.visit(this._scene,function(e){e.axes&&e.axes.forEach(function(e){e.reset()})}),this._reset.axes=!1),this._scene&&this._reset.legends&&(P.scene.visit(this._scene,function(e){e.legends&&e.legends.forEach(function(e){e.reset()})}),this._reset.legends=!1),this},e}(),P.View=function(){var t=function(e,t,n){this._el=null,this._build=!1,this._model=new P.Model,this._width=this.__width=t||500,this._height=this.__height=n||500,this._autopad=1,this._padding={top:0,left:0,bottom:0,right:0},this._viewport=null,this._renderer=null,this._handler=null,this._io=P.canvas,e&&this.initialize(e)},n=t.prototype;return n.width=function(e){return arguments.length?(this.__width!==e&&(this._width=this.__width=e,this._el&&this.initialize(this._el.parentNode),this._model.width(e),this._strict&&(this._autopad=1)),this):this.__width},n.height=function(e){return arguments.length?(this.__height!==e&&(this._height=this.__height=e,this._el&&this.initialize(this._el.parentNode),this._model.height(this._height),this._strict&&(this._autopad=1)),this):this.__height},n.padding=function(e){return arguments.length?(this._padding!==e&&(P.isString(e)?(this._autopad=1,this._padding={top:0,left:0,bottom:0,right:0},this._strict="strict"===e):(this._autopad=0,this._padding=e,this._strict=!1),this._el&&(this._renderer.resize(this._width,this._height,e),this._handler.padding(e))),this):this._padding},n.autopad=function(e){if(this._autopad<1)return this;this._autopad=0;var t=this._padding,n=this.model().scene().bounds,r=P.config.autopadInset,i=n.x1<0?Math.ceil(-n.x1)+r:0,a=n.y1<0?Math.ceil(-n.y1)+r:0,s=n.x2>this._width?Math.ceil(+n.x2-this._width)+r:0,n=n.y2>this._height?Math.ceil(+n.y2-this._height)+r:0;return t={left:i,top:a,right:s,bottom:n},this._strict?(this._autopad=0,this._padding=t,this._width=Math.max(0,this.__width-(i+s)),this._height=Math.max(0,this.__height-(a+n)),this._model.width(this._width),this._model.height(this._height),this._el&&this.initialize(this._el.parentNode),this.update({props:"enter"}).update({props:"update"})):this.padding(t).update(e),this},n.viewport=function(e){return arguments.length?(this._viewport!==e&&(this._viewport=e,this._el&&this.initialize(this._el.parentNode)),this):this._viewport},n.renderer=function(e){return arguments.length?("canvas"===e&&(e=P.canvas),"svg"===e&&(e=P.svg),this._io!==e&&(this._io=e,this._renderer=null,this._el&&this.initialize(this._el.parentNode),this._build&&this.render()),this):this._io},n.defs=function(e){return arguments.length?(this._model.defs(e),this):this._model.defs()},n.data=function(e){if(!arguments.length)return this._model.data();var t=P.keys(e).reduce(function(t,n){return t[n]=P.data.ingestAll(e[n]),t},{});return this._model.data(t),this._build=!1,this},n.model=function(e){return arguments.length?(this._model!==e&&(this._model=e,this._handler&&this._handler.model(e)),this):this._model},n.initialize=function(t){var n,r=this,i=r._width,a=r._height,s=r._padding;return e.select(t).select("div.vega").remove(),this._el=t=e.select(t).append("div").attr("class","vega").style("position","relative").node(),r._viewport&&e.select(t).style("width",(r._viewport[0]||i)+"px").style("height",(r._viewport[1]||a)+"px").style("overflow","auto"),r._renderer=(r._renderer||new this._io.Renderer).initialize(t,i,a,s),n=r._handler,r._handler=(new this._io.Handler).initialize(t,s,r).model(r._model),n&&n.handlers().forEach(function(e){r._handler.on(e.type,e.handler)}),this},n.render=function(e){return this._renderer.render(this._model.scene(),e),this},n.on=function(){return this._handler.on.apply(this._handler,arguments),this},n.off=function(){return this._handler.off.apply(this._handler,arguments),this},n.update=function(e){e=e||{};var t=this,n=e.duration?P.scene.transition(e.duration,e.ease):null;return t._build=t._build||(t._model.build(),!0),t._model.encode(n,e.props,e.items),n?n.start(function(e){t._renderer.render(t._model.scene(),e)}):t.render(e.items),t.autopad(e)},t}(),P.ViewFactory=function(e){return function(t){t=t||{};var n=(new P.View).width(e.width).height(e.height).padding(e.padding).viewport(e.viewport).renderer(t.renderer||"canvas").defs(e);return e.data.load&&n.data(e.data.load),t.data&&n.data(t.data),t.el&&n.initialize(t.el),t.hover!==!1&&n.on("mouseover",function(e,t){t.hasPropertySet("hover")&&this.update({props:"hover",items:t})}).on("mouseout",function(e,t){t.hasPropertySet("hover")&&this.update({props:"update",items:t})}),n}},P.Spec=function(){var e=function(e){this.spec={width:500,height:500,padding:0,data:[],scales:[],axes:[],marks:[]},e&&P.extend(this.spec,e)},t=e.prototype;return t.width=function(e){return this.spec.width=e,this},t.height=function(e){return this.spec.height=e,this},t.padding=function(e){return this.spec.padding=e,this},t.viewport=function(e){return this.spec.viewport=e,this},t.data=function(e,t){return t?t.name=e:t=P.isString(e)?{name:e}:e,this.spec.data.push(t),this},t.scale=function(e,t){return t?t.name=e:t=P.isString(e)?{name:e}:e,this.spec.scales.push(t),this},t.axis=function(e){return this.spec.axes.push(e),this},t.mark=function(e,t){t?t.type=e:t={type:e},t.properties={},this.spec.marks.push(t);var n=this;return{from:function(e,n){return t.from=n?(n.data=e,n):P.isString(e)?{data:e}:e,this},prop:function(e,n){return t.properties[e]=P.keys(n).reduce(function(e,t){var r=n[t];return e[t]=P.isObject(r)?r:{value:r},e},{}),this},done:function(){return n}}},t.parse=function(e){P.parse.spec(this.spec,e)},t.json=function(){return this.spec},e}(),P.spec=function(e){return new P.Spec(e)},P.headless={},P.headless.View=function(){var t=function(e,t,n,r,i){this._canvas=null,this._type=r,this._el="body",this._build=!1,this._model=new P.Model,this._width=this.__width=e||500,this._height=this.__height=t||500,this._padding=n||{top:0,left:0,bottom:0,right:0},this._autopad=P.isString(this._padding)?1:0,this._renderer=new P[r].Renderer,this._viewport=i||null,this.initialize()},n=t.prototype;return n.el=function(e){return arguments.length?(this._el!==e&&(this._el=e,this.initialize()),this):this._el},n.width=function(e){return arguments.length?(this._width!==e&&(this._width=e,this.initialize(),this._model.width(e)),this):this._width},n.height=function(e){return arguments.length?(this._height!==e&&(this._height=e,this.initialize(),this._model.height(this._height)),this):this._height},n.padding=function(e){return arguments.length?(this._padding!==e&&(P.isString(e)?(this._autopad=1,this._padding={top:0,left:0,bottom:0,right:0},this._strict="strict"===e):(this._autopad=0,this._padding=e,this._strict=!1),this.initialize()),this):this._padding},n.autopad=function(e){if(this._autopad<1)return this;this._autopad=0;var t=this._padding,n=this._model.scene().bounds,r=P.config.autopadInset,i=n.x1<0?Math.ceil(-n.x1)+r:0,a=n.y1<0?Math.ceil(-n.y1)+r:0,s=n.x2>this._width?Math.ceil(+n.x2-this._width)+r:0,n=n.y2>this._height?Math.ceil(+n.y2-this._height)+r:0;return t={left:i,top:a,right:s,bottom:n},this._strict?(this._autopad=0,this._padding=t,this._width=Math.max(0,this.__width-(i+s)),this._height=Math.max(0,this.__height-(a+n)),this._model.width(this._width),this._model.height(this._height),this._el&&this.initialize(),this.update({props:"enter"}).update({props:"update"})):this.padding(t).update(e),this},n.viewport=function(e){return arguments.length?(this._viewport=e,this.initialize(),this):_viewport},n.defs=function(e){return arguments.length?(this._model.defs(e),this):this._model.defs()},n.data=function(e){if(!arguments.length)return this._model.data();var t=P.keys(e).reduce(function(t,n){return t[n]=P.data.ingestAll(e[n]),t},{});return this._model.data(t),this._build=!1,this},n.renderer=function(){return this._renderer},n.canvas=function(){return this._canvas},n.canvasAsync=function(e){function t(){0===n.pendingImages()?(r.render(),e(r._canvas)):setTimeout(t,10)}var n=this._renderer,r=this;n.pendingImages()>0?t():e(this._canvas)},n.svg=function(){if("svg"!==this._type)return null;var t=this._padding,n=this._width+(t?t.left+t.right:0),r=this._height+(t?t.top+t.bottom:0);this._viewport&&(n=this._viewport[0]-(t?t.left+t.right:0),r=this._viewport[1]-(t?t.top+t.bottom:0));var i=e.select(this._el).select("svg").node().innerHTML.replace(/ href=/g," xlink:href=");return'<svg width="'+n+'" height="'+r+'" '+P.config.svgNamespace+">"+i+"</svg>"},n.initialize=function(){var e=this._width,t=this._height,n=this._padding;return this._viewport&&(e=this._viewport[0]-(n?n.left+n.right:0),t=this._viewport[1]-(n?n.top+n.bottom:0)),"svg"===this._type?this.initSVG(e,t,n):this.initCanvas(e,t,n),this},n.initCanvas=function(e,t,n){var r=require("canvas"),i=e+n.left+n.right,a=t+n.top+n.bottom,s=this._canvas=new r(i,a),o=s.getContext("2d");o.setTransform(1,0,0,1,n.left,n.top),this._renderer.context(o),this._renderer.resize(e,t,n)},n.initSVG=function(e,t,n){e+n.left+n.right,t+n.top+n.bottom;this._renderer.initialize(this._el,e,t,n)},n.render=function(e){return this._renderer.render(this._model.scene(),e),this},n.update=function(e){e=e||{};var t=this;return t._build=t._build||(t._model.build(),!0),t._model.encode(null,e.props,e.items),t.render(e.items),t.autopad(e)},t}(),P.headless.View.Factory=function(e){return function(t){t=t||{};var n=e.width,r=e.height,i=e.padding,a=e.viewport,s=t.renderer||"canvas",o=new P.headless.View(n,r,i,s,a).defs(e);return e.data.load&&o.data(e.data.load),t.data&&o.data(t.data),o}},P.headless.render=function(e,t){function n(n){try{var r=n({data:e.data,renderer:e.renderer}).update();"svg"===e.renderer?t(null,{svg:r.svg()}):r.canvasAsync(function(e){t(null,{canvas:e})})}catch(i){t(i,null)}}P.parse.spec(e.spec,n,P.headless.View.Factory)},P}),!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;"undefined"!=typeof window?t=window:"undefined"!=typeof global?t=global:"undefined"!=typeof self&&(t=self),t.vl=e()}}(function(){return function e(t,n,r){function i(s,o){if(!n[s]){if(!t[s]){var u="function"==typeof require&&require;if(!o&&u)return u(s,!0);if(a)return a(s,!0);var l=new Error("Cannot find module '"+s+"'");throw l.code="MODULE_NOT_FOUND",l}var c=n[s]={exports:{}};t[s][0].call(c.exports,function(e){var n=t[s][1][e];return i(n?n:e)},c,c.exports,e,t,n,r)}return n[s].exports}for(var a="function"==typeof require&&require,s=0;s<r.length;s++)i(r[s]);return i}({1:[function(e,t){var n=(e("./globals"),e("./util")),r=e("./consts"),i=n.merge(r,n);i.Encoding=e("./Encoding"),i.compile=e("./compile/compile"),i.data=e("./data"),i.field=e("./field"),i.schema=e("./schema/schema"),t.exports=i},{"./Encoding":2,"./compile/compile":6,"./consts":17,"./data":18,"./field":19,"./globals":20,"./schema/schema":21,"./util":23}],2:[function(e,t){"use strict";{var n=(e("./globals"),e("./consts")),r=e("./util"),i=e("./field"),a=e("./schema/schema");t.exports=function(){function e(e,t,r){var i=a.instantiate(),s={marktype:e,enc:t,cfg:r};for(var o in n.DEFAULTS)i.cfg[o]=n.DEFAULTS[o];for(var u in i.enc)i.enc[u].type=n.dataTypes[i.enc[u].type];var l=a.util.merge(i,s);this._marktype=l.marktype,this._enc=l.enc,this._cfg=l.cfg}function t(e,t){return e.isType(t,O)||e.bin(t)||e.isType(t,T)&&e.fn(t)}var s=e.prototype;return s.marktype=function(){return this._marktype},s.is=function(e){return this._marktype===e},s.has=function(e){return void 0!==this._enc[e].name},s.enc=function(e){return this._enc[e]},s.field=function(e,t,n){if(!this.has(e))return null;var r=t?"":"data.";return"count"===this._enc[e].aggr?r+"count":!n&&this._enc[e].bin?r+"bin_"+this._enc[e].name:!n&&this._enc[e].aggr?r+this._enc[e].aggr+"_"+this._enc[e].name:!n&&this._enc[e].fn?r+this._enc[e].fn+"_"+this._enc[e].name:r+this._enc[e].name},s.fieldName=function(e){return this._enc[e].name},s.fieldTitle=function(e){return this._enc[e].aggr?this._enc[e].aggr+"("+this._enc[e].name+")":this._enc[e].name},s.scale=function(e){return this._enc[e].scale||{}},s.axis=function(e){return this._enc[e].axis||{}},s.band=function(e){return this._enc[e].band||{}},s.bandSize=function(e){var t=e===Y&&this.has(ROW)&&this.has(Y)||e===X&&this.has(COL)&&this.has(X);return this.band(e).size||this.config(t?"multipleBandSize":"singleBandSize")},s.aggr=function(e){return this._enc[e].aggr},s.bin=function(e){return this._enc[e].bin},s.legend=function(e){return this._enc[e].legend},s.value=function(e){return this._enc[e].value},s.fn=function(e){return this._enc[e].fn},s.any=function(e){return r.any(this._enc,e)},s.all=function(e){return r.all(this._enc,e)},s.length=function(){return r.keys(this._enc).length},s.map=function(e){var t,n=[];for(t in this._enc)this.has(t)&&n.push(e(this._enc[t],t,this._enc));return n},s.reduce=function(e,t){var n,r=t;for(n in this._enc)this.has(n)&&(r=e(r,this._enc[n],n,this._enc));return r},s.forEach=function(e){var t,n=0;for(t in this._enc)this.has(t)&&e(t,this._enc[t],n++)},s.type=function(e){return this.has(e)?this._enc[e].type:null},s.text=function(e){var t=this._enc[TEXT].text;return e?t[e]:t},s.font=function(e){var t=this._enc[TEXT].text;return e?t[e]:t},s.isType=function(e,t){var n=this.type(e);return null===n?!1:(n&t)>0},s.isOrdinalScale=function(e){return this.has(e)&&t(this,e)},s.isQuantScale=function(e){return this.has(e)&&!t(this,e)},s.isAggregate=function(){var e;for(e in this._enc)if(this.has(e)&&this.aggr(e))return!0;return!1},s.isRaw=function(){return!this.isAggregate()},s.isDimension=function(e){return this.has(e)&&this.isAggregate()&&t(this,e)},s.isMeasure=function(e){return this.has(e)&&this.isAggregate()&&!t(this,e)},s.config=function(e){return this._cfg[e]},s.toSpec=function(e){var t,i=r.duplicate(this._enc);for(var s in i)i[s].type=n.dataTypeNames[i[s].type];t={marktype:this._marktype,enc:i},e||(t.cfg=r.duplicate(this._cfg));var o=a.instantiate();return a.util.subtract(t,o)},s.toShorthand=function(){this._enc;return this._marktype+"."+this.map(function(e,t){return t+"-"+i.shorthand(e)}).join(".")},e.parseShorthand=function(t,r){var i=t.split("."),s=i.shift();return i=i.reduce(function(e,t){var r=t.split("-"),i=r[0],s={name:r[1],type:n.dataTypes[r[2]]};for(var o in a.aggr.enum){var u=a.aggr.enum[o];if(0===s.name.indexOf(u+"_")){s.name=s.name.substr(u.length+1),"count"==u&&0===s.name.length&&(s.name="*"),s.aggr=u;break}}for(var o in a.timefns){var l=a.timefns[o];if(s.name&&0===s.name.indexOf(l+"_")){s.name=s.name.substr(s.length+1),s.fn=l;break}}return s.name&&0===s.name.indexOf("bin_")&&(s.name=s.name.substr(4),s.bin=!0),e[i]=s,e},{}),new e(s,i,r)},e.fromSpec=function(t,i){var a=r.duplicate(t.enc);for(var s in a)a[s].type=n.dataTypes[a[s].type];return new e(t.marktype,a,r.merge(t.cfg,i||{}))},e}()}},{"./consts":17,"./field":19,"./globals":20,"./schema/schema":21,"./util":23}],3:[function(e,t){function n(e,t,n){n=n||{};var i={},a={},s={},o={};return t.forEach(function(e,n){n.aggr?"count"===n.aggr?a.count={op:"count",field:"*"}:a[n.aggr+"|"+n.name]={op:n.aggr,field:"data."+n.name}:(i[n.name]=t.field(e),e==ROW||e==COL?o[n.name]=i[n.name]:e!==X&&e!==Y&&(s[n.name]=i[n.name]))}),i=r.vals(i),a=r.vals(a),a.length>0&&!n.preaggregatedData&&(e.transform||(e.transform=[]),e.transform.push({type:"aggregate",groupby:i,fields:a}),t.marktype()===TEXT&&a.forEach(function(t){var n=t.field.substr(5),r="data."+(t.op?t.op+"_":"")+n;e.transform.push({type:"formula",field:r,expr:"d3.format('.2f')(d."+r+")"})})),{details:r.vals(s),dims:i,facets:r.vals(o),aggregated:a.length>0}}var r=(e("../globals"),e("../util"));t.exports=n},{"../globals":20,"../util":23}],4:[function(e,t){function n(e,t,n){return e.title=n.fieldTitle(t),t==Y&&(e.titleOffset=60),e}var r=(e("../globals"),e("../util")),i=t.exports={};i.names=function(e){return r.keys(r.keys(e).reduce(function(t,n){var r=e[n].scale;return(r===X||r===Y)&&(t[e[n].scale]=1),t},{}))},i.defs=function(e,t,n){return e.reduce(function(e,r){return e.push(i.def(r,t,n)),e},[])},i.def=function(e,t,r){var i=e,a=e==COL,s=e==ROW;a&&(i="x"),s&&(i="y");var o={type:i,scale:e};if(t.isQuantScale(e)&&(o.ticks=3),t.axis(e).grid&&(o.grid=!0,o.layer="back"),t.axis(e).title&&(o=n(o,e,t,r)),(s||a)&&(o.properties={ticks:{opacity:{value:0}},majorTicks:{opacity:{value:0}},axis:{opacity:{value:0}}}),a&&(o.offset=[r.xAxisMargin||0,t.config("yAxisMargin")],o.orient="top"),e==X&&t.isOrdinalScale(X)&&(o.properties={labels:{angle:{value:270},align:{value:"right"},baseline:{value:"middle"}},title:{dy:{value:30}}}),t.axis(X).format?o.format=t.axis(X).format:t.isType(e,Q)?o.format="s":t.isType(e,T)&&(o.format="%Y-%m-%d"),t.isType(e,T)&&t.fn(e)){var u=t.fn(e),l=o.properties=o.properties||{},c=l.labels=l.labels||{},f=c.text=c.text||{};switch(u){case"day":case"month":f.scale="time-"+u}}return o}},{"../globals":20,"../util":23}],5:[function(e,t){function n(e,t,n){n=n||{};var i={};return t.forEach(function(e,t){t.bin&&(i[t.name]=t.name)}),i=r.keys(i),0===i.length||n.preaggregatedData?!1:(e.transform||(e.transform=[]),i.forEach(function(t){e.transform.push({type:"bin",field:"data."+t,output:"data.bin_"+t,maxbins:MAX_BINS})}),i)}var r=(e("../globals"),e("../util"));t.exports=n},{"../globals":20,"../util":23}],6:[function(e,t){function n(e,t){var n=i.setSize(e,t),p=n.cellWidth,g=n.cellHeight,v=e.any(function(e){return void 0!==e.aggr}),m=r(e,n,t),y=m.marks[0],x=o[e.marktype()],b=o.def(x,e,{hasAggregate:v}),k=e.has(ROW),_=e.has(COL),w=e.config("useVegaServer");y.marks.push(b),f(m.data[0],e,{preaggregatedData:w});var S=o[e.marktype()].line;w||(m=l(m,e));var O=c(m.data[0],e,{preaggregatedData:w}),A=O.details,T=A&&A.length>0,E=T&&h(m,e,b,O.facets);if(T&&(E||S)&&subfaceting(y,b,A,E,e),S){var M=e.isQuantScale(X)&&e.isOrdinalScale(Y)?Y:X;b.from||(b.from={}),b.from.transform=[{type:"sort",by:e.field(M)}]}return k||_?(m=d(y,e,g,p,m,b,E,t),m.legends=s.defs(e)):(y.scales=u.defs(u.names(b.properties.update),e,{stack:E,stats:t}),y.axes=a.defs(a.names(b.properties.update),e),y.legends=s.defs(e)),m}e("../globals"),e("../util");t.exports=n;var r=n.template=e("./template"),i=n.layout=e("./layout"),a=n.axis=e("./axis"),s=(n.group=e("./group"),n.legend=e("./legend")),o=n.marks=e("./marks"),u=n.scale=e("./scale"),l=n.time=e("./time"),c=n.aggregates=e("./aggregates"),f=n.binning=e("./binning"),d=n.faceting=e("./faceting"),h=n.stacking=e("./stacking");subfaceting=n.subfaceting=e("./subfaceting")},{"../globals":20,"../util":23,"./aggregates":3,"./axis":4,"./binning":5,"./faceting":7,"./group":8,"./layout":9,"./legend":10,"./marks":11,"./scale":12,"./stacking":13,"./subfaceting":14,"./template":15,"./time":16}],7:[function(e,t){function n(e,t,n,o,u,l,c,f){var d=e.properties.enter,h=[],p=[],g=t.has(ROW),v=t.has(COL),m=t.has(Y)?t.config("xAxisMargin"):void 0;if(d.fill={value:t.config("cellBackgroundColor")},e.from={data:e.marks[0].from.data},e.marks[0].from.transform?delete e.marks[0].from.data:delete e.marks[0].from,g){t.isOrdinalScale(ROW)||r.error("Row encoding should be ordinal."),d.y={scale:ROW,field:"keys."+h.length},d.height={value:n},h.push(t.field(ROW));var y;v&&(y=r.duplicate(e.from),y.transform=y.transform||[],y.transform.unshift({type:"facet",keys:[t.field(COL)]}));var x=a("x-axes",{axes:t.has(X)?i.defs(["x"],t):void 0,x:v?{scale:COL,field:"keys.0",offset:m}:{value:m},width:v&&{value:o},from:y});u.marks.push(x),u.axes=u.axes||[],u.axes.push.apply(u.axes,i.defs(["row"],t))}else t.has(X)&&p.push.apply(p,i.defs(["x"],t));if(v){t.isOrdinalScale(COL)||r.error("Col encoding should be ordinal."),d.x={scale:COL,field:"keys."+h.length},d.width={value:o},h.push(t.field(COL));var y;g&&(y=r.duplicate(e.from),y.transform=y.transform||[],y.transform.unshift({type:"facet",keys:[t.field(ROW)]}));var x=a("y-axes",{axes:t.has(Y)?i.defs(["y"],t):void 0,y:g&&{scale:ROW,field:"keys.0"},x:g&&{value:m},height:g&&{value:n},from:y});u.marks.push(x),u.axes=u.axes||[],u.axes.push.apply(u.axes,i.defs(["col"],t,{xAxisMargin:m}))}else t.has(Y)&&p.push.apply(p,i.defs(["y"],t));g&&(d.x?d.x.offset=m:d.x={value:m}),u.scales=(u.scales||[]).concat(s.defs(s.names(d).concat(s.names(l.properties.update)),t,{cellWidth:o,cellHeight:n,stack:c,facet:!0,stats:f})),p.length>0&&(e.axes=p);var b=e.from.transform||(e.from.transform=[]);return b.unshift({type:"facet",keys:h}),u}var r=(e("../globals"),e("../util")),i=e("./axis"),a=e("./group").def,s=e("./scale");t.exports=n},{"../globals":20,"../util":23,"./axis":4,"./group":8,"./scale":12}],8:[function(e,t){function n(e,t){return t=t||{},{_name:e||void 0,type:"group",from:t.from,properties:{enter:{x:t.x||void 0,y:t.y||void 0,width:t.width||{group:"width"},height:t.height||{group:"height"}}},scales:t.scales||void 0,axes:t.axes||void 0,marks:t.marks||[]}}t.exports={def:n}},{}],9:[function(e,t){function n(e,t,n){var r=e.fieldName(t);if(e.bin(t)){var a=i.getbins(n[r]);return(a.stop-a.start)/a.step}return n[r].cardinality}function r(e,t){var r,i,a=e.has(ROW),s=e.has(COL),o=e.marktype(),u=e.config("cellPadding");if(e.has(X))if(e.isOrdinalScale(X)){var l=n(e,X,t);r=(l+e.band(X).padding)*e.bandSize(X)}else r=s?e.enc(COL).width:e.config("singleWidth");else r=o===TEXT?e.config("textCellWidth"):e.bandSize(X);if(e.has(Y))if(e.isOrdinalScale(Y)){var c=n(e,Y,t);i=(c+e.band(Y).padding)*e.bandSize(Y)}else i=a?e.enc(ROW).height:e.config("singleHeight");else i=e.bandSize(Y);var f=r,d=i;if(s){var h=n(e,COL,t);f=r*((1+u)*(h-1)+1)}if(a){var p=n(e,ROW,t);d=i*((1+u)*(p-1)+1)}return{cellWidth:r,cellHeight:i,width:f,height:d}}{var i=(e("../globals"),e("../util"));e("../schema/schema")}t.exports={setSize:r}},{"../globals":20,"../schema/schema":21,"../util":23}],10:[function(e,t){var n=(e("../globals"),t.exports={});n.defs=function(e){var t=[];if(e.has(COLOR)&&e.legend(COLOR)&&t.push(n.def(COLOR,e,{fill:COLOR,orient:"right"})),e.has(SIZE)&&e.legend(SIZE)&&t.push(n.def(SIZE,e,{size:SIZE,orient:1===t.length?"left":"right"})),e.has(SHAPE)&&e.legend(SHAPE)){if(2===t.length)return console.error("Vegalite currently only supports two legends"),t;t.push(n.def(SHAPE,e,{shape:SHAPE,orient:1===t.length?"left":"right"}))}return t},n.def=function(e,t,n){var r,i=n;if(i.title=t.fieldTitle(e),t.isType(e,T)&&(r=t.fn(e))){var a=i.properties=i.properties||{},s=a.labels=a.labels||{},o=s.text=s.text||{};switch(r){case"day":case"month":o.scale="time-"+r}}return i}},{"../globals":20}],11:[function(e,t){function n(e){var t={};return e.isQuantScale(X)?(t.x={scale:X,field:e.field(X)},e.isOrdinalScale(Y)&&(t.x2={scale:X,value:0})):t.xc=e.has(X)?{scale:X,field:e.field(X)}:{value:0},e.isQuantScale(Y)?(t.y={scale:Y,field:e.field(Y)},t.y2={scale:Y,value:0}):t.yc=e.has(Y)?{scale:Y,field:e.field(Y)}:{group:"height"},t.width=e.isQuantScale(X)?{value:e.bandSize(X),offset:-1}:e.has(SIZE)?{scale:SIZE,field:e.field(SIZE)}:{value:e.bandSize(X),offset:-1},t.height=e.isQuantScale(Y)?{value:e.bandSize(Y),offset:-1}:e.has(SIZE)?{scale:SIZE,field:e.field(SIZE)}:{value:e.bandSize(Y),offset:-1},e.has(COLOR)?t.fill={scale:COLOR,field:e.field(COLOR)}:e.has(COLOR)||(t.fill={value:e.value(COLOR)}),e.has(ALPHA)&&(t.opacity={scale:ALPHA,field:e.field(ALPHA)}),t}function r(e,t){var n={};return t=t||{},e.has(X)?n.x={scale:X,field:e.field(X)}:e.has(X)||(n.x={value:e.bandSize(X)/2}),e.has(Y)?n.y={scale:Y,field:e.field(Y)}:e.has(Y)||(n.y={value:e.bandSize(Y)/2}),e.has(SIZE)?n.size={scale:SIZE,field:e.field(SIZE)}:e.has(SIZE)||(n.size={value:e.value(SIZE)}),e.has(SHAPE)?n.shape={scale:SHAPE,field:e.field(SHAPE)}:e.has(SHAPE)||(n.shape={value:e.value(SHAPE)}),e.has(COLOR)?n.stroke={scale:COLOR,field:e.field(COLOR)}:e.has(COLOR)||(n.stroke={value:e.value(COLOR)}),n.opacity=e.has(ALPHA)?{scale:ALPHA,field:e.field(ALPHA)}:{value:e.value(ALPHA)},n.strokeWidth={value:e.config("strokeWidth")},n}function i(e){var t={};return e.has(X)?t.x={scale:X,field:e.field(X)}:e.has(X)||(t.x={value:0}),e.has(Y)?t.y={scale:Y,field:e.field(Y)}:e.has(Y)||(t.y={group:"height"}),e.has(COLOR)?t.stroke={scale:COLOR,field:e.field(COLOR)}:e.has(COLOR)||(t.stroke={value:e.value(COLOR)}),e.has(ALPHA)&&(t.opacity={scale:ALPHA,field:e.field(ALPHA)}),t.strokeWidth={value:e.config("strokeWidth")},t}function a(e){var t={};return e.isQuantScale(X)?(t.x={scale:X,field:e.field(X)},e.isOrdinalScale(Y)&&(t.x2={scale:X,value:0},t.orient={value:"horizontal"})):t.x=e.has(X)?{scale:X,field:e.field(X)}:{value:0},e.isQuantScale(Y)?(t.y={scale:Y,field:e.field(Y)},t.y2={scale:Y,value:0}):t.y=e.has(Y)?{scale:Y,field:e.field(Y)}:{group:"height"},e.has(COLOR)?t.fill={scale:COLOR,field:e.field(COLOR)}:e.has(COLOR)||(t.fill={value:e.value(COLOR)}),e.has(ALPHA)&&(t.opacity={scale:ALPHA,field:e.field(ALPHA)}),t}function s(e){return function(t,n){var r={};return n=n||{},t.has(X)?r.x={scale:X,field:t.field(X)}:t.has(X)||(r.x={value:t.bandSize(X)/2}),t.has(Y)?r.y={scale:Y,field:t.field(Y)}:t.has(Y)||(r.y={value:t.bandSize(Y)/2}),t.has(SIZE)?r.size={scale:SIZE,field:t.field(SIZE)}:t.has(X)||(r.size={value:t.value(SIZE)}),r.shape={value:e},t.has(COLOR)?r.fill={scale:COLOR,field:t.field(COLOR)}:t.has(COLOR)||(r.fill={value:t.value(COLOR)}),r.opacity=t.has(ALPHA)?{scale:ALPHA,field:t.field(ALPHA)}:{value:t.value(ALPHA)},r}}function o(e){var t={};return e.has(X)?t.x={scale:X,field:e.field(X)}:e.has(X)||(t.x={value:e.bandSize(X)/2}),e.has(Y)?t.y={scale:Y,field:e.field(Y)}:e.has(Y)||(t.y={value:e.bandSize(Y)/2}),e.has(SIZE)?t.fontSize={scale:SIZE,field:e.field(SIZE)}:e.has(X)||(t.fontSize={value:e.font("size")}),e.has(COLOR)?t.fill={scale:COLOR,field:e.field(COLOR)}:e.has(COLOR)||(t.fill={value:e.value(COLOR)}),e.has(ALPHA)&&(t.opacity={scale:ALPHA,field:e.field(ALPHA)}),t.text=e.has(TEXT)?{field:e.field(TEXT)}:{value:"Abc"},t.font={value:e.font("family")},t.fontWeight={value:e.font("weight")},t.fontStyle={value:e.font("style")},t.baseline={value:e.text("baseline")},e.has(X)?e.isOrdinalScale(X)?(t.align={value:"left"},t.dx={value:e.text("margin")}):t.align={value:"center"}:e.has(Y)?(t.align={value:"left"},t.dx={value:e.text("margin")}):t.align={value:e.text("align")},t}var u=(e("../globals"),e("../util"),t.exports={});u.def=function(e,t,n){var r=e.prop(t,n);return{type:e.type,from:{data:TABLE},properties:{enter:r,update:r}}},u.bar={type:"rect",stack:!0,prop:n,requiredEncoding:["x","y"],supportedEncoding:{row:1,col:1,x:1,y:1,size:1,color:1,alpha:1}},u.line={type:"line",line:!0,prop:i,requiredEncoding:["x","y"],supportedEncoding:{row:1,col:1,x:1,y:1,color:1,alpha:1}},u.area={type:"area",stack:!0,line:!0,requiredEncoding:["x","y"],prop:a,supportedEncoding:u.line.supportedEncoding},u.circle={type:"symbol",prop:s("circle"),supportedEncoding:{row:1,col:1,x:1,y:1,size:1,color:1,alpha:1}},u.square={type:"symbol",prop:s("square"),supportedEncoding:u.circle.supportedEncoding},u.point={type:"symbol",prop:r,supportedEncoding:{row:1,col:1,x:1,y:1,size:1,color:1,alpha:1,shape:1}},u.text={type:"text",prop:o,requiredEncoding:["text"],supportedEncoding:{row:1,col:1,size:1,color:1,alpha:1,text:1}}
},{"../globals":20,"../util":23}],12:[function(e,t){function n(e,t,n){if(t.type(e)===T)switch(t.fn(e)){case"second":case"minute":return i.range(0,60);case"hour":return i.range(0,24);case"day":return i.range(0,7);case"date":return i.range(0,32);case"month":return i.range(0,12)}if(t.bin(e)&&n.stats){var r=i.getbins(n.stats[t.fieldName(e)]),a=i.range(r.start,r.stop,r.step);return e===Y?a.reverse():a}return e==n.stack?{data:STACKED,field:"data."+(n.facet?"max_":"")+"sum_"+t.field(e,!0)}:{data:TABLE,field:t.field(e)}}function r(e,t,n){var r=t.scale(e.name);switch(e.name){case X:"ordinal"===e.type?e.bandWidth=t.bandSize(X):(e.range=n.cellWidth?[0,n.cellWidth]:"width",e.zero=r.zero,e.reverse=r.reverse),e.round=!0,e.nice="time"===e.type?t.fn(e.name):!0;break;case Y:"ordinal"===e.type?e.bandWidth=t.bandSize(Y):(e.range=n.cellHeight?[n.cellHeight,0]:"height",e.zero=r.zero,e.reverse=r.reverse),e.round=!0,e.nice="time"===e.type?t.fn(e.name)||t.config("timeScaleNice"):!0;break;case ROW:e.bandWidth=n.cellHeight||t.config("cellHeight"),e.round=!0,e.nice=!0;break;case COL:e.bandWidth=n.cellWidth||t.config("cellWidth"),e.round=!0,e.nice=!0;break;case SIZE:e.range=t.is("bar")?[3,Math.max(t.bandSize(X),t.bandSize(Y))]:t.is(TEXT)?[8,40]:[10,1e3],e.round=!0,e.zero=!1;break;case SHAPE:e.range="shapes";break;case COLOR:var i=t.scale(COLOR).range;void 0===i&&("ordinal"===e.type?i="category10":(i=["#ddf","steelblue"],e.zero=!1)),e.range=i;break;case ALPHA:e.range=[.2,1];break;default:throw new Error("Unknown encoding name: "+e.name)}switch(e.name){case ROW:case COL:e.padding=t.config("cellPadding"),e.outerPadding=0;break;case X:case Y:"ordinal"===e.type&&(e.points=!0,e.padding=t.band(e.name).padding)}}var i=(e("../globals"),e("../util")),a=t.exports={};a.names=function(e){return i.keys(i.keys(e).reduce(function(t,n){return e[n]&&e[n].scale&&(t[e[n].scale]=1),t},{}))},a.defs=function(e,t,i){return i=i||{},e.reduce(function(e,s){var o={name:s,type:a.type(s,t),domain:n(s,t,i)};return"ordinal"!==o.type||t.bin(s)||(o.sort=!0),r(o,t,i),e.push(o),e},[])},a.type=function(e,t){switch(t.type(e)){case O:return"ordinal";case T:switch(t.fn(e)){case"second":case"minute":case"hour":case"day":case"date":case"month":return"ordinal";case"year":return"linear"}return"time";case Q:return t.bin(e)?"ordinal":t.scale(e).type}}},{"../globals":20,"../util":23}],13:[function(e,t){"use strict";function n(e,t,n,i){if(!r[t.marktype()].stack)return!1;if(!t.has(COLOR))return!1;var a=null,s=null,o=null,u=t.isMeasure(X),l=t.isMeasure(Y);if(u&&!l)a=Y,s=X,o=0;else{if(!l||u)return null;a=X,s=Y,o=1}var c={name:STACKED,source:TABLE,transform:[{type:"aggregate",groupby:[t.field(a)].concat(i),fields:[{op:"sum",field:t.field(s)}]}]};return i&&i.length>0&&c.transform.push({type:"aggregate",groupby:i,fields:[{op:"max",field:"data.sum_"+t.field(s,!0)}]}),e.data.push(c),n.from.transform=[{type:"stack",point:t.field(a),height:t.field(s),output:{y1:s,y0:s+"2"}}],n.properties.update[s]=n.properties.enter[s]={scale:s,field:s},n.properties.update[s+"2"]=n.properties.enter[s+"2"]={scale:s,field:s+"2"},s}var r=(e("../globals"),e("../util"),e("./marks"));t.exports=n},{"../globals":20,"../util":23,"./marks":11}],14:[function(e,t){function n(e,t,n,i,a){var s=e.marks,o=r("subfacet",{marks:s});e.marks=[o],o.from=t.from,delete t.from;var u=o.from.transform||(o.from.transform=[]);u.unshift({type:"facet",keys:n}),i&&a.has(COLOR)&&u.unshift({type:"sort",by:a.field(COLOR)})}var r=(e("../globals"),e("./group").def);t.exports=n},{"../globals":20,"./group":8}],15:[function(e,t){function n(e,t,n){var a={name:TABLE,format:{type:e.config("dataFormatType")}},s=i.getUrl(e,n);s&&(a.url=s);var o=e.config("useVegaServer");return e.forEach(function(e,t){if(t.type==T)a.format.parse=a.format.parse||{},a.format.parse[t.name]="date";else if(t.type==Q){if(a.format.parse=a.format.parse||{},"count"===t.aggr)var n="count";else if(o&&t.bin)var n="bin_"+t.name;else if(o&&t.aggr)var n=t.aggr+"_"+t.name;else var n=t.name;a.format.parse[n]="number"}}),{width:t.width,height:t.height,padding:"auto",data:[a],marks:[r("cell",{width:t.cellWidth?{value:t.cellWidth}:void 0,height:t.cellHeight?{value:t.cellHeight}:void 0})]}}var r=(e("../globals"),e("./group").def),i=e("../data");t.exports=n},{"../data":18,"../globals":20,"./group":8}],16:[function(e,t){function n(e,t){var r={},i={};t.forEach(function(e,n){n.type===T&&n.fn&&(r[t.field(e)]={field:n,encType:e},i[n.fn]=!0)});var a=e.data[0],s=a.transform=a.transform||[];for(var o in r){var u=r[o];n.transform(s,t,u.encType,u.field)}var l=e.scales=e.scales||[];for(var c in i)n.scale(l,c,t);return e}var r=(e("../globals"),e("../util"));t.exports=n,n.formula=function(e){var t="new Date(d.data."+e.name+")";switch(e.fn){case"second":return t+".getUTCSeconds()";case"minute":return t+".getUTCMinutes()";case"hour":return t+".getUTCHours()";case"day":return t+".getUTCDay()";case"date":return t+".getUTCDate()";case"month":return t+".getUTCMonth()";case"year":return t+".getUTCFullYear()"}console.error("no function specified for date")},n.transform=function(e,t,r,i){e.push({type:"formula",field:t.field(r),expr:n.formula(i)})},n.scale=function(e,t,n){var i=n.config("timeScaleLabelLength");switch(t){case"day":e.push({name:"time-day",type:"ordinal",domain:r.range(0,7),range:["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"].map(function(e){return e.substr(0,i)})});break;case"month":e.push({name:"time-month",type:"ordinal",domain:r.range(0,12),range:["January","February","March","April","May","June","July","August","September","October","November","December"].map(function(e){return e.substr(0,i)})})}}},{"../globals":20,"../util":23}],17:[function(e,t){var n=(e("./globals"),t.exports={});n.encodingTypes=[X,Y,ROW,COL,SIZE,SHAPE,COLOR,ALPHA,TEXT],n.dataTypes={O:O,Q:Q,T:T},n.dataTypeNames=["O","Q","T"].reduce(function(e,t){return e[n.dataTypes[t]]=t,e},{}),n.DEFAULTS={singleHeight:200,singleWidth:200,singleBandSize:21,multipleBandSize:13,cellPadding:.1,cellBackgroundColor:"#fdfdfd",xAxisMargin:0,yAxisMargin:0,textCellWidth:90,strokeWidth:2,timeScaleLabelLength:3}},{"./globals":20}],18:[function(e,t){var n=e("./util"),r=t.exports={};r.getUrl=function(e,t){if(!e.config("useVegaServer"))return e.config("dataUrl");if(0!==e.length()){var r=[];e.forEach(function(i,a){var s={name:e.field(i,!0),field:a.name};a.aggr&&(s.aggr=a.aggr),a.bin&&(s.binSize=n.getbins(t[a.name]).step),r.push(s)});var i={table:e.config("vegaServerTable"),fields:r};return e.config("vegaServerUrl")+"/query/?q="+JSON.stringify(i)}},r.getSchema=function(e){var t=[],r=n.keys(e[0]);return r.forEach(function(n){for(var r=0,i=e[r][n];""===i||null===i||void 0===i;)i=e[++r][n];var a="number"==typeof i?"Q":isNaN(Date.parse(i))?"O":"T";t.push({name:n,type:a})}),t},r.getStats=function(e){var t={},r=n.keys(e[0]);return r.forEach(function(r){var i=n.minmax(e,r);i.cardinality=n.uniq(e,r),i.count=e.length,t[r]=i}),t}},{"./util":23}],19:[function(e,t){var n=e("./consts"),r=t.exports={};r.shorthand=function(e){return(e.aggr?e.aggr+"_":"")+(e.fn?e.fn+"_":"")+(e.bin?"bin_":"")+(e.name||"")+"-"+(n.dataTypeNames[e.type]||e.type)},r.shorthands=function(e,t){return t=t||",",e.map(r.shorthand).join(t)};var i={O:0,G:1,T:2,Q:3};r.order={},r.order.typeThenName=function(e){return i[e.type]+"_"+e.name},r.order.original=function(){return 0},r.order.name=function(e){return e.name},r.order.typeThenCardinality=function(e,t){return t[e.name].cardinality}},{"./consts":17}],20:[function(){(function(e){var t=e||window;t.TABLE="table",t.STACKED="stacked",t.INDEX="index",t.X="x",t.Y="y",t.ROW="row",t.COL="col",t.SIZE="size",t.SHAPE="shape",t.COLOR="color",t.ALPHA="alpha",t.TEXT="text",t.O=1,t.Q=2,t.T=4,t.MAX_BINS=20}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],21:[function(e,t){var n=t.exports={},r=e("../util");n.util=e("./schemautil"),n.marktype={type:"string","enum":["point","bar","line","area","circle","square","text"]},n.aggr={type:"string","enum":["avg","sum","min","max","count"],supportedEnums:{Q:["avg","sum","min","max","count"],O:[],T:["avg","min","max"],"":["count"]},supportedTypes:{Q:!0,O:!0,T:!0,"":!0}},n.band={type:"object",properties:{size:{type:"integer",minimum:0},padding:{type:"integer",minimum:0,"default":1}}},n.timefns=["month","year","day","date","hour","minute","second"],n.fn={type:"string","enum":n.timefns,supportedTypes:{T:!0}},n.scale_type={type:"string","enum":["linear","log","pow","sqrt","quantile"],"default":"linear",supportedTypes:{Q:!0}},n.field={type:"object",properties:{name:{type:"string"}}};var i=r.duplicate,a=n.util.merge,s=a(i(n.field),{type:"object",properties:{type:{type:"string","enum":["O","Q","T"]},bin:{type:"boolean","default":!1,supportedTypes:{Q:!0}},aggr:n.aggr,fn:n.fn,scale:{type:"object",properties:{type:n.scale_type,reverse:{type:"boolean","default":!1},zero:{type:"boolean",description:"Include zero","default":!0,supportedTypes:{Q:!0}},nice:{type:"string","enum":["second","minute","hour","day","week","month","year"],supportedTypes:{T:!0}}}}}}),o=a(i(n.field),{type:"object",properties:{type:{type:"string","enum":["O","Q"]},bin:{type:"boolean","default":!1,supportedTypes:{Q:!0}},aggr:{type:"string","enum":["count"],supportedTypes:{O:!0}}}}),u={type:"object",properties:{axis:{type:"object",properties:{grid:{type:"boolean","default":!1,description:"A flag indicate if gridlines should be created in addition to ticks."},title:{type:"boolean","default":!0,description:"A title for the axis."},format:{type:"string",description:"The formatting pattern for axis labels."}}}}},l={type:"object",properties:{band:n.band}},c={type:"object",properties:{legend:{type:"boolean","default":!0}}},f={type:"object",properties:{text:{type:"object",properties:{text:{type:"object",properties:{align:{type:"string","default":"left"},baseline:{type:"string","default":"middle"},margin:{type:"integer","default":4,minimum:0}}},font:{type:"object",properties:{weight:{type:"string","enum":["normal","bold"],"default":"normal"},size:{type:"integer","default":10,minimum:0},family:{type:"string","default":"Helvetica Neue"},style:{type:"string","default":"normal","enum":["normal","italic"]}}}}}}},d={type:"object",properties:{value:{type:"integer","default":10,minimum:0}}},h={type:"object",properties:{value:{type:"string","default":"steelblue"},scale:{type:"object",properties:{range:{type:["string","array"]}}}}},p={type:"object",properties:{value:{type:"number","default":1,minimum:0,maximum:1}}},g={type:"object",properties:{value:{type:"string","enum":["circle","square","cross","diamond","triangle-up","triangle-down"],"default":"circle"}}},v={properties:{height:{type:"number",minimum:0,"default":150},padding:{type:"number",minimum:0,maximum:1,"default":.1}}},m={properties:{width:{type:"number",minimum:0,"default":150},padding:{type:"number",minimum:0,maximum:1,"default":.1}}},y={required:["name","type"]},x=a(a(a(i(s),u),l),y),b=i(x),k=a(i(o),y),_=a(i(k),v),w=a(i(k),m),S=a(a(i(s),c),d),O=a(a(i(s),c),h),A=a(i(s),p),T=a(a(i(o),c),g),E=a(i(s),f),M={type:"object",properties:{width:{type:"integer","default":void 0},height:{type:"integer","default":void 0},viewport:{type:"array",items:{type:["integer"]},"default":void 0},_minWidth:{type:"integer","default":20,minimum:0},_minHeight:{type:"integer","default":20,minimum:0},dataFormatType:{type:"string","enum":["json","csv"],"default":"json"},useVegaServer:{type:"boolean","default":!1},dataUrl:{type:"string","default":void 0},vegaServerTable:{type:"string","default":void 0},vegaServerUrl:{type:"string","default":"http://localhost:3001"}}};n.schema={$schema:"http://json-schema.org/draft-04/schema#",type:"object",required:["marktype","enc","cfg"],properties:{marktype:n.marktype,enc:{type:"object",properties:{x:x,y:b,row:_,col:w,size:S,color:O,alpha:A,shape:T,text:E}},cfg:M}},n.instantiate=function(){return n.util.instantiate(n.schema)}},{"../util":23,"./schemautil":22}],22:[function(e,t){var n=t.exports={},r=function(e){return 0===Object.keys(e).length};n.instantiate=function(e){if("object"===e.type){var t={};for(var r in e.properties){var i=n.instantiate(e.properties[r]);void 0!==i&&(t[r]=i)}return t}return"default"in e?e.default:void 0},n.subtract=function(e,t){var i={};for(var a in e)if(!t||t[a]!==e[a])if("object"!=typeof e[a]||e[a]instanceof Array)i[a]=e[a];else{var s=n.subtract(e[a],t[a]);r(s)||(i[a]=s)}return i},n.merge=function(e,t){if("object"!=typeof t||null===t)return e;for(var r in t)t.hasOwnProperty(r)&&void 0!==t[r]&&("object"!=typeof t[r]||null===t[r]?e[r]=t[r]:"object"!=typeof e[r]||null===e[r]?e[r]=n.merge(t[r].constructor===Array?[]:{},t[r]):n.merge(e[r],t[r]));return e}},{}],23:[function(e,t){var n=t.exports={};n.keys=function(e){var t,n=[];for(t in e)n.push(t);return n},n.vals=function(e){var t,n=[];for(t in e)n.push(e[t]);return n},n.range=function(e,t,n){if(arguments.length<3&&(n=1,arguments.length<2&&(t=e,e=0)),(t-e)/n==1/0)throw new Error("infinite range");var r,i=[],a=-1;if(0>n)for(;(r=e+n*++a)>t;)i.push(r);else for(;(r=e+n*++a)<t;)i.push(r);return i},n.find=function(e,t){var n=e.filter(function(e){return e[t.name]===t.value});return n.length&&n[0]||null},n.uniq=function(e,t){var n,r,i={},a=0;for(n=0;n<e.length;++n)r=e[n][t],i[r]||(i[r]=1,a+=1);return a},n.minmax=function(e,t){var n={min:+1/0,max:-1/0};for(i=0;i<e.length;++i){var r=e[i][t];r>n.max&&(n.max=r),r<n.min&&(n.min=r)}return n},n.duplicate=function(e){return JSON.parse(JSON.stringify(e))},n.any=function(e,t){var n,r=0;for(n in e)if(t(e[n],n,r++))return!0;return!1},n.all=function(e,t){var n,r=0;for(n in e)if(!t(e[n],n,r++))return!1;return!0},n.merge=function(e,t){return n.keys(t).reduce(function(e,n){return e[n]=t[n],e},e)},n.getbins=function(e){return vg.bins({min:e.min,max:e.max,maxbins:MAX_BINS})},n.error=function(e){console.error("[VL Error]",e)}},{}]},{},[1])(1)}),!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;"undefined"!=typeof window?t=window:"undefined"!=typeof global?t=global:"undefined"!=typeof self&&(t=self),t.vr=e()}}(function(){return function e(t,n,r){function i(s,o){if(!n[s]){if(!t[s]){var u="function"==typeof require&&require;if(!o&&u)return u(s,!0);if(a)return a(s,!0);var l=new Error("Cannot find module '"+s+"'");throw l.code="MODULE_NOT_FOUND",l}var c=n[s]={exports:{}};t[s][0].call(c.exports,function(e){var n=t[s][1][e];return i(n?n:e)},c,c.exports,e,t,n,r)}return n[s].exports}for(var a="function"==typeof require&&require,s=0;s<r.length;s++)i(r[s]);return i}({1:[function(e,t){t.exports={cluster:e("./cluster/cluster"),gen:e("./gen/gen"),rank:e("./rank/rank"),util:e("./util")}},{"./cluster/cluster":2,"./gen/gen":9,"./rank/rank":14,"./util":15}],2:[function(e,t){(function(n){"use strict";function r(e){var t=u(e),n=e.length,r=a.hcluster(i.range(n),function(e,n){return t[e][n]},"average",s.CLUSTER_THRESHOLD),l=r.map(function(e){return o.traverse(e,[])});//console.log("clusters", clusters.map(function(c){ return c.join("+"); }));
return l}t.exports=r;var i="undefined"!=typeof window?window.vl:"undefined"!=typeof n?n.vl:null,a="undefined"!=typeof window?window.clusterfck:"undefined"!=typeof n?n.clusterfck:null,s=e("./clusterconsts"),o=e("../util"),u=r.distanceTable=e("./distancetable")}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../util":15,"./clusterconsts":3,"./distancetable":4}],3:[function(e,t){var n=t.exports={};n.DIST_BY_ENCTYPE=[["x","y",.2],["row","col",.2],["color","shape",.2],["color","alpha",.2],["size","alpha",.2],["size","color",.2]].reduce(function(e,t){var n=t[0],r=t[1],i=t[2];return e[n]=e[n]||{},e[r]=e[r]||{},e[n][r]=e[r][n]=i,e},{}),n.DIST_MISSING=100,n.CLUSTER_THRESHOLD=1},{}],4:[function(e,t){(function(n){function r(e){var t,n,r=e.length,s=e.map(function(e){return a(e)}),o=new Array(r);for(t=0;r>t;t++)o[t]=new Array(r);for(t=0;r>t;t++)for(n=t+1;r>n;n++)o[n][t]=o[t][n]=i(s[t],s[n]);return o}function i(e,t){var n=u.union(s.keys(e.col),s.keys(t.col)),r=0;return n.forEach(function(n){var i=e.col[n],a=t.col[n];i&&a?i.type!=a.type&&(r+=(o.DIST_BY_ENCTYPE[i.type]||{})[a.type]||1):r+=o.DIST_MISSING}),r}function a(e){var t={},n=e.enc;return s.keys(n).forEach(function(e){var r=s.duplicate(n[e]);r.type=e,t[r.name||""]=r,delete r.name}),{marktype:e.marktype,col:t}}var s="undefined"!=typeof window?window.vl:"undefined"!=typeof n?n.vl:null,o=e("./clusterconsts"),u=e("../util");t.exports=r}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../util":15,"./clusterconsts":3}],5:[function(e,t){var n=t.exports={gen:{},cluster:{},rank:{}};n.gen.DEFAULT_OPT={genAggr:!0,genBin:!0,genTypeCasting:!0,aggrList:[void 0,"avg"],marktypeList:["point","bar","line","area","text"],omitTranpose:!1,omitDotPlotWithExtraEncoding:!1,omitAggrWithAllDimsOnFacets:!1,omitDimensionOnly:!1,omitAggregateWithMeasureOnly:!1}},{}],6:[function(e,t){(function(n){"use strict";function r(e,t,n){function r(o,u){if(o===t.length){if(n.omitAggregateWithMeasureOnly||n.omitDimensionOnly){var l=!1,c=!1,f=!1;if(s.forEach(function(e){a.isDim(e)?c=!0:(l=!0,e.aggr||(f=!0))}),!l&&n.omitDimensionOnly)return;if(!c&&!f&&n.omitAggregateWithMeasureOnly)return}var d=i.duplicate(s);return d.key=i.field.shorthands(d),void e.push(d)}var h=t[o];switch(h.type){case"Q":if(s[o]={name:h.name,type:h.type},h.aggr)s[o].aggr=h.aggr,r(o+1,!0);else{var p=h._aggr&&"*"!==h._aggr?h._aggr:n.aggrList;for(var g in p){var v=p[g];void 0!==v?(u===!0||null===u)&&(s[o].aggr=v,r(o+1,!0)):(u===!1||null===u)&&(delete s[o].aggr,r(o+1,!1))}n.genBin&&(delete s[o].aggr,s[o].bin=!0,s[o].type="Q",r(o+1,u)),n.genTypeCasting&&(delete s[o].aggr,delete s[o].bin,s[o].type="O",r(o+1,u))}break;case"O":default:s[o]=h,r(o+1,u)}}var s=new Array(t.length);return n=a.gen.getOpt(n),r(0,null),e}var i="undefined"!=typeof window?window.vl:"undefined"!=typeof n?n.vl:null,a=e("../util");t.exports=r}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../util":15}],7:[function(e,t){"use strict";function n(e,t,n,a,s){var o=r([],t,n);return s?o.reduce(function(e,t){return e[t]=i([],t,n,a),e},{}):o.reduce(function(e,t){return i(e,t,n,a)},[])}var r=e("./encs"),i=e("./marktypes");t.exports=n},{"./encs":8,"./marktypes":10}],8:[function(e,t){(function(n){"use strict";function r(e,t){if(e.x||e.y||e.geo||e.text||e.arc){if(e.x&&e.y&&t.omitTranpose&&e.x.type==e.y.type&&e.x.name>e.y.name)return!1;if(e.row||e.col){if(!e.x||!e.y)return!1;if(t.omitAggrWithAllDimsOnFacets){var n=!1,r=!1;for(var i in e){var a=e[i];if(a.aggr&&(n=!0),s.isDim(a)&&"row"!==i&&"col"!==i&&(r=!0),n&&r)break}if(n&&!r)return!1}}return e.x&&"count"==e.x.aggr&&!e.y?!1:e.y&&"count"==e.y.aggr&&!e.x?!1:!0}return!1}function i(e,t,n){function i(u){if(u===t.length)return void(r(s,n)&&e.push(a.duplicate(s)));var l=t[u];for(var c in a.encodingTypes){var f=a.encodingTypes[c];!(f in s)&&(o[f].dataTypes&a.dataTypes[l.type])>0&&(s[f]=l,i(u+1),delete s[f])}}var s={};return i(0),e}var a="undefined"!=typeof window?window.vl:"undefined"!=typeof n?n.vl:null,s=(e("../globals"),e("../util"));t.exports=i;var o={x:{dataTypes:a.dataTypes.O+a.dataTypes.Q+a.dataTypes.T,multiple:!0},y:{dataTypes:a.dataTypes.O+a.dataTypes.Q+a.dataTypes.T,multiple:!0},row:{dataTypes:a.dataTypes.O,multiple:!0},col:{dataTypes:a.dataTypes.O,multiple:!0},shape:{dataTypes:a.dataTypes.O},size:{dataTypes:a.dataTypes.Q},color:{dataTypes:a.dataTypes.O+a.dataTypes.Q},alpha:{dataTypes:a.dataTypes.Q},text:{dataTypes:ANY_DATA_TYPES}}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../globals":12,"../util":15}],9:[function(e,t){(function(n){{var r="undefined"!=typeof window?window.vl:"undefined"!=typeof n?n.vl:null,i=e("../util"),a=t.exports={aggregates:e("./aggregates"),projections:e("./projections"),encodings:e("./encodings"),encs:e("./encs"),marktypes:e("./marktypes")};({Q:r.schema.aggr.supportedEnums.Q}),{T:r.schema.timefns}}a.charts=function(e,t,n,r){t=i.gen.getOpt(t),r=void 0===r?{encodings:1}:r;var s,o,u=t.genAggr?a.aggregates([],e,t):[e],l=0;return r===!0||r&&r.aggr?s=u.reduce(function(e,n){return a.encs(e,n,t)},[]):(s=u.map(function(e){return a.encs([],e,t)},!0),l+=1),r===!0||r&&r.encodings?o=i.nestedReduce(s,function(e,r){return a.marktypes(e,r,t,n)},l,!0):(o=i.nestedMap(s,function(e){return a.marktypes([],e,t,n)},l,!0),l+=1),o}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../util":15,"./aggregates":6,"./encodings":7,"./encs":8,"./marktypes":10,"./projections":11}],10:[function(e,t){(function(n){"use strict";function r(e,t){var n=t.marktypeList.filter(function(n){var r=o.compile.marks[n],i=r.requiredEncoding,a=r.supportedEncoding;for(var s in i)if(!(i[s]in e))return!1;for(var u in e)if(!a[u])return!1;return!c[n]||c[n](e,t)});return n}function i(e,t){if(e.x&&e.y){if(t.omitTranpose&&u.xOyQ(e))return!1;if(u.isDim(e.x)&&u.isDim(e.y)){if(e.shape)return!1;if(e.color&&u.isDim(e.color))return!1}}else{if(t.omitTranpose&&e.y)return!1;if(t.omitDotPlotWithExtraEncoding&&o.keys(e).length>1)return!1;if(e.shape)return!1}return!0}function a(e,t){return void 0!==e.x.aggr^void 0!==e.y.aggr?t.omitTranpose&&u.xOyQ(e)?!1:!0:!1}function s(e){return"T"==e.x&&"Q"==e.y}var o="undefined"!=typeof window?window.vl:"undefined"!=typeof n?n.vl:null,u=e("../util"),l=e("../rank/rank");t.exports=function(e,t,n,i){return n=u.gen.getOpt(n),r(t,n).forEach(function(n){var r={marktype:n,enc:t,cfg:i},a=l.encoding(r);r.score=a.score,r.scoreFeatures=a.features,e.push(r)}),e};var c={point:i,bar:a,line:s,area:s}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../rank/rank":14,"../util":15}],11:[function(e,t){function n(e){var t=[],i=[{aggr:"count",name:"*",type:"Q"}],a=[];e.forEach(function(e){e.selected?t.push(e):i.push(e)});var s=r.chooseKorLess(i,1);return s.forEach(function(e){var r=t.concat(e);r.length>0&&(r.key=n.key(r),a.push(r))}),a}var r=e("../util");t.exports=n,n.key=function(e){return e.map(function(e){return e.name}).join(",")}},{"../util":15}],12:[function(){(function(e){var t=e||window;t.CHART_TYPES={TABLE:"TABLE",BAR:"BAR",PLOT:"PLOT",LINE:"LINE",AREA:"AREA",MAP:"MAP",HISTOGRAM:"HISTOGRAM"},t.ANY_DATA_TYPES=15}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],13:[function(e,t){function n(){}t.exports=n},{}],14:[function(e,t){(function(n){var r="undefined"!=typeof window?window.vl:"undefined"!=typeof n?n.vl:null,i=t.exports={projections:e("./rank-projections")},a={Q:{x:1,y:.99,size:.6,color:.4,alpha:.4},O:{x:.99,y:1,row:.7,col:.7,color:.8,shape:.6},T:{x:1,y:.8,row:.4,col:.4,color:.3,shape:.3}},s=.01,o=.5,u={line:.99,area:.98,bar:.97,point:.96,circle:.95,square:.95,text:.8};i.encoding=function(e){var t={},n=r.keys(e.enc);return n.forEach(function(n){var r=e.enc[n];t[r.name]={value:r.type+":"+n,score:a[r.type][n]||s}}),n.length>1&&(e.enc.x&&e.enc.y||e.enc.geo||(t.unusedPosition={score:o})),t.markType={value:e.marktype,score:u[e.marktype]},{score:r.keys(t).reduce(function(e,n){return e*t[n].score},1),features:t}},i.fieldsScore=function(){}}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./rank-projections":13}],15:[function(e,t){"use strict";var n=e("./consts"),r=t.exports={gen:{}},i=r.isDim=function(e){return e.bin||"O"===e.type};r.xOyQ=function(e){return e.x&&e.y&&i(e.x)&&i(e.y)},r.isArray=Array.isArray||function(e){return"[object Array]"=={}.toString.call(e)},r.json=function(e,t){return JSON.stringify(e,null,t)},r.keys=function(e){var t,n=[];for(t in e)n.push(t);return n},r.nestedMap=function(e,t,n,i){return e.map(0===n?t:function(e){var a=r.nestedMap(e,t,n-1);return i?a.filter(r.nonEmpty):a})},r.nestedReduce=function(e,t,n,i){return 0===n?e.reduce(t,[]):e.map(function(e){var a=r.nestedReduce(e,t,n-1);return i?a.filter(r.nonEmpty):a})},r.nonEmpty=function(e){return!r.isArray(e)||e.length>0},r.traverse=function(e,t){return void 0!==e.value?t.push(e.value):(e.left&&r.traverse(e.left,t),e.right&&r.traverse(e.right,t)),t},r.union=function(e,t){var n={};return e.forEach(function(e){n[e]=!0}),t.forEach(function(e){n[e]=!0}),r.keys(n)},r.gen.getOpt=function(e){return(e?r.keys(e):[]).reduce(function(t,n){return t[n]=e[n],t},Object.create(n.gen.DEFAULT_OPT))},r.powerset=function(e){for(var t=[[]],n=0;n<e.length;n++)for(var r=0,i=t.length;i>r;r++)t.push(t[r].concat(e[n]));return t},r.chooseKorLess=function(e,t){for(var n=[[]],r=0;r<e.length;r++)for(var i=0,a=n.length;a>i;i++){var s=n[i].concat(e[r]);s.length<=t&&n.push(s)}return n},r.chooseK=function(e,t){for(var n=[[]],r=[],i=0;i<e.length;i++)for(var a=0,s=n.length;s>a;a++){var o=n[a].concat(e[i]);o.length<t?n.push(o):o.length===t&&r.push(o)}return r},r.cross=function(e,t){for(var n=[],r=0;r<e.length;r++)for(var i=0;i<t.length;i++)n.push(e[r].concat(t[i]));return n}},{"./consts":5}]},{},[1])(1)}),angular.module("vleApp",["zeroclipboard"]).constant("_",window._).constant("vl",window.vl).constant("vg",window.vg).constant("Papa",window.Papa).config(["uiZeroclipConfigProvider",function(e){e.setZcConf({swfPath:"../bower_components/zeroclipboard/dist/ZeroClipboard.swf"})}]),angular.module("facetedviz",["vleApp","ngAnimate","ngCookies","ngTouch","ngSanitize","ui.router"]).constant("_",window._).constant("jQuery",window.$).constant("vl",window.vl).constant("vg",window.vg).constant("vr",window.vr).constant("tv4",window.tv4).constant("Papa",window.Papa).config(["$stateProvider","$urlRouterProvider",function(e,t){e.state("home",{url:"/",templateUrl:"app/main/main.html",controller:"MainCtrl"}),t.otherwise("/")}]),angular.module("vleApp").filter("compactJSON",function(){return function(e){return JSON.stringify(e,null,"  ",80)}}),angular.module("facetedviz").directive("vrConfig",["Visrec",function(e){return{templateUrl:"components/vrConfig/vrConfig.html",restrict:"E",scope:{},link:function(t){t.opt=e.opt}}}]),angular.module("vleApp").directive("vlPlot",function(){var e=0;return{templateUrl:"components/vlplot/vlplot.html",restrict:"E",scope:{vlSpec:"=",vgSpec:"=",visClass:"=",showCopy:"="},controller:["$scope","vg",function(t,n){t.visId=e++;var r;t.$watch("vgSpec",function(e){e&&n.parse.spec(e,function(e){r=null,r=e({el:"#vis-"+t.visId,renderer:"canvas"}),r.update()})})}]}}),angular.module("facetedviz").directive("visList",["Fields","Visrec","vl","jQuery",function(e,t,n,r){return{templateUrl:"components/visList/visList.html",restrict:"E",scope:{},link:function(i,a){i.Fields=e,i.Visrec=t,i.shorthands=n.field.shorthands;var a=a;i.select=function(e,n){t.selectedCluster=e;for(var i=r(a).find(".encoding-variations").detach(),s=function(e){return r(".vis-list-item:nth-child("+e+")")},o=n+1,u=s(o).offset().top;1==s(o).length&&s(o).offset().top===u;)o++;s(o-1).after(i)},i.$watch("Fields.fields",function(){var n=e.getList();t.update.projections(n)},!0)}}}]),angular.module("facetedviz").directive("variationList",["Visrec",function(e){return{templateUrl:"components/variationList/variationList.html",restrict:"E",scope:{},link:function(t){t.Visrec=e}}}]),angular.module("facetedviz").directive("fieldListItem",["Dataset","Fields",function(e,t){return{templateUrl:"components/fieldlistitem/fieldlistitem.html",restrict:"E",scope:{field:"="},link:function(n){n.typeNames=e.typeNames,n.Fields=t}}}]),angular.module("facetedviz").directive("fieldList",["Dataset","Fields",function(e,t){return{templateUrl:"components/fieldList/fieldList.html",restrict:"E",scope:{},link:function(n){n.Dataset=e,n.$watch("Dataset.dataschema",function(e){t.updateSchema(e)})}}}]),angular.module("facetedviz").directive("encodingVariations",["Visrec",function(e){return{templateUrl:"components/encodingVariations/encodingVariations.html",restrict:"E",replace:!0,scope:{},link:function(t){t.Visrec=e,t.close=function(){t.Visrec.selectedCluster=null}}}}]),angular.module("vleApp").directive("datasetSelector",["Dataset","Config",function(e,t){return{templateUrl:"components/datasetselector/datasetselector.html",restrict:"E",replace:!0,scope:{},controller:["$scope",function(n){n.Dataset=e,n.$watch("Dataset.dataset",function(n){e.update(n),t.updateDataset(n)})}]}}]),angular.module("facetedviz").service("Visrec",["vr","vl","_","Config","Dataset",function(e,t,n,r,i){var a={projections:[],aggregates:{},aggregateKeys:[],chartClusters:{},selectedCluster:null,update:{}};return a.opt={genAggr:!0,genBin:!0,genTypeCasting:!0,omitTranpose:!1,omitDotPlotWithExtraEncoding:!1,omitAggrWithAllDimsOnFacets:!1,omitDimensionOnly:!0,omitAggregateWithMeasureOnly:!0},a.update.projections=function(s){a.projections=e.gen.projections(s,a.opt),a.aggregates=a.projections.reduce(function(t,n){var r=n.key;return t[r]=e.gen.aggregates([],n,a.opt),t},{}),a.chartClusters=n.reduce(a.aggregates,function(n,s){return n=s.reduce(function(n,s){var o=e.gen.encodings([],s,a.opt,r.config),u=e.cluster(o,2.5).map(function(e){return e.sort(function(e,t){return o[t].score-o[e].score})}).sort(function(e,t){return o[t[0]].score-o[e[0]].score});return n[s.key]=u.map(function(e){return e.map(function(e){var n=o[e],r=t.Encoding.fromSpec(n);return{vlSpec:n,vgSpec:t.compile(r,i.stats)}})}),n},n)},{}),a.aggregateKeys=n.keys(a.chartClusters)},a}]),angular.module("facetedviz").controller("MainCtrl",["$scope",function(){}]),angular.module("facetedviz").factory("Fields",["_",function(e){var t={fields:{}};return t.updateSchema=function(n){t.fields=e.reduce(n,function(e,t){return e[t.name]={name:t.name,type:t.type,selected:!1},e},{})},t.getList=function(){return e.values(t.fields)},t}]);var datasets=[{name:"Barley",url:"data/barley.json",table:"barley_json"},{name:"Cars",url:"data/cars.json",table:"cars_json"},{name:"Crimea",url:"data/crimea.json",table:"crimea_json"},{name:"Driving",url:"data/driving.json",table:"driving_json"},{name:"Iris",url:"data/iris.json",table:"iris_json"},{name:"Jobs",url:"data/jobs.json",table:"jobs_json"},{name:"Population",url:"data/population.json",table:"population_json"},{name:"Movies",url:"data/movies.json",table:"movies_json"},{name:"Birdstrikes",url:"data/birdstrikes.json",table:"birdstrikes_json"}];angular.module("vleApp").factory("Dataset",["$http","Config","_","Papa","vl",function(e,t,n,r,i){var a={};a.datasets=datasets,a.dataset=datasets[7],a.dataschema=[],a.stats=null,a.typeNames={O:"text",Q:"number",T:"time",G:"geo"};var s={text:0,geo:1,time:2,numbers:3};return a.fieldOrder=function(e){return s[a.typeNames[e.type]]+"_"+e.name},a.update=function(s){if(t.useVegaServer){var o=t.serverUrl+"/stats/?name="+s.table;return e.get(o,{cache:!0}).then(function(e){var t=r.parse(e.data,{header:!0}),i=[],s={};n.each(n.filter(t.data,function(e){return e.name}),function(e){var t={};t.min=+e.min,t.max=+e.max,t.cardinality=+e.cardinality,s[e.name]=t;var n="integer"===e.type||"real"===e.type?"Q":"O";i.push({name:e.name,type:n})}),a.dataschema=i,a.stats=s})}return e.get(s.url,{cache:!0}).then(function(e){a.dataschema=i.data.getSchema(e.data),a.stats=i.data.getStats(e.data)})},a}]),angular.module("vleApp").service("Alerts",["$timeout",function(e){var t={};return t.alerts=[],t.add=function(n,r){var i={msg:n};t.alerts.push(i),r&&e(function(){var e=_.findIndex(t.alerts,i);t.closeAlert(e)},r)},t.closeAlert=function(e){t.alerts.splice(e,1)},t}]),angular.module("vleApp").factory("Config",["vl",function(e){var t={};return t.schema=e.schema.schema.properties.cfg,t.config=e.schema.util.instantiate(t.schema),t.updateDataset=function(e){t.config.dataUrl=e.url,t.config.vegaServerTable=e.table},t}]),angular.module("facetedviz").run(["$templateCache",function(e){e.put("app/main/main.html",'<div class="flex-root vflex full-width full-height"><div class="full-width"><div class="card full-height"><h1>FacetedViz</h1></div></div><div class="full-width"><alert-messages></alert-messages></div><div class="hflex full-width main-panel grow-1"><div class="pane data-pane full-height"><div class="card"><div class="right"><dataset-selector></dataset-selector></div><h2>Data</h2><field-list></field-list></div><div class="card"><vr-config></vr-config></div></div><div class="pane vis-list-pane full-width"><vis-list></vis-list></div></div><div class="hflex full-width dev-panel" ng-show="showDevPanel"></div></div>'),e.put("components/datasetselector/datasetselector.html",'<select id="datasetSelect" ng-model="Dataset.dataset" ng-options="dataset.name for dataset in Dataset.datasets"></select>'),e.put("components/encodingvariations/encodingvariations.html",'<div class="encoding-variations" id="evs" ng-show="Visrec.selectedCluster"><vl-plot vg-spec="Visrec.selectedCluster[0][0].vgSpec"></vl-plot><variation-list></variation-list><a href="#" ng-click="close()" class="close">Close</a></div>'),e.put("components/fieldlist/fieldlist.html",'<div class="schema"><div class="field" ng-repeat="field in Dataset.dataschema | orderBy: Dataset.fieldOrder"><field-list-item field="field"></field-list-item></div></div>'),e.put("components/fieldlistitem/fieldlistitem.html",'<input type="checkbox" ng-model="Fields.fields[field.name].selected" id="field-{{field.name}}-checkbox"> <label><div class="inline-block type icon-type-{{typeNames[field.type]}}" title="{{typeNames[field.type]}}">{{field.type}}</div><div ng-model="fieldDef" class="inline-block field-name">{{ field.name }}</div></label>'),e.put("components/variationlist/variationlist.html",'<h3>Variations Within Cluster</h3><div ng-repeat="subcluster in Visrec.selectedCluster[0]" class="vis-list-item"><vl-plot vis-class="vis-list" show-copy="true" vl-spec="subcluster.vlSpec" vg-spec="subcluster.vgSpec"></vl-plot></div>'),e.put("components/vislist/vislist.html",'<div ng-repeat="(akey, cluster) in Visrec.chartClusters" class="vis-list-item card"><div ng-if="cluster && cluster[0]"><div class="aggregate-header">{{ fieldSet.key }}</div><div class="vis-{{akey}}">{{pkey}}-{{akey}}<vl-plot vis-class="vis-list" show-copy="true" vl-spec="cluster[0][0].vlSpec" vg-spec="cluster[0][0].vgSpec"></vl-plot></div><div>&nbsp; <a ng-click="select(cluster, $index)" class="right command">Select</a> <a class="right command" ui-zeroclip="" zeroclip-model="cluster[0][0].vlSpec | compactJSON">Copy</a></div></div></div><encoding-variations></encoding-variations>'),e.put("components/vlplot/vlplot.html",'<div class="relative"><div class="vis {{visClass}}" id="vis-{{visId}}"></div></div>'),e.put("components/vrconfig/vrconfig.html","<div></div>")}]);