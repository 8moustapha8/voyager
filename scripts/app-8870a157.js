// Define module using Universal Module Definition pattern
// https://github.com/umdjs/umd/blob/master/amdWeb.js
!function(e){if("function"==typeof define&&define.amd)define(["d3","topojson"],e);else{var t="undefined"==typeof topojson?null:topojson;vg=e(d3,t)}}(function(e,t){function n(e){return e.replace(z,"$1\\'")}function r(e,t,n,r){for(;r>n;){var i=n+r>>>1;I.cmp(e[i],t)<0?n=i+1:r=i}return n}function a(e,t,n){var r=0,i=e.split(O);return e=n?(i=i.reverse()).filter(function(e){return r+=e.length,t>=r}).reverse():i.filter(function(e){return r+=e.length,t>=r}),e.length?e.join("").trim():i[0].slice(0,t)}function s(e){I.config.isNode?process.stderr.write(e+"\n"):console.log(e)}function o(e){I.config.isNode?process.stderr.write(e+"\n"):console.error(e)}function l(e){return e.__vgtree__=!0,e.nodes=function(){return u(this,[])},e}function u(e,t){var n,r=e.values,i=r?r.length:0;for(t.push(e),n=0;i>n;++n)u(r[n],t);return t}function c(e){var t,n,r=e;if(I.isArray(e))for(r=[],t=0,n=e.length;n>t;++t)r.push(c(e[t]));else if(I.isObject(e)){r={};for(t in e)r[t]=c(e[t])}return r}function d(e,t,n){if(r=[],n&&t.length>1){for(var r,i,a,s=f(e.domain()),o=-1,l=t.length,u=(t[1]-t[0])/++n;++o<l;)for(i=n;--i>0;)(a=+t[o]-i*u)>=s[0]&&r.push(a);for(--o,i=0;++i<n&&(a=+t[o]+i*u)<s[1];)r.push(a)}return r}function f(e){var t=e[0],n=e[e.length-1];return n>t?[t,n]:[n,t]}function h(e){return e.rangeExtent?e.rangeExtent():f(e.range())}function p(e,t,n,r,i,a){i=Math.max(i,0)+a,("left"===e||"top"===e)&&(i*=-1),"top"===e||"bottom"===e?(I.extend(t.properties.enter,{x:n,y:{value:i}}),I.extend(t.properties.update,{x:r,y:{value:i},align:{value:"center"},baseline:{value:X[e]}})):(I.extend(t.properties.enter,{x:{value:i},y:n}),I.extend(t.properties.update,{x:{value:i},y:r,align:{value:$[e]},baseline:{value:"middle"}}))}function g(e,t,n,r,i){var a="left"===e||"top"===e?-1:1;i=1/0===i?"top"===e||"bottom"===e?{group:"mark.group.height",mult:-a}:{group:"mark.group.width",mult:-a}:{value:a*i},"top"===e||"bottom"===e?(I.extend(t.properties.enter,{x:n,y:{value:0},y2:i}),I.extend(t.properties.update,{x:r,y:{value:0},y2:i}),I.extend(t.properties.exit,{x:r})):(I.extend(t.properties.enter,{x:{value:0},x2:i,y:n}),I.extend(t.properties.update,{x:{value:0},x2:i,y:r}),I.extend(t.properties.exit,{y:r}))}function m(e,t,n,r){var i=~~((n[0]+n[1])/2),a="top"===e||"left"===e?-1:1;"bottom"===e||"top"===e?I.extend(t.properties.update,{x:{value:i},y:{value:a*r},angle:{value:0}}):I.extend(t.properties.update,{x:{value:a*r},y:{value:i},angle:{value:-90}})}function v(e,t,n,r){var i;("top"===e||"left"===e)&&(r=-1*r),i="bottom"===e||"top"===e?"M"+n[0]+","+r+"V0H"+n[1]+"V"+r:"M"+r+","+n[0]+"H0V"+n[1]+"H"+r,t.properties.update.path={value:i}}function y(e,t,n){var r=n?{}:e,i=e.mark.def.offset,a=e.mark.def.orient,s=t.width,o=t.height;if(I.isArray(i)){var l=i[0],u=i[1];switch(a){case"left":r.x=-l,r.y=u;break;case"right":r.x=s+l,r.y=u;break;case"bottom":r.x=l,r.y=o+u;break;case"top":r.x=l,r.y=-u;break;default:r.x=l,r.y=u}}else switch(I.isObject(i)&&(i=-t.scales[i.scale](i.value)),a){case"left":r.x=-i,r.y=0;break;case"right":r.x=s+i,r.y=0;break;case"bottom":r.x=0,r.y=o+i;break;case"top":r.x=0,r.y=-i;break;default:r.x=0,r.y=0}n&&n.interpolate(e,r)}function x(){return{type:"rule",interactive:!1,key:"data",properties:{enter:{stroke:{value:I.config.axis.tickColor},strokeWidth:{value:I.config.axis.tickWidth},opacity:{value:1e-6}},exit:{opacity:{value:1e-6}},update:{opacity:{value:1}}}}}function b(){return{type:"text",interactive:!0,key:"data",properties:{enter:{fill:{value:I.config.axis.tickLabelColor},font:{value:I.config.axis.tickLabelFont},fontSize:{value:I.config.axis.tickLabelFontSize},opacity:{value:1e-6},text:{field:"label"}},exit:{opacity:{value:1e-6}},update:{opacity:{value:1}}}}}function k(){return{type:"text",interactive:!0,properties:{enter:{font:{value:I.config.axis.titleFont},fontSize:{value:I.config.axis.titleFontSize},fontWeight:{value:I.config.axis.titleFontWeight},fill:{value:I.config.axis.titleColor},align:{value:"center"},baseline:{value:"middle"},text:{field:"data"}},update:{}}}}function w(){return{type:"path",interactive:!1,properties:{enter:{x:{value:.5},y:{value:.5},stroke:{value:I.config.axis.axisColor},strokeWidth:{value:I.config.axis.axisWidth}},update:{}}}}function _(e,t,n){var r,i=n?{}:e,a=e.mark.def.offset,s=e.mark.def.orient,o=2*e.mark.def.padding,l=~~e.bounds.width()+(e.width?0:o),u=~~e.bounds.height()+(e.height?0:o);switch(i.x=.5,i.y=.5,i.width=l,i.height=u,!n&&t.bounds&&(t.bounds.delta=t.bounds.x2-t.width),s){case"left":r=t.bounds?t.bounds.x1:0,i.x+=r-a-l;break;case"right":r=t.width,t.bounds&&(r=n?t.width+t.bounds.delta:t.bounds.x2),i.x+=r+a}n&&n.interpolate(e,i),e.mark.def.properties.enter(e,t,n)}function S(e,t,n,r,i){var a=e.properties.enter,s=e.properties.update;t&&(a.size=s.size={scale:t.scaleName,field:"data"}),n&&(a.shape=s.shape={scale:n.scaleName,field:"data"}),r&&(a.fill=s.fill={scale:r.scaleName,field:"data"}),i&&(a.stroke=s.stroke={scale:i.scaleName,field:"data"})}function C(){var e=I.config.legend;return{type:"text",interactive:!1,key:"data",properties:{enter:{x:{value:0},y:{value:0},fill:{value:e.titleColor},font:{value:e.titleFont},fontSize:{value:e.titleFontSize},fontWeight:{value:e.titleFontWeight},baseline:{value:"top"},text:{field:"data"},opacity:{value:1e-6}},exit:{opacity:{value:1e-6}},update:{opacity:{value:1}}}}}function E(){var e=I.config.legend;return{type:"symbol",interactive:!1,key:"data",properties:{enter:{x:{field:"offset",mult:.5},y:{scale:"legend",field:"index"},shape:{value:e.symbolShape},size:{value:e.symbolSize},stroke:{value:e.symbolColor},strokeWidth:{value:e.symbolStrokeWidth},opacity:{value:1e-6}},exit:{opacity:{value:1e-6}},update:{x:{field:"offset",mult:.5},y:{scale:"legend",field:"index"},opacity:{value:1}}}}}function L(){var e=I.config.legend;return{type:"text",interactive:!1,key:"data",properties:{enter:{x:{field:"offset",offset:5},y:{scale:"legend",field:"index"},fill:{value:e.labelColor},font:{value:e.labelFont},fontSize:{value:e.labelFontSize},align:{value:e.labelAlign},baseline:{value:e.labelBaseline},text:{field:"label"},opacity:{value:1e-6}},exit:{opacity:{value:1e-6}},update:{opacity:{value:1},x:{field:"offset",offset:5},y:{scale:"legend",field:"index"}}}}}function A(){var e=I.config.legend;return{type:"rect",interactive:!1,properties:{enter:{x:{value:0},y:{value:0},width:{value:e.gradientWidth},height:{value:e.gradientHeight},stroke:{value:e.gradientStrokeColor},strokeWidth:{value:e.gradientStrokeWidth},opacity:{value:1e-6}},exit:{opacity:{value:1e-6}},update:{x:{value:0},y:{value:0},opacity:{value:1}}}}}function M(){var e=I.config.legend;return{type:"text",interactive:!1,key:"data",properties:{enter:{x:{scale:"legend",field:"data"},y:{value:20},dy:{value:2},fill:{value:e.labelColor},font:{value:e.labelFont},fontSize:{value:e.labelFontSize},align:{field:"align"},baseline:{value:"top"},text:{field:"label"},opacity:{value:1e-6}},exit:{opacity:{value:1e-6}},update:{x:{scale:"legend",field:"data"},y:{value:20},opacity:{value:1}}}}}var I={version:"1.5.0",d3:e,topojson:t},P=Object.prototype.toString;I.isObject=function(e){return e===Object(e)},I.isFunction=function(e){return"[object Function]"==P.call(e)},I.isString=function(e){return"[object String]"==P.call(e)},I.isArray=Array.isArray||function(e){return"[object Array]"==P.call(e)},I.isNumber=function(e){return"[object Number]"==P.call(e)},I.isBoolean=function(e){return"[object Boolean]"==P.call(e)},I.isTree=function(e){return e&&e.__vgtree__},I.tree=function(e,t){var n=[e];return n.__vgtree__=!0,n.children=t||"children",n},I.number=function(e){return null===e?null:+e},I.boolean=function(e){return null===e?null:!!e},I.date=function(e){return null===e?null:Date.parse(e)},I.startsWith=String.prototype.startsWith?function(e,t){return e.startsWith(t)}:function(e,t){return 0===e.lastIndexOf(t,0)},I.identity=function(e){return e},I.true=function(){return!0},I.extend=function(e){for(var t,n,r=1,i=arguments.length;i>r;++r){t=arguments[r];for(n in t)e[n]=t[n]}return e},I.duplicate=function(e){return JSON.parse(JSON.stringify(e))},I.field=function(e){return e.split("\\.").map(function(e){return e.split(".")}).reduce(function(e,t){return e.length&&(e[e.length-1]+="."+t.shift()),e.push.apply(e,t),e},[])},I.accessor=function(e){var t;return I.isFunction(e)||null==e?e:I.isString(e)&&(t=I.field(e)).length>1?function(e){return t.reduce(function(e,t){return e[t]},e)}:function(t){return t[e]}},I.mutator=function(e){var t;return I.isString(e)&&(t=I.field(e)).length>1?function(e,n){for(var r=0;r<t.length-1;++r)e=e[t[r]];e[t[r]]=n}:function(t,n){t[e]=n}},I.comparator=function(e){var t=[];return void 0===e&&(e=[]),e=I.array(e).map(function(e){var n=1;return"-"===e[0]?(n=-1,e=e.slice(1)):"+"===e[0]&&(n=1,e=e.slice(1)),t.push(n),I.accessor(e)}),function(n,r){var i,a,s,o,l;for(i=0,a=e.length;a>i;++i){if(s=e[i],o=s(n),l=s(r),l>o)return-1*t[i];if(o>l)return t[i]}return 0}},I.cmp=function(e,t){return t>e?-1:e>t?1:e>=t?0:null===e&&null===t?0:null===e?-1:null===t?1:0/0},I.numcmp=function(e,t){return e-t},I.array=function(e){return null!=e?I.isArray(e)?e:[e]:[]},I.values=function(e){return I.isObject(e)&&!I.isArray(e)&&e.values?e.values:e},I.str=function(e){return I.isArray(e)?"["+e.map(I.str)+"]":I.isObject(e)?JSON.stringify(e):I.isString(e)?"'"+n(e)+"'":e};var z=/(^|[^\\])'/g;I.keys=function(e){var t=[];for(var n in e)t.push(n);return t},I.toMap=function(e){return e.reduce(function(e,t){return e[t]=1,e},{})},I.unique=function(e,t,n){if(!I.isArray(e)||0===e.length)return[];t=t||I.identity,n=n||[];for(var r,i={},a=0,s=e.length;s>a;++a)r=t(e[a]),r in i||(i[r]=!0,n.push(r));return n},I.minIndex=function(e,t){if(!I.isArray(e)||0==e.length)return-1;t=t||I.identity;for(var n=0,r=t(e[0]),i=r,a=1,s=e.length;s>a;++a)i=t(e[a]),r>i&&(r=i,n=a);return n},I.maxIndex=function(e,t){if(!I.isArray(e)||0==e.length)return-1;t=t||I.identity;for(var n=0,r=t(e[0]),i=r,a=1,s=e.length;s>a;++a)i=t(e[a]),i>r&&(r=i,n=a);return n},I.bins=function(e){e=e||{};var t,n,i,a,s=e.maxbins||1024,o=e.base||10,l=e.div||[5,2],u=e.minstep||0,c=Math.log(o),d=Math.ceil(Math.log(s)/c),f=e.min,h=e.max,p=h-f,g=Math.max(u,Math.pow(o,Math.round(Math.log(p)/c)-d)),m=Math.ceil(p/g);if(null!=e.step)g=e.step;else if(e.steps)g=e.steps[Math.min(e.steps.length-1,r(e.steps,p/s,0,e.steps.length))];else{do g*=o,m=Math.ceil(p/g);while(m>s);for(i=0;i<l.length;++i)n=g/l[i],n>=u&&s>=p/n&&(g=n,m=Math.ceil(p/g))}return n=Math.log(g),t=n>=0?0:~~(-n/c)+1,a=(0>f?-1:1)*Math.pow(o,-t-1),f=Math.min(f,Math.floor(f/g+a)*g),h=Math.ceil(h/g)*g,{start:f,stop:h,step:g,unit:t}},I.truncate=function(e,t,n,r,i){var s=e.length;if(t>=s)return e;i=i||"...";var o=Math.max(0,t-i.length);switch(n){case"left":return i+(r?a(e,o,1):e.slice(s-o));case"middle":case"center":var l=Math.ceil(o/2),u=Math.floor(o/2);return(r?a(e,l):e.slice(0,l))+i+(r?a(e,u,1):e.slice(s-u));default:return(r?a(e,o):e.slice(0,o))+i}};var O=/([\u0009\u000A\u000B\u000C\u000D\u0020\u00A0\u1680\u180E\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200A\u202F\u205F\u2028\u2029\u3000\uFEFF])/;I.log=function(e){s("[Vega Log] "+e)},I.error=function(e){o("[Vega Err] "+e)},I.config={},I.config.isNode=!1,I.config.domainWhiteList=!1,I.config.safeMode=!1,I.config.baseURL="",I.config.defaultProtocol="http:",I.config.svgNamespace='version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"',I.config.autopadInset=5,I.config.scale={time:e.time.scale,utc:e.time.scale.utc},I.config.render={lineWidth:1,lineCap:"butt",font:"sans-serif",fontSize:11},I.config.axis={orient:"bottom",ticks:10,padding:3,axisColor:"#000",gridColor:"#d8d8d8",tickColor:"#000",tickLabelColor:"#000",axisWidth:1,tickWidth:1,tickSize:6,tickLabelFontSize:11,tickLabelFont:"sans-serif",titleColor:"#000",titleFont:"sans-serif",titleFontSize:11,titleFontWeight:"bold",titleOffset:35},I.config.legend={orient:"right",offset:10,padding:3,gradientStrokeColor:"#888",gradientStrokeWidth:1,gradientHeight:16,gradientWidth:100,labelColor:"#000",labelFontSize:10,labelFont:"sans-serif",labelAlign:"left",labelBaseline:"middle",labelOffset:8,symbolShape:"circle",symbolSize:50,symbolColor:"#888",symbolStrokeWidth:1,titleColor:"#000",titleFont:"sans-serif",titleFontSize:11,titleFontWeight:"bold"},I.config.color={rgb:[128,128,128],lab:[50,0,0],hcl:[0,0,50],hsl:[0,0,.5]},I.config.range={category10:["#1f77b4","#ff7f0e","#2ca02c","#d62728","#9467bd","#8c564b","#e377c2","#7f7f7f","#bcbd22","#17becf"],category20:["#1f77b4","#aec7e8","#ff7f0e","#ffbb78","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5","#8c564b","#c49c94","#e377c2","#f7b6d2","#7f7f7f","#c7c7c7","#bcbd22","#dbdb8d","#17becf","#9edae5"],shapes:["circle","cross","diamond","square","triangle-down","triangle-up"]},I.Bounds=function(){var e=function(e){this.clear(),e&&this.union(e)},t=e.prototype;return t.clear=function(){return this.x1=+Number.MAX_VALUE,this.y1=+Number.MAX_VALUE,this.x2=-Number.MAX_VALUE,this.y2=-Number.MAX_VALUE,this},t.set=function(e,t,n,r){return this.x1=e,this.y1=t,this.x2=n,this.y2=r,this},t.add=function(e,t){return e<this.x1&&(this.x1=e),t<this.y1&&(this.y1=t),e>this.x2&&(this.x2=e),t>this.y2&&(this.y2=t),this},t.expand=function(e){return this.x1-=e,this.y1-=e,this.x2+=e,this.y2+=e,this},t.round=function(){return this.x1=Math.floor(this.x1),this.y1=Math.floor(this.y1),this.x2=Math.ceil(this.x2),this.y2=Math.ceil(this.y2),this},t.translate=function(e,t){return this.x1+=e,this.x2+=e,this.y1+=t,this.y2+=t,this},t.rotate=function(e,t,n){var r=Math.cos(e),i=Math.sin(e),a=t-t*r+n*i,s=n-t*i-n*r,o=this.x1,l=this.x2,u=this.y1,c=this.y2;return this.clear().add(r*o-i*u+a,i*o+r*u+s).add(r*o-i*c+a,i*o+r*c+s).add(r*l-i*u+a,i*l+r*u+s).add(r*l-i*c+a,i*l+r*c+s)},t.union=function(e){return e.x1<this.x1&&(this.x1=e.x1),e.y1<this.y1&&(this.y1=e.y1),e.x2>this.x2&&(this.x2=e.x2),e.y2>this.y2&&(this.y2=e.y2),this},t.encloses=function(e){return e&&this.x1<=e.x1&&this.x2>=e.x2&&this.y1<=e.y1&&this.y2>=e.y2},t.intersects=function(e){return e&&!(this.x2<e.x1||this.x1>e.x2||this.y2<e.y1||this.y1>e.y2)},t.contains=function(e,t){return!(e<this.x1||e>this.x2||t<this.y1||t>this.y2)},t.width=function(){return this.x2-this.x1},t.height=function(){return this.y2-this.y1},e}(),I.Gradient=function(){function e(e){this.id="grad_"+T++,this.type=e||"linear",this.stops=[],this.x1=0,this.x2=1,this.y1=0,this.y2=0}var t=e.prototype;return t.stop=function(e,t){return this.stops.push({offset:e,color:t}),this},e}();var T=0;I.canvas={},I.canvas.path=function(){function t(e){var t,n,r,i=[];e=e.slice().replace(f[0],"###$1").split(f[1]).slice(1);for(var a,s,o=0,l=e.length;l>o;o++){t=e[o],n=t.slice(1).trim().replace(f[2],"$1###-").split(f[3]),s=[t.charAt(0)];for(var a=0,u=n.length;u>a;a++)r=parseFloat(n[a]),isNaN(r)||s.push(r);var c=s[0].toLowerCase(),h=d[c];if(s.length-1>h)for(var p=1,g=s.length;g>p;p+=h)i.push([s[0]].concat(s.slice(p,p+h)));else i.push(s)}return i}function n(e,t,n,r,s,o,l){for(var u=r[0],c=r[1],d=r[2],f=r[3],h=r[4],p=r[5],g=r[6],m=i(p,g,u,c,f,h,d,t,n),v=0;v<m.length;v++){var y=a.apply(null,m[v]);e.bezierCurveTo.apply(e,y),s.add(y[0]-o,y[1]-l),s.add(y[2]-o,y[3]-l),s.add(y[4]-o,y[5]-l)}}function r(e,t,n,r){for(var s=n[0],o=n[1],l=n[2],u=n[3],c=n[4],d=n[5],f=n[6],h=i(d,f,s,o,u,c,l,e,t),p=0;p<h.length;p++){var g=a.apply(null,h[p]);r.add(g[0],g[1]),r.add(g[2],g[3]),r.add(g[4],g[5])}}function i(e,t,n,r,i,a,s,o,l){if(c=g.call(arguments),h[c])return h[c];var u=s*(Math.PI/180),d=Math.sin(u),f=Math.cos(u);n=Math.abs(n),r=Math.abs(r);var p=f*(o-e)*.5+d*(l-t)*.5,m=f*(l-t)*.5-d*(o-e)*.5,v=p*p/(n*n)+m*m/(r*r);v>1&&(v=Math.sqrt(v),n*=v,r*=v);var y=f/n,x=d/n,b=-d/r,k=f/r,w=y*o+x*l,_=b*o+k*l,S=y*e+x*t,C=b*e+k*t,E=(S-w)*(S-w)+(C-_)*(C-_),L=1/E-.25;0>L&&(L=0);var A=Math.sqrt(L);a==i&&(A=-A);var M=.5*(w+S)-A*(C-_),I=.5*(_+C)+A*(S-w),P=Math.atan2(_-I,w-M),z=Math.atan2(C-I,S-M),O=z-P;0>O&&1==a?O+=2*Math.PI:O>0&&0==a&&(O-=2*Math.PI);for(var T=Math.ceil(Math.abs(O/(.5*Math.PI+.001))),F=[],D=0;T>D;D++){var N=P+D*O/T,U=P+(D+1)*O/T;F[D]=[M,I,N,U,n,r,d,f]}return h[c]=F}function a(e,t,n,r,i,a,s,o){if(c=g.call(arguments),p[c])return p[c];var l=o*i,u=-s*a,d=s*i,f=o*a,h=Math.cos(n),m=Math.sin(n),v=Math.cos(r),y=Math.sin(r),x=.5*(r-n),b=Math.sin(.5*x),k=8/3*b*b/Math.sin(x),w=e+h-k*m,_=t+m+k*h,S=e+v,C=t+y,E=S+k*y,L=C-k*v;return p[c]=[l*w+u*_,d*w+f*_,l*E+u*L,d*E+f*L,l*S+u*C,d*S+f*C]}function s(e,t,r,i){var a,s,o,l,u,c=null,d=0,f=0,h=0,p=0,g=new I.Bounds;void 0==r&&(r=0),void 0==i&&(i=0),e.beginPath();for(var m=0,v=t.length;v>m;++m){switch(a=t[m],a[0]){case"l":d+=a[1],f+=a[2],e.lineTo(d+r,f+i),g.add(d,f);break;case"L":d=a[1],f=a[2],e.lineTo(d+r,f+i),g.add(d,f);break;case"h":d+=a[1],e.lineTo(d+r,f+i),g.add(d,f);break;case"H":d=a[1],e.lineTo(d+r,f+i),g.add(d,f);break;case"v":f+=a[1],e.lineTo(d+r,f+i),g.add(d,f);break;case"V":f=a[1],e.lineTo(d+r,f+i),g.add(d,f);break;case"m":d+=a[1],f+=a[2],e.moveTo(d+r,f+i),g.add(d,f);break;case"M":d=a[1],f=a[2],e.moveTo(d+r,f+i),g.add(d,f);break;case"c":s=d+a[5],o=f+a[6],h=d+a[3],p=f+a[4],e.bezierCurveTo(d+a[1]+r,f+a[2]+i,h+r,p+i,s+r,o+i),g.add(d+a[1],f+a[2]),g.add(h,p),g.add(s,o),d=s,f=o;break;case"C":d=a[5],f=a[6],h=a[3],p=a[4],e.bezierCurveTo(a[1]+r,a[2]+i,h+r,p+i,d+r,f+i),g.add(a[1],a[2]),g.add(h,p),g.add(d,f);break;case"s":s=d+a[3],o=f+a[4],h=2*d-h,p=2*f-p,e.bezierCurveTo(h+r,p+i,d+a[1]+r,f+a[2]+i,s+r,o+i),g.add(h,p),g.add(d+a[1],f+a[2]),g.add(s,o),h=d+a[1],p=f+a[2],d=s,f=o;break;case"S":s=a[3],o=a[4],h=2*d-h,p=2*f-p,e.bezierCurveTo(h+r,p+i,a[1]+r,a[2]+i,s+r,o+i),d=s,f=o,g.add(a[1],a[2]),g.add(h,p),g.add(s,o),h=a[1],p=a[2];break;case"q":s=d+a[3],o=f+a[4],h=d+a[1],p=f+a[2],e.quadraticCurveTo(h+r,p+i,s+r,o+i),d=s,f=o,g.add(h,p),g.add(s,o);break;case"Q":s=a[3],o=a[4],e.quadraticCurveTo(a[1]+r,a[2]+i,s+r,o+i),d=s,f=o,h=a[1],p=a[2],g.add(h,p),g.add(s,o);break;case"t":s=d+a[1],o=f+a[2],null===c[0].match(/[QqTt]/)?(h=d,p=f):"t"===c[0]?(h=2*d-l,p=2*f-u):"q"===c[0]&&(h=2*d-h,p=2*f-p),l=h,u=p,e.quadraticCurveTo(h+r,p+i,s+r,o+i),d=s,f=o,h=d+a[1],p=f+a[2],g.add(h,p),g.add(s,o);break;case"T":s=a[1],o=a[2],h=2*d-h,p=2*f-p,e.quadraticCurveTo(h+r,p+i,s+r,o+i),d=s,f=o,g.add(h,p),g.add(s,o);break;case"a":n(e,d+r,f+i,[a[1],a[2],a[3],a[4],a[5],a[6]+d+r,a[7]+f+i],g,r,i),d+=a[6],f+=a[7];break;case"A":n(e,d+r,f+i,[a[1],a[2],a[3],a[4],a[5],a[6]+r,a[7]+i],g,r,i),d=a[6],f=a[7];break;case"z":case"Z":e.closePath()}c=a}return g.translate(r,i)}function o(e,t){for(var n,i,a,s,o,l=null,u=0,c=0,d=0,f=0,h=0,p=e.length;p>h;++h){switch(n=e[h],n[0]){case"l":u+=n[1],c+=n[2],t.add(u,c);break;case"L":u=n[1],c=n[2],t.add(u,c);break;case"h":u+=n[1],t.add(u,c);break;case"H":u=n[1],t.add(u,c);break;case"v":c+=n[1],t.add(u,c);break;case"V":c=n[1],t.add(u,c);break;case"m":u+=n[1],c+=n[2],t.add(u,c);break;case"M":u=n[1],c=n[2],t.add(u,c);break;case"c":i=u+n[5],a=c+n[6],d=u+n[3],f=c+n[4],t.add(u+n[1],c+n[2]),t.add(d,f),t.add(i,a),u=i,c=a;break;case"C":u=n[5],c=n[6],d=n[3],f=n[4],t.add(n[1],n[2]),t.add(d,f),t.add(u,c);break;case"s":i=u+n[3],a=c+n[4],d=2*u-d,f=2*c-f,t.add(d,f),t.add(u+n[1],c+n[2]),t.add(i,a),d=u+n[1],f=c+n[2],u=i,c=a;break;case"S":i=n[3],a=n[4],d=2*u-d,f=2*c-f,u=i,c=a,t.add(n[1],n[2]),t.add(d,f),t.add(i,a),d=n[1],f=n[2];break;case"q":i=u+n[3],a=c+n[4],d=u+n[1],f=c+n[2],u=i,c=a,t.add(d,f),t.add(i,a);break;case"Q":i=n[3],a=n[4],u=i,c=a,d=n[1],f=n[2],t.add(d,f),t.add(i,a);break;case"t":i=u+n[1],a=c+n[2],null===l[0].match(/[QqTt]/)?(d=u,f=c):"t"===l[0]?(d=2*u-s,f=2*c-o):"q"===l[0]&&(d=2*u-d,f=2*c-f),s=d,o=f,u=i,c=a,d=u+n[1],f=c+n[2],t.add(d,f),t.add(i,a);break;case"T":i=n[1],a=n[2],d=2*u-d,f=2*c-f,u=i,c=a,t.add(d,f),t.add(i,a);break;case"a":r(u,c,[n[1],n[2],n[3],n[4],n[5],n[6]+u,n[7]+c],t),u+=n[6],c+=n[7];break;case"A":r(u,c,[n[1],n[2],n[3],n[4],n[5],n[6],n[7]],t),u=n[6],c=n[7];break;case"z":case"Z":}l=n}return t}function l(t){var n,r=t[0];return n="horizontal"===r.orient?e.svg.area().y(function(e){return e.y}).x0(function(e){return e.x}).x1(function(e){return e.x+e.width}):e.svg.area().x(function(e){return e.x}).y1(function(e){return e.y}).y0(function(e){return e.y+e.height}),r.interpolate&&n.interpolate(r.interpolate),null!=r.tension&&n.tension(r.tension),n(t)}function u(t){var n=t[0],r=e.svg.line().x(function(e){return e.x}).y(function(e){return e.y});return n.interpolate&&r.interpolate(n.interpolate),null!=n.tension&&r.tension(n.tension),r(t)}var c,d={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7},f=[/([MLHVCSQTAZmlhvcsqtaz])/g,/###/,/(\d)-/g,/\s|,|###/],h={},p={},g=Array.prototype.join;return{parse:t,render:s,bounds:o,area:l,line:u}}(),I.canvas.marks=function(){function e(e,t){var n=t.x||0,r=t.y||0,i=t.innerRadius||0,a=t.outerRadius||0,s=(t.startAngle||0)-Math.PI/2,o=(t.endAngle||0)-Math.PI/2;e.beginPath(),0===i?e.moveTo(n,r):e.arc(n,r,i,s,o,0),e.arc(n,r,a,o,s,1),e.closePath()}function t(e,t){var n=t[0],r=n.mark,i=r.pathCache||(r.pathCache=S(I.canvas.path.area(t)));C(e,i)}function n(e,t){var n=t[0],r=n.mark,i=r.pathCache||(r.pathCache=S(I.canvas.path.line(t)));C(e,i)}function r(e,t){if(null!=t.path){var n=t.pathCache||(t.pathCache=S(t.path));return C(e,n,t.x,t.y)}}function i(e,t){e.beginPath();var n,r,i,a,s=null!=t.size?t.size:100,o=t.x,l=t.y;if(null==t.shape||"circle"===t.shape)return n=Math.sqrt(s/Math.PI),e.arc(o,l,n,0,2*Math.PI,0),void e.closePath();switch(t.shape){case"cross":n=Math.sqrt(s/5)/2,r=3*n,e.moveTo(o-r,l-n),e.lineTo(o-n,l-n),e.lineTo(o-n,l-r),e.lineTo(o+n,l-r),e.lineTo(o+n,l-n),e.lineTo(o+r,l-n),e.lineTo(o+r,l+n),e.lineTo(o+n,l+n),e.lineTo(o+n,l+r),e.lineTo(o-n,l+r),e.lineTo(o-n,l+n),e.lineTo(o-r,l+n);break;case"diamond":a=Math.sqrt(s/(2*L)),i=a*L,e.moveTo(o,l-a),e.lineTo(o+i,l),e.lineTo(o,l+a),e.lineTo(o-i,l);break;case"square":r=Math.sqrt(s),n=r/2,e.rect(o-n,l-n,r,r);break;case"triangle-down":i=Math.sqrt(s/E),a=i*E/2,e.moveTo(o,l+a),e.lineTo(o+i,l-a),e.lineTo(o-i,l-a);break;case"triangle-up":i=Math.sqrt(s/E),a=i*E/2,e.moveTo(o,l-a),e.lineTo(o+i,l+a),e.lineTo(o-i,l+a)}e.closePath()}function a(e,t){var r=t[0],i=r.strokeWidth,a=r.strokeCap;e.lineWidth=null!=i?i:I.config.render.lineWidth,e.lineCap=null!=a?a:I.config.render.lineCap,n(e,t)}function s(e,t){var n=t.x||0,r=t.y||0,i=null!=t.x2?t.x2:n,a=null!=t.y2?t.y2:r,s=t.strokeWidth,o=t.strokeCap;e.lineWidth=null!=s?s:I.config.render.lineWidth,e.lineCap=null!=o?o:I.config.render.lineCap,e.beginPath(),e.moveTo(n,r),e.lineTo(i,a)}function o(e,t,n,r){var i,a,s,o=n.fill,l=n.stroke;e(t,r),i=null==n.opacity?1:n.opacity,0!=i&&(o||l)&&(o&&(t.globalAlpha=i*(null==n.fillOpacity?1:n.fillOpacity),t.fillStyle=m(t,n,o),t.fill()),l&&(s=null!=(s=n.strokeWidth)?s:I.config.render.lineWidth,s>0&&(t.globalAlpha=i*(null==n.strokeOpacity?1:n.strokeOpacity),t.strokeStyle=m(t,n,l),t.lineWidth=s,t.lineCap=null!=(a=n.strokeCap)?a:I.config.render.lineCap,t.vgLineDash(n.strokeDash||null),t.vgLineDashOffset(n.strokeDashOffset||0),t.stroke())))}function l(e,t,n,r){var i,a,s;for(i=0,a=n.items.length;a>i;++i)s=n.items[i],(!r||r.intersects(s.bounds))&&o(e,t,s,s)}function u(e,t,n){if(t.items.length)for(var r,i,a,s,o,l,u,c,d,f,h=t.items,p=0,g=h.length;g>p;++p)r=h[p],(!n||n.intersects(r.bounds))&&(u=r.x||0,c=r.y||0,d=r.width||0,f=r.height||0,s=null==r.opacity?1:r.opacity,0!=s&&((i=r.fill)&&(e.globalAlpha=s*(null==r.fillOpacity?1:r.fillOpacity),e.fillStyle=m(e,r,i),e.fillRect(u,c,d,f)),(a=r.stroke)&&(l=null!=(l=r.strokeWidth)?l:I.config.render.lineWidth,l>0&&(e.globalAlpha=s*(null==r.strokeOpacity?1:r.strokeOpacity),e.strokeStyle=m(e,r,a),e.lineWidth=l,e.lineCap=null!=(o=r.strokeCap)?o:I.config.render.lineCap,e.vgLineDash(r.strokeDash||null),e.vgLineDashOffset(r.strokeDashOffset||0),e.strokeRect(u,c,d,f)))))}function c(e,t,n){if(t.items.length)for(var r,i,a,s,o,l,u,c,d,f=t.items,h=0,p=f.length;p>h;++h)r=f[h],(!n||n.intersects(r.bounds))&&(l=r.x||0,u=r.y||0,c=null!=r.x2?r.x2:l,d=null!=r.y2?r.y2:u,a=null==r.opacity?1:r.opacity,0!=a&&(i=r.stroke)&&(o=null!=(o=r.strokeWidth)?o:I.config.render.lineWidth,o>0&&(e.globalAlpha=a*(null==r.strokeOpacity?1:r.strokeOpacity),e.strokeStyle=m(e,r,i),e.lineWidth=o,e.lineCap=null!=(s=r.strokeCap)?s:I.config.render.lineCap,e.vgLineDash(r.strokeDash||null),e.vgLineDashOffset(r.strokeDashOffset||0),e.beginPath(),e.moveTo(l,u),e.lineTo(c,d),e.stroke())))}function d(e,t,n){if(t.items.length)for(var r,i=this,a=t.items,s=0,o=a.length;o>s;++s)if(r=a[s],!n||n.intersects(r.bounds)){r.image&&r.image.url===r.url||(r.image=i.loadImage(r.url),r.image.url=r.url);var l,u,c,d,f;c=r.width||r.image&&r.image.width||0,d=r.height||r.image&&r.image.height||0,l=(r.x||0)-("center"===r.align?c/2:"right"===r.align?c:0),u=(r.y||0)-("middle"===r.baseline?d/2:"bottom"===r.baseline?d:0),r.image.loaded&&(e.globalAlpha=null!=(f=r.opacity)?f:1,e.drawImage(r.image,l,u,c,d))}}function f(e,t,n){if(t.items.length)for(var r,i,a,s,o,l,u,c,d,f=t.items,h=0,p=f.length;p>h;++h)r=f[h],(!n||n.intersects(r.bounds))&&(e.font=I.scene.fontString(r),e.textAlign=r.align||"left",e.textBaseline=r.baseline||"alphabetic",s=null==r.opacity?1:r.opacity,0!=s&&(l=r.x||0,u=r.y||0,(c=r.radius)&&(d=(r.theta||0)-Math.PI/2,l+=c*Math.cos(d),u+=c*Math.sin(d)),r.angle?(e.save(),e.translate(l,u),e.rotate(r.angle*Math.PI/180),l=r.dx||0,u=r.dy||0):(l+=r.dx||0,u+=r.dy||0),(i=r.fill)&&(e.globalAlpha=s*(null==r.fillOpacity?1:r.fillOpacity),e.fillStyle=m(e,r,i),e.fillText(r.text,l,u)),(a=r.stroke)&&(o=null!=(o=r.strokeWidth)?o:1,o>0&&(e.globalAlpha=s*(null==r.strokeOpacity?1:r.strokeOpacity),e.strokeStyle=m(r,a),e.lineWidth=o,e.strokeText(r.text,l,u))),r.angle&&e.restore()))}function h(e){return function(t,n,r){l(e,t,n,r)}}function p(e){return function(t,n,r){n.items.length&&(!r||r.intersects(n.items[0].bounds))&&o(e,t,n.items[0],n.items)}}function g(e,t,n){if(t.items.length){var r,i,a,s,o,l,c,d,f,h=t.items,p=this;for(u(e,t,n),l=0,c=h.length;c>l;++l){for(r=h[l],i=r.axisItems||[],a=r.legendItems||[],s=r.x||0,o=r.y||0,e.save(),e.translate(s,o),r.clip&&(e.beginPath(),e.rect(0,0,r.width||0,r.height||0),e.clip()),n&&n.translate(-s,-o),d=0,f=i.length;f>d;++d)"back"===i[d].def.layer&&p.draw(e,i[d],n);for(d=0,f=r.items.length;f>d;++d)p.draw(e,r.items[d],n);for(d=0,f=i.length;f>d;++d)"back"!==i[d].def.layer&&p.draw(e,i[d],n);for(d=0,f=a.length;f>d;++d)p.draw(e,a[d],n);n&&n.translate(s,o),e.restore()}}}function m(e,t,n){return n.id?v(e,n,t.bounds):n}function v(e,t,n){var r,i,a=n.width(),s=n.height(),o=n.x1+t.x1*a,l=n.y1+t.y1*s,u=n.x1+t.x2*a,c=n.y1+t.y2*s,d=e.createLinearGradient(o,l,u,c),f=t.stops;for(r=0,i=f.length;i>r;++r)d.addColorStop(f[r].offset,f[r].color);return d}function y(e,t,n,r,i,a){if(0===t.items.length||t.bounds&&!t.bounds.contains(i,a))return!1;var s,o,l,u,c,d,f,h=t.items,p=this;for(d=h.length;--d>=0;){for(o=h[d],u=o.x||0,c=o.y||0,e.save(),e.translate(u,c),f=o.items.length;--f>=0;)if(s=o.items[f],s.interactive!==!1&&(l=p.pick(s,n,r,i-u,a-c)))return e.restore(),l;e.restore()}return t.interactive?x(M.group,e,t,n,r,i,a):!1}function x(e,t,n,r,i,a,s){if(!n.items.length)return!1;var o,l,u;for(1!==t._ratio&&(r*=t._ratio,i*=t._ratio),u=n.items.length;--u>=0;)if(o=n.items[u],l=o.bounds,(!l||l.contains(a,s))&&l&&e(t,o,r,i,a,s))return o;return!1}function b(e,t,n,r,i,a){if(!t.items.length)return!1;var s,o=t.items;return s=o[0].bounds,s&&!s.contains(i,a)?!1:(1!==e._ratio&&(n*=e._ratio,r*=e._ratio),M.area(e,o,n,r)?o[0]:!1)}function k(e,t,n,r,i,a){if(!t.items.length)return!1;var s,o=t.items;return s=o[0].bounds,s&&!s.contains(i,a)?!1:(1!==e._ratio&&(n*=e._ratio,r*=e._ratio),M.line(e,o,n,r)?o[0]:!1)}function w(e){return function(t,n,r,i,a,s){return x(e,t,n,r,i,a,s)}}function _(e,t,n,r,i,a){if(!t.fontSize)return!1;if(!t.angle)return!0;var s=I.scene.bounds.text(t,A,!0),o=-t.angle*Math.PI/180,l=Math.cos(o),u=Math.sin(o),n=t.x,r=t.y,c=l*i-u*a+(n-n*l+r*u),d=u*i+l*a+(r-n*u-r*l);return s.contains(c,d)}var S=I.canvas.path.parse,C=I.canvas.path.render,E=(Math.PI/2,Math.sqrt(3)),L=Math.tan(30*Math.PI/180),A=new I.Bounds,M={text:_,rect:function(){return!0},image:function(){return!0},group:function(e,t){return t.fill||t.stroke},rule:function(e,t,n,r){return e.isPointInStroke?(s(e,t),e.isPointInStroke(n,r)):!1},line:function(e,t,n,r){return e.isPointInStroke?(a(e,t),e.isPointInStroke(n,r)):!1},arc:function(t,n,r,i){return e(t,n),t.isPointInPath(r,i)},area:function(e,n,r,i){return t(e,n),e.isPointInPath(r,i)},path:function(e,t,n,i){return r(e,t),e.isPointInPath(n,i)},symbol:function(e,t,n,r){return i(e,t),e.isPointInPath(n,r)}};return{draw:{group:g,area:p(t),line:p(n),arc:h(e),path:h(r),symbol:h(i),rect:u,rule:c,text:f,image:d,drawOne:p,drawAll:h},pick:{group:y,area:b,line:k,arc:w(M.arc),path:w(M.path),symbol:w(M.symbol),rect:w(M.rect),rule:w(M.rule),text:w(M.text),image:w(M.image),pickAll:x}}}(),I.canvas.Renderer=function(){function t(e,t){var n=window.devicePixelRatio||1,r=t.webkitBackingStorePixelRatio||t.mozBackingStorePixelRatio||t.msBackingStorePixelRatio||t.oBackingStorePixelRatio||t.backingStorePixelRatio||1,i=n/r;if(n!==r){var a=e.width,s=e.height;e.setAttribute("width",a*i),e.setAttribute("height",s*i),e.style.width=a+"px",e.style.height=s+"px"}return i}function n(e){if(!e.vgLineDash){var t=[];e.setLineDash?(e.vgLineDash=function(e){this.setLineDash(e||t)},e.vgLineDashOffset=function(e){this.lineDashOffset=e}):void 0!==e.webkitLineDash?(e.vgLineDash=function(e){this.webkitLineDash=e||t},e.vgLineDashOffset=function(e){this.webkitLineDashOffset=e}):void 0!==e.mozDash?(e.vgLineDash=function(e){this.mozDash=e},e.vgLineDashOffset=function(){}):(e.vgLineDash=function(){},e.vgLineDashOffset=function(){})}}function r(e,t){for(var n=new I.Bounds(t);null!=(e=e.mark.group);)n.translate(e.x||0,e.y||0);return n}function i(e){return e?I.array(e).reduce(function(e,t){return e.union(r(t,t.bounds)).union(r(t,t["bounds:prev"]))},new I.Bounds):null}function a(e,t){var n=null;return t&&(n=new I.Bounds(t).round(),e.beginPath(),e.rect(n.x1,n.y1,n.width(),n.height()),e.clip()),n}var s=function(){this._ctx=null,this._el=null,this._bgcolor=null,this._imgload=0},o=s.prototype;return o.initialize=function(t,n,r,i,a){if(this._el=t,this.background(a),!t)return this;var s=e.select(t).selectAll("canvas.marks").data([1]);return s.enter().append("canvas").attr("class","marks"),s.exit().remove(),this.resize(n,r,i)},o.background=function(e){return this._bgcolor=e,this},o.resize=function(r,i,a){if(this._width=r,this._height=i,this._padding=a,this._el){var s=e.select(this._el).select("canvas.marks");s.attr("width",r+a.left+a.right).attr("height",i+a.top+a.bottom);var o;this._ctx=s.node().getContext("2d"),this._ctx._ratio=o=t(s.node(),this._ctx)||1,this._ctx.setTransform(o,0,0,o,o*a.left,o*a.top)}return n(this._ctx),this},o.context=function(e){return e?(this._ctx=e,this):this._ctx},o.element=function(){return this._el},o.pendingImages=function(){return this._imgload},o.render=function(e,t){var n,r=this._ctx,s=this._padding,o=this._width+s.left+s.right,l=this._height+s.top+s.bottom,u=null;this._scene=e,r.save(),u=a(r,i(t)),this.clear(-s.left,-s.top,o,l),this.draw(r,e,u),t&&(r.restore(),r.save(),n=a(r,i(t)),u.encloses(n)||(this.clear(-s.left,-s.top,o,l),this.draw(r,e,n))),r.restore(),this._scene=null},o.draw=function(e,t,n){var r=t.marktype,i=I.canvas.marks.draw[r];i.call(this,e,t,n)},o.clear=function(e,t,n,r){var i=this._ctx;i.clearRect(e,t,n,r),null!=this._bgcolor&&(i.fillStyle=this._bgcolor,i.fillRect(e,t,n,r))},o.renderAsync=function(e){var t=this;t._async_id&&clearTimeout(t._async_id),t._async_id=setTimeout(function(){t.render(e),delete t._async_id},50)},o.loadImage=function(e){var t,n=this,r=n._scene,i=null;if(I.config.isNode)n._imgload+=1,i=new(require("canvas").Image),I.data.load(e,function(t,r){return n._imgload-=1,t?void I.error(t):(I.log("LOAD IMAGE: "+e),i.src=r,void(i.loaded=!0))});else{if(i=new Image,t=I.data.load.sanitizeUrl(e),!t)return;n._imgload+=1,i.onload=function(){I.log("LOAD IMAGE: "+t),i.loaded=!0,n._imgload-=1,n.renderAsync(r)},i.src=t}return i},s}(),I.canvas.Handler=function(){function t(e){var t=e.indexOf(".");return 0>t?e:e.slice(0,t)}var n=function(e,t){this._active=null,this._down=null,this._handlers={},e&&this.initialize(e),t&&this.model(t)},r=n.prototype;r.initialize=function(t,n,a){this._el=e.select(t).node(),this._canvas=e.select(t).select("canvas.marks").node(),this._padding=n,this._obj=a||null;
var s=this._canvas,o=this;return i.forEach(function(e){s.addEventListener(e,function(t){r[e].call(o,t)})}),this},r.padding=function(e){return this._padding=e,this},r.model=function(e){return arguments.length?(this._model=e,this):this._model},r.handlers=function(){var e=this._handlers;return I.keys(e).reduce(function(t,n){return e[n].reduce(function(e,t){return e.push(t),e},t)},[])};var i=["mouseup","dblclick","wheel","keydown","keypress","keyup","mousewheel"];return i.forEach(function(e){r[e]=function(t){this.fire(e,t)}}),i.push("mousedown"),i.push("mousemove"),i.push("mouseout"),i.push("click"),r.mousemove=function(e){var t=this._padding,n=e.target.getBoundingClientRect(),r=e.clientX-n.left,i=e.clientY-n.top,a=this._active,s=this.pick(this._model.scene(),r,i,r-t.left,i-t.top);return s===a?void this.fire("mousemove",e):(a&&this.fire("mouseout",e),this._active=s,void(s&&this.fire("mouseover",e)))},r.mouseout=function(e){this._active&&this.fire("mouseout",e),this._active=null},r.mousedown=function(e){this._down=this._active,this.fire("mousedown",e)},r.click=function(e){this._down===this._active&&(this.fire("click",e),this._down=null)},r.DOMMouseScroll=function(e){this.fire("mousewheel",e)},r.fire=function(e,t){var n=this._active,r=this._handlers[e];if(n&&r)for(var i=0,a=r.length;a>i;++i)r[i].handler.call(this._obj,t,n)},r.on=function(e,n){var r=t(e),i=this._handlers;return i=i[r]||(i[r]=[]),i.push({type:e,handler:n}),this},r.off=function(e,n){var r=t(e),i=this._handlers[r];if(i){for(var a=i.length;--a>=0;)i[a].type===e&&(n&&i[a].handler!==n||i.splice(a,1));return this}},r.context=function(){return this._canvas.getContext("2d")},r.pick=function(e,t,n,r,i){var a=this.context(),s=e.marktype,o=I.canvas.marks.pick[s];return o.call(this,a,e,t,n,r,i)},n}(),I.svg={},I.svg.marks=function(){function t(e){return e.x||0}function n(e){return e.y||0}function r(e){return e.x+e.width||0}function i(e){return e.y+e.height||0}function a(e){return null==e.size?100:e.size}function s(e){return e.shape||"circle"}function o(e){var t,n,r,i,a,s=e.mark?e:e.length?e[0]:null;if(null!==s)for(t=0,n=T.length;n>t;++t)r=T[t],i=O[r],a=s[r],null==a?"fill"===i?this.style.setProperty(i,"none",null):this.style.removeProperty(i):(a.id&&(I.svg._cur._defs.gradient[a.id]=a,a="url("+window.location.href+"#"+a.id+")"),this.style.setProperty(i,a+"",null))}function l(e){var t=e.x||0,n=e.y||0;this.setAttribute("transform","translate("+t+","+n+")"),this.setAttribute("d",S(e))}function u(e){if(e.length){var t=e[0],n="horizontal"===t.orient?E:C;n.interpolate(t.interpolate||"linear").tension(null==t.tension?.7:t.tension),this.setAttribute("d",n(e))}}function c(e){if(e.length){var t=e[0];L.interpolate(t.interpolate||"linear").tension(null==t.tension?.7:t.tension),this.setAttribute("d",L(e))}}function d(e){var t=e.x||0,n=e.y||0;this.setAttribute("transform","translate("+t+","+n+")"),null!=e.path&&this.setAttribute("d",e.path)}function f(e){this.setAttribute("x",e.x||0),this.setAttribute("y",e.y||0),this.setAttribute("width",e.width||0),this.setAttribute("height",e.height||0)}function h(e){var t=e.x||0,n=e.y||0;this.setAttribute("x1",t),this.setAttribute("y1",n),this.setAttribute("x2",null!=e.x2?e.x2:t),this.setAttribute("y2",null!=e.y2?e.y2:n)}function p(e){var t=e.x||0,n=e.y||0;this.setAttribute("transform","translate("+t+","+n+")"),this.setAttribute("d",A(e))}function g(e){var t=e.width||e.image&&e.image.width||0,n=e.height||e.image&&e.image.height||0,r=e.x-("center"===e.align?t/2:"right"===e.align?t:0),i=e.y-("middle"===e.baseline?n/2:"bottom"===e.baseline?n:0),a=I.data.load.sanitizeUrl(e.url);a&&this.setAttributeNS("http://www.w3.org/1999/xlink","href",a),this.setAttribute("x",r),this.setAttribute("y",i),this.setAttribute("width",t),this.setAttribute("height",n)}function m(e){var t=(e.fontStyle?e.fontStyle+" ":"")+(e.fontVariant?e.fontVariant+" ":"")+(e.fontWeight?e.fontWeight+" ":"")+(null!=e.fontSize?e.fontSize:I.config.render.fontSize)+"px "+(e.font||I.config.render.font);return t}function v(e){var t=e.x||0,n=e.y||0,r=e.dx||0,i=e.dy||0,a=e.angle||0,s=e.radius||0,o=z[e.align||"left"],l="top"===e.baseline?".9em":"middle"===e.baseline?".35em":0;if(s){var u=(e.theta||0)-Math.PI/2;t+=s*Math.cos(u),n+=s*Math.sin(u)}this.setAttribute("x",t+r),this.setAttribute("y",n+i),this.setAttribute("text-anchor",o),a?this.setAttribute("transform","rotate("+a+" "+t+","+n+")"):this.removeAttribute("transform"),l?this.setAttribute("dy",l):this.removeAttribute("dy"),this.textContent=e.text,this.style.setProperty("font",m(e),null)}function y(e){var t=e.x||0,n=e.y||0;if(this.setAttribute("transform","translate("+t+","+n+")"),e.clip){var r={width:e.width||0,height:e.height||0},i=e.clip_id||(e.clip_id="clip"+P++);I.svg._cur._defs.clipping[i]=r,this.setAttribute("clip-path","url(#"+i+")")}}function x(e){var t=e.width||0,n=e.height||0;this.setAttribute("width",t),this.setAttribute("height",n)}function b(e){var t="type-"+e.type;return e.name&&(t+=" "+e.name),t}function k(e,t,n){return function(r,i,a){w(r,i,a,e,t,n)}}function w(t,n,r,i,a,s){var l=s?[n.items]:n.items,u=n.interactive===!1?"none":null,c=t.node().childNodes,d="g"!==i,f=(f=c[r+1])?e.select(f):t.append("g").attr("id","g"+ ++M).attr("class",b(n.def)),h=f.attr("id"),p="#"+h+" > "+i,g=f.selectAll(p).data(l),m=g.enter().append(i);return d?(f.style("pointer-events",u),m.each(function(e){e.mark?e._svg=this:e.length&&(e[0]._svg=this)})):m.append("rect").attr("class","background").style("pointer-events",u),g.exit().remove(),g.each(a),d?g.each(o):f.selectAll(p+" > rect.background").each(x).each(o),f}function _(t,n,r){var i,a,s,o=w(t,n,r,"g",y),l=o.node().childNodes,u=l.length;for(i=0;u>i;++i){var c=l[i].__data__.items,d=l[i].__data__.legendItems||[],f=l[i].__data__.axisItems||[],h=e.select(l[i]),p=0;for(a=0,s=f.length;s>a;++a)"back"===f[a].def.layer&&_.call(this,h,f[a],p++);for(a=0,s=c.length;s>a;++a)this.draw(h,c[a],p++);for(a=0,s=f.length;s>a;++a)"back"!==f[a].def.layer&&_.call(this,h,f[a],p++);for(a=0,s=d.length;s>a;++a)_.call(this,h,d[a],p++)}}var S=e.svg.arc(),C=e.svg.area().x(t).y1(n).y0(i),E=e.svg.area().y(n).x0(r).x1(t),L=e.svg.line().x(t).y(n),A=e.svg.symbol().type(s).size(a),M=0,P=0,z={left:"start",center:"middle",right:"end"},O={fill:"fill",fillOpacity:"fill-opacity",stroke:"stroke",strokeWidth:"stroke-width",strokeOpacity:"stroke-opacity",strokeCap:"stroke-linecap",strokeDash:"stroke-dasharray",strokeDashOffset:"stroke-dashoffset",opacity:"opacity"},T=I.keys(O);return{update:{group:f,area:u,line:c,arc:l,path:d,symbol:p,rect:f,rule:h,text:v,image:g},nested:{area:!0,line:!0},style:o,draw:{group:_,area:k("path",u,!0),line:k("path",c,!0),arc:k("path",l),path:k("path",d),symbol:k("path",p),rect:k("rect",f),rule:k("line",h),text:k("text",v),image:k("image",g),draw:k}}}(),I.svg.Renderer=function(){var t=function(){this._svg=null,this._ctx=null,this._el=null,this._defs={gradient:{},clipping:{}}},n=t.prototype;return n.initialize=function(t,n,r,i,a){return this._el=t,e.select(t).select("svg.marks").remove(),this._svg=e.select(t).append("svg").attr("class","marks"),null!=a&&this._svg.style("background-color",a),this._ctx=this._svg.append("g"),this.resize(n,r,i)},n.resize=function(e,t,n){return this._width=e,this._height=t,this._padding=n,this._svg.attr("width",e+n.left+n.right).attr("height",t+n.top+n.bottom),this._ctx.attr("transform","translate("+n.left+","+n.top+")"),this},n.context=function(){return this._ctx},n.element=function(){return this._el},n.updateDefs=function(){var t,n,r=this._svg,i=this._defs,a=I.keys(i.gradient),s=I.keys(i.clipping),o=r.select("defs");return 0===a.length&&0==s.length?void o.remove():(o.empty()&&(o=r.insert("defs",":first-child")),t=o.selectAll("linearGradient").data(a,I.identity),t.enter().append("linearGradient").attr("id",I.identity),t.exit().remove(),t.each(function(t){var n=i.gradient[t],r=e.select(this);r.attr({x1:n.x1,x2:n.x2,y1:n.y1,y2:n.y2}),stop=r.selectAll("stop").data(n.stops),stop.enter().append("stop"),stop.exit().remove(),stop.attr("offset",function(e){return e.offset}).attr("stop-color",function(e){return e.color})}),n=o.selectAll("clipPath").data(s,I.identity),n.enter().append("clipPath").attr("id",I.identity),n.exit().remove(),void n.each(function(t){var n=i.clipping[t],r=e.select(this).selectAll("rect").data([1]);r.enter().append("rect"),r.attr("x",0).attr("y",0).attr("width",n.width).attr("height",n.height)}))},n.render=function(e,t){I.svg._cur=this,t?this.renderItems(I.array(t)):this.draw(this._ctx,e,-1),this.updateDefs(),delete I.svg._cur},n.renderItems=function(e){var t,n,r,i,a,s=I.svg.marks;for(i=0,a=e.length;a>i;++i)t=e[i],n=t._svg,r=t.mark.marktype,t=s.nested[r]?t.mark.items:t,s.update[r].call(n,t),s.style.call(n,t)},n.draw=function(e,t,n){var r=t.marktype,i=I.svg.marks.draw[r];i.call(this,e,t,n)},t}(),I.svg.Handler=function(){function t(e){var t=this;return function(n){var r=n.target,i=r.__data__;i&&(i=i.mark?i:i[0],e.call(t._obj,n,i))}}function n(e){var t=e.indexOf(".");return 0>t?e:e.slice(0,t)}var r=function(e,t){this._active=null,this._handlers={},e&&this.initialize(e),t&&this.model(t)},i=r.prototype;return i.initialize=function(t,n,r){return this._el=e.select(t).node(),this._svg=e.select(t).select("svg.marks").node(),this._padding=n,this._obj=r||null,this},i.padding=function(e){return this._padding=e,this},i.model=function(e){return arguments.length?(this._model=e,this):this._model},i.handlers=function(){var e=this._handlers;return I.keys(e).reduce(function(t,n){return e[n].reduce(function(e,t){return e.push(t),e},t)},[])},i.on=function(r,i){var a=n(r),s=this._handlers,o=e.select(this._svg).node(),l={type:r,handler:i,svg:t.call(this,i)};return s=s[a]||(s[a]=[]),s.push(l),o.addEventListener(a,l.svg),this},i.off=function(t,r){var i=n(t),a=this._handlers[i],s=e.select(this._svg).node();if(a){for(var o=a.length;--o>=0;)a[o].type===t&&(r&&a[o].handler!==r||(s.removeEventListener(i,a[o].svg),a.splice(o,1)));return this}},r}(),I.data={},I.data.ingestAll=function(e){return I.isTree(e)?l(I.data.ingestTree(e[0],e.children)):e.map(I.data.ingest)},I.data.ingest=function(e,t){return{data:e,index:t}},I.data.ingestTree=function(e,t,n){var r,i,a=I.data.ingest(e,n||0),s=e[t];if(s&&(r=s.length))for(a.values=Array(r),i=0;r>i;++i)a.values[i]=I.data.ingestTree(s[i],t,i);return a},I.data.mapper=function(e){return function(t){return t.forEach(e),t}},I.data.size=function(e,t){return e=I.isArray(e)?e:[0,e],e=e.map(function(e){return"string"==typeof e?t[e]:e})},I.data.load=function(){function t(e){if(I.config.baseURL&&!s.test(e)&&(I.startsWith(e,"/")||"/"===I.config.baseURL[I.config.baseURL.length-1]||(e="/"+e),e=I.config.baseURL+e),I.config.isNode&&I.startsWith(e,"//")&&(e=I.config.defaultProtocol+e),I.config.domainWhiteList){var t,n;if(I.config.isNode){var r=require("url").parse(e);if(I.config.safeMode&&"http:"!==r.protocol&&"https:"!==r.protocol)return!1;t=r.hostname,n=null}else{var i=document.createElement("a");i.href=e,""==i.host&&(i.href=i.href),t=i.hostname.toLowerCase(),n=window.location.hostname}if(n!==t){var a=I.config.domainWhiteList.some(function(e){var n=t.length-e.length;return e===t||n>1&&"."===t[n-1]&&t.lastIndexOf(e)===n});a||(I.error("URL is not whitelisted: "+e),e=!1)}}return e}function n(e,t){var n=I.data.load.sanitizeUrl(e);n?I.config.isNode?I.startsWith(n,o)?i(n.slice(o.length),t):a(n,t):r(n,t):t("Bad URL",null)}function r(t,n){I.log("LOAD XHR: "+t),e.xhr(t,function(e,t){t&&(t=t.responseText),n(e,t)})}function i(e,t){I.log("LOAD FILE: "+e),require("fs").readFile(e,t)}function a(e,t){I.log("LOAD HTTP: "+e);require("request")(e,function(e,n,r){e||200!==n.statusCode?t(e,null):t(null,r)})}var s=/^([A-Za-z]+:)?\/\//,o="file://";return n.sanitizeUrl=t,n}(),I.data.read=function(){function n(e,t){var n=t&&t.type||"json";return e=a[n](e,t),t&&t.parse&&r(e,t.parse),e}function r(e,t){var n=I.keys(t),r=n.map(function(e){return s[t[e]]}),a=I.isTree(e);i(a?[e]:e,n,r,a)}function i(e,t,n,i){var a,s,o,l,u;for(s=0,l=e.length;l>s;++s){for(a=e[s],o=0,u=t.length;u>o;++o)a[t[o]]=n[o](a[t[o]]);i&&a.values&&r(a,t,n,!0)}}var a={},s={number:I.number,"boolean":I.boolean,date:I.date};return a.json=function(e,t){var n=I.isObject(e)?e:JSON.parse(e);return t&&t.property&&(n=I.accessor(t.property)(n)),n},a.csv=function(t){var n=e.csv.parse(t);return n},a.tsv=function(t){var n=e.tsv.parse(t);return n},a.topojson=function(e,n){if(null==t)return I.error("TopoJSON library not loaded."),[];var r=I.isObject(e)?e:JSON.parse(e),i=[];return n&&n.feature?i=(i=r.objects[n.feature])?t.feature(r,i).features:(I.error("Invalid TopoJSON object: "+n.feature),[]):n&&n.mesh?i=(i=r.objects[n.mesh])?[t.mesh(r,r.objects[n.mesh])]:(I.error("Invalid TopoJSON object: "+n.mesh),[]):I.error("Missing TopoJSON feature or mesh parameter."),i},a.treejson=function(e,t){return e=I.isObject(e)?e:JSON.parse(e),I.tree(e,t.children)},n.formats=a,n.parse=r,n}(),I.data.aggregate=function(){function e(e){this.field=e,this.ops=[],this.flags=0,this.count=0}var t=1,n=2,r=4,a=8,s=16,o=32;return e.prototype.clone=function(){var t,n,r=new e(this.field);for(t in this)n=this[t],r[t]=I.isArray(n)?n.slice():n;return r},e.prototype.init=function(e){"sum"===e?(this.flags|=t,this.sum=0):"avg"===e?(this.flags|=n,this.avg=0):"var"===e||"std"===e?(this.flags|=r|n,this.avg=0,this.dev=0):"min"===e?(this.flags|=a,this.min=+1/0):"max"===e?(this.flags|=s,this.max=-1/0):"median"===e&&(this.flags|=o,this.vals=[]),this.ops.push(e)},e.prototype.update=function(e){var i,l=this,u=l.flags;l.count+=1,u&t&&(l.sum+=e),u&n&&(i=e-l.avg,l.avg+=i/l.count),u&r&&(l.dev+=i*(e-l.avg)),u&a&&(l.min=e<l.min?e:l.min),u&s&&(l.max=e>l.max?e:l.max),u&o&&l.vals.push(e)},e.prototype.value=function(e){switch(e){case"sum":return this.sum;case"avg":return this.avg;case"var":return this.dev/(this.count-1);case"std":return Math.sqrt(this.dev/(this.count-1));case"min":return this.min;case"max":return this.max;case"median":var t=this.vals,n=t.length,r=~~(n/2);return n?n%2?t[r]:.5*(t[r-1]+t[r]):0}},e.prototype.done=function(e){this.vals&&this.vals.sort(I.numcmp);for(var t=this.ops,n=0;n<t.length;++n)"count"===t[n]?e.count=this.count:e[t[n]+"_"+this.field]=this.value(t[n]);return e},function(){function t(e){var t=s.reduce(function(t,n){return t.push(n(e)),t},[]).join("|");return u[t]||(u[t]=n(e))}function n(e){var t=a.map(function(e){return e.clone()});for(t.data={},i=0;i<l.length;++i)t.data[l[i]]=s[i](e);return t}function r(e){var n,r,i,a,s;for(r=0;r<e.length;++r)for(a=e[r],s=t(a),i=0;i<s.length;++i)s[i].update(o[i](a));var l=[],c=0;for(n in u){for(s=u[n],r=0;r<s.length;++r)s[r].done(s.data);l.push({index:c++,data:s.data})}return u={},l}var a,s,o,l=[],u={};return r.fields=function(t){var n={};return o=[],a=I.array(t).reduce(function(t,r){var i,a=r.field;return n[a]||(o.push(I.accessor(a)),i=0===a.indexOf("data.")?a.slice(5):a,t.push(n[a]=new e(i))),n[a].init(r.op),t},[]),r},r.groupby=function(e){return l=I.array(e),s=l.map(function(e,t){return 0===e.indexOf("data.")&&(l[t]=e.slice(5)),I.accessor(e)}),r},r}}(),I.data.array=function(){function e(e){return e.map(function(e){for(var n=[],r=0,i=t.length;i>r;++r)n.push(t[r](e));return n})}var t=[];return e.fields=function(n){return t=I.array(n).map(I.accessor),e},e},I.data.bin=function(){function e(e){var t={min:null!=i?i:+1/0,max:null!=a?a:-1/0,step:null!=s?s:null,maxbins:o};(null==i||null==a)&&e.forEach(function(e){var r=n(e);null==i&&r>t.max&&(t.max=r),null==a&&r<t.min&&(t.min=r)});var l=I.bins(t);return e.forEach(function(e){var t=n(e);r(e,l.start+l.step*~~((t-l.start)/l.step))}),e}var t,n,r,i=void 0,a=void 0,s=void 0,o=20,l="bin";return e.min=function(t){return i=t,e},e.max=function(t){return a=t,e},e.step=function(t){return s=t,e},e.maxbins=function(t){return o=t,e},e.field=function(r){return t=r,n=I.accessor(r),e},e.output=function(t){return l=t,r=I.mutator(t),e},e},I.data.copy=function(){var e=I.accessor("data"),t=[],n=null,r=I.data.mapper(function(r){var i,a,s=e(r),o=n||t;for(i=0,a=t.length;a>i;++i)r[o[i]]=s[t[i]];return r});return r.from=function(t){return e=I.accessor(t),r},r.fields=function(e){return t=I.array(e),r},r.as=function(e){return n=I.array(e),r},r},I.data.cross=function(){function e(e){var i,a,s,o=[],l=t||e,u=e.length;for(a=0;u>a;++a)for(s=0;u>s;++s)n&&a===s||(i={},i[r.left]=e[a],i[r.right]=l[s],o.push(i));return o}var t=null,n=!1,r={left:"a",right:"b"};return e["with"]=function(n){return t=n,e},e.diagonal=function(t){return n=!t,e},e.output=function(t){return I.keys(r).forEach(function(e){void 0!==t[e]&&(r[e]=t[e])}),e},e},I.data.facet=function(){function e(e){var r,i,a,s,o,l,u,c={key:"",keys:[],values:[]},d={},f=c.values;if(0===t.length)return f.push(r={key:"",keys:[],index:0,values:n?e.slice():e}),n&&n(r.values),c;for(o=0,s=e.length;s>o;++o){for(l=0,i=[],a="";l<t.length;++l)u=t[l](e[o]),i.push(u),a+=(l>0?"|":"")+String(u);r=d[a],void 0===r&&f.push(r=d[a]={key:a,keys:i,index:f.length,values:[]}),r.values.push(e[o])}if(n)for(o=0,s=f.length;s>o;++o)n(f[o].values);return c}var t=[],n=null;return e.keys=function(n){return t=I.array(n).map(I.accessor),e},e.sort=function(t){return n=I.data.sort().by(t),e},e},I.data.filter=function(){function e(e){return t?e.filter(t):e}var t=null;return e.test=function(n){return t=I.isFunction(n)?n:I.parse.expr(n),e},e},I.data.flatten=function(){function e(e){return t(e,[])}function t(e,n){if(e.values)for(var r=0,i=e.values.length;i>r;++r)t(e.values[r],n);else n.push(e);return n}return e},I.data.fold=function(){function e(e){var i,a,s,o,l=[],u=t.length;for(a=0,o=e.length;o>a;++a)for(i=e[a],s=0;u>s;++s){var c={index:l.length,data:i.data};c[r.key]=t[s],c[r.value]=n[s](i),l.push(c)}return l}var t=[],n=[],r={key:"key",value:"value"};return e.fields=function(r){return t=I.array(r),n=t.map(I.accessor),e},e.output=function(t){return I.keys(r).forEach(function(e){void 0!==t[e]&&(r[e]=t[e])}),e},e},I.data.force=function(){function t(e,t,i){n.size(I.data.size(l,i)).nodes(e),r&&t[r]&&n.links(t[r]),n.start();for(var a=0;o>a;++a)n.tick();return n.stop(),e}var n=e.layout.force(),r=null,i=20,a=1,s=-30,o=500,l=["width","height"],u=["friction","theta","gravity","alpha"];return t.links=function(e){return r=e,t},t.size=function(e){return l=e,t},t.linkDistance=function(e){return i="number"==typeof e?e:I.accessor(e),n.linkDistance(i),t},t.linkStrength=function(e){return a="number"==typeof e?e:I.accessor(e),n.linkStrength(a),t},t.charge=function(e){return s="number"==typeof e?e:I.accessor(e),n.charge(s),t},t.iterations=function(e){return o=e,t},u.forEach(function(e){t[e]=function(r){return n[e](r),t}}),t},I.data.force.dependencies=["links"],I.data.formula=function(){return function(){var e,t=null,n=I.identity,r=I.data.mapper(function(r,i,a){return t&&e(r,n.call(null,r,i,a)),r});return r.field=function(n){return t=n,e=I.mutator(t),r},r.expr=function(e){return n=I.isFunction(e)?e:I.parse.expr(e),r},r}}(),I.data.geo=function(){function t(){var t={},r="mercator",i=e.geo[r](),a=I.identity,s=I.identity,o={x:"x",y:"y"},l=I.data.mapper(function(e){var t=[s(e),a(e)],n=i(t);return e[o.x]=n[0],e[o.y]=n[1],e});return l.func=function(){return i},l.projection=function(n){if(r!==n){r=n,i=e.geo[r]();for(var a in t)i[a](t[a])}return l},n.forEach(function(e){l[e]=function(n){return t[e]=n,i[e](n),l}}),l.lon=function(e){return s=I.accessor(e),l},l.lat=function(e){return a=I.accessor(e),l},l.output=function(e){return I.keys(o).forEach(function(t){void 0!==e[t]&&(o[t]=e[t])}),e},l}var n=["center","scale","translate","rotate","precision","clipAngle"];return t.params=n,t}(),I.data.geopath=function(){var t=e.geo.path().projection(e.geo.mercator()),n="mercator",r=I.identity,i={},a={path:"path"},s=I.data.mapper(function(e){return e[a.path]=t(r(e)),e});return s.projection=function(r){if(n!==r){n=r;var a=e.geo[n]();for(var o in i)a[o](i[o]);t.projection(a)}return s},I.data.geo.params.forEach(function(e){s[e]=function(n){return i[e]=n,t.projection()[e](n),s}}),s.value=function(e){return r=I.accessor(e),s},s.output=function(e){return I.keys(a).forEach(function(t){void 0!==e[t]&&(a[t]=e[t])}),e},s},I.data.link=function(){function e(e){var t=s(e),n=o(e);return"M"+t.x+","+t.y+"L"+n.x+","+n.y}function t(e){var t=s(e),n=o(e),r=n.x-t.x,i=n.y-t.y,a=l*(r+i),u=l*(i-r);return"M"+t.x+","+t.y+"C"+(t.x+a)+","+(t.y+u)+" "+(n.x+u)+","+(n.y-a)+" "+n.x+","+n.y}function n(e){var t=s(e),n=o(e),r=(t.x+n.x)/2;return"M"+t.x+","+t.y+"C"+r+","+t.y+" "+r+","+n.y+" "+n.x+","+n.y}function r(e){var t=s(e),n=o(e),r=(t.y+n.y)/2;return"M"+t.x+","+t.y+"C"+t.x+","+r+" "+n.x+","+r+" "+n.x+","+n.y}function i(e){var t=c[a];return e.forEach(function(e){e[u.path]=t(e)}),e}var a="line",s=I.accessor("source"),o=I.accessor("target"),l=.2,u={path:"path"},c={line:e,curve:t,diagonal:n,diagonalX:n,diagonalY:r};return i.shape=function(e){return a=e,i},i.tension=function(e){return l=e,i},i.source=function(e){return s=I.accessor(e),i},i.target=function(e){return o=I.accessor(e),i},i.output=function(e){return I.keys(u).forEach(function(t){void 0!==e[t]&&(u[t]=e[t])}),i},i},I.data.pie=function(){function t(t){var n=t.map(function(e){return+r(e)}),l=i,u=(a-i)/e.sum(n),c=e.range(t.length);return s&&c.sort(function(e,t){return n[e]-n[t]}),c.forEach(function(e){var r;t[e].value=r=n[e],t[e][o.startAngle]=l,t[e][o.midAngle]=l+.5*r*u,t[e][o.endAngle]=l+=r*u}),t}var n=function(){return 1},r=n,i=0,a=2*Math.PI,s=!1,o={startAngle:"startAngle",endAngle:"endAngle",midAngle:"midAngle"};return t.sort=function(e){return s=e,t},t.value=function(e){return r=e?I.accessor(e):n,t},t.startAngle=function(e){return i=Math.PI*e/180,t},t.endAngle=function(e){return a=Math.PI*e/180,t},t.output=function(e){return I.keys(o).forEach(function(t){void 0!==e[t]&&(o[t]=e[t])}),t},t},I.data.slice=function(){function e(e){if(e=I.values(e),"min"===t)e=[e[I.minIndex(e,n)]];else if("max"===t)e=[e[I.maxIndex(e,n)]];else if("median"===t){var r=e.slice().sort(function(e,t){return e=n(e),t=n(t),t>e?-1:e>t?1:0});e=[e[~~(r.length/2)]]}else{var i=I.array(t);e=e.slice(i[0],i[1])}return e}var t=null,n=I.accessor("data");return e.by=function(n){return t=n,e},e.field=function(t){return n=I.accessor(t),e},e},I.data.sort=function(){function e(e){e=I.isArray(e)?e:e.values||[],e.sort(t);for(var n=0,r=e.length;r>n;++n)e[n].index=n;return e}var t=null;return e.by=function(n){return t=I.comparator(n),e},e},I.data.stack=function(){function t(e){var t=o.y0,i=o.y1,a=o.cy,s=n(e);return 0===s.length?e:(r.out(function(e,n,r){e.datum&&(e.datum[t]=n,e.datum[i]=r+n,e.datum[a]=n+r/2)})(s),e)}function n(e){var t,n,r,s,o,l,u,c,d=I.values(e),f=[],h=[];if(0===d.length)return h;for(n=0,r=d.length;r>n;++n){for(t=I.values(d[n]),s=0,o=t.length;o>s;++s)f.push({x:i(t[s]),y:a(t[s]),z:n,datum:t[s]});h.push([])}for(f.sort(function(e,t){return e.x<t.x?-1:e.x>t.x?1:e.z<t.z?-1:e.z>t.z?1:0}),c=f[0].x,n=0,s=0,l=0,r=f.length;r>l;++l){if(u=f[l],u.x!==c){for(;n<h.length;)h[n++].push({x:s,y:0});c=u.x,n=0,s+=1}for(;u.z>n;)h[n++].push({x:s,y:0});u.x=s,h[n++].push(u)}for(;n<h.length;)h[n++].push({x:s,y:0});return h}var r=e.layout.stack(),i=I.accessor("index"),a=I.accessor("data"),s=["offset","order"],o={y0:"y2",y1:"y",cy:"cy"};return t.point=function(e){return i=I.accessor(e),t},t.height=function(e){return a=I.accessor(e),t},s.forEach(function(e){t[e]=function(n){return r[e](n),t}}),t.output=function(n){return e.keys(o).forEach(function(e){void 0!==n[e]&&(o[e]=n[e])}),t},t},I.data.stats=function(){function e(e){var t,s,o,l,u=+1/0,c=-1/0,d=0,f=0,h=0,p=(I.isArray(e)?e:e.values||[]).map(n);for(t=0,s=p.length;s>t;++t)o=p[t],u>o&&(u=o),o>c&&(c=o),d+=o,l=o-f,f+=l/(t+1),h+=l*(o-f);h/=s-1;var g=I.isArray(e)?{}:e;if(i&&(p.sort(I.numcmp),t=p.length>>1,g[a.median]=p.length%2?p[t]:(p[t-1]+p[t])/2),g[a.count]=s,g[a.min]=u,g[a.max]=c,g[a.sum]=d,g[a.mean]=f,g[a.variance]=h,g[a.stdev]=Math.sqrt(h),r){for(p=I.isArray(e)?e:e.values,o={},o[a.count]=s,o[a.min]=u,o[a.max]=c,o[a.sum]=d,o[a.mean]=f,o[a.variance]=h,o[a.stdev]=Math.sqrt(h),i&&(o[a.median]=g[a.median]),t=0,s=p.length;s>t;++t)p[t].stats=o;I.isArray(e)&&(g=p)}return g}function t(t){return I.isArray(t)?e(t):(t.values||[]).map(e)}var n=I.accessor("data"),r=!1,i=!1,a={count:"count",min:"min",max:"max",sum:"sum",mean:"mean",variance:"variance",stdev:"stdev",median:"median"};return t.median=function(e){return i=e||!1,t},t.value=function(e){return n=I.accessor(e),t},t.assign=function(e){return r=e,t},t.output=function(e){return I.keys(a).forEach(function(t){void 0!==e[t]&&(a[t]=e[t])}),t},t},I.data.treemap=function(){function t(e,t,a){e=n.size(I.data.size(i,a)).value(r).nodes(I.isTree(e)?e:{values:e});var o=I.keys(s),l=o.length;return e.forEach(function(e){for(var t,n,r=0;l>r;++r)t=o[r],t!==s[t]&&(n=e[t],delete e[t],e[s[t]]=n)}),e}var n=e.layout.treemap().children(function(e){return e.values}),r=I.accessor("data"),i=["width","height"],a=["round","sticky","ratio","padding"],s={x:"x",y:"y",dx:"width",dy:"height"};return t.size=function(e){return i=e,t},t.value=function(e){return r=I.accessor(e),t},a.forEach(function(e){t[e]=function(r){return n[e](r),t}}),t.output=function(e){return I.keys(s).forEach(function(t){void 0!==e[t]&&(s[t]=e[t])}),t},t},I.data.truncate=function(){var e,t=I.accessor("data"),n="truncate",r="right",i="...",a=!0,s=100,o=I.data.mapper(function(n){var o=I.truncate(t(n),s,r,a,i);return e(n,o),n});return o.value=function(e){return t=I.accessor(e),o},o.output=function(t){return n=t,e=I.mutator(t),o},o.limit=function(e){return s=+e,o},o.position=function(e){return r=e,o},o.ellipsis=function(e){return i=e+"",o},o.wordbreak=function(e){return a=!!e,o},o},I.data.unique=function(){function e(e){return I.unique(e,t).map(function(e){var t={};return t[n]=e,t})}var t=null,n="field";return e.field=function(n){return t=I.accessor(n),e},e.as=function(t){return n=t,e},e},I.data.window=function(){function e(e){e=I.isArray(e)?e:e.values||[];var r,i,a,s=[],o=e.length-t;for(r=0;o>=r;r+=n){for(i=0,a=[];t>i;++i)a.push(e[r+i]);s.push({key:r,values:a})}return{values:s}}var t=2,n=1;return e.size=function(n){return t=n,e},e.step=function(t){return n=t,e},e},I.data.wordcloud=function(){function t(e,t,o){function u(t){var r,i,s,o,u,c=n.size(),d=c[0]/2,f=c[1]/2,h=I.keys(l),p=h.length;for(e.sort(function(e,t){return a(t)-a(e)}),s=0,o=t.length;o>s;++s)for(i=e[s],u=0;p>u;++u)r=h[u],i[l[r]]=t[s][r],"x"===r&&(i[l.x]+=d),"y"===r&&(i[l.y]+=f)}return n.size(I.data.size(i,o)).text(r).fontSize(a).rotate(s).words(e).on("end",u).start(),e}var n=e.layout.cloud().size([900,500]),r=I.accessor("data"),i=["width","height"],a=function(){return 14},s=function(){return 0},o=["font","fontStyle","fontWeight","padding"],l={x:"x",y:"y",size:"fontSize",font:"font",rotate:"angle"};return t.text=function(e){return r=I.accessor(e),t},t.size=function(e){return i=e,t},t.fontSize=function(e){return a=I.accessor(e),t},t.rotate=function(e){var n;return I.isObject(e)&&!Array.isArray(e)?void 0!==e.random?(n=(n=e.random)?I.array(n):[0],s=function(){return n[~~(Math.random()*n.length-1e-5)]}):void 0!==e.alternate&&(n=(n=e.alternate)?I.array(n):[0],s=function(e,t){return n[t%n.length]}):s=I.accessor(field),t},o.forEach(function(e){t[e]=function(r){return n[e](r),t}}),t.output=function(e){return I.keys(l).forEach(function(t){void 0!==e[t]&&(l[t]=e[t])}),t},t},I.data.zip=function(){function e(e,s){var o,l,u,c,d,f=s[t],h=f.length;for(a&&(d={},f.forEach(function(e){d[a(e)]=e})),u=0,c=e.length;c>u;++u)l=e[u],l[n]=d?null!=(o=d[r(l)])?o:i:f[u%h];return e}var t=null,n="zip",r=I.accessor("data"),i=void 0,a=null;return e["with"]=function(n){return t=n,e},e["default"]=function(t){return i=t,e},e.as=function(t){return n=t,e},e.key=function(t){return r=I.accessor(t),e},e.withKey=function(t){return a=I.accessor(t),e},e},I.data.zip.dependencies=["with"],I.expression={},I.expression.parse=function(e,t){return U.parse("("+e+")",t)},I.expression.code=function(e){return N(e)};var F={NaN:"NaN",E:"Math.E",LN2:"Math.LN2",LN10:"Math.LN10",LOG2E:"Math.LOG2E",LOG10E:"Math.LOG10E",PI:"Math.PI",SQRT1_2:"Math.SQRT1_2",SQRT2:"Math.SQRT2"},D=function(e){function t(t,n,r,i){var a=e(n[0]);return r&&(a=r+"("+a+")",I.startsWith(r,"new ")&&(a="("+a+")")),a+"."+t+(0>i?"":0===i?"()":"("+n.slice(1).map(e).join(",")+")")}var n="new Date",r="String",i="RegExp";return{isNaN:"isNaN",isFinite:"isFinite",abs:"Math.abs",acos:"Math.acos",asin:"Math.asin",atan:"Math.atan",atan2:"Math.atan2",ceil:"Math.ceil",cos:"Math.cos",exp:"Math.exp",floor:"Math.floor",log:"Math.log",max:"Math.max",min:"Math.min",pow:"Math.pow",random:"Math.random",round:"Math.round",sin:"Math.sin",sqrt:"Math.sqrt",tan:"Math.tan",now:"Date.now",datetime:"new Date",date:function(e){return t("getDate",e,n,0)},day:function(e){return t("getDay",e,n,0)},year:function(e){return t("getFullYear",e,n,0)},month:function(e){return t("getMonth",e,n,0)},hours:function(e){return t("getHours",e,n,0)},minutes:function(e){return t("getMinutes",e,n,0)},seconds:function(e){return t("getSeconds",e,n,0)},milliseconds:function(e){return t("getMilliseconds",e,n,0)},time:function(e){return t("getTime",e,n,0)},timezoneoffset:function(e){return t("getTimezoneOffset",e,n,0)},utcdate:function(e){return t("getUTCDate",e,n,0)},utcday:function(e){return t("getUTCDay",e,n,0)},utcyear:function(e){return t("getUTCFullYear",e,n,0)},utcmonth:function(e){return t("getUTCMonth",e,n,0)},utchours:function(e){return t("getUTCHours",e,n,0)},utcminutes:function(e){return t("getUTCMinutes",e,n,0)},utcseconds:function(e){return t("getUTCSeconds",e,n,0)},utcmilliseconds:function(e){return t("getUTCMilliseconds",e,n,0)},parseFloat:"parseFloat",parseInt:"parseInt",length:function(e){return t("length",e,null,-1)},upper:function(e){return t("toUpperCase",e,r,0)},lower:function(e){return t("toLowerCase",e,r,0)},slice:function(e){return t("slice",e,r)},substring:function(e){return t("substring",e,r)},test:function(e){return t("test",e,i)},"if":function(t){if(t.length<3)throw new Error("Missing arguments to if function.");if(t.length>3)throw new Error("Too many arguments to if function.");var n=t.map(e);return n[0]+"?"+n[1]+":"+n[2]}}},N=function(e){function t(e){if(e instanceof String)return e;var t=o[e.type];if(null==t)throw new Error("Unsupported type: "+e.type);return t(e)}e=e||{};var n=e.constants||F,r=(e.functions||D)(t),i=e.idWhiteList?I.toMap(e.idWhiteList):null,a=e.idBlackList?I.toMap(e.idBlackList):null,s=0,o={Literal:function(e){return e.raw},Identifier:function(e){var t=e.name;if(s>0)return t;if(n.hasOwnProperty(t))return n[t];if(i){if(i.hasOwnProperty(t))return t;throw new Error("Illegal identifier: "+t)}if(a&&a.hasOwnProperty(t))throw new Error("Illegal identifier: "+t);return t},Program:function(e){return e.body.map(t).join("\n")},MemberExpression:function(e){var n=!e.computed,r=t(e.object);n&&(s+=1);var i=t(e.property);return n&&(s-=1),r+(n?"."+i:"["+i+"]")},CallExpression:function(e){if("Identifier"!==e.callee.type)throw new Error("Illegal callee type: "+e.callee.type);var n=e.callee.name,i=e.arguments,a=r.hasOwnProperty(n)&&r[n];if(!a)throw new Error("Unrecognized function: "+n);return a instanceof Function?a(i):a+"("+i.map(t).join(",")+")"},ArrayExpression:function(e){return"["+e.elements.map(t).join(",")+"]"},BinaryExpression:function(e){return"("+t(e.left)+e.operator+t(e.right)+")"},UnaryExpression:function(e){return"("+e.operator+t(e.argument)+")"},UpdateExpression:function(e){return"("+(prefix?e.operator+t(e.argument):t(e.argument)+e.operator)+")"},ConditionalExpression:function(e){return"("+t(e.test)+"?"+t(e.consequent)+":"+t(e.alternate)+")"},LogicalExpression:function(e){return"("+t(e.left)+e.operator+t(e.right)+")"},ObjectExpression:function(e){return"{"+e.properties.map(t).join(",")+"}"},Property:function(e){s+=1;var n=t(e.key);return s-=1,n+":"+t(e.value)},ExpressionStatement:function(e){return t(e.expression)}};return t},U=function(){"use strict";function e(e,t){if(!e)throw new Error("ASSERT: "+t)}function t(e){return e>=48&&57>=e}function n(e){return"0123456789abcdefABCDEF".indexOf(e)>=0}function r(e){return"01234567".indexOf(e)>=0}function i(e){return 32===e||9===e||11===e||12===e||160===e||e>=5760&&[5760,6158,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279].indexOf(e)>=0
}function a(e){return 10===e||13===e||8232===e||8233===e}function s(e){return 36===e||95===e||e>=65&&90>=e||e>=97&&122>=e||92===e||e>=128&&St.NonAsciiIdentifierStart.test(String.fromCharCode(e))}function o(e){return 36===e||95===e||e>=65&&90>=e||e>=97&&122>=e||e>=48&&57>=e||92===e||e>=128&&St.NonAsciiIdentifierPart.test(String.fromCharCode(e))}function l(e){switch(e){case"class":case"enum":case"export":case"extends":case"import":case"super":return!0;default:return!1}}function u(e){switch(e){case"implements":case"interface":case"package":case"private":case"protected":case"public":case"static":case"yield":case"let":return!0;default:return!1}}function c(e){if(Et&&u(e))return!0;switch(e.length){case 2:return"if"===e||"in"===e||"do"===e;case 3:return"var"===e||"for"===e||"new"===e||"try"===e||"let"===e;case 4:return"this"===e||"else"===e||"case"===e||"void"===e||"with"===e||"enum"===e;case 5:return"while"===e||"break"===e||"catch"===e||"throw"===e||"const"===e||"yield"===e||"class"===e||"super"===e;case 6:return"return"===e||"typeof"===e||"delete"===e||"switch"===e||"export"===e||"import"===e;case 7:return"default"===e||"finally"===e||"extends"===e;case 8:return"function"===e||"continue"===e||"debugger"===e;case 10:return"instanceof"===e;default:return!1}}function d(){var e,t;for(t=0===Lt;It>Lt;)if(e=Ct.charCodeAt(Lt),i(e))++Lt;else{if(!a(e))break;++Lt,13===e&&10===Ct.charCodeAt(Lt)&&++Lt,++At,Mt=Lt,t=!0}}function f(e){var t,r,i,a=0;for(r="u"===e?4:2,t=0;r>t;++t){if(!(It>Lt&&n(Ct[Lt])))return"";i=Ct[Lt++],a=16*a+"0123456789abcdef".indexOf(i.toLowerCase())}return String.fromCharCode(a)}function h(){var e,t,r,i;for(e=Ct[Lt],t=0,"}"===e&&j({},_t.UnexpectedToken,"ILLEGAL");It>Lt&&(e=Ct[Lt++],n(e));)t=16*t+"0123456789abcdef".indexOf(e.toLowerCase());return(t>1114111||"}"!==e)&&j({},_t.UnexpectedToken,"ILLEGAL"),65535>=t?String.fromCharCode(t):(r=(t-65536>>10)+55296,i=(t-65536&1023)+56320,String.fromCharCode(r,i))}function p(){var e,t;for(e=Ct.charCodeAt(Lt++),t=String.fromCharCode(e),92===e&&(117!==Ct.charCodeAt(Lt)&&j({},_t.UnexpectedToken,"ILLEGAL"),++Lt,e=f("u"),e&&"\\"!==e&&s(e.charCodeAt(0))||j({},_t.UnexpectedToken,"ILLEGAL"),t=e);It>Lt&&(e=Ct.charCodeAt(Lt),o(e));)++Lt,t+=String.fromCharCode(e),92===e&&(t=t.substr(0,t.length-1),117!==Ct.charCodeAt(Lt)&&j({},_t.UnexpectedToken,"ILLEGAL"),++Lt,e=f("u"),e&&"\\"!==e&&o(e.charCodeAt(0))||j({},_t.UnexpectedToken,"ILLEGAL"),t+=e);return t}function g(){var e,t;for(e=Lt++;It>Lt;){if(t=Ct.charCodeAt(Lt),92===t)return Lt=e,p();if(!o(t))break;++Lt}return Ct.slice(e,Lt)}function m(){var e,t,n;return e=Lt,t=92===Ct.charCodeAt(Lt)?p():g(),n=1===t.length?xt.Identifier:c(t)?xt.Keyword:"null"===t?xt.NullLiteral:"true"===t||"false"===t?xt.BooleanLiteral:xt.Identifier,{type:n,value:t,lineNumber:At,lineStart:Mt,start:e,end:Lt}}function v(){var e,t,n,r,i=Lt,a=Ct.charCodeAt(Lt),s=Ct[Lt];switch(a){case 46:case 40:case 41:case 59:case 44:case 123:case 125:case 91:case 93:case 58:case 63:case 126:return++Lt,Ot.tokenize&&(40===a?Ot.openParenToken=Ot.tokens.length:123===a&&(Ot.openCurlyToken=Ot.tokens.length)),{type:xt.Punctuator,value:String.fromCharCode(a),lineNumber:At,lineStart:Mt,start:i,end:Lt};default:if(e=Ct.charCodeAt(Lt+1),61===e)switch(a){case 43:case 45:case 47:case 60:case 62:case 94:case 124:case 37:case 38:case 42:return Lt+=2,{type:xt.Punctuator,value:String.fromCharCode(a)+String.fromCharCode(e),lineNumber:At,lineStart:Mt,start:i,end:Lt};case 33:case 61:return Lt+=2,61===Ct.charCodeAt(Lt)&&++Lt,{type:xt.Punctuator,value:Ct.slice(i,Lt),lineNumber:At,lineStart:Mt,start:i,end:Lt}}}return r=Ct.substr(Lt,4),">>>="===r?(Lt+=4,{type:xt.Punctuator,value:r,lineNumber:At,lineStart:Mt,start:i,end:Lt}):(n=r.substr(0,3),">>>"===n||"<<="===n||">>="===n?(Lt+=3,{type:xt.Punctuator,value:n,lineNumber:At,lineStart:Mt,start:i,end:Lt}):(t=n.substr(0,2),s===t[1]&&"+-<>&|".indexOf(s)>=0||"=>"===t?(Lt+=2,{type:xt.Punctuator,value:t,lineNumber:At,lineStart:Mt,start:i,end:Lt}):"<>=!+-*%&|^/".indexOf(s)>=0?(++Lt,{type:xt.Punctuator,value:s,lineNumber:At,lineStart:Mt,start:i,end:Lt}):void j({},_t.UnexpectedToken,"ILLEGAL")))}function y(e){for(var t="";It>Lt&&n(Ct[Lt]);)t+=Ct[Lt++];return 0===t.length&&j({},_t.UnexpectedToken,"ILLEGAL"),s(Ct.charCodeAt(Lt))&&j({},_t.UnexpectedToken,"ILLEGAL"),{type:xt.NumericLiteral,value:parseInt("0x"+t,16),lineNumber:At,lineStart:Mt,start:e,end:Lt}}function x(e){for(var n="0"+Ct[Lt++];It>Lt&&r(Ct[Lt]);)n+=Ct[Lt++];return(s(Ct.charCodeAt(Lt))||t(Ct.charCodeAt(Lt)))&&j({},_t.UnexpectedToken,"ILLEGAL"),{type:xt.NumericLiteral,value:parseInt(n,8),octal:!0,lineNumber:At,lineStart:Mt,start:e,end:Lt}}function b(){var n,i,a;if(a=Ct[Lt],e(t(a.charCodeAt(0))||"."===a,"Numeric literal must start with a decimal digit or a decimal point"),i=Lt,n="","."!==a){if(n=Ct[Lt++],a=Ct[Lt],"0"===n){if("x"===a||"X"===a)return++Lt,y(i);if(r(a))return x(i);a&&t(a.charCodeAt(0))&&j({},_t.UnexpectedToken,"ILLEGAL")}for(;t(Ct.charCodeAt(Lt));)n+=Ct[Lt++];a=Ct[Lt]}if("."===a){for(n+=Ct[Lt++];t(Ct.charCodeAt(Lt));)n+=Ct[Lt++];a=Ct[Lt]}if("e"===a||"E"===a)if(n+=Ct[Lt++],a=Ct[Lt],("+"===a||"-"===a)&&(n+=Ct[Lt++]),t(Ct.charCodeAt(Lt)))for(;t(Ct.charCodeAt(Lt));)n+=Ct[Lt++];else j({},_t.UnexpectedToken,"ILLEGAL");return s(Ct.charCodeAt(Lt))&&j({},_t.UnexpectedToken,"ILLEGAL"),{type:xt.NumericLiteral,value:parseFloat(n),lineNumber:At,lineStart:Mt,start:i,end:Lt}}function k(){var t,n,i,s,o,l,u,c,d="",p=!1;for(u=At,c=Mt,t=Ct[Lt],e("'"===t||'"'===t,"String literal must starts with a quote"),n=Lt,++Lt;It>Lt;){if(i=Ct[Lt++],i===t){t="";break}if("\\"===i)if(i=Ct[Lt++],i&&a(i.charCodeAt(0)))++At,"\r"===i&&"\n"===Ct[Lt]&&++Lt,Mt=Lt;else switch(i){case"u":case"x":"{"===Ct[Lt]?(++Lt,d+=h()):(l=Lt,o=f(i),o?d+=o:(Lt=l,d+=i));break;case"n":d+="\n";break;case"r":d+="\r";break;case"t":d+="	";break;case"b":d+="\b";break;case"f":d+="\f";break;case"v":d+="";break;default:r(i)?(s="01234567".indexOf(i),0!==s&&(p=!0),It>Lt&&r(Ct[Lt])&&(p=!0,s=8*s+"01234567".indexOf(Ct[Lt++]),"0123".indexOf(i)>=0&&It>Lt&&r(Ct[Lt])&&(s=8*s+"01234567".indexOf(Ct[Lt++]))),d+=String.fromCharCode(s)):d+=i}else{if(a(i.charCodeAt(0)))break;d+=i}}return""!==t&&j({},_t.UnexpectedToken,"ILLEGAL"),{type:xt.StringLiteral,value:d,octal:p,startLineNumber:u,startLineStart:c,lineNumber:At,lineStart:Mt,start:n,end:Lt}}function w(e,t){var n,r=e;t.indexOf("u")>=0&&(r=r.replace(/\\u\{([0-9a-fA-F]+)\}/g,function(e,t){return parseInt(t,16)<=1114111?"x":void j({},_t.InvalidRegExp)}).replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,"x"));try{n=new RegExp(r)}catch(i){j({},_t.InvalidRegExp)}try{return new RegExp(e,t)}catch(a){return null}}function _(){var t,n,r,i,s;for(t=Ct[Lt],e("/"===t,"Regular expression literal must start with a slash"),n=Ct[Lt++],r=!1,i=!1;It>Lt;)if(t=Ct[Lt++],n+=t,"\\"===t)t=Ct[Lt++],a(t.charCodeAt(0))&&j({},_t.UnterminatedRegExp),n+=t;else if(a(t.charCodeAt(0)))j({},_t.UnterminatedRegExp);else if(r)"]"===t&&(r=!1);else{if("/"===t){i=!0;break}"["===t&&(r=!0)}return i||j({},_t.UnterminatedRegExp),s=n.substr(1,n.length-2),{value:s,literal:n}}function S(){var e,t,n,r;for(t="",n="";It>Lt&&(e=Ct[Lt],o(e.charCodeAt(0)));)if(++Lt,"\\"===e&&It>Lt)if(e=Ct[Lt],"u"===e){if(++Lt,r=Lt,e=f("u"))for(n+=e,t+="\\u";Lt>r;++r)t+=Ct[r];else Lt=r,n+="u",t+="\\u";R({},_t.UnexpectedToken,"ILLEGAL")}else t+="\\",R({},_t.UnexpectedToken,"ILLEGAL");else n+=e,t+=e;return{value:n,literal:t}}function C(){var e,t,n,r;return Pt=null,d(),e=Lt,t=_(),n=S(),r=w(t.value,n.value),Ot.tokenize?{type:xt.RegularExpression,value:r,regex:{pattern:t.value,flags:n.value},lineNumber:At,lineStart:Mt,start:e,end:Lt}:{literal:t.literal+n.literal,value:r,regex:{pattern:t.value,flags:n.value},start:e,end:Lt}}function E(){var e,t,n,r;return d(),e=Lt,t={start:{line:At,column:Lt-Mt}},n=C(),t.end={line:At,column:Lt-Mt},Ot.tokenize||(Ot.tokens.length>0&&(r=Ot.tokens[Ot.tokens.length-1],r.range[0]===e&&"Punctuator"===r.type&&("/"===r.value||"/="===r.value)&&Ot.tokens.pop()),Ot.tokens.push({type:"RegularExpression",value:n.literal,regex:n.regex,range:[e,Lt],loc:t})),n}function L(e){return e.type===xt.Identifier||e.type===xt.Keyword||e.type===xt.BooleanLiteral||e.type===xt.NullLiteral}function A(){var e,t;if(e=Ot.tokens[Ot.tokens.length-1],!e)return E();if("Punctuator"===e.type){if("]"===e.value)return v();if(")"===e.value)return t=Ot.tokens[Ot.openParenToken-1],!t||"Keyword"!==t.type||"if"!==t.value&&"while"!==t.value&&"for"!==t.value&&"with"!==t.value?v():E();if("}"===e.value){if(Ot.tokens[Ot.openCurlyToken-3]&&"Keyword"===Ot.tokens[Ot.openCurlyToken-3].type){if(t=Ot.tokens[Ot.openCurlyToken-4],!t)return v()}else{if(!Ot.tokens[Ot.openCurlyToken-4]||"Keyword"!==Ot.tokens[Ot.openCurlyToken-4].type)return v();if(t=Ot.tokens[Ot.openCurlyToken-5],!t)return E()}return v()}return E()}return"Keyword"===e.type&&"this"!==e.value?E():v()}function M(){var e;return d(),Lt>=It?{type:xt.EOF,lineNumber:At,lineStart:Mt,start:Lt,end:Lt}:(e=Ct.charCodeAt(Lt),s(e)?m():40===e||41===e||59===e?v():39===e||34===e?k():46===e?t(Ct.charCodeAt(Lt+1))?b():v():t(e)?b():Ot.tokenize&&47===e?A():v())}function I(){var e,t,n,r;return d(),e={start:{line:At,column:Lt-Mt}},t=M(),e.end={line:At,column:Lt-Mt},t.type!==xt.EOF&&(n=Ct.slice(t.start,t.end),r={type:bt[t.type],value:n,range:[t.start,t.end],loc:e},t.regex&&(r.regex={pattern:t.regex.pattern,flags:t.regex.flags}),Ot.tokens.push(r)),t}function P(){var e;return e=Pt,Lt=e.end,At=e.lineNumber,Mt=e.lineStart,Pt="undefined"!=typeof Ot.tokens?I():M(),Lt=e.end,At=e.lineNumber,Mt=e.lineStart,e}function z(){var e,t,n;e=Lt,t=At,n=Mt,Pt="undefined"!=typeof Ot.tokens?I():M(),Lt=e,At=t,Mt=n}function O(){this.line=At,this.column=Lt-Mt}function T(){this.start=new O,this.end=null}function F(e){this.start=e.type===xt.StringLiteral?{line:e.startLineNumber,column:e.start-e.startLineStart}:{line:e.lineNumber,column:e.start-e.lineStart},this.end=null}function D(){Lt=Pt.start,Pt.type===xt.StringLiteral?(At=Pt.startLineNumber,Mt=Pt.startLineStart):(At=Pt.lineNumber,Mt=Pt.lineStart),Ot.range&&(this.range=[Lt,0]),Ot.loc&&(this.loc=new T)}function N(e){Ot.range&&(this.range=[e.start,0]),Ot.loc&&(this.loc=new F(e))}function U(){var e,t,n,r;return e=Lt,t=At,n=Mt,d(),r=At!==t,Lt=e,At=t,Mt=n,r}function j(t,n){var r,i=Array.prototype.slice.call(arguments,2),a=n.replace(/%(\d)/g,function(t,n){return e(n<i.length,"Message reference must be in range"),i[n]});throw"number"==typeof t.lineNumber?(r=new Error("Line "+t.lineNumber+": "+a),r.index=t.start,r.lineNumber=t.lineNumber,r.column=t.start-Mt+1):(r=new Error("Line "+At+": "+a),r.index=Lt,r.lineNumber=At,r.column=Lt-Mt+1),r.description=a,r}function R(){try{j.apply(null,arguments)}catch(e){if(!Ot.errors)throw e;Ot.errors.push(e)}}function W(e){if(e.type===xt.EOF&&j(e,_t.UnexpectedEOS),e.type===xt.NumericLiteral&&j(e,_t.UnexpectedNumber),e.type===xt.StringLiteral&&j(e,_t.UnexpectedString),e.type===xt.Identifier&&j(e,_t.UnexpectedIdentifier),e.type===xt.Keyword){if(l(e.value))j(e,_t.UnexpectedReserved);else if(Et&&u(e.value))return void R(e,_t.StrictReservedWord);j(e,_t.UnexpectedToken,e.value)}j(e,_t.UnexpectedToken,e.value)}function B(e){var t=P();(t.type!==xt.Punctuator||t.value!==e)&&W(t)}function V(e){if(Ot.errors){var t=Pt;t.type!==xt.Punctuator&&t.value!==e?R(t,_t.UnexpectedToken,t.value):P()}else B(e)}function q(e){return Pt.type===xt.Punctuator&&Pt.value===e}function G(e){return Pt.type===xt.Keyword&&Pt.value===e}function K(){var e;return 59===Ct.charCodeAt(Lt)||q(";")?void P():(e=At,d(),void(At===e&&(Pt.type===xt.EOF||q("}")||W(Pt))))}function H(){var e=[],t=new D;for(B("[");!q("]");)q(",")?(P(),e.push(null)):(e.push(ut()),q("]")||B(","));return P(),t.finishArrayExpression(e)}function $(){var e,t=new D;return e=P(),e.type===xt.StringLiteral||e.type===xt.NumericLiteral?(Et&&e.octal&&R(e,_t.StrictOctalLiteral),t.finishLiteral(e)):t.finishIdentifier(e.value)}function X(){var e,t,n,r,i=new D;return e=Pt,e.type===xt.Identifier?(n=$(),B(":"),r=ut(),i.finishProperty("init",n,r)):e.type!==xt.EOF&&e.type!==xt.Punctuator?(t=$(),B(":"),r=ut(),i.finishProperty("init",t,r)):void W(e)}function Q(){var e,t,n,r,i=[],a={},s=String,o=new D;for(B("{");!q("}");)e=X(),t=e.key.type===kt.Identifier?e.key.name:s(e.key.value),r="init"===e.kind?wt.Data:"get"===e.kind?wt.Get:wt.Set,n="$"+t,Object.prototype.hasOwnProperty.call(a,n)?(a[n]===wt.Data?Et&&r===wt.Data?R({},_t.StrictDuplicateProperty):r!==wt.Data&&R({},_t.AccessorDataProperty):r===wt.Data?R({},_t.AccessorDataProperty):a[n]&r&&R({},_t.AccessorGetSet),a[n]|=r):a[n]=r,i.push(e),q("}")||V(",");return B("}"),o.finishObjectExpression(i)}function J(){var e;return B("("),++zt.parenthesisCount,e=ct(),B(")"),e}function Z(){var e,t,n,r;if(q("("))return J();if(q("["))return H();if(q("{"))return Q();if(e=Pt.type,r=new D,e===xt.Identifier||Tt[Pt.value])n=r.finishIdentifier(P().value);else if(e===xt.StringLiteral||e===xt.NumericLiteral)Et&&Pt.octal&&R(Pt,_t.StrictOctalLiteral),n=r.finishLiteral(P());else{if(e===xt.Keyword)throw new Error("Disabled.");e===xt.BooleanLiteral?(t=P(),t.value="true"===t.value,n=r.finishLiteral(t)):e===xt.NullLiteral?(t=P(),t.value=null,n=r.finishLiteral(t)):q("/")||q("/=")?(n=r.finishLiteral("undefined"!=typeof Ot.tokens?E():C()),z()):W(P())}return n}function Y(){var e=[];if(B("("),!q(")"))for(;It>Lt&&(e.push(ut()),!q(")"));)V(",");return B(")"),e}function et(){var e,t=new D;return e=P(),L(e)||W(e),t.finishIdentifier(e.value)}function tt(){return B("."),et()}function nt(){var e;return B("["),e=ct(),B("]"),e}function rt(){var e,t,n,r,i=zt.allowIn;for(r=Pt,zt.allowIn=!0,e=Z();;)if(q("."))n=tt(),e=new N(r).finishMemberExpression(".",e,n);else if(q("("))t=Y(),e=new N(r).finishCallExpression(e,t);else{if(!q("["))break;n=nt(),e=new N(r).finishMemberExpression("[",e,n)}return zt.allowIn=i,e}function it(){var e;if(e=rt(),Pt.type===xt.Punctuator&&(q("++")||q("--"))&&!U())throw new Error("Disabled.");return e}function at(){var e,t,n;if(Pt.type!==xt.Punctuator&&Pt.type!==xt.Keyword)t=it();else{if(q("++")||q("--"))throw new Error("Disabled.");if(q("+")||q("-")||q("~")||q("!"))n=Pt,e=P(),t=at(),t=new N(n).finishUnaryExpression(e.value,t);else{if(G("delete")||G("void")||G("typeof"))throw new Error("Disabled.");t=it()}}return t}function st(e,t){var n=0;if(e.type!==xt.Punctuator&&e.type!==xt.Keyword)return 0;switch(e.value){case"||":n=1;break;case"&&":n=2;break;case"|":n=3;break;case"^":n=4;break;case"&":n=5;break;case"==":case"!=":case"===":case"!==":n=6;break;case"<":case">":case"<=":case">=":case"instanceof":n=7;break;case"in":n=t?7:0;break;case"<<":case">>":case">>>":n=8;break;case"+":case"-":n=9;break;case"*":case"/":case"%":n=11}return n}function ot(){var e,t,n,r,i,a,s,o,l,u;if(e=Pt,l=at(),r=Pt,i=st(r,zt.allowIn),0===i)return l;for(r.prec=i,P(),t=[e,Pt],s=at(),a=[l,r,s];(i=st(Pt,zt.allowIn))>0;){for(;a.length>2&&i<=a[a.length-2].prec;)s=a.pop(),o=a.pop().value,l=a.pop(),t.pop(),n=new N(t[t.length-1]).finishBinaryExpression(o,l,s),a.push(n);r=P(),r.prec=i,a.push(r),t.push(Pt),n=at(),a.push(n)}for(u=a.length-1,n=a[u],t.pop();u>1;)n=new N(t.pop()).finishBinaryExpression(a[u-1].value,a[u-2],n),u-=2;return n}function lt(){var e,t,n,r,i;return i=Pt,e=ot(),q("?")&&(P(),t=zt.allowIn,zt.allowIn=!0,n=ut(),zt.allowIn=t,B(":"),r=ut(),e=new N(i).finishConditionalExpression(e,n,r)),e}function ut(){var e,t,n,r;return e=zt.parenthesisCount,r=Pt,t=Pt,n=lt()}function ct(){var e;if(e=ut(),q(","))throw new Error("Disabled.");return e}function dt(e){var t=ct();return K(),e.finishExpressionStatement(t)}function ft(){var e,t,n=Pt.type;if(n===xt.EOF&&W(Pt),n===xt.Punctuator&&"{"===Pt.value)throw new Error("Disabled.");if(t=new D,n===xt.Punctuator)switch(Pt.value){case";":throw new Error("Disabled.");case"(":return dt(t)}else if(n===xt.Keyword)throw new Error("Disabled.");return e=ct(),K(),t.finishExpressionStatement(e)}function ht(){if(Pt.type===xt.Keyword)switch(Pt.value){case"const":case"let":throw new Error("Disabled.");case"function":throw new Error("Disabled.");default:return ft()}return Pt.type!==xt.EOF?ft():void 0}function pt(){for(var e,t,n,r,i=[];It>Lt&&(t=Pt,t.type===xt.StringLiteral)&&(e=ht(),i.push(e),e.expression.type===kt.Literal);)n=Ct.slice(t.start+1,t.end-1),"use strict"===n?(Et=!0,r&&R(r,_t.StrictOctalLiteral)):!r&&t.octal&&(r=t);for(;It>Lt&&(e=ht(),"undefined"!=typeof e);)i.push(e);return i}function gt(){var e,t;return d(),z(),t=new D,Et=!0,e=pt(),t.finishProgram(e)}function mt(){var e,t,n,r=[];for(e=0;e<Ot.tokens.length;++e)t=Ot.tokens[e],n={type:t.type,value:t.value},t.regex&&(n.regex={pattern:t.regex.pattern,flags:t.regex.flags}),Ot.range&&(n.range=t.range),Ot.loc&&(n.loc=t.loc),r.push(n);Ot.tokens=r}function vt(e,t){var n,r;n=String,"string"==typeof e||e instanceof String||(e=n(e)),Ct=e,Lt=0,At=Ct.length>0?1:0,Mt=0,It=Ct.length,Pt=null,zt={allowIn:!0,labelSet:{},inFunctionBody:!1,inIteration:!1,inSwitch:!1,lastCommentStart:-1},Ot={},t=t||{},t.tokens=!0,Ot.tokens=[],Ot.tokenize=!0,Ot.openParenToken=-1,Ot.openCurlyToken=-1,Ot.range="boolean"==typeof t.range&&t.range,Ot.loc="boolean"==typeof t.loc&&t.loc,"boolean"==typeof t.tolerant&&t.tolerant&&(Ot.errors=[]);try{if(z(),Pt.type===xt.EOF)return Ot.tokens;for(P();Pt.type!==xt.EOF;)try{P()}catch(i){if(Ot.errors){Ot.errors.push(i);break}throw i}mt(),r=Ot.tokens,"undefined"!=typeof Ot.errors&&(r.errors=Ot.errors)}catch(a){throw a}finally{Ot={}}return r}function yt(e,t){var n,r;r=String,"string"==typeof e||e instanceof String||(e=r(e)),Ct=e,Lt=0,At=Ct.length>0?1:0,Mt=0,It=Ct.length,Pt=null,zt={allowIn:!0,labelSet:{},parenthesisCount:0,inFunctionBody:!1,inIteration:!1,inSwitch:!1,lastCommentStart:-1},Ot={},"undefined"!=typeof t&&(Ot.range="boolean"==typeof t.range&&t.range,Ot.loc="boolean"==typeof t.loc&&t.loc,Ot.loc&&null!==t.source&&void 0!==t.source&&(Ot.source=r(t.source)),"boolean"==typeof t.tokens&&t.tokens&&(Ot.tokens=[]),"boolean"==typeof t.tolerant&&t.tolerant&&(Ot.errors=[]));try{n=gt(),"undefined"!=typeof Ot.tokens&&(mt(),n.tokens=Ot.tokens),"undefined"!=typeof Ot.errors&&(n.errors=Ot.errors)}catch(i){throw i}finally{Ot={}}return n}var xt,bt,kt,wt,_t,St,Ct,Et,Lt,At,Mt,It,Pt,zt,Ot;xt={BooleanLiteral:1,EOF:2,Identifier:3,Keyword:4,NullLiteral:5,NumericLiteral:6,Punctuator:7,StringLiteral:8,RegularExpression:9},bt={},bt[xt.BooleanLiteral]="Boolean",bt[xt.EOF]="<end>",bt[xt.Identifier]="Identifier",bt[xt.Keyword]="Keyword",bt[xt.NullLiteral]="Null",bt[xt.NumericLiteral]="Numeric",bt[xt.Punctuator]="Punctuator",bt[xt.StringLiteral]="String",bt[xt.RegularExpression]="RegularExpression",kt={AssignmentExpression:"AssignmentExpression",ArrayExpression:"ArrayExpression",BinaryExpression:"BinaryExpression",CallExpression:"CallExpression",ConditionalExpression:"ConditionalExpression",ExpressionStatement:"ExpressionStatement",Identifier:"Identifier",Literal:"Literal",LogicalExpression:"LogicalExpression",MemberExpression:"MemberExpression",ObjectExpression:"ObjectExpression",Program:"Program",Property:"Property",UnaryExpression:"UnaryExpression",UpdateExpression:"UpdateExpression"},wt={Data:1,Get:2,Set:4},_t={UnexpectedToken:"Unexpected token %0",UnexpectedNumber:"Unexpected number",UnexpectedString:"Unexpected string",UnexpectedIdentifier:"Unexpected identifier",UnexpectedReserved:"Unexpected reserved word",UnexpectedEOS:"Unexpected end of input",NewlineAfterThrow:"Illegal newline after throw",InvalidRegExp:"Invalid regular expression",UnterminatedRegExp:"Invalid regular expression: missing /",InvalidLHSInAssignment:"Invalid left-hand side in assignment",InvalidLHSInForIn:"Invalid left-hand side in for-in",MultipleDefaultsInSwitch:"More than one default clause in switch statement",NoCatchOrFinally:"Missing catch or finally after try",UnknownLabel:"Undefined label '%0'",Redeclaration:"%0 '%1' has already been declared",IllegalContinue:"Illegal continue statement",IllegalBreak:"Illegal break statement",IllegalReturn:"Illegal return statement",StrictModeWith:"Strict mode code may not include a with statement",StrictCatchVariable:"Catch variable may not be eval or arguments in strict mode",StrictVarName:"Variable name may not be eval or arguments in strict mode",StrictParamName:"Parameter name eval or arguments is not allowed in strict mode",StrictParamDupe:"Strict mode function may not have duplicate parameter names",StrictFunctionName:"Function name may not be eval or arguments in strict mode",StrictOctalLiteral:"Octal literals are not allowed in strict mode.",StrictDelete:"Delete of an unqualified identifier in strict mode.",StrictDuplicateProperty:"Duplicate data property in object literal not allowed in strict mode",AccessorDataProperty:"Object literal may not have data and accessor property with the same name",AccessorGetSet:"Object literal may not have multiple get/set accessors with the same name",StrictLHSAssignment:"Assignment to eval or arguments is not allowed in strict mode",StrictLHSPostfix:"Postfix increment/decrement may not have eval or arguments operand in strict mode",StrictLHSPrefix:"Prefix increment/decrement may not have eval or arguments operand in strict mode",StrictReservedWord:"Use of future reserved word in strict mode"},St={NonAsciiIdentifierStart:new RegExp("[ªµºÀ-ÖØ-öø-ˁˆ-ˑˠ-ˤˬˮͰ-ʹͶͷͺ-ͽͿΆΈ-ΊΌΎ-ΡΣ-ϵϷ-ҁҊ-ԯԱ-Ֆՙա-ևא-תװ-ײؠ-يٮٯٱ-ۓەۥۦۮۯۺ-ۼۿܐܒ-ܯݍ-ޥޱߊ-ߪߴߵߺࠀ-ࠕࠚࠤࠨࡀ-ࡘࢠ-ࢲऄ-हऽॐक़-ॡॱ-ঀঅ-ঌএঐও-নপ-রলশ-হঽৎড়ঢ়য়-ৡৰৱਅ-ਊਏਐਓ-ਨਪ-ਰਲਲ਼ਵਸ਼ਸਹਖ਼-ੜਫ਼ੲ-ੴઅ-ઍએ-ઑઓ-નપ-રલળવ-હઽૐૠૡଅ-ଌଏଐଓ-ନପ-ରଲଳଵ-ହଽଡ଼ଢ଼ୟ-ୡୱஃஅ-ஊஎ-ஐஒ-கஙசஜஞடணதந-பம-ஹௐఅ-ఌఎ-ఐఒ-నప-హఽౘౙౠౡಅ-ಌಎ-ಐಒ-ನಪ-ಳವ-ಹಽೞೠೡೱೲഅ-ഌഎ-ഐഒ-ഺഽൎൠൡൺ-ൿඅ-ඖක-නඳ-රලව-ෆก-ะาำเ-ๆກຂຄງຈຊຍດ-ທນ-ຟມ-ຣລວສຫອ-ະາຳຽເ-ໄໆໜ-ໟༀཀ-ཇཉ-ཬྈ-ྌက-ဪဿၐ-ၕၚ-ၝၡၥၦၮ-ၰၵ-ႁႎႠ-ჅჇჍა-ჺჼ-ቈቊ-ቍቐ-ቖቘቚ-ቝበ-ኈኊ-ኍነ-ኰኲ-ኵኸ-ኾዀዂ-ዅወ-ዖዘ-ጐጒ-ጕጘ-ፚᎀ-ᎏᎠ-Ᏼᐁ-ᙬᙯ-ᙿᚁ-ᚚᚠ-ᛪᛮ-ᛸᜀ-ᜌᜎ-ᜑᜠ-ᜱᝀ-ᝑᝠ-ᝬᝮ-ᝰក-ឳៗៜᠠ-ᡷᢀ-ᢨᢪᢰ-ᣵᤀ-ᤞᥐ-ᥭᥰ-ᥴᦀ-ᦫᧁ-ᧇᨀ-ᨖᨠ-ᩔᪧᬅ-ᬳᭅ-ᭋᮃ-ᮠᮮᮯᮺ-ᯥᰀ-ᰣᱍ-ᱏᱚ-ᱽᳩ-ᳬᳮ-ᳱᳵᳶᴀ-ᶿḀ-ἕἘ-Ἕἠ-ὅὈ-Ὅὐ-ὗὙὛὝὟ-ώᾀ-ᾴᾶ-ᾼιῂ-ῄῆ-ῌῐ-ΐῖ-Ίῠ-Ῥῲ-ῴῶ-ῼⁱⁿₐ-ₜℂℇℊ-ℓℕℙ-ℝℤΩℨK-ℭℯ-ℹℼ-ℿⅅ-ⅉⅎⅠ-ↈⰀ-Ⱞⰰ-ⱞⱠ-ⳤⳫ-ⳮⳲⳳⴀ-ⴥⴧⴭⴰ-ⵧⵯⶀ-ⶖⶠ-ⶦⶨ-ⶮⶰ-ⶶⶸ-ⶾⷀ-ⷆⷈ-ⷎⷐ-ⷖⷘ-ⷞⸯ々-〇〡-〩〱-〵〸-〼ぁ-ゖゝ-ゟァ-ヺー-ヿㄅ-ㄭㄱ-ㆎㆠ-ㆺㇰ-ㇿ㐀-䶵一-鿌ꀀ-ꒌꓐ-ꓽꔀ-ꘌꘐ-ꘟꘪꘫꙀ-ꙮꙿ-ꚝꚠ-ꛯꜗ-ꜟꜢ-ꞈꞋ-ꞎꞐ-ꞭꞰꞱꟷ-ꠁꠃ-ꠅꠇ-ꠊꠌ-ꠢꡀ-ꡳꢂ-ꢳꣲ-ꣷꣻꤊ-ꤥꤰ-ꥆꥠ-ꥼꦄ-ꦲꧏꧠ-ꧤꧦ-ꧯꧺ-ꧾꨀ-ꨨꩀ-ꩂꩄ-ꩋꩠ-ꩶꩺꩾ-ꪯꪱꪵꪶꪹ-ꪽꫀꫂꫛ-ꫝꫠ-ꫪꫲ-ꫴꬁ-ꬆꬉ-ꬎꬑ-ꬖꬠ-ꬦꬨ-ꬮꬰ-ꭚꭜ-ꭟꭤꭥꯀ-ꯢ가-힣ힰ-ퟆퟋ-ퟻ豈-舘並-龎ﬀ-ﬆﬓ-ﬗיִײַ-ﬨשׁ-זּטּ-לּמּנּסּףּפּצּ-ﮱﯓ-ﴽﵐ-ﶏﶒ-ﷇﷰ-ﷻﹰ-ﹴﹶ-ﻼＡ-Ｚａ-ｚｦ-ﾾￂ-ￇￊ-ￏￒ-ￗￚ-ￜ]"),NonAsciiIdentifierPart:new RegExp("[ªµºÀ-ÖØ-öø-ˁˆ-ˑˠ-ˤˬˮ̀-ʹͶͷͺ-ͽͿΆΈ-ΊΌΎ-ΡΣ-ϵϷ-ҁ҃-҇Ҋ-ԯԱ-Ֆՙա-և֑-ׇֽֿׁׂׅׄא-תװ-ײؐ-ؚؠ-٩ٮ-ۓە-ۜ۟-۪ۨ-ۼۿܐ-݊ݍ-ޱ߀-ߵߺࠀ-࠭ࡀ-࡛ࢠ-ࢲࣤ-ॣ०-९ॱ-ঃঅ-ঌএঐও-নপ-রলশ-হ়-ৄেৈো-ৎৗড়ঢ়য়-ৣ০-ৱਁ-ਃਅ-ਊਏਐਓ-ਨਪ-ਰਲਲ਼ਵਸ਼ਸਹ਼ਾ-ੂੇੈੋ-੍ੑਖ਼-ੜਫ਼੦-ੵઁ-ઃઅ-ઍએ-ઑઓ-નપ-રલળવ-હ઼-ૅે-ૉો-્ૐૠ-ૣ૦-૯ଁ-ଃଅ-ଌଏଐଓ-ନପ-ରଲଳଵ-ହ଼-ୄେୈୋ-୍ୖୗଡ଼ଢ଼ୟ-ୣ୦-୯ୱஂஃஅ-ஊஎ-ஐஒ-கஙசஜஞடணதந-பம-ஹா-ூெ-ைொ-்ௐௗ௦-௯ఀ-ఃఅ-ఌఎ-ఐఒ-నప-హఽ-ౄె-ైొ-్ౕౖౘౙౠ-ౣ౦-౯ಁ-ಃಅ-ಌಎ-ಐಒ-ನಪ-ಳವ-ಹ಼-ೄೆ-ೈೊ-್ೕೖೞೠ-ೣ೦-೯ೱೲഁ-ഃഅ-ഌഎ-ഐഒ-ഺഽ-ൄെ-ൈൊ-ൎൗൠ-ൣ൦-൯ൺ-ൿංඃඅ-ඖක-නඳ-රලව-ෆ්ා-ුූෘ-ෟ෦-෯ෲෳก-ฺเ-๎๐-๙ກຂຄງຈຊຍດ-ທນ-ຟມ-ຣລວສຫອ-ູົ-ຽເ-ໄໆ່-ໍ໐-໙ໜ-ໟༀ༘༙༠-༩༹༵༷༾-ཇཉ-ཬཱ-྄྆-ྗྙ-ྼ࿆က-၉ၐ-ႝႠ-ჅჇჍა-ჺჼ-ቈቊ-ቍቐ-ቖቘቚ-ቝበ-ኈኊ-ኍነ-ኰኲ-ኵኸ-ኾዀዂ-ዅወ-ዖዘ-ጐጒ-ጕጘ-ፚ፝-፟ᎀ-ᎏᎠ-Ᏼᐁ-ᙬᙯ-ᙿᚁ-ᚚᚠ-ᛪᛮ-ᛸᜀ-ᜌᜎ-᜔ᜠ-᜴ᝀ-ᝓᝠ-ᝬᝮ-ᝰᝲᝳក-៓ៗៜ៝០-៩᠋-᠍᠐-᠙ᠠ-ᡷᢀ-ᢪᢰ-ᣵᤀ-ᤞᤠ-ᤫᤰ-᤻᥆-ᥭᥰ-ᥴᦀ-ᦫᦰ-ᧉ᧐-᧙ᨀ-ᨛᨠ-ᩞ᩠-᩿᩼-᪉᪐-᪙ᪧ᪰-᪽ᬀ-ᭋ᭐-᭙᭫-᭳ᮀ-᯳ᰀ-᰷᱀-᱉ᱍ-ᱽ᳐-᳔᳒-ᳶ᳸᳹ᴀ-᷵᷼-ἕἘ-Ἕἠ-ὅὈ-Ὅὐ-ὗὙὛὝὟ-ώᾀ-ᾴᾶ-ᾼιῂ-ῄῆ-ῌῐ-ΐῖ-Ίῠ-Ῥῲ-ῴῶ-ῼ‌‍‿⁀⁔ⁱⁿₐ-ₜ⃐-⃥⃜⃡-⃰ℂℇℊ-ℓℕℙ-ℝℤΩℨK-ℭℯ-ℹℼ-ℿⅅ-ⅉⅎⅠ-ↈⰀ-Ⱞⰰ-ⱞⱠ-ⳤⳫ-ⳳⴀ-ⴥⴧⴭⴰ-ⵧⵯ⵿-ⶖⶠ-ⶦⶨ-ⶮⶰ-ⶶⶸ-ⶾⷀ-ⷆⷈ-ⷎⷐ-ⷖⷘ-ⷞⷠ-ⷿⸯ々-〇〡-〯〱-〵〸-〼ぁ-ゖ゙゚ゝ-ゟァ-ヺー-ヿㄅ-ㄭㄱ-ㆎㆠ-ㆺㇰ-ㇿ㐀-䶵一-鿌ꀀ-ꒌꓐ-ꓽꔀ-ꘌꘐ-ꘫꙀ-꙯ꙴ-꙽ꙿ-ꚝꚟ-꛱ꜗ-ꜟꜢ-ꞈꞋ-ꞎꞐ-ꞭꞰꞱꟷ-ꠧꡀ-ꡳꢀ-꣄꣐-꣙꣠-ꣷꣻ꤀-꤭ꤰ-꥓ꥠ-ꥼꦀ-꧀ꧏ-꧙ꧠ-ꧾꨀ-ꨶꩀ-ꩍ꩐-꩙ꩠ-ꩶꩺ-ꫂꫛ-ꫝꫠ-ꫯꫲ-꫶ꬁ-ꬆꬉ-ꬎꬑ-ꬖꬠ-ꬦꬨ-ꬮꬰ-ꭚꭜ-ꭟꭤꭥꯀ-ꯪ꯬꯭꯰-꯹가-힣ힰ-ퟆퟋ-ퟻ豈-舘並-龎ﬀ-ﬆﬓ-ﬗיִ-ﬨשׁ-זּטּ-לּמּנּסּףּפּצּ-ﮱﯓ-ﴽﵐ-ﶏﶒ-ﷇﷰ-ﷻ︀-️︠-︭︳︴﹍-﹏ﹰ-ﹴﹶ-ﻼ０-９Ａ-Ｚ＿ａ-ｚｦ-ﾾￂ-ￇￊ-ￏￒ-ￗￚ-ￜ]")},N.prototype=D.prototype={finish:function(){Ot.range&&(this.range[1]=Lt),Ot.loc&&(this.loc.end=new O,Ot.source&&(this.loc.source=Ot.source))},finishArrayExpression:function(e){return this.type=kt.ArrayExpression,this.elements=e,this.finish(),this},finishAssignmentExpression:function(e,t,n){return this.type=kt.AssignmentExpression,this.operator=e,this.left=t,this.right=n,this.finish(),this},finishBinaryExpression:function(e,t,n){return this.type="||"===e||"&&"===e?kt.LogicalExpression:kt.BinaryExpression,this.operator=e,this.left=t,this.right=n,this.finish(),this},finishCallExpression:function(e,t){return this.type=kt.CallExpression,this.callee=e,this.arguments=t,this.finish(),this},finishConditionalExpression:function(e,t,n){return this.type=kt.ConditionalExpression,this.test=e,this.consequent=t,this.alternate=n,this.finish(),this},finishExpressionStatement:function(e){return this.type=kt.ExpressionStatement,this.expression=e,this.finish(),this},finishIdentifier:function(e){return this.type=kt.Identifier,this.name=e,this.finish(),this},finishLiteral:function(e){return this.type=kt.Literal,this.value=e.value,this.raw=Ct.slice(e.start,e.end),e.regex&&(this.regex=e.regex),this.finish(),this},finishMemberExpression:function(e,t,n){return this.type=kt.MemberExpression,this.computed="["===e,this.object=t,this.property=n,this.finish(),this},finishObjectExpression:function(e){return this.type=kt.ObjectExpression,this.properties=e,this.finish(),this},finishProgram:function(e){return this.type=kt.Program,this.body=e,this.finish(),this},finishProperty:function(e,t,n){return this.type=kt.Property,this.key=t,this.value=n,this.kind=e,this.finish(),this},finishUnaryExpression:function(e,t){return this.type="++"===e||"--"===e?kt.UpdateExpression:kt.UnaryExpression,this.operator=e,this.argument=t,this.prefix=!0,this.finish(),this}};var Tt={"if":1,"this":1};return{tokenize:vt,parse:yt}}();I.parse={},I.parse.axes=function(){function e(e,n,r){(e||[]).forEach(function(e,i){n[i]=n[i]||I.scene.axis(),t(e,i,n[i],r)})}function t(e,t,r,i){void 0!==e.scale&&r.scale(i[e.scale]),r.orient(e.orient||n[e.type]),r.offset(e.offset||0),r.layer(e.layer||"front"),r.grid(e.grid||!1),r.title(e.title||null),r.titleOffset(null!=e.titleOffset?e.titleOffset:I.config.axis.titleOffset),r.tickValues(e.values||null),r.tickFormat(e.format||null),r.tickSubdivide(e.subdivide||0),r.tickPadding(e.tickPadding||I.config.axis.padding);var a=[];if(void 0!==e.tickSize)for(var s=0;3>s;++s)a.push(e.tickSize);else{var o=I.config.axis.tickSize;a=[o,o,o]}null!=e.tickSizeMajor&&(a[0]=e.tickSizeMajor),null!=e.tickSizeMinor&&(a[1]=e.tickSizeMinor),null!=e.tickSizeEnd&&(a[2]=e.tickSizeEnd),a.length&&r.tickSize.apply(r,a),r.tickCount(e.ticks||I.config.axis.ticks);var l=e.properties;l&&l.ticks?(r.majorTickProperties(l.majorTicks?I.extend({},l.ticks,l.majorTicks):l.ticks),r.minorTickProperties(l.minorTicks?I.extend({},l.ticks,l.minorTicks):l.ticks)):(r.majorTickProperties(l&&l.majorTicks||{}),r.minorTickProperties(l&&l.minorTicks||{})),r.tickLabelProperties(l&&l.labels||{}),r.titleProperties(l&&l.title||{}),r.gridLineProperties(l&&l.grid||{}),r.domainProperties(l&&l.axis||{})}var n={x:"bottom",y:"left",top:"top",bottom:"bottom",left:"left",right:"right"};return e}(),I.parse.background=function(t){return null==t?null:e.rgb(t)+""},I.parse.data=function(e,t){function n(e){return function(n,r){n?I.error("LOADING FAILED: "+e.url):i.load[e.name]=I.data.read(r.toString(),e.format),0===--a&&t()}}function r(e){1!==u[e]&&(u[e]||(u[e]=1,(i.source[e]||[]).forEach(r),(i.deps[e]||[]).forEach(r),u[e]=2,l.push(e)))}var i={defs:e,load:{},flow:{},deps:{},source:{},sorted:null},a=0;(e||[]).forEach(function(e){if(e.url?(a+=1,I.data.load(e.url,n(e))):e.values?i.load[e.name]=I.data.read(e.values,e.format):e.source&&(i.source[e.source]||(i.source[e.source]=[])).push(e.name),e.transform){var t=I.parse.dataflow(e);i.flow[e.name]=t,t.dependencies.forEach(function(t){(i.deps[t]||(i.deps[t]=[])).push(e.name)})}});for(var s,o=(e||[]).map(I.accessor("name")),l=[],u={};o.length;)2!==u[s=o.pop()]&&r(s);return i.sorted=l.reverse(),0===a&&setTimeout(t,1),i},I.parse.dataflow=function(e){var t=(e.transform||[]).map(I.parse.transform),n=t.length?function(e,n,r){return t.reduce(function(e,t){return t(e,n,r)},e)}:I.identity;return n.transforms=t,n.dependencies=I.keys((e.transform||[]).reduce(function(e,t){var n=I.data[t.type].dependencies;return n&&n.forEach(function(n){t[n]&&(e[t[n]]=1)}),e},{})),n},I.parse.expr=function(){var e=I.expression.parse,t=I.expression.code({idWhiteList:["d","index","data"]});return function(n){var r=t(e(n));return Function("d","index","data",'"use strict"; return ('+r+");")}}(),I.parse.legends=function(){function e(e,n,r){(e||[]).forEach(function(e,i){n[i]=n[i]||I.scene.legend(),t(e,i,n[i],r)})}function t(e,t,n,r){n.size(e.size?r[e.size]:null),n.shape(e.shape?r[e.shape]:null),n.fill(e.fill?r[e.fill]:null),n.stroke(e.stroke?r[e.stroke]:null),e.orient&&n.orient(e.orient),null!=e.offset&&n.offset(e.offset),n.title(e.title||null),n.values(e.values||null),n.format(void 0!==e.format?e.format:null);var i=e.properties;n.titleProperties(i&&i.title||{}),n.labelProperties(i&&i.labels||{}),n.legendProperties(i&&i.legend||{}),n.symbolProperties(i&&i.symbols||{}),n.gradientProperties(i&&i.gradient||{})}return e}(),I.parse.mark=function(e){var t=e.properties,n=e.marks;if(I.keys(t).forEach(function(n){t[n]=I.parse.properties(e.type,t[n])}),e.delay&&(e.delay=I.parse.properties(e.type,{delay:e.delay})),e.from){var r=e.from.data,i=I.parse.dataflow(e.from);e.from=function(e,t,n){var a=I.scene.data(r?e[r]:null,n);return i(a,e,t)}}return n&&(e.marks=n.map(I.parse.mark)),e},I.parse.marks=function(e,t,n){return{type:"group",width:t,height:n,scales:e.scales||[],axes:e.axes||[],legends:e.legends||[],marks:(e.marks||[]).map(I.parse.mark)}},I.parse.padding=function(e){if(null==e)return"auto";if(I.isString(e))return"strict"===e?"strict":"auto";if(I.isObject(e))return e;var t=I.isNumber(e)?e:20;return{top:t,left:t,right:t,bottom:t}},I.parse.properties=function(){function e(e,r){var i,a,s,o,l="",u=I.keys(r),c={};for(l+="var o = trans ? {} : item;\n",i=0,a=u.length;a>i;++i)o=r[s=u[i]],l+=i>0?"\n  ":"  ",l+="o."+s+" = "+n(s,o)+";",c[s]=!0;c.x2&&(c.x?(l+="\n  if (o.x > o.x2) { var t = o.x; o.x = o.x2; o.x2 = t; };",l+="\n  o.width = (o.x2 - o.x);"):l+=c.width?"\n  o.x = (o.x2 - o.width);":"\n  o.x = o.x2;"),c.xc&&(l+=c.width?"\n  o.x = (o.xc - o.width/2);":"\n  o.x = o.xc;"),c.y2&&(c.y?(l+="\n  if (o.y > o.y2) { var t = o.y; o.y = o.y2; o.y2 = t; };",l+="\n  o.height = (o.y2 - o.y);"):l+=c.height?"\n  o.y = (o.y2 - o.height);":"\n  o.y = o.y2;"),c.yc&&(l+=c.height?"\n  o.y = (o.yc - o.height/2);":"\n  o.y = o.yc;"),t(e,c)&&(l+="\n  item.touch();"),l+="\n  if (trans) trans.interpolate(item, o);";try{return Function("item","group","trans",l)}catch(d){I.error(d),I.log(l)}}function t(e,t){return t.path||("area"===e||"line"===e)&&(t.x||t.x2||t.width||t.y||t.y2||t.height||t.tension||t.interpolate)}function n(e,t){if(null==t)return null;var n="fill"===e||"stroke"===e;if(n){if(t.c)return r("hcl",t.h,t.c,t.l);if(t.h||t.s)return r("hsl",t.h,t.s,t.l);if(t.l||t.a)return r("lab",t.l,t.a,t.b);if(t.r||t.g||t.b)return r("rgb",t.r,t.g,t.b)}if(t.template)return I.parse.template.source(t.template,"item.datum");var a="item.datum.data";if(void 0!==t.value&&(a=I.str(t.value)),null!=t.group){var s="group.datum";I.isString(t.group)&&(s=i[t.group]?"group."+t.group:"group.datum["+I.field(t.group).map(I.str).join("][")+"]")}if(null!=t.field?I.isString(t.field)?(a="item.datum["+I.field(t.field).map(I.str).join("][")+"]",null!=t.group&&(a="this.accessor("+a+")("+s+")")):a="this.accessor(group.datum["+I.field(t.field.group).map(I.str).join("][")+"])(item.datum.data)":null!=t.group&&(a=s),null!=t.scale){var o=I.isString(t.scale)?I.str(t.scale):(t.scale.group?"group":"item")+".datum["+I.str(t.scale.group||t.scale.field)+"]";o="group.scales["+o+"]",a=o+(t.band?".rangeBand()":"("+a+")")}return a="("+(null!=t.mult?I.number(t.mult)+" * ":"")+a+")"+(t.offset?" + "+I.number(t.offset):"")}function r(e,t,r,i){var a=t?n("",t):I.config.color[e][0],s=r?n("",r):I.config.color[e][1],o=i?n("",i):I.config.color[e][2];return"(this.d3."+e+"("+[a,s,o].join(",")+') + "")'}var i={width:1,height:1,"mark.group.width":1,"mark.group.height":1};return e}(),I.parse.scales=function(){function t(e,t,r,i){return(e||[]).reduce(function(e,t){var a=t.name,s=a+":prev";return e[a]=n(t,e[a],r,i),e[s]=e[s]||e[a],e},t||{})}function n(e,t,n,s){var o=r(e,t),l=o.type===d?i:a,c=u(e,s),f=I.values(s.datum);return l(e,o,c,n,f),o}function r(t,n){var r=t.type||c;if(!n||r!==n.type){var i=I.config.scale[r]||e.scale[r];i||I.error("Unrecognized scale type: "+r),(n=i()).type=n.type||r,n.scaleName=t.name}return n}function i(e,t,n,r,i){var a,l,u,c,d=!1,f=e.padding||0,h=null==e.outerPadding?f:e.outerPadding;
if(I.isObject(e.range)&&!I.isArray(e.range)&&(d=!0,c=e.range.fields||I.array(e.range),n=s(c,r,i)),l=e.sort&&!d,a=o(e,r,i,l),a&&t.domain(a),e.bandWidth){var p=e.bandWidth,g=a.length,m=n[0]||0,v=e.points?f*p:f*p*(g-1)+2*h;n=[m,m+(p*g+v)]}u="string"==typeof n[0],u||n.length>2||1===n.length||d?t.range(n):e.points&&(e.round||null==e.round)?t.rangeRoundPoints(n,f):e.points?t.rangePoints(n,f):e.round||null==e.round?t.rangeRoundBands(n,f,h):t.rangeBands(n,f,h)}function a(t,n,r,i,a){var s,u;s=t.type===g?o(t,i,a,!1):l(t,i,a),n.domain(s),"height"===t.range&&(r=r.reverse()),n[t.round&&n.rangeRound?"rangeRound":"range"](r),t.exponent&&t.type===h&&n.exponent(t.exponent),t.clamp&&n.clamp(!0),t.nice&&(t.type===p?(u=e.time[t.nice],u||I.error("Unrecognized interval: "+u),n.nice(u)):n.nice())}function s(e,t,n){return e.reduce(function(e,r){var i=I.values(t[r.data]||n),a=I.accessor(I.isString(r.field)?r.field:"data."+I.accessor(r.field.group)(n));return I.unique(i,a,e)},[])}function o(e,t,n,r){var i,a,o=e.domain;return I.isArray(o)?i=r?o.slice():o:I.isObject(o)&&(a=o.fields||I.array(o),i=s(a,t,n)),i&&r&&i.sort(I.cmp),i}function l(t,n,r){function i(t,i,a,s){var l=I.values(n[t.data]||r),u=I.array(t.field).map(function(e){return I.isString(e)?e:"data."+I.accessor(e.group)(r)});u.forEach(function(t){t=I.accessor(t),i&&(o[0]=e.min([o[0],e.min(l,t)])),a&&(o[s]=e.max([o[s],e.max(l,t)]))})}var a,s,o=[null,null];return void 0!==t.domain&&(I.isArray(t.domain)?o=t.domain.slice():I.isObject(t.domain)?(a=t.domain.fields||I.array(t.domain),a.forEach(function(e){i(e,1,1,1)})):o=t.domain),s=o.length-1,void 0!==t.domainMin&&(I.isObject(t.domainMin)?(o[0]=null,a=t.domainMin.fields||I.array(t.domainMin),a.forEach(function(e){i(e,1,0,s)})):o[0]=t.domainMin),void 0!==t.domainMax&&(I.isObject(t.domainMax)?(o[s]=null,a=t.domainMax.fields||I.array(t.domainMax),a.forEach(function(e){i(e,0,1,s)})):o[s]=t.domainMax),t.type===f||t.type===p||!t.zero&&void 0!==t.zero||(o[0]=Math.min(0,o[0]),o[s]=Math.max(0,o[s])),o}function u(e,t){var n=[null,null];if(void 0!==e.range)if("string"==typeof e.range)if(m[e.range])n=[0,t[e.range]];else{if(!I.config.range[e.range])return I.error("Unrecogized range: "+e.range),n;n=I.config.range[e.range]}else if(I.isArray(e.range))n=I.duplicate(e.range);else{if(I.isObject(e.range))return null;n=[0,e.range]}if(void 0!==e.rangeMin&&(n[0]=e.rangeMin),void 0!==e.rangeMax&&(n[n.length-1]=e.rangeMax),void 0!==e.reverse){var r=e.reverse;I.isObject(r)&&(r=I.accessor(r.field)(t.datum)),r&&(n=n.reverse())}return n}var c="linear",d="ordinal",f="log",h="pow",p="time",g="quantile",m={width:1,height:1};return t}(),I.parse.spec=function(t,n,r){function i(e){e=I.duplicate(e);var t=e.width||500,i=e.height||500,a=e.viewport||null,s={width:t,height:i,viewport:a,background:I.parse.background(e.background),padding:I.parse.padding(e.padding),marks:I.parse.marks(e,t,i),data:I.parse.data(e.data,function(){n(o)})},o=r(s)}r=r||I.ViewFactory,I.isObject(t)?i(t):e.json(t,function(e,t){e?I.error(e):i(t)})},I.parse.template=function(e){var t=I.parse.template.source(e,"d");t="var __t; return "+t+";";try{return new Function("d",t).bind(I)}catch(n){throw n.source=t,n}},I.parse.template.source=function(e,t){t=t||"obj";var n=0,r="'",i=R;return e.replace(i,function(i,a,s){return r+=e.slice(n,s).replace(B,V),n=s+i.length,a&&(r+="'\n+((__t=("+j(a,t)+"))==null?'':__t)+\n'"),i}),r+"'"};var j=function(t,n){function r(e){return e=e||"",s?(s=!1,o="String("+o+")"+e):o+=e,o}var i=t.split("|"),a=i.shift().trim(),s=!0,o=I.field(a).map(I.str).join("][");o=n+"["+o+"]";for(var l=0;l<i.length;++l){var u,c,d,f=i[l],h=null;switch((u=f.indexOf(":"))>0&&(f=f.slice(0,u),h=i[l].slice(u+1).split(",").map(function(e){return e.trim()})),f=f.trim()){case"length":r(".length");break;case"lower":r(".toLowerCase()");break;case"upper":r(".toUpperCase()");break;case"lower-locale":r(".toLocaleLowerCase()");break;case"upper-locale":r(".toLocaleUpperCase()");break;case"trim":r(".trim()");break;case"left":c=I.number(h[0]),r(".slice(0,"+c+")");break;case"right":c=I.number(h[0]),r(".slice(-"+c+")");break;case"mid":c=I.number(h[0]),d=c+I.number(h[1]),r(".slice(+"+c+","+d+")");break;case"slice":c=I.number(h[0]),r(".slice("+c+(h.length>1?","+I.number(h[1]):"")+")");break;case"truncate":c=I.number(h[0]),d=h[1],d="left"!==d&&"middle"!==d&&"center"!==d?"right":d,o="this.truncate("+r()+","+c+',"'+d+'")';break;case"number":c=K(h[0],e.format),s=!1,o="this.__formats["+c+"]("+o+")";break;case"time":c=K(h[0],e.time.format),s=!1,o="this.__formats["+c+"]("+o+")";break;default:throw Error("Unrecognized template filter: "+f)}}return o},R=/\{\{(.+?)\}\}|$/g,W={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},B=/\\|'|\r|\n|\u2028|\u2029/g,V=function(e){return"\\"+W[e]},q=[],G={},K=function(e,t){if(!("'"===e[0]&&"'"===e[e.length-1]||'"'!==e[0]&&'"'===e[e.length-1]))throw Error("Format pattern must be quoted: "+e);if(e=e.slice(1,-1),!G[e]){var n=t(e),r=q.length;q.push(n),G[e]=r}return G[e]};I.__formats=q,I.parse.transform=function(e){var t=I.data[e.type]();return I.keys(e).forEach(function(n){"type"!==n&&t[n](e[n])}),t},I.scene={},I.scene.GROUP="group",I.scene.ENTER=0,I.scene.UPDATE=1,I.scene.EXIT=2,I.scene.DEFAULT_DATA={sentinel:1},I.scene.data=function(e,t){var n=I.scene.DEFAULT_DATA;return e=I.values(e||t||[n]),e===n&&(e=[n]),e},I.scene.fontString=function(e){return(e.fontStyle?e.fontStyle+" ":"")+(e.fontVariant?e.fontVariant+" ":"")+(e.fontWeight?e.fontWeight+" ":"")+(null!=e.fontSize?e.fontSize:I.config.render.fontSize)+"px "+(e.font||I.config.render.font)},I.scene.Item=function(){function e(e){this.mark=e}var t=e.prototype;return t.hasPropertySet=function(e){var t=this.mark.def.properties;return t&&null!=t[e]},t.cousin=function(e,t){if(0===e)return this;e=e||-1;var n=this.mark,r=n.group,i=null==t?n.items.indexOf(this):t,a=r.items.indexOf(n)+e;return r.items[a].items[i]},t.sibling=function(e){if(0===e)return this;e=e||-1;var t=this.mark,n=t.items.indexOf(this)+e;return t.items[n]},t.remove=function(){var e=this,t=e.mark.items,n=t.indexOf(e);return n>=0&&(n===t.length-1?t.pop():t.splice(n,1)),e},t.touch=function(){this.pathCache&&(this.pathCache=null),this.mark.pathCache&&(this.mark.pathCache=null)},e}(),I.scene.item=function(e){return new I.scene.Item(e)},I.scene.visit=function(e,t){var n,r,i,a,s;if(t(e))return!0;var o=["items","axisItems","legendItems"];for(i=0,a=o.length;a>i;++i)if(s=e[o[i]])for(n=0,r=s.length;r>n;++n)if(I.scene.visit(s[n],t))return!0},I.scene.build=function(){function t(e,t,s,l,u){var c=I.scene.data(e.from?e.from(t,s,l):null,l);return s=n(e,s),s.items=r(e,c,s),a(e,s),e.type===o&&i(e,t,s,u),s}function n(e,t){return t=t||{},t.def=e,t.marktype=e.type,t.interactive=!(e.interactive===!1),t}function r(e,t,n){var r,i,a,o,d,f,h=s(e.key),p=n.items||[],g=[],m={};for(r=0,a=p.length;a>r;++r)o=p[r],o.status=c,h&&(m[o.key]=o);for(r=0,a=t.length;a>r;++r)d=t[r],i=r,o=h?m[i=h(d)]:p[r],f=o?!1:(o=I.scene.item(n),!0),o.status=f?l:u,o.datum=d,o.key=i,g.push(o);for(r=0,a=p.length;a>r;++r)o=p[r],o.status===c&&(o.key=h?o.key:g.length,g.splice(o.index,0,o));return g}function i(e,n,r,i){var a,s,o,l,u,c,d=r.items,f=e.marks;for(a=0,s=d.length;s>a;++a){if(c=d[a],!i&&c.scales)for(u in c.scales)u.indexOf(":prev")<0&&(c.scales[u+":prev"]=c.scales[u].copy());for(c.items=c.items||[],o=0,l=f.length;l>o;++o)c.items[o]=t(f[o],n,c.items[o],c.datum),c.items[o].group=c}}function a(t,n){if(t.duration&&(n.duration=t.duration),t.ease&&(n.ease=e.ease(t.ease)),t.delay){var r,i=n.items,a=n.group,s=i.length;for(r=0;s>r;++r)t.delay.call(this,i[r],a)}}function s(e){if(null==e)return null;var t=I.array(e).map(I.accessor);return function(e){for(var n="",r=0,i=t.length;i>r;++r)r>0&&(n+="|"),n+=String(t[r](e));return n}}var o=I.scene.GROUP,l=I.scene.ENTER,u=I.scene.UPDATE,c=I.scene.EXIT;return t}(),I.scene.bounds=function(){function t(){return w||(w=(I.config.isNode?new(require("canvas"))(1,1):e.select("body").append("canvas").attr("class","vega_hidden").attr("width",1).attr("height",1).style("display","none").node()).getContext("2d"))}function n(e,t,n){return null==t?n.set(0,0,0,0):(m(t,n),e.stroke&&0!==e.opacity&&e.strokeWidth>0&&n.expand(e.strokeWidth)),n}function r(e,t){var r=e.path?e.pathCache||(e.pathCache=g(e.path)):null;return n(e,r,t)}function i(e,t){var r=e.mark.items,e=r[0],i=e.pathCache||(e.pathCache=g(v(r)));return n(r[0],i,t)}function a(e,t){var r=e.mark.items,e=r[0],i=e.pathCache||(e.pathCache=g(y(r)));return n(r[0],i,t)}function s(e,t){var n=e.x||0,r=e.y||0,i=n+e.width||0,a=r+e.height||0;return t.set(n,r,i,a),e.stroke&&0!==e.opacity&&e.strokeWidth>0&&t.expand(e.strokeWidth),t}function o(e,t){var n=e.width||0,r=e.height||0,i=(e.x||0)-("center"===e.align?n/2:"right"===e.align?n:0),a=(e.y||0)-("middle"===e.baseline?r/2:"bottom"===e.baseline?r:0);return t.set(i,a,i+n,a+r)}function l(e,t){var n,r;return t.set(n=e.x||0,r=e.y||0,null!=e.x2?e.x2:n,null!=e.y2?e.y2:r),e.stroke&&0!==e.opacity&&e.strokeWidth>0&&t.expand(e.strokeWidth),t}function u(e,t){var n,r,i,a,s,o,l,u,c,d=e.x||0,f=e.y||0,h=e.innerRadius||0,p=e.outerRadius||0,g=(e.startAngle||0)-x,m=(e.endAngle||0)-x,v=1/0,y=-1/0,b=1/0,k=-1/0,w=[g,m],_=g-g%x;for(r=0;4>r&&m>_;++r,_+=x)w.push(_);for(r=0,i=w.length;i>r;++r)n=w[r],a=Math.cos(n),o=h*a,u=p*a,s=Math.sin(n),l=h*s,c=p*s,v=Math.min(v,o,u),y=Math.max(y,o,u),b=Math.min(b,l,c),k=Math.max(k,l,c);return t.set(d+v,f+b,d+y,f+k),e.stroke&&0!==e.opacity&&e.strokeWidth>0&&t.expand(e.strokeWidth),t}function c(e,t){var n,r,i,a,s=null!=e.size?e.size:100,o=e.x||0,l=e.y||0;switch(e.shape){case"cross":n=Math.sqrt(s/5)/2,r=3*n,t.set(o-r,l-n,o+r,l+n);break;case"diamond":a=Math.sqrt(s/(2*k)),i=a*k,t.set(o-i,l-a,o+i,l+a);break;case"square":r=Math.sqrt(s),n=r/2,t.set(o-n,l-n,o+n,l+n);break;case"triangle-down":i=Math.sqrt(s/b),a=i*b/2,t.set(o-i,l-a,o+i,l+a);break;case"triangle-up":i=Math.sqrt(s/b),a=i*b/2,t.set(o-i,l-a,o+i,l+a);break;default:n=Math.sqrt(s/Math.PI),t.set(o-n,l-n,o+n,l+n)}return e.stroke&&0!==e.opacity&&e.strokeWidth>0&&t.expand(e.strokeWidth),t}function d(e,n,r){var i,a,s=(e.x||0)+(e.dx||0),o=(e.y||0)+(e.dy||0),l=e.fontSize||I.config.render.fontSize,u=e.align,c=e.baseline,d=e.radius||0,f=t();return f.font=I.scene.fontString(e),f.textAlign=u||"left",f.textBaseline=c||"alphabetic",i=f.measureText(e.text||"").width,d&&(a=(e.theta||0)-Math.PI/2,s+=d*Math.cos(a),o+=d*Math.sin(a)),"center"===u?s-=i/2:"right"===u&&(s-=i),"top"===c?o+=l/5:"bottom"===c?o-=l:"middle"===c?o=o-l/2+l/10:o-=4*l/5,n.set(s,o,s+i,o+l),e.angle&&!r&&n.rotate(e.angle*Math.PI/180,e.x||0,e.y||0),n.expand(r?0:1)}function f(e,t,n){var r,i,a=e.axisItems||[],s=e.legendItems||[];for(r=0,i=a.length;i>r;++r)t.union(a[r].bounds);for(r=0,i=e.items.length;i>r;++r)t.union(e.items[r].bounds);if(n){for(r=0,i=s.length;i>r;++r)t.union(s[r].bounds);null!=e.width&&null!=e.height&&t.add(e.width,e.height),null!=e.x&&null!=e.y&&t.add(0,0)}return t.translate(e.x||0,e.y||0),t}function h(e,t,n){t=t||_[e.mark.marktype],e.bounds_prev||(e["bounds:prev"]=new I.Bounds);var r=e.bounds,i=e["bounds:prev"];return r&&i.clear().union(r),e.bounds=t(e,r?r.clear():new I.Bounds,n),r||i.clear().union(e.bounds),e.bounds}function p(e,t,n){t=t||e.bounds&&e.bounds.clear()||new I.Bounds;var r,i,a=e.marktype,s=_[a],o=e.items;if("area"===a||"line"===a)o.length&&(o[0].bounds=s(o[0],t));else for(r=0,i=o.length;i>r;++r)t.union(h(o[r],s,n));e.bounds=t}var g=I.canvas.path.parse,m=I.canvas.path.bounds,v=I.canvas.path.area,y=I.canvas.path.line,x=Math.PI/2,b=Math.sqrt(3),k=Math.tan(30*Math.PI/180),w=null,_={group:f,symbol:c,image:o,rect:s,rule:l,arc:u,text:d,path:r,area:i,line:a};return{mark:p,item:h,text:d,group:f}}(),I.scene.encode=function(){function e(e,r,i,a,s){return a&&s?t.call(this,e,r,i,a,s):n.call(this,e,e,r,i,a),e}function t(e,t,n,r,i){i=I.array(i);var a,s,o,l,u,c;for(a=0,s=i.length;s>a;++a)o=i[a],l=o.mark.group||null,u=o.mark.def.properties,c=u&&u[r],c&&(c.call(I,o,l,n),I.scene.bounds.item(o))}function n(e,t,n,r,o){a.call(this,e,t.items,n,r,o),t.marktype===s?i.call(this,t,n,e,r,o):I.scene.bounds.mark(t)}function r(e,t,n,r,s){i.call(this,t,n,e,r,s),a.call(this,e,t.items,n,r,s),I.scene.bounds.mark(t,null,!0)}function i(e,t,i,a,s){var o,l,u,c,d,f,h,p,g,m,v,y;for(o=0,l=e.items.length;l>o;++o)for(d=e.items[o],f=d.scales||(d.scales=t.scales?I.extend({},i.scales):i.scales),t.scales&&I.parse.scales(t.scales,f,this._data,d),t.axes&&(h=d.axes||(d.axes=[]),p=d.axisItems||(d.axisItems=[]),I.parse.axes(t.axes,h,d.scales),h.forEach(function(e,t){g=e.def(),p[t]=I.scene.build(g,this._data,p[t],null,1),p[t].group=d,n.call(this,d,d.axisItems[t],g,a)})),u=0,c=d.items.length;c>u;++u)n.call(this,d,d.items[u],t.marks[u],a,s);if(I.scene.bounds.mark(e,null,!t.legends),t.legends){for(o=0,l=e.items.length;l>o;++o)d=e.items[o],m=d.legends||(d.legends=[]),v=d.legendItems||(d.legendItems=[]),I.parse.legends(t.legends,m,d.scales),m.forEach(function(e,t){y=e.def(),v[t]=I.scene.build(y,this._data,v[t],null,1),v[t].group=d,r.call(this,d,d.legendItems[t],y,a)});I.scene.bounds.mark(e,null,!0)}}function a(e,t,n,r,i){var a,s,d,f,h=n.properties||c,p=h.enter,g=h.update,m=h.exit;if(i){if(f=h[i])for(a=0,s=t.length;s>a;++a)f.call(I,t[a],e,r)}else for(a=0;a<t.length;++a)d=t[a],d.status===o&&(p&&p.call(I,d,e),d.status=l),d.status!==u&&g&&g.call(I,d,e,r),d.status===u&&(m&&m.call(I,d,e,r),r&&!m?r.interpolate(d,c):r||t[a--].remove())}var s=I.scene.GROUP,o=I.scene.ENTER,l=I.scene.UPDATE,u=I.scene.EXIT,c={};return e}(),I.scene.Transition=function(){function t(t,n){this.duration=t||500,this.ease=n&&e.ease(n)||e.ease("cubic-in-out"),this.updates={next:null}}function n(e){for(var t,n,r,i,a,s,o=this.updates,l=o,u=l.next,c=this.duration,d=!0;null!=u;l=u,u=l.next)if(t=u.item,n=t.delay||0,r=(e-n)/c,0>r)d=!1;else{for(r>1&&(r=1),i=u.ease(r),a=0,s=u.length;s>a;++a)t[u[a].property]=u[a](i);t.touch(),I.scene.bounds.item(t),1===r?(u.remove&&t.remove(),l.next=u.next,u=l):d=!1}return this.callback(),d}var r=t.prototype,i={text:1,url:1};return r.interpolate=function(t,n){var r,a,s,o,l=null;for(r in n)a=t[r],s=n[r],a!==s&&(i[r]||void 0===a?t[r]=s:"number"!=typeof a||isFinite(a)?(o=e.interpolate(a,s),o.property=r,(l||(l=[])).push(o)):t[r]=s);return null===l&&t.status===I.scene.EXIT&&(l=[]),null!=l&&(l.item=t,l.ease=t.mark.ease||this.ease,l.next=this.updates.next,this.updates.next=l),this},r.start=function(t){for(var r=this,i=r.updates,a=i.next;null!=a;i=a,a=i.next)a.item.status===I.scene.EXIT&&(a.remove=!0);r.callback=t,e.timer(function(e){return n.call(r,e)})},t}(),I.scene.transition=function(e,t){return new I.scene.Transition(e,t)},I.scene.axis=function(){function t(){c=null}function n(){return P||("log"===s.type?".1s":null)}function r(){var t=n();return s.tickFormat?s.tickFormat(O,t):t?"time"===s.type?e.time.format(t):e.format(t):String}function i(e){var t={major:M,minor:null};return null==t.major&&(t.major=s.ticks?s.ticks(O):s.domain()),t.minor=d(s,t.major,z).map(I.data.ingest),t.major=t.major.map(function(t){return t=I.data.ingest(t),t.label=e(t.data),t}),t}function a(e){var t,n,r;"ordinal"===e.type?(t={scale:e.scaleName,offset:.5+e.rangeBand()/2},n=t):(t={scale:e.scaleName,offset:.5},n={scale:e.scaleName+":prev",offset:.5}),r=h(e);var i=x(),a=x(),s=x(),l=b(),c=w(),d=k();i.properties.enter.stroke={value:I.config.axis.gridColor},g(o,i,n,t,1/0),g(o,a,n,t,C),g(o,s,n,t,E),p(o,l,n,t,C,A),v(o,c,r,L),m(o,d,r,u),I.extend(i.properties.update,T),I.extend(a.properties.update,D),I.extend(s.properties.update,N),I.extend(l.properties.update,F),I.extend(c.properties.update,j),I.extend(d.properties.update,U);var f=[i,a,s,l,c,d];return{type:"group",interactive:!1,properties:{enter:y,update:y},marks:f.map(I.parse.mark)}}var s,o=I.config.axis.orient,l=0,u=I.config.axis.titleOffset,c=null,f="front",_=!1,S=null,C=I.config.axis.tickSize,E=I.config.axis.tickSize,L=I.config.axis.tickSize,A=I.config.axis.padding,M=null,P=null,z=0,O=I.config.axis.ticks,T={},F={},D={},N={},U={},j={},R={};return R.def=function(){var e=c?c:c=a(s),t=r(),n=i(t),u=S?[S].map(I.data.ingest):[];return e.marks[0].from=function(){return _?n.major:[]},e.marks[1].from=function(){return n.major},e.marks[2].from=function(){return n.minor},e.marks[3].from=e.marks[1].from,e.marks[4].from=function(){return[1]},e.marks[5].from=function(){return u},e.offset=l,e.orient=o,e.layer=f,e},R.scale=function(e){return arguments.length?(s!==e&&(s=e,t()),R):s},R.orient=function(e){return arguments.length?(o!==e&&(o=e in H?e+"":I.config.axis.orient,t()),R):o},R.title=function(e){return arguments.length?(S!==e&&(S=e,t()),R):S},R.tickCount=function(e){return arguments.length?(O=e,R):O},R.tickValues=function(e){return arguments.length?(M=e,R):M},R.tickFormat=function(e){return arguments.length?(P!==e&&(P=e,t()),R):P},R.tickSize=function(e,n){if(!arguments.length)return C;var r=arguments.length-1,i=+e,a=r>1?+n:C,s=r>0?+arguments[r]:C;return(C!==i||E!==a||L!==s)&&t(),C=i,E=a,L=s,R},R.tickSubdivide=function(e){return arguments.length?(z=+e,R):z},R.offset=function(e){return arguments.length?(l=I.isObject(e)?e:+e,R):l},R.tickPadding=function(e){return arguments.length?(A!==+e&&(A=+e,t()),R):A},R.titleOffset=function(e){return arguments.length?(u!==+e&&(u=+e,t()),R):u},R.layer=function(e){return arguments.length?(f!==e&&(f=e,t()),R):f},R.grid=function(e){return arguments.length?(_!==e&&(_=e,t()),R):_},R.gridLineProperties=function(e){return arguments.length?(T!==e&&(T=e),R):T},R.majorTickProperties=function(e){return arguments.length?(D!==e&&(D=e),R):D},R.minorTickProperties=function(e){return arguments.length?(N!==e&&(N=e),R):N},R.tickLabelProperties=function(e){return arguments.length?(F!==e&&(F=e),R):F},R.titleProperties=function(e){return arguments.length?(U!==e&&(U=e),R):U},R.domainProperties=function(e){return arguments.length?(j!==e&&(j=e),R):j},R.reset=function(){t()},R};var H={top:1,right:1,bottom:1,left:1},$={bottom:"center",top:"center",left:"right",right:"left"},X={bottom:"top",top:"bottom",left:"middle",right:"middle"};I.scene.legend=function(){function t(){o=null}function n(e){return"ordinal"===e||"quantize"===e||"quantile"===e||"threshold"===e}function r(t){var n,r,a,s=i(l,u,c,d),o=(null==h?t.ticks?t.ticks.apply(t,b):t.domain():h).map(I.data.ingest),g=null==p?t.tickFormat?t.tickFormat.apply(t,b):String:p,v=5,y=e.range(o.length);l?(r=o.map(function(e){return Math.sqrt(l(e.data))}),a=e.max(r),r=r.reduce(function(e,t,n,r){return n>0&&(e[n]=e[n-1]+r[n-1]/2+v),e[n]+=t/2,e},[0]).map(Math.round)):(a=Math.round(Math.sqrt(I.config.legend.symbolSize)),r=f||(n=O.fontSize)&&n.value+v||I.config.legend.labelFontSize+v,r=y.map(function(e,t){return Math.round(a/2+t*r)}));var k,w=x;m&&(k=z.fontSize,w+=5+(k&&k.value||I.config.legend.titleFontSize));for(var _=0,S=r.length;S>_;++_)r[_]+=w;var t={name:"legend",type:"ordinal",points:!0,domain:y,range:r},C=(m?[m]:[]).map(I.data.ingest);return o.forEach(function(e){e.label=g(e.data),e.offset=a}),s.scales=[t],s.marks[0].from=function(){return C},s.marks[1].from=function(){return o},s.marks[2].from=s.marks[1].from,s}function i(e,t,n,r){var i=C(),a=E(),s=L();return S(a,e,t,n,r),I.extend(i.properties.update,z),I.extend(a.properties.update,w),I.extend(s.properties.update,O),i.properties.enter.x.value+=x,i.properties.enter.y.value+=x,s.properties.enter.x.offset+=x+1,a.properties.enter.x.offset=x+1,s.properties.update.x.offset+=x+1,a.properties.update.x.offset=x+1,{type:"group",interactive:!1,properties:{enter:I.parse.properties("group",k),update:_},marks:[i,a,s].map(I.parse.mark)}}function a(e){var t=s(e),n=e.domain(),r=n.map(I.data.ingest),i=P.width&&P.width.value||I.config.legend.gradientWidth,a=null==p?e.tickFormat?e.tickFormat.apply(e,b):String:p,o={name:"legend",type:e.type,round:!0,zero:!1,domain:[n[0],n[n.length-1]],range:[x,i+x]};"pow"===e.type&&(o.exponent=e.exponent());var l=(m?[m]:[]).map(I.data.ingest);return r.forEach(function(e,t){e.label=a(e.data),e.align=t==r.length-1?"right":0==t?"left":"center"}),t.scales=[o],t.marks[0].from=function(){return l},t.marks[1].from=function(){return[1]},t.marks[2].from=function(){return r},t}function s(e){var t=C(),n=A(),r=M(),i=new I.Gradient,a=e.domain(),s=a[0],o=a[a.length-1],l=e.copy().domain([s,o]).range([0,1]),u="linear"!==e.type&&e.ticks?e.ticks.call(e,15):a;s!==u[0]&&u.unshift(s),o!==u[u.length-1]&&u.push(o);for(var c=0,d=u.length;d>c;++c)i.stop(l(u[c]),e(u[c]));n.properties.enter.fill={value:i},I.extend(t.properties.update,z),I.extend(n.properties.update,P),I.extend(r.properties.update,O);var f=n.properties,h=P.height,p=h&&h.value||f.enter.height.value;if(r.properties.enter.y.value=p,r.properties.update.y.value=p,m){var g=t.properties,v=z.fontSize,y=4+(v&&v.value||g.enter.fontSize.value);n.properties.enter.y.value+=y,r.properties.enter.y.value+=y,n.properties.update.y.value+=y,r.properties.update.y.value+=y}return t.properties.enter.x.value+=x,t.properties.enter.y.value+=x,n.properties.enter.x.value+=x,n.properties.enter.y.value+=x,r.properties.enter.y.value+=x,n.properties.update.x.value+=x,n.properties.update.y.value+=x,r.properties.update.y.value+=x,{type:"group",interactive:!1,properties:{enter:I.parse.properties("group",k),update:_},marks:[t,n,r].map(I.parse.mark)}}var o,l=null,u=null,c=null,d=null,f=null,h=null,p=null,g=null,m=void 0,v="right",y=I.config.legend.offset,x=I.config.legend.padding,b=[5],k={},w={},P={},z={},O={},T={},o=null;return T.def=function(){var t=l||u||c||d;return p=g?"time"===t.type?e.time.format(g):e.format(g):null,o||(o=t!==c&&t!==d||n(t.type)?r(t):a(t)),o.orient=v,o.offset=y,o.padding=x,o},T.size=function(e){return arguments.length?(l!==e&&(l=e,t()),T):l},T.shape=function(e){return arguments.length?(u!==e&&(u=e,t()),T):u},T.fill=function(e){return arguments.length?(c!==e&&(c=e,t()),T):c},T.stroke=function(e){return arguments.length?(d!==e&&(d=e,t()),T):d},T.title=function(e){return arguments.length?(m!==e&&(m=e,t()),T):m},T.format=function(e){return arguments.length?(g!==e&&(g=e,t()),T):g},T.spacing=function(e){return arguments.length?(f!==+e&&(f=+e,t()),T):f},T.orient=function(e){return arguments.length?(v=e in Q?e+"":I.config.legend.orient,T):v},T.offset=function(e){return arguments.length?(y=+e,T):y},T.values=function(e){return arguments.length?(h=e,T):h},T.legendProperties=function(e){return arguments.length?(k=e,T):k},T.symbolProperties=function(e){return arguments.length?(w=e,T):w},T.gradientProperties=function(e){return arguments.length?(P=e,T):P},T.labelProperties=function(e){return arguments.length?(O=e,T):O},T.titleProperties=function(e){return arguments.length?(z=e,T):z},T.reset=function(){t()},T};var Q={right:1,left:1};return I.Model=function(){function e(){this._defs=null,this._data={},this._scene=null,this._reset={axes:!1,legends:!1}}var t=e.prototype;return t.defs=function(e){return arguments.length?(this._defs=e,this):this._defs},t.data=function(e){function t(e){(o[e]||[]).forEach(function(n){a[n]=e,t(n)})}if(!arguments.length)return this._data;var n,r,i,a={},s=this._defs,o=s.data.source,u=s.data.flow||{},d=s.data.sorted,f=d.length;for(I.keys(e).forEach(t),n=0;f>n;++n){if(e[r=d[n]])i=e[r];else{if(!a[r])continue;i=c(this._data[a[r]]),I.isTree(e)&&l(i)}this._data[r]=u[r]?u[r](i,this._data,s.marks):i}return this._reset.legends=!0,this},t.width=function(e){return this._defs&&(this._defs.width=e),this._defs&&this._defs.marks&&(this._defs.marks.width=e),this._scene&&(this._scene.items[0].width=e),this._reset.axes=!0,this},t.height=function(e){return this._defs&&(this._defs.height=e),this._defs&&this._defs.marks&&(this._defs.marks.height=e),this._scene&&(this._scene.items[0].height=e),this._reset.axes=!0,this},t.scene=function(e){return arguments.length?(this._scene=e,this):this._scene},t.build=function(){var e=this,t=e._data,n=e._defs.marks;return e._scene=I.scene.build.call(e,n,t,e._scene),e._scene.items[0].width=n.width,e._scene.items[0].height=n.height,e._scene.interactive=!1,this},t.encode=function(e,t,n){this.reset();var r=this,i=r._scene,a=r._defs;return I.scene.encode.call(r,i,a.marks,e,t,n),this},t.reset=function(){return this._scene&&this._reset.axes&&(I.scene.visit(this._scene,function(e){e.axes&&e.axes.forEach(function(e){e.reset()})}),this._reset.axes=!1),this._scene&&this._reset.legends&&(I.scene.visit(this._scene,function(e){e.legends&&e.legends.forEach(function(e){e.reset()})}),this._reset.legends=!1),this},e}(),I.View=function(){var t=function(e,t,n){this._el=null,this._build=!1,this._model=new I.Model,this._width=this.__width=t||500,this._height=this.__height=n||500,this._bgcolor=null,this._autopad=1,this._padding={top:0,left:0,bottom:0,right:0},this._viewport=null,this._renderer=null,this._handler=null,this._io=I.canvas,e&&this.initialize(e)},n=t.prototype;return n.width=function(e){return arguments.length?(this.__width!==e&&(this._width=this.__width=e,this._el&&this.initialize(this._el.parentNode),this._model.width(e),this._strict&&(this._autopad=1)),this):this.__width},n.height=function(e){return arguments.length?(this.__height!==e&&(this._height=this.__height=e,this._el&&this.initialize(this._el.parentNode),this._model.height(this._height),this._strict&&(this._autopad=1)),this):this.__height},n.background=function(e){return arguments.length?(this._bgcolor!==e&&(this._bgcolor=e,this._el&&this.initialize(this._el.parentNode)),this):this._bgcolor},n.padding=function(e){return arguments.length?(this._padding!==e&&(I.isString(e)?(this._autopad=1,this._padding={top:0,left:0,bottom:0,right:0},this._strict="strict"===e):(this._autopad=0,this._padding=e,this._strict=!1),this._el&&(this._renderer.resize(this._width,this._height,e),this._handler.padding(e))),this):this._padding},n.autopad=function(e){if(this._autopad<1)return this;this._autopad=0;var t=this._padding,n=this.model().scene().bounds,r=I.config.autopadInset,i=n.x1<0?Math.ceil(-n.x1)+r:0,a=n.y1<0?Math.ceil(-n.y1)+r:0,s=n.x2>this._width?Math.ceil(+n.x2-this._width)+r:0,n=n.y2>this._height?Math.ceil(+n.y2-this._height)+r:0;return t={left:i,top:a,right:s,bottom:n},this._strict?(this._autopad=0,this._padding=t,this._width=Math.max(0,this.__width-(i+s)),this._height=Math.max(0,this.__height-(a+n)),this._model.width(this._width),this._model.height(this._height),this._el&&this.initialize(this._el.parentNode),this.update({props:"enter"}).update({props:"update"})):this.padding(t).update(e),this},n.viewport=function(e){return arguments.length?(this._viewport!==e&&(this._viewport=e,this._el&&this.initialize(this._el.parentNode)),this):this._viewport},n.renderer=function(e){return arguments.length?("canvas"===e&&(e=I.canvas),"svg"===e&&(e=I.svg),this._io!==e&&(this._io=e,this._renderer=null,this._el&&this.initialize(this._el.parentNode),this._build&&this.render()),this):this._io},n.defs=function(e){return arguments.length?(this._model.defs(e),this):this._model.defs()},n.data=function(e){if(!arguments.length)return this._model.data();var t=I.keys(e).reduce(function(t,n){return t[n]=I.data.ingestAll(e[n]),t},{});return this._model.data(t),this._build=!1,this},n.model=function(e){return arguments.length?(this._model!==e&&(this._model=e,this._handler&&this._handler.model(e)),this):this._model},n.initialize=function(t){var n,r=this,i=r._width,a=r._height,s=r._bgcolor,o=r._padding;return e.select(t).select("div.vega").remove(),this._el=t=e.select(t).append("div").attr("class","vega").style("position","relative").node(),r._viewport&&e.select(t).style("width",(r._viewport[0]||i)+"px").style("height",(r._viewport[1]||a)+"px").style("overflow","auto"),r._renderer=(r._renderer||new this._io.Renderer).initialize(t,i,a,o,s),n=r._handler,r._handler=(new this._io.Handler).initialize(t,o,r).model(r._model),n&&n.handlers().forEach(function(e){r._handler.on(e.type,e.handler)}),this},n.render=function(e){return this._renderer.render(this._model.scene(),e),this},n.on=function(){return this._handler.on.apply(this._handler,arguments),this},n.off=function(){return this._handler.off.apply(this._handler,arguments),this},n.update=function(e){e=e||{};var t=this,n=e.duration?I.scene.transition(e.duration,e.ease):null;return t._build=t._build||(t._model.build(),!0),t._model.encode(n,e.props,e.items),n?n.start(function(e){t._renderer.render(t._model.scene(),e)}):t.render(e.items),t.autopad(e)},t}(),I.ViewFactory=function(e){return function(t){t=t||{};var n=(new I.View).width(e.width).height(e.height).background(e.background).padding(e.padding).viewport(e.viewport).renderer(t.renderer||"canvas").defs(e);return e.data.load&&n.data(e.data.load),t.data&&n.data(t.data),t.el&&n.initialize(t.el),t.hover!==!1&&n.on("mouseover",function(e,t){t.hasPropertySet("hover")&&this.update({props:"hover",items:t})}).on("mouseout",function(e,t){t.hasPropertySet("hover")&&this.update({props:"update",items:t})}),n}},I.Spec=function(){var e=function(e){this.spec={width:500,height:500,padding:0,data:[],scales:[],axes:[],marks:[]},e&&I.extend(this.spec,e)},t=e.prototype;return t.width=function(e){return this.spec.width=e,this},t.height=function(e){return this.spec.height=e,this},t.padding=function(e){return this.spec.padding=e,this},t.viewport=function(e){return this.spec.viewport=e,this},t.data=function(e,t){return t?t.name=e:t=I.isString(e)?{name:e}:e,this.spec.data.push(t),this},t.scale=function(e,t){return t?t.name=e:t=I.isString(e)?{name:e}:e,this.spec.scales.push(t),this},t.axis=function(e){return this.spec.axes.push(e),this},t.mark=function(e,t){t?t.type=e:t={type:e},t.properties={},this.spec.marks.push(t);var n=this;return{from:function(e,n){return t.from=n?(n.data=e,n):I.isString(e)?{data:e}:e,this},prop:function(e,n){return t.properties[e]=I.keys(n).reduce(function(e,t){var r=n[t];return e[t]=I.isObject(r)?r:{value:r},e},{}),this},done:function(){return n}}},t.parse=function(e){I.parse.spec(this.spec,e)},t.json=function(){return this.spec},e}(),I.spec=function(e){return new I.Spec(e)},I.headless={},I.headless.canvas=I.canvas.Renderer,I.headless.svg=function(){function t(e,t,n){var r="<"+e;if(t)for(var i in t){var a=t[i];null!=a&&(r+=" "+i+'="'+a+'"')}return n&&(r+=" "+n),r+">"}function n(e){return"</"+e+">"}function r(e){return e=null==e?"":String(e),e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function i(e){return String(e).replace(/\"/g,"'")}function a(e){var r=e.width||0,i=e.height||0;return 0===r&&0===i?"":t("rect",{"class":"background",width:r,height:i},_(e,"rect"))+n("rect")}function s(e,t){var n=e.x||0,r=e.y||0,i={transform:"translate("+n+","+r+")"};if(e.clip){var a={width:e.width||0,height:e.height||0},s=e.clip_id||(e.clip_id="clip"+T++);t.clipping[s]=a,i["clip-path"]="url(#"+s+")"}return i}function o(e){var t=e.x||0,n=e.y||0;return{transform:"translate("+t+","+n+")",d:A(e)}}function l(e){if(e.length){var t=e[0],n="horizontal"===t.orient?P:M;return n.interpolate(t.interpolate||"linear").tension(null==t.tension?.7:t.tension),{d:n(e)}}}function u(e){if(e.length){var t=e[0];return z.interpolate(t.interpolate||"linear").tension(null==t.tension?.7:t.tension),{d:z(e)}}}function c(e){var t=e.x||0,n=e.y||0;return{transform:"translate("+t+","+n+")",d:e.path}}function d(e){return{x:e.x||0,y:e.y||0,width:e.width||0,height:e.height||0}}function f(e){var t=e.x||0,n=e.y||0;return{x1:t,y1:n,x2:null!=e.x2?e.x2:t,y2:null!=e.y2?e.y2:n}}function h(e){var t=e.x||0,n=e.y||0;return{transform:"translate("+t+","+n+")",d:O(e)}}function p(e){var t=e.width||e.image&&e.image.width||0,n=e.height||e.image&&e.image.height||0,r=e.x-("center"===e.align?t/2:"right"===e.align?t:0),i=e.y-("middle"===e.baseline?n/2:"bottom"===e.baseline?n:0),a=I.config.baseURL+e.url;return{"xlink:href":a,x:r,y:i,width:t,height:n}}function g(e){var t=e.x||0,n=e.y||0,r=e.dx||0,i=e.dy||0,a=e.angle||0,s=e.radius||0,o=F[e.align||"left"],l="top"===e.baseline?".9em":"middle"===e.baseline?".35em":0;if(s){var u=(e.theta||0)-Math.PI/2;t+=s*Math.cos(u),n+=s*Math.sin(u)}return{x:t+r,y:n+i,"text-anchor":o,transform:a?"rotate("+a+" "+t+","+n+")":null,dy:l?l:null}}function m(e){var t="type-"+e.type;return e.name&&(t+=" "+e.name),t}function v(e){return e.x||0}function y(e){return e.y||0}function x(e){return e.x+e.width||0
}function b(e){return e.y+e.height||0}function k(e){return null==e.size?100:e.size}function w(e){return e.shape||"circle"}function _(e,t,n){var r,i,a,s,o,l=e.mark?e:e.length?e[0]:null;if(null===l)return null;var u="";for(r=0,i=N.length;i>r;++r)a=N[r],s=D[a],o=l[a],null==o?"fill"===s&&(u+="fill:none;"):(o.id&&(n.gradient[o.id]=o,o="url("+window.location.href+"#"+o.id+")"),u+=s+":"+o+";");return"text"===t&&(u+="font:"+S(l)),u.length?'style="'+u+'"':null}function S(e){var t=(e.fontStyle?e.fontStyle+" ":"")+(e.fontVariant?e.fontVariant+" ":"")+(e.fontWeight?e.fontWeight+" ":"")+(null!=e.fontSize?e.fontSize:I.config.render.fontSize)+"px "+(e.font&&i(e.font)||I.config.render.font);return t}var C=function(){this._text={head:"",root:"",foot:"",defs:"",body:""},this._defs={gradient:{},clipping:{}}},E=C.prototype;E.initialize=function(e,r,i,a,s){var o=this._text,l={width:r,height:i};null!=s&&(l.style="background-color:"+s+";"),o.head=t("svg",l,I.config.svgNamespace),o.root=t("g",{transform:"translate("+a.left+","+a.top+")"}),o.foot=n("g")+n("svg")},E.svg=function(){var e=this._text;return e.head+e.defs+e.root+e.body+e.foot},E.buildDefs=function(){var e,r,i=this._defs,a=I.keys(i.gradient),s=I.keys(i.clipping),o="";for(e=0;e<a.length;++e){var l=a[e],u=i.gradient[l],c=u.stops;for(o+=t("linearGradient",{id:l,x1:u.x1,x2:u.x2,y1:u.y1,y2:u.y2}),r=0;r<c.length;++r)o+=t("stop",{offset:c[r].offset,"stop-color":c[r].color})+n("stop");o+=n("linearGradient")}for(e=0;e<s.length;++e){var l=s[e],u=i.clipping[l];o+=t("clipPath",{id:l}),o+=t("rect",{x:0,y:0,width:u.width,height:u.height})+n("rect"),o+=n("clipPath")}return o},E.render=function(e){this._text.body=this.draw(e),this._text.defs=this.buildDefs()},E.draw=function(e){var i,a,s=L[e.marktype],o=s[0],l=s[1],u=s[2]||!1,c=u?[e.items]:e.items,d=this._defs,f="";for(f+=t("g",{"class":m(e.def)}),i=0;i<c.length;++i)a="g"===o?null:_(c[i],o,d),f+=t(o,l(c[i],d),a),"text"===o&&(f+=r(c[i].text)),"g"===o&&(f+=this.drawGroup(c[i])),f+=n(o);return f+n("g")};var L={group:["g",s],area:["path",l,!0],line:["path",u,!0],arc:["path",o],path:["path",c],symbol:["path",h],rect:["rect",d],rule:["line",f],text:["text",g],image:["image",p]};E.drawGroup=function(e){var t,n,r="",i=e.axisItems||[],s=e.items,o=e.legendItems||[];for(r+=a(e),t=0,n=i.length;n>t;++t)"back"===i[t].def.layer&&(r+=this.draw(i[t]));for(t=0,n=s.length;n>t;++t)r+=this.draw(s[t]);for(t=0,n=i.length;n>t;++t)"back"!==i[t].def.layer&&(r+=this.draw(i[t]));for(t=0,n=o.length;n>t;++t)r+=this.draw(o[t]);return r};var A=e.svg.arc(),M=e.svg.area().x(v).y1(y).y0(b),P=e.svg.area().y(y).x0(x).x1(v),z=e.svg.line().x(v).y(y),O=e.svg.symbol().type(w).size(k),T=0,F={left:"start",center:"middle",right:"end"},D={fill:"fill",fillOpacity:"fill-opacity",stroke:"stroke",strokeWidth:"stroke-width",strokeOpacity:"stroke-opacity",strokeCap:"stroke-linecap",strokeDash:"stroke-dasharray",strokeDashOffset:"stroke-dashoffset",opacity:"opacity"},N=I.keys(D);return C}(),I.headless.View=function(){var e=function(e,t,n,r,i,a){this._canvas=null,this._type=i,this._el="body",this._build=!1,this._model=new I.Model,this._width=this.__width=e||500,this._height=this.__height=t||500,this._bgcolor=r||null,this._padding=n||{top:0,left:0,bottom:0,right:0},this._autopad=I.isString(this._padding)?1:0,this._renderer=new I.headless[i],this._viewport=a||null,this.initialize()},t=e.prototype;return t.el=function(e){return arguments.length?(this._el!==e&&(this._el=e,this.initialize()),this):this._el},t.model=function(){return this._model},t.width=function(e){return arguments.length?(this._width!==e&&(this._width=e,this.initialize(),this._model.width(e)),this):this._width},t.height=function(e){return arguments.length?(this._height!==e&&(this._height=e,this.initialize(),this._model.height(this._height)),this):this._height},t.background=function(e){return arguments.length?(this._bgcolor!==e&&(this._bgcolor=e,this.initialize()),this):this._bgcolor},t.padding=function(e){return arguments.length?(this._padding!==e&&(I.isString(e)?(this._autopad=1,this._padding={top:0,left:0,bottom:0,right:0},this._strict="strict"===e):(this._autopad=0,this._padding=e,this._strict=!1),this.initialize()),this):this._padding},t.autopad=function(e){if(this._autopad<1)return this;this._autopad=0;var t=this._padding,n=this._model.scene().bounds,r=I.config.autopadInset,i=n.x1<0?Math.ceil(-n.x1)+r:0,a=n.y1<0?Math.ceil(-n.y1)+r:0,s=n.x2>this._width?Math.ceil(+n.x2-this._width)+r:0,n=n.y2>this._height?Math.ceil(+n.y2-this._height)+r:0;return t={left:i,top:a,right:s,bottom:n},this._strict?(this._autopad=0,this._padding=t,this._width=Math.max(0,this.__width-(i+s)),this._height=Math.max(0,this.__height-(a+n)),this._model.width(this._width),this._model.height(this._height),this._el&&this.initialize(),this.update({props:"enter"}).update({props:"update"})):this.padding(t).update(e),this},t.viewport=function(e){return arguments.length?(this._viewport=e,this.initialize(),this):_viewport},t.defs=function(e){return arguments.length?(this._model.defs(e),this):this._model.defs()},t.data=function(e){if(!arguments.length)return this._model.data();var t=I.keys(e).reduce(function(t,n){return t[n]=I.data.ingestAll(e[n]),t},{});return this._model.data(t),this._build=!1,this},t.renderer=function(){return this._renderer},t.canvas=function(){return this._canvas},t.canvasAsync=function(e){function t(){0===n.pendingImages()?(r.render(),e(r._canvas)):setTimeout(t,10)}var n=this._renderer,r=this;n.pendingImages()>0?t():e(this._canvas)},t.svg=function(){return"svg"===this._type?this._renderer.svg():null},t.initialize=function(){var e=this._width,t=this._height,n=this._bgcolor,r=this._padding;return this._viewport&&(e=this._viewport[0]-(r?r.left+r.right:0),t=this._viewport[1]-(r?r.top+r.bottom:0)),"svg"===this._type?this.initSVG(e,t,r,n):this.initCanvas(e,t,r,n),this},t.initCanvas=function(e,t,n,r){var i=require("canvas"),a=e+(n?n.left+n.right:0),s=t+(n?n.top+n.bottom:0),o=this._canvas=new i(a,s),l=o.getContext("2d");l.setTransform(1,0,0,1,n.left,n.top),this._renderer.context(l),this._renderer.resize(e,t,n),this._renderer.background(r)},t.initSVG=function(e,t,n,r){var i=e+(n?n.left+n.right:0),a=t+(n?n.top+n.bottom:0);this._renderer.initialize(this._el,i,a,n,r)},t.render=function(e){return this._renderer.render(this._model.scene(),e),this},t.update=function(e){e=e||{};var t=this;return t._build=t._build||(t._model.build(),!0),t._model.encode(null,e.props,e.items),t.render(e.items),t.autopad(e)},e}(),I.headless.View.Factory=function(e){return function(t){t=t||{};var n=e.width,r=e.height,i=e.padding,a=e.background,s=e.viewport,o=t.renderer||"canvas",l=new I.headless.View(n,r,i,a,o,s).defs(e);return e.data.load&&l.data(e.data.load),t.data&&l.data(t.data),l}},I.headless.render=function(e,t){function n(n){try{var r=n({data:e.data,renderer:e.renderer}).update();"svg"===e.renderer?t(null,{svg:r.svg(),view:r}):r.canvasAsync(function(e){t(null,{canvas:e,view:r})})}catch(i){t(i,null)}}I.parse.spec(e.spec,n,I.headless.View.Factory)},I}),angular.module("voyager",["vlui","zeroclipboard","720kb.tooltips","LocalStorageModule","ngOrderObjectBy","angular-websql","Chronicle","ngCookies","ngTouch","ngSanitize","ui.router"]).constant("_",window._).constant("jQuery",window.$).constant("vl",window.vl).constant("vg",window.vg).constant("cp",window.cp).constant("tv4",window.tv4).constant("Papa",window.Papa).constant("Blob",window.Blob).constant("URL",window.URL).constant("Tether",window.Tether).constant("Drop",window.Drop).constant("dl",window.dl).config(["uiZeroclipConfigProvider",function(e){e.setZcConf({swfPath:"bower_components/zeroclipboard/dist/ZeroClipboard.swf"})}]).config(["$stateProvider","$urlRouterProvider","consts",function(e,t,n){window.vl.extend(n,{debug:!0,debugInList:!0,numInitClusters:15,numMoreClusters:9,appId:"voyager",enableExclude:!0}),e.state("home",{url:"/",templateUrl:"app/main/main.html",controller:"MainCtrl"}),t.otherwise("/")}]),angular.module("voyager").service("Visrec",["cp","vl","_","consts","Config","Dataset","Logger","Fields",function(e,t,n,r,i,a,s,o){function l(r){var s=e.gen.encodings([],r,a.stats,{data:i.getData(),config:i.getConfig()}),o=e.cluster(s).map(function(e){return e.map(function(e){e=n.cloneDeep(e),t.Encoding.toggleSort(e);var i=t.Encoding.fromSpec(e,{});return{fieldSetKey:r.key,fieldSet:r,vlSpec:e,encoding:i,shorthand:i.toShorthand(),score:e.score,scoreFeatures:e.scoreFeatures}})});return o.key=r.key,o}var u={projections:[],aggregates:{},fieldSetDict:{},fieldSets:[],fieldSetKeys:[],chartClusters:{},numClustersGenerated:0,selectedCluster:null,selectedFieldSet:null,update:{}},c={genTypeCasting:!1},d={genTypeCasting:!1,maxCardinalityForAutoAddOrdinal:null,omitDotPlot:!0},f={genTypeCasting:!1};return u.update.projections=function(n){var i=(new Date).getTime(),s=e.gen.projections(n,a.stats,{}||(0===o.selected.length?d:f)),h={},p={},g=[],m={},v=(new Date).getTime();s.forEach(function(t){var n=t.key,r=n===o.selectedPKey,i=r?c:0===o.selected.length?d:f;h[n]=e.gen.aggregates([],t,a.stats,i),h[n].forEach(function(e){p[e.key]=e,e.isExactMatch=r,g.push(e)})});var y=(new Date).getTime();u.numClustersGenerated=Math.min(r.numInitClusters,g.length);for(var x=0;x<u.numClustersGenerated;x++){var b=g[x];m[b.key]=l(b)}u.projections=s,u.aggregates=h,u.fieldSetDict=p,u.fieldSets=g,u.chartClusters=m;var k=(new Date).getTime(),w=n.filter(function(e){return e.selected});console.log("gen time – projections ",t.field.shorthands(w)," :",v-i,"aggregates:",y-v,"encodings:"+(k-y),"total:",k-i)},u.update.clusters=function(e){if(e>u.numClustersGenerated){var t=u.fieldSets,n=u.numClustersGenerated,r=u.chartClusters;e=Math.min(e,t.length);for(var i=n;e>i;i++){var a=t[i];r[a.key]=l(a)}u.numClustersGenerated=e}},u}]),angular.module("voyager").controller("MainCtrl",["$scope","$document","Chronicle","Visrec","Config","Dataset","Fields","Bookmarks","Logger","Drop","consts",function(e,t,n,r,i,a,s,o,l,u,c){e.consts=c,e.canUndo=!1,e.canRedo=!1,e.Visrec=r,e.Fields=s,e.Dataset=a,e.Config=i,e.Logger=l,e.Bookmarks=o,e.showBookmark=!1,e.hideBookmark=function(){e.showBookmark=!1},o.load(),a.update(a.dataset).then(function(){i.updateDataset(a.dataset),s.updateSchema(a.dataschema),e.chron=n.record("Fields.fields",e,!0,["Visrec.numClustersGenerated","Dataset.dataset","Dataset.dataschema","Dataset.stats","Config.config"]),e.canUndoRedo=function(){e.canUndo=e.chron.canUndo(),e.canRedo=e.chron.canRedo()},e.chron.addOnAdjustFunction(e.canUndoRedo),e.chron.addOnUndoFunction(e.canUndoRedo),e.chron.addOnRedoFunction(e.canUndoRedo),e.chron.addOnUndoFunction(function(){l.logInteraction(l.actions.UNDO)}),e.chron.addOnRedoFunction(function(){l.logInteraction(l.actions.REDO)}),angular.element(t).on("keydown",function(t){return t.keyCode!=="Z".charCodeAt(0)||!t.ctrlKey&&!t.metaKey||t.shiftKey?t.keyCode==="Y".charCodeAt(0)&&(t.ctrlKey||t.metaKey)?(e.chron.redo(),e.$digest(),!1):t.keyCode==="Z".charCodeAt(0)&&(t.ctrlKey||t.metaKey)&&t.shiftKey?(e.chron.redo(),e.$digest(),!1):void 0:(e.chron.undo(),e.$digest(),!1)})})}]),angular.module("voyager").factory("Fields",["_","Dataset","vl","cp","Logger",function(e,t,n,r,i){function a(e){e.selected=void 0,e._any=!n.field.isTypes(e,["O","N"])&&"count"!==e.aggregate,delete e._raw,delete e._aggregate,delete e._timeUnit}var s={fields:{},highlighted:{},selected:[],selectedKey:null};return s.updateSchema=function(n){n=n||t.dataschema,s.fields=e(n).reduce(function(e,t){return a(t),e[t.name]=t,e},{}),s.highlighted={}},s.update=function(){var e=s.getList();return s.selected=e.filter(function(e){return e.selected}),s.selectedPKey=r.gen.projections.key(s.selected),i.logInteraction(i.actions.FIELDS_CHANGE,{selected:s.selected,list:e}),e},s.reset=function(){e.each(s.fields,a)},s.getList=function(){var t=e.sortBy(e.values(s.fields),function(e){return n.field.order.typeThenName(e)});return t},s.setSelected=function(e,t){(s.fields[e]||{}).selected=t},s.toggleSelected=function(e){var t=s.fields[e]||{};t.selected=t.selected?void 0:!0},s.isSelected=function(e){return(s.fields[e]||{}).selected},s.setHighlight=function(e,t){s.highlighted[e]=t},t.onUpdate.push(s.updateSchema),s}]),angular.module("voyager").directive("visList",["Fields","Visrec","vl","jQuery","consts","_","Logger",function(e,t,n,r,i,a,s){return{templateUrl:"components/vislist/vislist.html",restrict:"E",replace:!0,scope:{},link:function(r,o){function l(){r.limit=i.numInitClusters,o.scrollTop(0);var n=e.update();t.update.projections(n)}r.Fields=e,r.Visrec=t,r.consts=i,r.shorthands=n.field.shorthands,r.limit=i.numInitClusters,r.increaseLimit=function(){r.limit+i.numMoreClusters>t.numClustersGenerated&&t.update.clusters(r.limit+i.numMoreClusters),r.limit+=i.numMoreClusters,s.logInteraction(s.actions.LOAD_MORE,r.limit)},r.select=function(e,n){s.logInteraction(s.actions.DRILL_DOWN_OPEN,e.key),t.selectedFieldSet=e,t.selectedCluster=n},r.isInList=function(e){return e in t.chartClusters};var u=a.debounce(l,200,{maxWait:1500});r.$watch("Fields.fields",function(e,t){t&&0!==a.keys(t).length?u():l()},!0)}}}]),angular.module("voyager").directive("functionList",["_","vl","Logger",function(e,t,n){return{templateUrl:"components/functionlist/functionlist.html",restrict:"E",scope:{field:"="},link:function(e){function r(e){return"T"===e?t.schema.timeUnits:[]}function i(e){return t.schema.aggregate.supportedEnums[e]}var a="bin",s="raw",o="count",l="AUTO";e.func={selected:l,list:[l]},e.functionChanged=function(t){var o=e.field,u=o?o.type:"";o&&(o._bin=t===a||void 0,o._aggregate=-1!==i(u).indexOf(t)?t:void 0,o._timeUnit=-1!==r(u).indexOf(t)?t:void 0,o._raw=t===s||void 0,o._any=t===l||void 0,n.logInteraction(n.actions.FUNC_CHANGE,t))},e.$watch("field",function(n){if(n){var u=n.name?n.type:"";if(t.field.isCount(n))e.func.list=[o],e.func.selected=o;else{var c="O"===u;e.func.list=(c?[s]:[l,s]).concat(r(u)).concat(i(u).filter(function(e){return e!==o})).concat("Q"===u?[a]:[]),e.func.selected=n._bin?a:n._raw?s:n._aggregate||n._timeUnit||(c?s:l)}}},!0)}}}]),angular.module("voyager").directive("encodingVariations",["Visrec","Bookmarks","consts","$document","_","Logger",function(e,t,n,r,i,a){return{templateUrl:"components/encodingvariations/encodingvariations.html",restrict:"E",replace:!0,scope:{},link:function(s){function o(e){27===e.keyCode&&(console.log("escape"),s.close(),angular.element(r).off("keydown",o))}s.Visrec=e,s.Bookmarks=t,s.consts=n,s._=i,angular.element(r).on("keydown",o),s.isInList=function(t){return e.selectedCluster&&t===e.selectedCluster.key},s.select=function(e){s.selectedSubcluster=e,a.logInteraction(a.actions.CLUSTER_SELECT,e)},s.close=function(){a.logInteraction(a.actions.DRILL_DOWN_CLOSE,e.selectedCluster.key),s.Visrec.selectedCluster=null},s.$watch("Visrec.selectedCluster",function(e){s.selectedSubcluster=e?e[0]:null})}}}]),angular.module("voyager").directive("fieldListItem",["Dataset","Fields","consts",function(e,t,n){return{templateUrl:"components/fieldlistitem/fieldlistitem.html",restrict:"E",replace:!0,scope:{field:"="},link:function(e,r){e.consts=n,e.Fields=t,e.popupContent=r.find(".popup-functions")[0]},controller:["$scope","Dataset",function(e,t){e.stats=t.stats[e.field.name]}]}}]),angular.module("voyager").directive("fieldList",["Dataset","Fields",function(e,t){return{templateUrl:"components/fieldlist/fieldlist.html",restrict:"E",scope:{},link:function(n){n.Dataset=e,n.Fields=t}}}]),angular.module("voyager").run(["$templateCache",function(e){e.put("app/main/main.html",'<div class="flex-root vflex full-width full-height"><div class="full-width no-shrink"><div class="card no-right-margin no-top-margin margin-bottom"><div class="right"><div class="controls"><span ng-show="consts.debug"><a ng-href="{{ {fields: Fields.fields} | reportUrl }}" target="_blank" class="command debug" tooltips="" tooltip-size="small" tooltip-content="Report an issue"><i class="fa fa-bug"></i></a><a class="command debug" ng-click="showDevPanel = !showDevPanel" tooltips="" tooltip-size="small" tooltip-content="Debug Tool"><i class="fa fa-wrench"></i></a></span> <a class="command" ng-click="showBookmark=true"><i class="fa fa-bookmark"></i> Bookmarks ({{Bookmarks.length}})</a> <a class="command" ng-click="chron.undo()" ng-class="{disabled: !canUndo}"><i class="fa fa-undo"></i> Undo</a> <a class="command" ng-click="chron.redo()" ng-class="{disabled: !canRedo}"><i class="fa fa-repeat"></i> Redo</a></div></div><h1>Data Voyager</h1></div><alert-messages></alert-messages></div><div class="hflex full-width main-panel grow-1"><div class="pane data-pane noselect"><div class="card abs-100 no-top-margin"><div class="right"><dataset-selector></dataset-selector></div><h2>Data</h2><field-list></field-list></div></div><div class="pane vis-list-pane"><vis-list></vis-list></div></div><div class="hflex full-width dev-panel" ng-show="showDevPanel"><div class="pane"><div class="card"><button ng-click="Logger.clear()">Clear logs</button><br><button ng-click="Logger.export()">Download logs</button></div><label><input type="checkbox" ng-model="consts.debugInList"> Show Debug In List</label></div></div></div><bookmark-list active="showBookmark" deactivate="hideBookmark();" highlighted="Fields.highlighted"></bookmark-list>'),e.put("components/encodingvariations/encodingvariations.html",'<div class="encoding-variations modal" ng-show="Visrec.selectedCluster"><div class="wrapper"><div class="vflex full-width full-height" id="evs" ng-if="Visrec.selectedCluster"><div class="encoding-variations-header modal-header no-shrink card no-top-margin no-right-margin margin-bottom"><div class="right"><a ng-click="close()" class="right">Close</a></div><div class="field-set-info no-bottom-margin"><b>Various Visualizations Showing</b><field-info ng-repeat="field in Visrec.selectedFieldSet" field="field" show-type="true" class="selected"></field-info><span ng-if="consts.debug" tooltips="" tooltip-size="small" tooltip-content="{{_.pluck(selectedSubcluster, \'shorthand\').join(\'<br/>\')}}"></span></div></div><div class="hflex flex-grow-1"><div class="selected-variation no-shrink"><vl-plot-group chart="selectedSubcluster[0]" disabled="!Visrec.selectedCluster" config-set="large" show-bookmark="true" show-debug="consts.debug && consts.debugInList" show-filter-null="true" show-log="true" show-mark-type="true" show-sort="true" show-transpose="true" always-scrollable="true" tooltip="true" priority="consts.priority.popup" class="abs-100 scroll-xy full-vl-plot-group no-top-margin"></vl-plot-group></div><div class="variations vflex flex-grow-1 scroll-y" ng-if="Visrec.selectedCluster.length > 1"><div class="full-width"><vl-plot-group ng-repeat="subcluster in Visrec.selectedCluster" ng-class="{selected: selectedSubcluster == subcluster}" chart="subcluster[0]" disabled="!subcluster || !subcluster[0]" is-in-list="isInList" show-bookmark="true" rescale="true" thumbnail="true" max-width="300" ng-click="select(subcluster)" class="row-vl-plot-group clickable" priority="consts.priority.popup + $index + 1"></vl-plot-group></div></div></div></div></div></div>'),e.put("components/fieldlist/fieldlist.html",'<div class="schema"><div class="field" ng-repeat="field in Dataset.dataschema | orderBy: Dataset.fieldOrder"><field-list-item field="field"></field-list-item></div><div class="tool"><a ng-click="Fields.reset()"><i class="fa fa-eraser"></i> Reset</a></div></div>'),e.put("components/fieldlistitem/fieldlistitem.html",'<div class="field-list-item full-width" ng-mouseover="Fields.highlighted[field.name] = true" ng-mouseout="Fields.highlighted[field.name] = false"><i class="fa selection clickable" ng-class="{\'fa-check-square\': Fields.isSelected(field.name), \'fa-square\': Fields.isSelected(field.name) === undefined, \'fa-minus-circle\': Fields.isSelected(field.name) === false}" ng-click="Fields.toggleSelected(field.name)" ng-dblclick="consts.enableExclude && Fields.setSelected(field.name, false)"></i><field-info field="field" show-type="true" show-caret="true" disable-count-or-o-caret="true" show-info="true" popup-content="popupContent" action="Fields.toggleSelected(field.name)" class="flex-grow-1 list-item clickable" ng-class="{selected: Fields.isSelected(field.name), excluded: Fields.isSelected(field.name)===false, highlighted: Fields.highlighted[field.name]}"></field-info><div class="drop-container"><div class="popup-menu popup-functions" ng-show="(field.type!==\'O\' && field.aggregate!==\'count\') || consts.enableExclude"><div style="width:150px"><function-list field="Fields.fields[field.name]"></function-list></div><div class="inclusion" ng-show="consts.enableExclude"><h4>Field</h4><div><a ng-class="{inactive: Fields.isSelected(field.name) !== true}" ng-click="Fields.setSelected(field.name, true)"><i class="fa fa-check-square"></i> Include</a></div><div><a ng-class="{inactive: Fields.isSelected(field.name) !== undefined}" ng-click="Fields.setSelected(field.name, undefined)"><i class="fa fa-square"></i> Optional</a></div><div><a ng-class="{inactive: Fields.isSelected(field.name) !== false}" ng-click="Fields.setSelected(field.name, false)"><i class="fa fa-minus-circle"></i> Exclude</a></div></div></div></div></div>'),e.put("components/functionlist/functionlist.html",'<div class="mb5" ng-if="func.list.length > 1"><h4>Functions</h4><label class="func-label field-func" ng-repeat="f in func.list"><input type="radio" ng-value="f" ng-model="func.selected" ng-change="functionChanged(f)"> {{f || \'-\'}}</label></div>'),e.put("components/vislist/vislist.html",'<div class="abs-100 scroll-y"><div class="exact-match-list" ng-if="Fields.selected.length > 0 && Visrec.aggregates[Fields.selectedPKey].length > 0"><div class="card no-top-margin vis-list-header"><span class="desc">Showing Data Variations for</span><field-info ng-repeat="(name, field) in Fields.selected" field="field" show-type="true" ng-class="{ selected: true, highlighted: (Fields.highlighted||{})[field.name] }" ng-mouseover="(Fields.highlighted||{})[field.name] = true" ng-mouseout="(Fields.highlighted||{})[field.name] = false"></field-info></div><div class="vis-list hflex flex-wrap"><vl-plot-group ng-repeat="fieldSet in Visrec.aggregates[Fields.selectedPKey]" ng-init="cluster = Visrec.chartClusters[fieldSet.key]" class="wrapped-vl-plot-group" chart="cluster[0][0]" is-in-list="isInList" field-set="fieldSet" show-bookmark="true" show-debug="consts.debug && consts.debugInList" show-expand="true" show-filter-null="true" show-sort="true" overflow="true" tooltip="true" is-selected="Fields.isSelected" highlighted="Fields.highlighted" expand-action="select(fieldSet, cluster, $index)" priority="consts.priority.vislist + $index"></vl-plot-group></div></div><div ng-if="Fields.selected.length === 0" class="card vis-list-header no-top-margin"><span class="desc">Start by looking at some univariate distributions below or select some fields with the data selector!</span></div><div ng-if="Fields.selected.length > 0" class="card vis-list-header"><span class="desc">Showing Data Variations for</span><field-info ng-repeat="(name, field) in Fields.selected" field="field" show-type="true" ng-class="{ selected: true, highlighted: (Fields.highlighted||{})[field.name] }" ng-mouseover="(Fields.highlighted||{})[field.name] = true" ng-mouseout="(Fields.highlighted||{})[field.name] = false"></field-info><span class="desc">with one additional field.</span></div><div class="vis-list hflex flex-wrap"><vl-plot-group ng-repeat="fieldSet in Visrec.fieldSets | limitTo: limit - Visrec.aggregates[Fields.selectedPKey].length" ng-init="cluster = Visrec.chartClusters[fieldSet.key]" ng-if="!fieldSet.isExactMatch" class="wrapped-vl-plot-group" chart="cluster[0][0]" is-in-list="isInList" field-set="fieldSet" is-selected="Fields.isSelected" highlighted="Fields.highlighted" show-bookmark="true" show-debug="consts.debug && consts.debugInList" show-expand="true" show-filter-null="true" show-sort="true" overflow="true" tooltip="true" expand-action="select(fieldSet, cluster, $index)"></vl-plot-group></div><encoding-variations ng-show="Visrec.selectedCluster"></encoding-variations><a ng-click="increaseLimit()"><div class="vis-list-more" ng-show="limit < Visrec.fieldSets.length">Load more...</div></a></div>')}]);